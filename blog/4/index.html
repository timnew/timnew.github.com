<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/blog/4/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '[object Object]', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-is-android-api-document-on-consumerirmanager-lying" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/" class="article-date">
  <time datetime="2014-05-28T00:00:00.000Z" itemprop="datePublished">2014-05-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/">Is Android API document on ConsumerIrManager lying?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Just found a shocking fact that Android API document on <code>ConsumerIrManger.transmit</code> method is wrong!</p>
<p>KitKat has realised its own Infrared blaster API, which is incompatible with legacy Samsung private API. So I was working on <a href="https://github.com/timnew/AndroidInfrared" target="_blank" rel="external">Android Infrared Library</a> to make it adapted automatically on both Samsung private API and <code>Kit Kat</code>official API.</p>
<p>After I finished the coding according the document, I found the app broke on my Galaxy Note 3 with <code>Kit Kat</code>. It works perfect when running on <code>Jelly Bean</code>.</p>
<p>And I figured out an issue that it takes longer time to transmit the same seqeunce when I upgraded API. (When IR blaster is working, the LED indicator on the phone turns blue. And I found the time of indicator turning blue is significant longer than before.) And my <a href="https://github.com/timnew/IRRecorder" target="_blank" rel="external">IRRecorder</a> cannot recognize the sequence sent by my phone any longer.</p>
<p>After spent several hours, I figured out the reason. The pattern was encoded in a wrong way. But I’m pretty sure that I strictly followed the API document.</p>
<p>So I get a conculusion that <strong>the <code>ConsumerIrManager</code> implementation on Samsung Note 3 is different to what described in Android API document.</strong> However I’m not sure the reason is that the Android document is lying or Samsung implemented the driver in a wrong way.</p>
<p>Here is the technical details of the issue and its solution:</p>
<p>IR Command is trasmitted by turnning the IR blaster LED on and off for a certain period of time. So each IR command can be represented by a series of time periods, which indicates how long the led is on or off. The difference between Samsung API and Kit Kat APi is that how the time is mesured.</p>
<blockquote><p><strong>carrierFrequency</strong> The IR carrier frequency in Hertz.<br><strong>pattern</strong> The alternating on/off pattern in microseconds to transmit.</p>
<footer><strong>ConsumerIrManager.transmit(int carrierFrequency, int[] pattern)</strong><cite><a href="https://developer.android.com/reference/android/hardware/ConsumerIrManager.html#transmit(int,%20int[])" target="_blank" rel="external">Android Developer Reference</a></cite></footer></blockquote>
<p>According to the <a href="https://developer.android.com/reference/android/hardware/ConsumerIrManager.html#transmit(int,%20int[]" target="_blank" rel="external">Android Developer Refernece</a>), the time in KitKat is measured in the unit of microseconds.</p>
<p>But for Samsung, the time is mesured by the number of cycles. Take NEC encoding as example, the frequency is 38kHz. So the cycle time <code>T ~= 26us</code>. BIT_MARK is <code>21 cycles</code>, the period of time is around <code>26us x 21 ~= 546us</code>.</p>
<p>So ideally, regardless of lead-in and lead-out sequence, to send the code <code>0xA</code> in NEC encoding, Samsung API needs <code>21 60 21 21 21 60 21 21</code>; and Kit Kat API needs <code>560 1600 560 560 560 1600 560 560</code>.</p>
<p>But accroding to my experience, the Android Developer Reference is wrong. <strong>Even in KitKat, the time sequence is also measure by number of cycles instead of the number of microseconds!</strong></p>
<p>So to fix the issue, you need some mathmatical work. Here is the conversion formula:</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = t / T = t * f / <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">n: <span class="keyword">the</span> <span class="built_in">number</span> <span class="keyword">of</span> cycles</span><br><span class="line">t: <span class="keyword">the</span> <span class="built_in">time</span> <span class="keyword">in</span> microseconds</span><br><span class="line">T: <span class="keyword">the</span> cycle <span class="built_in">time</span> <span class="keyword">in</span> microseconds</span><br><span class="line">f: <span class="keyword">the</span> transmitting frequency <span class="keyword">in</span> Hertz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/" data-id="cinedk749006xchsi8xhhi2o6" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/samsung/">Samsung</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/api/">api</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/document/">document</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/error/">error</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/infrared/">infrared</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kit-kat/">kit kat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lying/">lying</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-use-jade-as-client-side-template-engine" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/26/use-jade-as-client-side-template-engine/" class="article-date">
  <time datetime="2014-05-26T00:00:00.000Z" itemprop="datePublished">2014-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/26/use-jade-as-client-side-template-engine/">Use Jade as client-side template engine</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://jade-lang.com/" target="_blank" rel="external">Jade</a> is a powerful JavaScript HTML template engine, which is concise and powerful. Due to its awesome syntax and powerful features, it almost become the default template engine for node.js web servers.</p>
<p>Jade is well known as a server-side HTML template, but actually it can also be used as a client-side template engine, which is barely known by people! To have a better understanding of this issue, firstly we should how Jade engine works.</p>
<p>When we’re translating a jade file into HTML, Jade engine actually does 2 separate tasks: <strong>Compiling</strong> and <strong>Rendering</strong>.</p>
<h3 id="Compiling"><a href="#Compiling" class="headerlink" title="Compiling"></a>Compiling</h3><p>Compiling is almost a transparent process when rendering jade files directly into HTML, including, rendering a jade file with <code>jade</code> cli tool. But it is actually the most important step while translating the jade template to HTML.<br>Compiling will be translate the jade file into a JavaScript function. During the process, all the static content has been translated.</p>
<p>Here is simple example:</p>
<figure class="highlight plain"><figcaption><span>Jade template</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html(lang=&quot;en&quot;)</span><br><span class="line">  head</span><br><span class="line">    title Title  </span><br><span class="line">  body</span><br><span class="line">    h1 Jade - node template engine</span><br><span class="line">    #container.col</span><br><span class="line">      p You are amazing</span><br><span class="line">      p.</span><br><span class="line">        Jade is a terse and simple</span><br><span class="line">        templating language with a</span><br><span class="line">        strong focus on performance</span><br><span class="line">        and powerful features.</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>Compiled template</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">template</span>(<span class="params">locals</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buf = [];</span><br><span class="line">    <span class="keyword">var</span> jade_mixins = &#123;&#125;;</span><br><span class="line">    buf.push(<span class="string">'&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;Title  &lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Jade - node template engine&lt;/h1&gt;&lt;div id="container"class="col"&gt;     &lt;p&gt;You are amazing&lt;/p&gt;&lt;p&gt;Jade is a terse and simple\ntemplating language with a\nstrong focus on performance\nand powerful features.&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;'</span>);</span><br><span class="line">    <span class="keyword">return</span> buf.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As you can see, the template is translated into a JavaScript function, which contains all the HTML data. In this case, since we didn’t introduce any interpolation, so the HTML content has been fully generated.</p>
<p>The case will become more complicated when interpolation, <code>each</code>, <code>if</code> statement is introduced.</p>
<figure class="highlight plain"><figcaption><span>Jade template with interpolation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html(lang=&quot;en&quot;)</span><br><span class="line">  head</span><br><span class="line">    title =title  </span><br><span class="line">  body</span><br><span class="line">    h1 Jade - node template engine</span><br><span class="line">    #container.col</span><br><span class="line">    ul</span><br><span class="line">      each item in items</span><br><span class="line">        li= item</span><br><span class="line"></span><br><span class="line">    if usingJade</span><br><span class="line">      p You are amazing</span><br><span class="line">    else</span><br><span class="line">      p Get it!</span><br><span class="line"></span><br><span class="line">    p.</span><br><span class="line">      Jade is a terse and simple</span><br><span class="line">      templating language with a</span><br><span class="line">      strong focus on performance</span><br><span class="line">      and powerful features.</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>Compiled template with interpolation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">template</span>(<span class="params">locals</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buf = [];</span><br><span class="line">    <span class="keyword">var</span> jade_mixins = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> locals_ = locals || &#123;&#125;, items = locals_.items, usingJade = locals_.usingJade;</span><br><span class="line">    buf.push(<span class="string">'&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;=title  &lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Jade - node template engine&lt;/h1&gt;&lt;div id="container"class="col"&gt;&lt;/div&gt;&lt;ul&gt;'</span>);</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $$obj = items;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"number"</span> == <span class="keyword">typeof</span> $$obj.length) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> $index = <span class="number">0</span>, $$l = $$obj.length; $index &lt; $$l; $index++) &#123;</span><br><span class="line">                <span class="keyword">var</span> item = $$obj[$index];</span><br><span class="line">                buf.push(<span class="string">"&lt;li&gt;"</span> + jade.escape(<span class="literal">null</span> == (jade.interp = item) ? <span class="string">""</span> : jade.interp) + <span class="string">"&lt;/li&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> $$l = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> $index <span class="keyword">in</span> $$obj) &#123;</span><br><span class="line">                $$l++;</span><br><span class="line">                <span class="keyword">var</span> item = $$obj[$index];</span><br><span class="line">                buf.push(<span class="string">"&lt;li&gt;"</span> + jade.escape(<span class="literal">null</span> == (jade.interp = item) ? <span class="string">""</span> : jade.interp) + <span class="string">"&lt;/li&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).call(<span class="keyword">this</span>);</span><br><span class="line">    buf.push(<span class="string">"&lt;/ul&gt;"</span>);</span><br><span class="line">    <span class="keyword">if</span> (usingJade) &#123;</span><br><span class="line">        buf.push(<span class="string">"&lt;p&gt;You are amazing&lt;/p&gt;"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        buf.push(<span class="string">"&lt;p&gt;Get it!&lt;/p&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    buf.push(<span class="string">"&lt;p&gt;Jade is a terse and simple\ntemplating language with a\nstrong focus on performance\nand powerful features.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">    <span class="keyword">return</span> buf.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><figcaption><span>Data for interpolation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"Jade Demo"</span>,</span><br><span class="line">  <span class="attr">"usingJade"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"items"</span>:[</span><br><span class="line">    <span class="string">"item1"</span>,</span><br><span class="line">    <span class="string">"item2"</span>,</span><br><span class="line">    <span class="string">"item3"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><figcaption><span>Output Html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>=title  <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Jade - node template engine<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>item3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>You are amazing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      Jade is a terse and simple</span><br><span class="line">      templating language with a</span><br><span class="line">      strong focus on performance</span><br><span class="line">      and powerful features.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Well, as you can see, the function has become quite complicated than before. It could become more complicated when <code>extend</code>, <code>include</code> or <code>mixin</code> introduced, you can trial it on your own.</p>
<h3 id="Rendering"><a href="#Rendering" class="headerlink" title="Rendering"></a>Rendering</h3><p>After the compiling, the rendering process is quite simple. Just invoking the compiled function, the return string is rendered html. The only thing need to mentioned here is the interpolation data should be passed to the template function as <code>locals</code>.</p>
<h3 id="Using-Jade-as-front-end-template-engine"><a href="#Using-Jade-as-front-end-template-engine" class="headerlink" title="Using Jade as front-end template engine"></a>Using Jade as front-end template engine</h3><p>Still now, you probably have got my idea. To use jade a front-end template, we can compose the template in jade. Later compile it into JavaScript file. And then we can invoke the JavaScript function in front-end to achieve dynamic client-side rendering!</p>
<p>Since Jade template has been precompiled at server side, so there is very little runtime effort when rendering the template at client-side. So it is a cheaper solution when you have lots of templates.</p>
<p>To compile the jade files into JavaScript instead of HTML, you need to pass <code>-c</code> or <code>--client</code> option to <code>jade</code> cli tool. Or calling <code>jade.compile</code> instead of <code>jade.render</code> while using JavaScript API.</p>
<h3 id="Configure-Grunt"><a href="#Configure-Grunt" class="headerlink" title="Configure Grunt"></a>Configure Grunt</h3><p>Well, since <a href="http://gruntjs.com/" target="_blank" rel="external">Grunt</a> is popular in node.js world. So we can also use Grunt to do the stuff for us.<br>Basically, use grunt for jade is straightforward. But it is a little bit tricky when you want to compile the back-end template into HTML as well as to compile the front-end template into JavaScripts.</p>
<p>I used a little trick to solve the issue. I follow the convention in Rails, that prefix the front-end template files with underscore.<br>So</p>
<figure class="highlight mizar"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/layouts/default.jade       -&gt; Layout file, extended <span class="keyword">by</span> back-<span class="keyword">end</span>/front-<span class="keyword">end</span> templates, should <span class="keyword">not</span> <span class="keyword">be</span> compiled.</span><br><span class="line">/views/settings/index.jade  -&gt; Back-<span class="keyword">end</span> template, should <span class="keyword">be</span> compiled into HTML</span><br><span class="line">/views/settings/_item.jade  -&gt; Front-<span class="keyword">end</span> template, should <span class="keyword">be</span> compiled into JavaScript</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><figcaption><span>Gruntfile.coffee</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">(grunt)</span> -&gt;</span></span><br><span class="line">  grunt.initConfig</span><br><span class="line">    pkg: grunt.file.readJSON(<span class="string">'package.json'</span>)</span><br><span class="line"></span><br><span class="line">    jade:</span><br><span class="line">      options:</span><br><span class="line">        pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      compile:</span><br><span class="line">        expand: <span class="literal">true</span></span><br><span class="line">        cwd: <span class="string">'views'</span></span><br><span class="line">        src: [<span class="string">'**/*.jade'</span>, <span class="string">'!**/_*.jade'</span>]</span><br><span class="line">        dest: <span class="string">'build/'</span></span><br><span class="line">        ext: <span class="string">'.html'</span></span><br><span class="line"></span><br><span class="line">      template:</span><br><span class="line">        options:</span><br><span class="line">          client: <span class="literal">true</span></span><br><span class="line">          namespace: <span class="string">'Templates'</span></span><br><span class="line"></span><br><span class="line">        expand: <span class="literal">true</span></span><br><span class="line">        cwd: <span class="string">'views'</span></span><br><span class="line">        src: [<span class="string">'**/_*.jade'</span>]</span><br><span class="line">        dest: <span class="string">'build/'</span></span><br><span class="line">        ext: <span class="string">'.js'</span></span><br><span class="line"></span><br><span class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-jade'</span>)  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>I distinguish the layouts and templates by file path. And distinguish the front-end/back-end templates by prefix. The filter <code>!**/_*.jade</code> excludes the front-end templates when compiling the back-end templates.</p>
<p>This approach should work fine in most cases, but if you are facing more complicated situation, and can’t be handled with this trick, try defining your own convention, and recognizing it with custom filter function to categorize them.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/26/use-jade-as-client-side-template-engine/" data-id="cinedk746006uchsiy1j4rb6d" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/05/26/use-jade-as-client-side-template-engine/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/client-side/">client side</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/front-end/">front-end</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/grunt/">grunt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jade/">jade</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pre-compile/">pre-compile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/template-engine/">template engine</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-create-shortcut-for-your-project-mingle-with-alfred" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/26/create-shortcut-for-your-project-mingle-with-alfred/" class="article-date">
  <time datetime="2014-05-26T00:00:00.000Z" itemprop="datePublished">2014-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/mac/">Mac</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/26/create-shortcut-for-your-project-mingle-with-alfred/">Create shortcut for your project Mingle with Alfred</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A few days ago, I post a blog(<a href="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox">Create shortcut for your project Mingle with Chrome OmniBox</a>) about that we can access specific Mingle story card directly from Chrome “OmniBox”. The shortcut is created by registering Mingle search as custom search in Chrome.</p>
<p>Today I found applying the same trick to launch apps, we can have one step further. In Mac OS, almost all the launcher apps support custom search, such as <a href="http://www.alfredapp.com/" target="_blank" rel="external">Aflred</a>, <a href="http://qsapp.com/" target="_blank" rel="external">QuickSilver</a>, <a href="http://www.nulana.com/launcher" target="_blank" rel="external">Launcher</a>. Even in Windows, we also have <a href="http://www.launchy.net/" target="_blank" rel="external">Launchy</a>. For Linux, I believe there should be similar stuff. So the trick is environment independent.</p>
<p>To add custom search query in different launch app is quite different, but should be straightforward.<br>I’ll take Alfred as example:</p>
<ol>
<li><p>Open Alfred Preference</p>
<img src="/blog/2014/05/26/create-shortcut-for-your-project-mingle-with-alfred/alfred.png" alt="Alfred Preferences" title="Alfred Preferences">
</li>
<li><p>Register Mingle as custom search</p>
<img src="/blog/2014/05/26/create-shortcut-for-your-project-mingle-with-alfred/detail.png" alt="Alfred Preferences" title="Alfred Preferences">
</li>
</ol>
<p>The url for custom search can be get with the same approach described in <a href="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox">previous post</a>. Alfred uses <code>{query}</code> as placeholder, so you should replace the <code>%s</code> with <code>{query}</code> when coping the url from chrome to Alfred.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/26/create-shortcut-for-your-project-mingle-with-alfred/" data-id="cinedk743006rchsiuw32ew90" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/05/26/create-shortcut-for-your-project-mingle-with-alfred/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/alfred/">Alfred</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/custom-search/">custom search</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mingle/">mingle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shortcut/">shortcut</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-upgrading-dsl-from-coffeescript-to-json-part-2-redefine-dsl-behavior" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-2-redefine-dsl-behavior/" class="article-date">
  <time datetime="2014-05-11T00:00:00.000Z" itemprop="datePublished">2014-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-2-redefine-dsl-behavior/">Upgrading DSL From CoffeeScript to JSON: Part.2. Redefine DSL behavior</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is the second post in this series, <a href="/blog/2014/05/11/upgrade-dsl-from-coffeescript-to-json-part-1-migrator">previous one</a> discussed the JSON schema migration mechanism.</p>
<p>After finish JSON DSL implementation, the No.1 problem I need to handle is how to upgrading the configuration in CoffeeScript to JSON format.</p>
<p>One of the solutions is to do it manually. Well, it is possible, but… JSON isn’t a language really designed for human, composing configuration for 50+ sites doesn’t sound like a pleasant work for me. Even when I finished it, how can I ensure all the configuration is properly upgraded? The sun is bright today, I don’t want to waste whole afternoon in front of the computer checking the JSON. In one word, I’m lazy…</p>
<p>Since most of the change of DSL is happened on representation instead of structure. So in most cases, there is 1-to-1 mapping between v1 DSL and v2 DSL. So maybe I can generate the most of v2 DSL by using V1 DSL! Then manually handle some exceptions.</p>
<p>Here is a snippet of V1 DSL</p>
<figure class="highlight coffeescript"><figcaption><span>Ver 1 DSL snippet</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">AdKiller.run -&gt;</span><br><span class="line"></span><br><span class="line">  @host <span class="string">'imagetwist.com'</span>, <span class="function">-&gt;</span></span><br><span class="line">    @clean(<span class="string">'#myad'</span>, <span class="string">'#popupOverlay'</span>)</span><br><span class="line">    @revealImg(<span class="string">'.pic'</span>)</span><br><span class="line"></span><br><span class="line">  @host <span class="string">'yankoimages.net'</span>, <span class="function">-&gt;</span></span><br><span class="line">    @clean(<span class="string">'#firopage'</span>)</span><br><span class="line">    @revealImg(<span class="string">'img'</span>)</span><br><span class="line"></span><br><span class="line">  @host <span class="string">'imageback.info'</span>, <span class="string">'imagepong.info'</span>, <span class="string">'imgking.us'</span>, <span class="string">'imgabc.us'</span>, <span class="function">-&gt;</span></span><br><span class="line">    @revealA(<span class="string">'.text_align_center a'</span>)</span><br><span class="line"></span><br><span class="line">  @host <span class="string">'imgserve.net'</span>,</span><br><span class="line">    <span class="string">'imgcloud.co'</span>,</span><br><span class="line">    <span class="string">'hosterbin.com'</span>,</span><br><span class="line">    <span class="string">'myhotimage.org'</span>,</span><br><span class="line">    <span class="string">'img-zone.com'</span>,</span><br><span class="line">    <span class="string">'imgtube.net'</span>,</span><br><span class="line">    <span class="string">'pixup.us'</span>,</span><br><span class="line">    <span class="string">'imgcandy.net'</span>,</span><br><span class="line">    <span class="string">'croftimage.com'</span>,</span><br><span class="line">    <span class="string">'www.imagefolks.com'</span>,</span><br><span class="line">    <span class="string">'imgcloud.co'</span>,</span><br><span class="line">    <span class="string">'imgmoney.com'</span>,</span><br><span class="line">    <span class="string">'imagepicsa.com'</span>,</span><br><span class="line">    <span class="string">'imagecorn.com'</span>,</span><br><span class="line">    <span class="string">'imgcorn.com'</span>,</span><br><span class="line">    <span class="string">"imgboo.me"</span>,</span><br><span class="line">    <span class="string">'imgrim.com'</span>,</span><br><span class="line">    <span class="string">'imgdig.com'</span>,</span><br><span class="line">    <span class="string">'imgnext.com'</span>,</span><br><span class="line">    <span class="string">'hosturimage.com'</span>,</span><br><span class="line">    <span class="string">'image-gallery.us'</span>,</span><br><span class="line">    <span class="string">'imgmaster.net'</span>,</span><br><span class="line">    <span class="string">'img.spicyzilla.com'</span>,</span><br><span class="line">    <span class="string">'bulkimg.info'</span>,</span><br><span class="line">    <span class="string">'pic.apollon-fervor.com'</span>,</span><br><span class="line">    <span class="string">'08lkk.com'</span>,</span><br><span class="line">    <span class="string">'damimage.com'</span>,</span><br><span class="line">    <span class="function">-&gt;</span></span><br><span class="line">      @click(<span class="string">'#continuetoimage input'</span>)</span><br><span class="line">      @clean(<span class="string">'#logo'</span>)</span><br><span class="line">      @safeRevealImg(<span class="string">'#container img[class]'</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>In version 1 implementation, <code>@host</code> defines the sites. And in the block of <code>@host</code> method, <code>@click</code>, <code>@clean</code>, <code>@revealImg</code> methods define the actions for the sites. The <code>@host</code> method instantiate new instance of <code>Cleaner</code>. The code block is invoked when cleaner is triggered, which does the actually cleaning.</p>
<p>Now I want to keep this file, since it shares the configuration between version 1 and version 2. And I redefine the behaviors of the cleaning method, such as <code>@clean</code>, <code>@click</code>, etc., I generate the JSON data when it is invoked instead of really altering the DOM. So I got this:</p>
<figure class="highlight coffeescript"><figcaption><span>seed_data_generator</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env coffee</span></span><br><span class="line"></span><br><span class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">AdKiller =</span><br><span class="line">  run: <span class="function"><span class="params">(block)</span> -&gt;</span></span><br><span class="line">    @scripts = &#123;&#125;</span><br><span class="line">    @hosts = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    block.call(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">    fs.writeFileSync <span class="string">'seed_data.json'</span>, JSON.stringify(&#123;version: <span class="number">1</span>, @hosts, @scripts&#125;)</span><br><span class="line"></span><br><span class="line">  host: <span class="function"><span class="params">(hosts..., block)</span> -&gt;</span></span><br><span class="line">    @currentScript = []</span><br><span class="line">    scriptId = hosts[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    @scripts[scriptId] = @currentScript</span><br><span class="line">    <span class="keyword">for</span> host <span class="keyword">in</span> hosts</span><br><span class="line">      @hosts[host] = scriptId</span><br><span class="line"></span><br><span class="line">    block.call(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">  remove: <span class="function"><span class="params">(selectors...)</span> -&gt;</span></span><br><span class="line">    selectors.unshift <span class="string">'remove'</span></span><br><span class="line">    @currentScript.push selectors</span><br><span class="line"></span><br><span class="line">  clean: <span class="function"><span class="params">(selectors...)</span> -&gt;</span> <span class="comment"># Backward compatibility</span></span><br><span class="line">    selectors.unshift <span class="string">'remove'</span></span><br><span class="line">    @currentScript.push selectors</span><br><span class="line"></span><br><span class="line">  hide: <span class="function"><span class="params">(selectors...)</span> -&gt;</span></span><br><span class="line">    selectors.unshift <span class="string">'clean'</span></span><br><span class="line">    @currentScript.push selectors</span><br><span class="line"></span><br><span class="line">  click: <span class="function"><span class="params">(selector)</span> -&gt;</span></span><br><span class="line">    @currentScript.push [<span class="string">'click'</span>, selector]</span><br><span class="line"></span><br><span class="line">  revealA: <span class="function"><span class="params">(selector)</span> -&gt;</span></span><br><span class="line">    @currentScript.push [<span class="string">'revealA'</span>, selector]</span><br><span class="line"></span><br><span class="line">  revealImg: <span class="function"><span class="params">(selector)</span> -&gt;</span></span><br><span class="line">    @currentScript.push [<span class="string">'revealImg'</span>, selector]</span><br><span class="line"></span><br><span class="line">  safeRevealA: <span class="function"><span class="params">(selector)</span> -&gt;</span></span><br><span class="line">    @currentScript.push [<span class="string">'safeRevealA'</span>, selector]</span><br><span class="line"></span><br><span class="line">  safeRevealImg: <span class="function"><span class="params">(selector)</span> -&gt;</span></span><br><span class="line">    @currentScript.push [<span class="string">'safeRevealImg'</span>, selector]</span><br><span class="line"></span><br><span class="line">AdKiller.run -&gt;</span><br><span class="line">  @host <span class="string">'imagetwist.com'</span>, <span class="function">-&gt;</span></span><br><span class="line">    @clean(<span class="string">'#myad'</span>, <span class="string">'#popupOverlay'</span>)</span><br><span class="line">    @revealImg(<span class="string">'.pic'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>
<p>So now I can easily invoking this piece of code, to convert verion 1 DSL to JSON format.</p>
<p>DSL behavior redefinition is a super powerful trick, we used it on JSON parsing, validation, and generation before on PlayUp project. Which saved us tons of time from writing boring code.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-2-redefine-dsl-behavior/" data-id="cinedk742006ochsiffcm1t7u" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-2-redefine-dsl-behavior/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coffeescript/">coffeescript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dsl/">dsl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json/">json</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/language/">language</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/upgrading/">upgrading</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-upgrading-dsl-from-coffeescript-to-json-part-1-migrator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-1-migrator/" class="article-date">
  <time datetime="2014-05-11T00:00:00.000Z" itemprop="datePublished">2014-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-1-migrator/">Upgrading DSL from CoffeeScript to JSON: Part.1. Migrator</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’m working on the Harvester-AdKiller version 2 recently. Version 2 dropped the idea “Code as Configuration”, because the nature of Chrome Extension. Recompiling and reloading the extension every time when configuration changed is the pain in the ass for me as an user.</p>
<p>For security reason, Chrome Extension disabled all the Javascript runtime evaluation features, such as <code>eval</code> or <code>new Function(&#39;code&#39;)</code>. So that it become almost impossible to edit code as data, and later applied it on the fly.</p>
<p>Thanks to the version 1, the feature and DSL has almost fully settled, little updates needed in the near future. So I can use a less flexible language as the DSL instead of CoffeeScript.</p>
<p>Finally I decided to replace CoffeeScript to JSON, which can be easily edited and applied on the fly.</p>
<p>After introducing JSON DSL, to enable DSL upgrading in the future, an migration system become important and urgent. (Actually, this prediction is so solid. I have changed the JSON schema once today.) So I come up a new migration system:</p>
<figure class="highlight coffeescript"><figcaption><span>Upgrader</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upgrader</span></span></span><br><span class="line">  constructor: <span class="function">-&gt;</span></span><br><span class="line">    @execute()</span><br><span class="line"></span><br><span class="line">  execute: <span class="function">=&gt;</span></span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"[Upgrader] Current Version: <span class="subst">#&#123;Configuration.version&#125;</span>"</span></span><br><span class="line">    migrationName = <span class="string">"<span class="subst">#&#123;Configuration.version&#125;</span>"</span></span><br><span class="line">    migration = <span class="keyword">this</span>[migrationName]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unless</span> migration?</span><br><span class="line">      <span class="built_in">console</span>.log <span class="string">'[Upgrader] Latest version, no migration needed.'</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"[Upgrader] Migration needed..."</span></span><br><span class="line">    migration.call(<span class="keyword">this</span>, @execute)</span><br><span class="line"></span><br><span class="line">  <span class="string">'undefined'</span>: <span class="function"><span class="params">(done)</span> -&gt;</span></span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"[Upgrader] Load data from seed..."</span></span><br><span class="line">    Configuration.resetDataFromSeed(done)</span><br><span class="line"></span><br><span class="line">  <span class="string">'1.0'</span>: <span class="function"><span class="params">(done)</span> -&gt;</span></span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"[Upgrader] Migrating configuration schema from 1.0 to 1.1..."</span></span><br><span class="line">    <span class="comment"># Do the migration logic here</span></span><br><span class="line">    done()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The <code>Upgrader</code> will be instantiate when extension started, after <code>Configuration</code> is initialized, which holds the DSL data for runtime usage.</p>
<p>When the <code>execute</code> method is invoked, it check the current version, and check is there a upgrading method match to this version. If yes, it triggers the migration; otherwise it succeed the migration. Each time a migration process is completed, it re-trigger <code>execute</code> method for another round of check.</p>
<p>Adding migration for a specific version of schema is quite simple. Just as method <code>1.0</code> does, declaring a method with the version number in the <code>Upgrader</code>.</p>
<p><code>&#39;undefined&#39;</code> method is a special migration method, which is invoked there is no previous configuration found. So I initialize the configuration from seed data json file, which is generated from the version 1 DSL.</p>
<p>The seed data generation is also an interesting topic. Please refer to <a href="/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-dot-2-redefine-dsl-behavior">next post(Redfine DSL behavior)</a> of this series for details.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-1-migrator/" data-id="cinedk741006lchsicrvkn47p" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/05/11/upgrading-dsl-from-coffeescript-to-json-part-1-migrator/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coffeescript/">coffeescript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dsl/">dsl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json/">json</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/language/">language</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/migration/">migration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/schema/">schema</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/update/">update</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/upgrading/">upgrading</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-chrome-extension-rpc-router" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/11/chrome-extension-rpc-router/" class="article-date">
  <time datetime="2014-05-11T00:00:00.000Z" itemprop="datePublished">2014-05-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/chrome/">Chrome</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/11/chrome-extension-rpc-router/">Chrome Extension RPC Router</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>When developing chrome extension, communication between background script and content scripts is very typical use case. Chrome provides messaging APIs to achieve this goal. But this API has limitation that every message goes to the same listener.</p>
<p>Background script in Chrome extension usually works as a function hub for the whole extension, so background scripts usually required to process different types of messages. Then the limit of Chrome messaging API become an issue we need to face.</p>
<p>There are several approaches to resolve the limitation. Since API allow multiple listener, a simple and cheap solution is Responsibility Chain; adding listener for each message type, and checking message type at beginning of the listener.</p>
<figure class="highlight js"><figcaption><span>Responsbility Chain</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">message, sender, sendResponse</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(message.type != <span class="string">'reloadData'</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// reload data logic here</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">chrome.runtime.onMessage.addListener(<span class="function"><span class="keyword">function</span>(<span class="params">message, sender, sendResponse</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(message.type != <span class="string">'updateBrowerAction'</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// update browser action logic here</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>This approach works, but not that graceful. And there is potential performance issue when message types increases.</p>
<p>So I come up a new more graceful solution: RPC Message Router</p>
<figure class="highlight coffeescript"><figcaption><span>RCPRouter</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"></span><br><span class="line"><span class="title">extractResponseHandler</span> = <span class="params">(args)</span> -&gt;</span></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">undefined</span> <span class="keyword">if</span> args.length == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  last = args.pop()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">typeof</span> last == <span class="string">'function'</span></span><br><span class="line">    <span class="keyword">return</span> last</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    args.push last</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> @<span class="title">RPCRouter</span></span></span><br><span class="line">  constructor: <span class="function">-&gt;</span></span><br><span class="line">    chrome.runtime.onMessage.addListener @handleMassage</span><br><span class="line"></span><br><span class="line">  handleMassage: <span class="function"><span class="params">(message, sender, sendResponse)</span> =&gt;</span></span><br><span class="line">    &#123;method: methodName, args&#125; = message</span><br><span class="line">    method = <span class="keyword">this</span>[methodName]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unless</span> method?</span><br><span class="line">      <span class="built_in">console</span>.error <span class="string">"Unknown RPC method: %s"</span>, methodName</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    args.push sendResponse</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"RPC Call: %s, args: %o"</span>, methodName, args</span><br><span class="line">    method.apply(<span class="keyword">this</span>, args)</span><br><span class="line"></span><br><span class="line">  callBackground: <span class="function"><span class="params">(method, args...)</span> -&gt;</span></span><br><span class="line">    responseHandler = extractResponseHandler(args)</span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"RPC Call to Background: %s, args: %o"</span>, method, args</span><br><span class="line">    chrome.runtime.sendMessage &#123;method, args&#125;, responseHandler</span><br><span class="line"></span><br><span class="line">  callTab: <span class="function"><span class="params">(tabId, method, args...)</span> -&gt;</span></span><br><span class="line">    responseHandler = extractResponseHandler(args)</span><br><span class="line">    <span class="built_in">console</span>.log <span class="string">"RPC Call to Tab \"%s\": %s, args: %o"</span>, tabId, method, args</span><br><span class="line">    chrome.tabs.sendMessage tabId, &#123;method, args&#125;, responseHandler</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So this new RPCRouter wraps the chrome original messaging API and provides a more convenient way to invoke a remote method. To create a specific RPC Router for background page or content page is quite easy.</p>
<figure class="highlight coffeescript"><figcaption><span>Responsbility Chain</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BackgroundRPCRouter</span> <span class="keyword">extends</span> <span class="title">RPCRouter</span></span></span><br><span class="line">  refreshData: <span class="function"><span class="params">(isForceUpdate, dataLoadedCallback)</span> -&gt;</span></span><br><span class="line">    <span class="comment"># reload data logic here</span></span><br><span class="line"></span><br><span class="line">    dataLoadedCallback(data)</span><br><span class="line"></span><br><span class="line">  updateBrowerAction: <span class="function"><span class="params">(icon, hintText)</span> -&gt;</span></span><br><span class="line">    <span class="comment"># update browser action logic here</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> <span class="comment"># protection: avoid channel leak</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>HINT:</strong><br>Using messaging API in chrome here should be careful. Coffee script will return the last executed statement result as function result, which could be potentially truthy, such as non-zero number, object. The truthy return value will make the channel become a async channel, which won’t be closed until the <code>sendResponse</code> callback is invoked. But just as the handler <code>updateBrowserAction</code>, the handler doesn’t need a <code>sendResponse</code> callback, the issue will keep the channel alive forever. So do add <code>false</code> or <code>return false</code> at the end of the method unless you can ensure the function will never yield truthy value in last statement.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/11/chrome-extension-rpc-router/" data-id="cinedk73z006ichsitxsuiht1" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/05/11/chrome-extension-rpc-router/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rpc/">RPC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chrome/">chrome</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/extension/">extension</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/messaging/">messaging</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/router/">router</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/routing/">routing</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-create-shortcut-for-your-project-mingle-with-chrome-omnibox" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/" class="article-date">
  <time datetime="2014-05-09T00:00:00.000Z" itemprop="datePublished">2014-05-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/chrome/">Chrome</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/">Create shortcut for your project Mingle with Chrome OmniBox</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Mingle is a common choice of story wall management system in ThoughtWorks internal projects.</p>
<p>Mingle uses rest style url to identify card or entities in the system, so the url contains the account id and project id in it.<br>Hosted Mingle is used in most project, to distinguish between accounts and projects, the url of the project mingle site is usually long, e.g., <code>https://minglehosting.thoughtworks.com/telstra_de/projects/telstra_24x7_apps/</code>. And other resources in the project, such as cards, whose url will be even longer.</p>
<p>When working in the team, open a specific card is a very common scenario, such as kicking off story, moving card, update story ACs, etc. To open a card, user usually need to open the project mingle home page, and use the search feature in the project. To open the home page, usually you need to save the url into your bookmark.</p>
<p>Today I found a better way to solve this issue, using the Chrome OmniBox! Chrome OmniBox is usually configured by <a href="http://www.opensearch.org/Home" target="_blank" rel="external">Open Search Description</a>. But it also allow user to manually add search engine configuration.</p>
<p>After the registration, we can use Mingle search direct from OmniBox, and we can open a specific card by typing “#card number”.</p>
<ol>
<li>Keyword Mingle in OmniBox<img src="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/omnibox_1.png" alt="Keyword mingle in OmniBox" title="Keyword mingle in OmniBox"></li>
<li>Search in OmniBox<img src="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/omnibox_2.png" alt="Search in OmniBox" title="Search in OmniBox"></li>
<li>Open the page<img src="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/omnibox_3.png" alt="Open the page" title="Open the page">
</li>
</ol>
<p>To register Mingle to Chrome OmniBox, you can use following approach:</p>
<p>Find out the Mingle search page url first:</p>
<ol>
<li>Open Mingle project home page, type <code>test</code> in the Search Box. Press enter, copy the url, and replace word <code>test</code> with <code>%s</code>. That’s the search url.<img src="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/setup_1.png" alt="Find Search Url" title="Find Search Url"></li>
<li>Open url <code>chrome://settings</code>, find <code>Manage search engines</code>.<img src="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/setup_2.png" alt="Find Manage search engines" title="Find Manage search engines"></li>
<li>Register new search engine.<br><strong> The first box is the display name of item, <code>Mingle</code>, <code>project_name Mingle</code> is recommended
</strong> The second box is the keyword triggers the search, <code>mingle</code> is recommended. In most cases, you will work with only 1 mingle instance, so it will not cause confusion. But if it does, add more specific keyword to it.<br>** The third box is the url search url, paste the url you just found<img src="/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/setup_3.png" alt="Register mingle" title="Register mingle">
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/" data-id="cinedk73x006fchsiccjtlb8o" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/05/09/create-shortcut-for-your-project-mingle-with-chrome-omnibox/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chrome/">chrome</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/custom-search/">custom search</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mingle/">mingle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/omnibox/">omnibox</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shortcut/">shortcut</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-app-crash-issue-when-inflating-viewpager" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/04/22/app-crash-issue-when-inflating-viewpager/" class="article-date">
  <time datetime="2014-04-22T00:00:00.000Z" itemprop="datePublished">2014-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/04/22/app-crash-issue-when-inflating-viewpager/">App crash issue when inflating ViewPager</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I wrote a very simple layout file with a <code>ViewPager</code>, but the app crashes when inflating it.</p>
<figure class="highlight xml"><figcaption><span>Layout file</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ViewPager</span></span><br><span class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/view_pager"</span></span><br><span class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Here is the error message:</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">04</span>-<span class="number">22</span> <span class="number">22</span>:<span class="number">27</span>:<span class="number">00.828</span>    <span class="number">1128</span>-<span class="number">1479</span>/com.github.timnew.rubiktimer E/AndroidRuntime﹕ FATAL EXCEPTION: main</span><br><span class="line">    Process: com.github.timnew.rubiktimer, PID: <span class="number">1128</span></span><br><span class="line">    java.lang.RuntimeException: Unable to start activity ComponentInfo&#123;com.github.timnew.rubiktimer/com.github.timnew.rubiktimer.history.HistoryActivity_&#125;: android.<span class="built_in">view</span>.InflateException: Binary XML file line #<span class="number">7</span>: Error inflating class ViewPager</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.performLaunchActivity(ActivityThread.java:<span class="number">2282</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:<span class="number">2340</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.access$<span class="number">800</span>(ActivityThread.java:<span class="number">157</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread$H.handleMessage(ActivityThread.java:<span class="number">1247</span>)</span><br><span class="line">            <span class="built_in">at</span> android.os.Handler.dispatchMessage(Handler.java:<span class="number">102</span>)</span><br><span class="line">            <span class="built_in">at</span> android.os.Looper.loop(Looper.java:<span class="number">157</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.main(ActivityThread.java:<span class="number">5293</span>)</span><br><span class="line">            <span class="built_in">at</span> java.lang.reflect.Method.invokeNative(Native Method)</span><br><span class="line">            <span class="built_in">at</span> java.lang.reflect.Method.invoke(Method.java:<span class="number">515</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">1265</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">1081</span>)</span><br><span class="line">            <span class="built_in">at</span> dalvik.<span class="built_in">system</span>.NativeStart.main(Native Method)</span><br><span class="line">     Caused by: android.<span class="built_in">view</span>.InflateException: Binary XML file line #<span class="number">7</span>: Error inflating class ViewPager</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.createViewFromTag(LayoutInflater.java:<span class="number">713</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.rInflate(LayoutInflater.java:<span class="number">761</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.inflate(LayoutInflater.java:<span class="number">498</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.inflate(LayoutInflater.java:<span class="number">398</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.inflate(LayoutInflater.java:<span class="number">354</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.policy.impl.PhoneWindow.setContentView(PhoneWindow.java:<span class="number">340</span>)</span><br><span class="line">            <span class="built_in">at</span> com.actionbarsherlock.internal.ActionBarSherlockNative.setContentView(ActionBarSherlockNative.java:<span class="number">134</span>)</span><br><span class="line">            <span class="built_in">at</span> com.actionbarsherlock.app.SherlockFragmentActivity.setContentView(SherlockFragmentActivity.java:<span class="number">262</span>)</span><br><span class="line">            <span class="built_in">at</span> com.github.timnew.rubiktimer.history.HistoryActivity_.setContentView(HistoryActivity_.java from OutputFileObject:<span class="number">44</span>)</span><br><span class="line">            <span class="built_in">at</span> com.github.timnew.rubiktimer.history.HistoryActivity_.onCreate(HistoryActivity_.java from OutputFileObject:<span class="number">34</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.Activity.performCreate(Activity.java:<span class="number">5389</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:<span class="number">1105</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.performLaunchActivity(ActivityThread.java:<span class="number">2246</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:<span class="number">2340</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.access$<span class="number">800</span>(ActivityThread.java:<span class="number">157</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread$H.handleMessage(ActivityThread.java:<span class="number">1247</span>)</span><br><span class="line">            <span class="built_in">at</span> android.os.Handler.dispatchMessage(Handler.java:<span class="number">102</span>)</span><br><span class="line">            <span class="built_in">at</span> android.os.Looper.loop(Looper.java:<span class="number">157</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.main(ActivityThread.java:<span class="number">5293</span>)</span><br><span class="line">            <span class="built_in">at</span> java.lang.reflect.Method.invokeNative(Native Method)</span><br><span class="line">            <span class="built_in">at</span> java.lang.reflect.Method.invoke(Method.java:<span class="number">515</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">1265</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">1081</span>)</span><br><span class="line">            <span class="built_in">at</span> dalvik.<span class="built_in">system</span>.NativeStart.main(Native Method)</span><br><span class="line">     Caused by: java.lang.ClassNotFoundException: Didn't find class <span class="string">"android.view.ViewPager"</span> on path: DexPathList[[zip file <span class="string">"/data/app/com.github.timnew.rubiktimer-76.apk"</span>],nativeLibraryDirectories=[/data/app-lib/com.github.timnew.rubiktimer-<span class="number">76</span>, /vendor/lib, /<span class="built_in">system</span>/lib]]</span><br><span class="line">            <span class="built_in">at</span> dalvik.<span class="built_in">system</span>.BaseDexClassLoader.findClass(BaseDexClassLoader.java:<span class="number">67</span>)</span><br><span class="line">            <span class="built_in">at</span> java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">497</span>)</span><br><span class="line">            <span class="built_in">at</span> java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">457</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.createView(LayoutInflater.java:<span class="number">565</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.onCreateView(LayoutInflater.java:<span class="number">658</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.policy.impl.PhoneLayoutInflater.onCreateView(PhoneLayoutInflater.java:<span class="number">66</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.onCreateView(LayoutInflater.java:<span class="number">675</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.createViewFromTag(LayoutInflater.java:<span class="number">700</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.rInflate(LayoutInflater.java:<span class="number">761</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.inflate(LayoutInflater.java:<span class="number">498</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.inflate(LayoutInflater.java:<span class="number">398</span>)</span><br><span class="line">            <span class="built_in">at</span> android.<span class="built_in">view</span>.LayoutInflater.inflate(LayoutInflater.java:<span class="number">354</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.policy.impl.PhoneWindow.setContentView(PhoneWindow.java:<span class="number">340</span>)</span><br><span class="line">            <span class="built_in">at</span> com.actionbarsherlock.internal.ActionBarSherlockNative.setContentView(ActionBarSherlockNative.java:<span class="number">134</span>)</span><br><span class="line">            <span class="built_in">at</span> com.actionbarsherlock.app.SherlockFragmentActivity.setContentView(SherlockFragmentActivity.java:<span class="number">262</span>)</span><br><span class="line">            <span class="built_in">at</span> com.github.timnew.rubiktimer.history.HistoryActivity_.setContentView(HistoryActivity_.java from OutputFileObject:<span class="number">44</span>)</span><br><span class="line">            <span class="built_in">at</span> com.github.timnew.rubiktimer.history.HistoryActivity_.onCreate(HistoryActivity_.java from OutputFileObject:<span class="number">34</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.Activity.performCreate(Activity.java:<span class="number">5389</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:<span class="number">1105</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.performLaunchActivity(ActivityThread.java:<span class="number">2246</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:<span class="number">2340</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.access$<span class="number">800</span>(ActivityThread.java:<span class="number">157</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread$H.handleMessage(ActivityThread.java:<span class="number">1247</span>)</span><br><span class="line">            <span class="built_in">at</span> android.os.Handler.dispatchMessage(Handler.java:<span class="number">102</span>)</span><br><span class="line">            <span class="built_in">at</span> android.os.Looper.loop(Looper.java:<span class="number">157</span>)</span><br><span class="line">            <span class="built_in">at</span> android.app.ActivityThread.main(ActivityThread.java:<span class="number">5293</span>)</span><br><span class="line">            <span class="built_in">at</span> java.lang.reflect.Method.invokeNative(Native Method)</span><br><span class="line">            <span class="built_in">at</span> java.lang.reflect.Method.invoke(Method.java:<span class="number">515</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">1265</span>)</span><br><span class="line">            <span class="built_in">at</span> com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">1081</span>)</span><br><span class="line">            <span class="built_in">at</span> dalvik.<span class="built_in">system</span>.NativeStart.main(Native Method)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>According to the message, we can figure out that the issue is caused because Android cannot found the class <code>android.view.ViewPager</code>.</p>
<p>If we’re careful enough, we can figure out that there is something wrong with the <code>ViewPager</code> fullname. Since <code>ViewPager</code> isn’t a standard widget, so it is provided in Support Library instead in the core SDK. So it is not in the package of <code>android.view</code>, it is in the pacakge <code>android.support.v4.view</code>.</p>
<p>To fix the issue, we should not reference the <code>ViewPager</code> with plain name but with the full name <code>android.support.v4.view.ViewPager</code>.</p>
<p>So this is the updated layout xml:</p>
<figure class="highlight xml"><figcaption><span>Fixed Lyaout</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span><br><span class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/view_pager"</span></span><br><span class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span><br><span class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/04/22/app-crash-issue-when-inflating-viewpager/" data-id="cinedk73v006cchsikm6a5osy" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/04/22/app-crash-issue-when-inflating-viewpager/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/crash/">crash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/inflator/">inflator</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/view-pager/">view pager</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-start-acitivity-in-background-on-android-4-4-kitkat" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/12/19/start-acitivity-in-background-on-android-4-4-kitkat/" class="article-date">
  <time datetime="2013-12-19T00:00:00.000Z" itemprop="datePublished">2013-12-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/12/19/start-acitivity-in-background-on-android-4-4-kitkat/">Start Acitivity in background on Android 4.4 KitKat</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>For some reason, Android 4.4 KitKat has changed the implementation while starting activity.</p>
<p>In Android 4.3, <code>Activity</code> started from inactive <code>Activity</code> is also inactive.<br>But in Android 4.4, <code>Activity</code> started form inactive <code>Activity</code> will be brought to front.<br>Here, <code>Inactive Activity</code> means the activity paused by user pressing <code>Home</code> button or switch to another app.</p>
<p>This change won’t be felt in most sceanrios. But for activities that started from AsyncTask, it does have some significant impact on user experience.</p>
<p>I’m working on a app, that shows a Splash Screen when user logged in. And the Splash screen is implemented with activity.</p>
<p>It takes some time for app to communicate with backend server during the loggin in, and user might press “Home” button to temporarily leave the app during the time.</p>
<p>I don’t want the my splash screen to interrupt the user if the user returned to the home screen. So I wish to start the splash screen activity in the background if current acitivity has been brought to background.</p>
<p>It isn’t an issue on Android 4.3, but on Android 4.4 KitKat, it causes problem.<br>I googled this issue and tried the <code>FLAG_ACTIVITY_MULTIPLE_TASK</code>, and comfirmed that it is not helping to this issue.</p>
<p>So I have to come up some kind of “hacking” solution as described below:</p>
<p>I add a <code>isPaused</code> property to <code>BaseAcitity</code>, which is the base class of all activities in my app.</p>
<figure class="highlight java"><figcaption><span>Add isPaused to BaseActivity</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">FragmentActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String START_FROM_PAUSED_ACTIVITY_FLAG = <span class="string">"START_FROM_PAUSED_ACTIVITY_FLAG"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> paused = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        paused = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        paused = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPaused</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> paused;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Then when I start the start the <code>SplashActivity</code>, I’ll put the <code>isPaused</code> value into the intent.</p>
<figure class="highlight java"><figcaption><span>Add flag when start activity</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(activity, SplashActivity.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">boolean</span> isStartingFromBackgroundActivity = activity.isPaused();</span><br><span class="line">intent.putExtra(BaseActivity.START_FROM_PAUSED_ACTIVITY_FLAG, isStartingFromBackgroundActivity);</span><br><span class="line"></span><br><span class="line">startActivity(intent);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>And check isPaused value in <code>onCreate</code> callback in <code>SplashAcitivity</code>, and push the <code>SplashAcitivty</code> to background if the value is true.</p>
<figure class="highlight java"><figcaption><span>Check flag when activity is created</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isStartedFromBackgroundActivity())</span><br><span class="line">        moveTaskToBack(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isStartedFromBackgroundActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> getIntent().getBooleanExtra(START_FROM_PAUSED_ACTIVITY_FLAG, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/12/19/start-acitivity-in-background-on-android-4-4-kitkat/" data-id="cinedk73t0069chsiu06wwcc6" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/12/19/start-acitivity-in-background-on-android-4-4-kitkat/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/activity/">activity</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/background/">background</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kitkat/">kitkat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/movetasktoback/">moveTaskToBack</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-npmethod-called-on-non-npobject-wrapped-jsobject" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/12/16/npmethod-called-on-non-npobject-wrapped-jsobject/" class="article-date">
  <time datetime="2013-12-16T00:00:00.000Z" itemprop="datePublished">2013-12-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/12/16/npmethod-called-on-non-npobject-wrapped-jsobject/">NPMethod called on non-NPObject wrapped JSObject</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’m working on a “hybrid” android appilcation. In the app, part of the UI was written in HTML and hosted in a WebView. And I exposed several Java objects to JavaScript as <code>Java Script Interface</code>.</p>
<figure class="highlight java"><figcaption><span>Setup WebView</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webView.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);</span><br><span class="line">webView.addJavascriptInterface(irBlaster, <span class="string">"irBlaster"</span>);</span><br></pre></td></tr></table></figure>
<p>The <code>irBlaster</code> object contains several methods, and js will invoke the specific method according to the data-attribute bound to the element.</p>
<figure class="highlight coffeescript"><figcaption><span>Script that handles the button click in HTML</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">onIrButtonClicked: <span class="function"><span class="params">(e)</span> =&gt;</span></span><br><span class="line">  $button = $(e.currentTarget)</span><br><span class="line">  type = $button.data(<span class="string">'irType'</span>)</span><br><span class="line"></span><br><span class="line">  sendFunc = irBlaster[type]</span><br><span class="line"></span><br><span class="line">  code = @parseCode($button.data(<span class="string">'irCode'</span>))</span><br><span class="line">  length = $button.data(<span class="string">'irLength'</span>)</span><br><span class="line"></span><br><span class="line">  sendFunc(length, code)</span><br></pre></td></tr></table></figure>
<p>The previous coffee-script works fine in my Jasmine tests with javascript mock version of irBlaster. When the button clicked, the proper method was invoked with proper arguments.<br>But when I run this code with real android app, WebView yields error says “NPMethod called on non-NPObject wrapped JSObject”.</p>
<p>The error message looks quite hard to understand the meaning, so I spent quite time to diagnose the code.</p>
<p>After several try, I found the following code works fine, but original one doesn’t:</p>
<figure class="highlight coffeescript"><figcaption><span>Code works</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">onIrButtonClicked: <span class="function"><span class="params">(e)</span> =&gt;</span></span><br><span class="line">  $button = $(e.currentTarget)</span><br><span class="line">  type = $button.data(<span class="string">'irType'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> irBlaster[type]</span><br><span class="line">    <span class="keyword">when</span> <span class="string">'NEC'</span></span><br><span class="line"></span><br><span class="line">      code = @parseCode($button.data(<span class="string">'irCode'</span>))</span><br><span class="line">      length = $button.data(<span class="string">'irLength'</span>)</span><br><span class="line"></span><br><span class="line">      irBlaster.NEC(length, code)</span><br><span class="line"></span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So I realize the issue was occurd in the javascript contextual binding.</p>
<p>Javascript is function-first-citizen language, and method call on object was simulate by invoking the function with specific context, and the code behavior won’t change if there is no reference to this pointer in the method. So it is quite normal that fetch a method from a object than invoke it without context.</p>
<p>That is why the Jasmine tests passed successfully. But the <code>irBlaster</code> isn’t real or simple javascript, but a native java object provided by js binding interface, so there is a limitation that the method on it cannot be invoked without context. Or it causes error.</p>
<p>So the issue can be resolved as following code by invoking the method in a “reflection” flavor:</p>
<figure class="highlight coffeescript"><figcaption><span>Invoking native binding object with context provided in HTML</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">onIrButtonClicked: <span class="function"><span class="params">(e)</span> =&gt;</span></span><br><span class="line">  $button = $(e.currentTarget)</span><br><span class="line">  type = $button.data(<span class="string">'irType'</span>)</span><br><span class="line"></span><br><span class="line">  sendFunc = irBlaster[type]</span><br><span class="line"></span><br><span class="line">  code = @parseCode($button.data(<span class="string">'irCode'</span>))</span><br><span class="line">  length = $button.data(<span class="string">'irLength'</span>)</span><br><span class="line"></span><br><span class="line">  sendFunc.call(irBlaster, length, code)</span><br></pre></td></tr></table></figure>
<p>In previous code, I invoke the <code>sendFunc</code> with <code>call</code>, and provids irBlaster as the context as <code>this</code>. So the problem solved, the code runs smoothly without issue.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/12/16/npmethod-called-on-non-npobject-wrapped-jsobject/" data-id="cinedk73s0067chsihp4hp303" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/12/16/npmethod-called-on-non-npobject-wrapped-jsobject/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/npmethod/">NPMethod</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/npobject/">NPObject</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webview/">WebView</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wrapper/">Wrapper</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binding/">binding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/browser/">browser</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/blog/3/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/blog/2/">2</a><a class="page-number" href="/blog/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/blog/5/">5</a><a class="page-number" href="/blog/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/blog/12/">12</a><a class="extend next" rel="next" href="/blog/5/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Articles récents</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Nuage de mot-clés</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Catégories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>