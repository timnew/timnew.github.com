<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/blog/5/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');

  ga('require', 'displayfeatures');

ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-asset-path-in-android-stuidio" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/12/13/asset-path-in-android-stuidio/" class="article-date">
  <time datetime="2013-12-13T00:00:00.000Z" itemprop="datePublished">2013-12-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/12/13/asset-path-in-android-stuidio/">Asset path in Android Stuidio</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>According to <a href="https://developer.android.com/tools/projects/index.html#ApplicationProjects" target="_blank" rel="external">Android guideline document</a>, the assets folder is created automatically and is positioned under the root of the project folder.  </p>
<p>So the assets folder should be located at <code>&lt;project root&gt;/assets</code></p>
<p>But according to my experience, I found it is not true, or is partially true.</p>
<p>The path to assets folder varies according to the build system being used. So it could be very confusing and sometimes make things too complicated.</p>
<h3 id="ADT"><a href="#ADT" class="headerlink" title="ADT"></a>ADT</h3><p>For the very traditional ADT build system, then the assets folder is located at <code>&lt;project root&gt;/assets</code></p>
<h3 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h3><p>For new Gradle build system, it changed the project structure definition, which is slightly different to the ADT one.</p>
<p>Gradle build system requires the assets folder is part of the “source code” so the asset folder should located at <code>&lt;project root&gt;/src/main/assets/</code>.</p>
<p>For more detailed information, check out this <a href="http://tools.android.com/tech-docs/new-build-system/user-guide#TOC-Project-Structure" target="_blank" rel="external">document</a>.</p>
<h3 id="Android-Studio"><a href="#Android-Studio" class="headerlink" title="Android Studio"></a>Android Studio</h3><p>In Android Studio (also apply to IntelliJ IDEA), things get a little bit more complicated. The assets path could be configured in project.</p>
<p>Android Studio store this path in project file (*.iml), which is an xml file. In the project file, under the XPath <code>/module/component@name=&quot;FacetManager&quot;/facet@type=&quot;android&quot;/configuration</code>, there could be a <code>&lt;option&gt;</code> node with name <code>ASSETS_FOLDER_RELATIVE_PATH</code> to descript the path.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">option</span> <span class="attr">name</span>=<span class="string">"ASSETS_FOLDER_RELATIVE_PATH"</span> <span class="attr">value</span>=<span class="string">"/assets"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>If the option element with specific name doesn’t exist, please manully create it.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><ul>
<li><p>Using Eclipse + ADT, place the assets at <code>&lt;project root&gt;/assets</code></p>
</li>
<li><p>Using Android Studio (or IntelliJ) with Ant or Maven, place the assets at <code>&lt;project root&gt;/assets</code>. And set <code>ASSETS_FOLDER_RELATIVE_PATH</code> to <code>/assets</code></p>
</li>
<li><p>Using Android Studio with Gradle, place the assets at <code>&lt;project root&gt;/src/main/assets/</code>. And set <code>ASSETS_FOLDER_RELATIVE_PATH</code> to <code>/src/main/assets</code>. And invoke <code>mergeAssets</code> during build.</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/12/13/asset-path-in-android-stuidio/" data-id="ciqg4g840005p6nsilc6dzhts" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/12/13/asset-path-in-android-stuidio/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-studio/">android studio</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/assets/">assets</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/folder/">folder</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gradle/">gradle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/idea/">idea</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/intellij/">intellij</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/path/">path</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/resource/">resource</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-dynamically-inflates-ui-in-android-app" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/12/13/dynamically-inflates-ui-in-android-app/" class="article-date">
  <time datetime="2013-12-13T00:00:00.000Z" itemprop="datePublished">2013-12-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/12/13/dynamically-inflates-ui-in-android-app/">Dynamically inflates UI in Android App</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>There is a fascinating idea that inflates UI according to an android layout xml downloaded from server. According to the Android API, it looks quite feasible.</p>
<p>One of <code>LayoutInflate.inflate</code> <a href="http://developer.android.com/reference/android/view/LayoutInflater.html#inflate(org.xmlpull.v1.XmlPullParser, android.view.ViewGroup)" target="_blank" rel="external">method overloads</a> accept Layout Xml as <code>XmlPullParser</code>.</p>
<p>And <code>XmlPullParser</code> can wrap around an input stream, so as consequence, following code seems to be working:</p>
<figure class="highlight java"><figcaption><span>Inflate view on the fly</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicView</span> <span class="keyword">extends</span> <span class="title">FrameLayout</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DynamicView</span><span class="params">(Context context, InputStream layoutData)</span> <span class="keyword">throws</span> XmlPullParserException </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line"></div><div class="line">        createView(context, layoutData);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createView</span><span class="params">(Context context, InputStream layoutData)</span> <span class="keyword">throws</span> XmlPullParserException </span>&#123;</div><div class="line">        LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);</div><div class="line"></div><div class="line">        XmlPullParserFactory factory = XmlPullParserFactory.newInstance();</div><div class="line">        factory.setNamespaceAware(<span class="keyword">true</span>);</div><div class="line">        XmlPullParser parser = factory.newPullParser();</div><div class="line"></div><div class="line">        parser.setInput(layoutData, <span class="string">"UTF-8"</span>);</div><div class="line"></div><div class="line">        inflater.inflate(parser, <span class="keyword">this</span>, <span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div></pre></td></tr></table></figure>
<p>The code looks great, compiling looks fine, but when the code excuted, an exception is thrown by the inflater.</p>
<p>According to the LayoutInflater document, this approach won’t work(at least for now, it won’t).</p>
<blockquote><p>For performance reasons, view inflation relies heavily on pre-processing of XML files that is done at build time. Therefore, it is not currently possible to use LayoutInflater with an XmlPullParser over a plain XML file at runtime.</p>
<footer><strong>LayoutInflater Document</strong><cite><a href="http://developer.android.com/reference/android/view/LayoutInflater.html" target="_blank" rel="external">developer.android.com</a></cite></footer></blockquote>
<p>Actually, Android compiler compiles the layout xml files into binary xml block, which has convert attributes into some special format. And in Android SDK, the <code>LayoutInflater</code> uses <code>XmlResourceParser</code> instead of plain <code>XmlPullParser</code>, which is created by <code>XmlBlock</code>.</p>
<p><code>XmlBlock</code> is an internal class used in <code>Resources</code> to cache the binary xml document.</p>
<p>And there is no way to create XmlResourceParser or other classes to inject custom behavior into this process. Personally assume that it is pretty much related to the Android Resource and Theming mechanism, there are quite a number cross references between resources. To make it works in a efficient way, Android Runtime did a lot work, such as cache and pre-processing. To override this behavior require quite a number of work and need to aware of potential performance issue. Since the inflating could happen quite often during navigation.</p>
<p>As a not that fansy alternative, UI based on HTML hosted in WebView could be considered.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/12/13/dynamically-inflates-ui-in-android-app/" data-id="ciqg4g843005v6nsi8052522j" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/12/13/dynamically-inflates-ui-in-android-app/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dynamic/">dynamic</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/inflate/">inflate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/layout-inflater/">layout inflater</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/on-the-fly/">on the fly</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/runtime/">runtime</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ui/">ui</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xml/">xml</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-reuse-android-built-in-bluetooth-device-picker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/12/11/reuse-android-built-in-bluetooth-device-picker/" class="article-date">
  <time datetime="2013-12-11T00:00:00.000Z" itemprop="datePublished">2013-12-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/12/11/reuse-android-built-in-bluetooth-device-picker/">Reuse Android built-in Bluetooth Device Picker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Most Android devices support Bluetooth, and most Android ROMs has built-in bluetooth device picker, which is available to other system apps to select a bluetooth device. Theoretically the Bluetooth Device Picker could be reuse in any apps. But for some reasons, the API is not documented, and not published to everyone.</p>
<p>But it is possible to reuse such resources, so I wrote the following code. But due to the using of undocumented API, so it is not garenteed to work on all android devices.</p>
<p><a href="https://gist.github.com/timnew/7908603" target="_blank" rel="external">Code is available as Gist</a></p>
<script src="//gist.github.com/7908603.js"></script>
<p>In the code I uses the <a href="https://github.com/excilys/androidannotations" target="_blank" rel="external">Android Annotations</a>, but it should be easy to remove the dependency on <code>Android Annotations</code> by adding a constructor to BluetoothDeviceManager that accepts <code>Context</code>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/12/11/reuse-android-built-in-bluetooth-device-picker/" data-id="ciqg4g83p005d6nsi7px0c299" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/12/11/reuse-android-built-in-bluetooth-device-picker/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/activity/">activity</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bluetooth/">bluetooth</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/built-in/">built-in</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/device/">device</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/picker/">picker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reuse/">reuse</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/system/">system</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-adjust-files-encoding-in-finder-context-menu-gb1312-to-utf-8-with-1-click" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/10/27/adjust-files-encoding-in-finder-context-menu-gb1312-to-utf-8-with-1-click/" class="article-date">
  <time datetime="2013-10-27T00:00:00.000Z" itemprop="datePublished">2013-10-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/mac/">Mac</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/10/27/adjust-files-encoding-in-finder-context-menu-gb1312-to-utf-8-with-1-click/">Adjust files encoding in Finder context menu &quot;GB1312 to UTF-8 with 1-click&quot;</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>One of the most annoying thing of Mac is that encoding, espeically you’re living in a non-Mac world.</p>
<p>Mac uses UTF-8 as the default encoding for text files. But Windows uses local encoding, so it changes according to your OS language.  For Chinese users, Windows uses GB2312 as the default encoding.</p>
<p>So usually the movie subtitle files, the song lyrics files, the plain text novel files, the code contains Chinese, which you downloaded form web sites or recieved from others usually cannot be read because of the wrong encoding.</p>
<p>So I really wish to have an item in my finder’s context menu that I can adjust the encoding of selected files with 1-click.</p>
<p>Luckily, with the help of Ruby, Automator workflow and Mac OSX service, it isn’t that hard.</p>
<p>So basically, OSX loads all the workflow files saved in <code>~/Library/Services/</code>, which is displayed as Context Menu in finder.</p>

<p>To build the service, work through the following steps:</p>
<h2 id="1-To-create-a-new-service-just-pick-Service-in-Automator’s-‘create-new-document’-dialog"><a href="#1-To-create-a-new-service-just-pick-Service-in-Automator’s-‘create-new-document’-dialog" class="headerlink" title="1. To create a new service, just pick Service in Automator’s ‘create new document’ dialog."></a>1. To create a new service, just pick <code>Service</code> in Automator’s ‘create new document’ dialog.</h2>
<h2 id="2-Set-service-input-as-“files-and-folders-from-any-application”"><a href="#2-Set-service-input-as-“files-and-folders-from-any-application”" class="headerlink" title="2. Set service input as “files and folders from any application”."></a>2. Set service input as “files and folders from any application”.</h2>
<h2 id="3-Run-Ruby-Script-to-transcode-the-files"><a href="#3-Run-Ruby-Script-to-transcode-the-files" class="headerlink" title="3. Run Ruby Script to transcode the files"></a>3. Run Ruby Script to transcode the files</h2><p>Add a “Run Shell Script” action to execute the following ruby code, which is used to transcode the files passed to service. (For more detail about how to embed Ruby in workflow, check out <a href="/blog/2013/10/27/using-rvmed-ruby-in-mac-automator-workflow/">Using RVMed Ruby in Mac Automator Workflow</a> )</p>
<p>Make sure the input is passed as arugments to the ruby script.</p>

<figure class="highlight ruby"><figcaption><span>Transcode the files</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">old_files = []</div><div class="line"></div><div class="line">ARGV.each <span class="keyword">do</span> <span class="params">|name|</span></div><div class="line">  <span class="keyword">next</span> <span class="keyword">until</span> File.file? name</div><div class="line">  backup_name = name + <span class="string">'.old'</span></div><div class="line">  File.rename name, backup_name</div><div class="line"></div><div class="line">  source = File.open backup_name, <span class="string">'r:GB2312:UTF-8'</span></div><div class="line">  dest = File.open name, <span class="string">'w'</span></div><div class="line"></div><div class="line">  <span class="keyword">while</span> line = source.gets</div><div class="line">      dest.puts line</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  puts name</div><div class="line"></div><div class="line">  old_files &lt;&lt; backup_name</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">ENV[<span class="string">'Transcode_Backup_Files'</span>] = old_files.join(<span class="string">'|'</span>)</div><div class="line"></div></pre></td></tr></table></figure>
<h2 id="4-Display-a-growl-message-when-processing-is-done"><a href="#4-Display-a-growl-message-when-processing-is-done" class="headerlink" title="4. Display a growl message when processing is done"></a>4. Display a growl message when processing is done</h2>
<h2 id="5-Prompt-user-whether-to-keep-the-backup-files"><a href="#5-Prompt-user-whether-to-keep-the-backup-files" class="headerlink" title="5. Prompt user whether to keep the backup files"></a>5. Prompt user whether to keep the backup files</h2><p>I use a <code>Ask for confirmation</code> action to ask whether user want to keep the backup files.<br>The workflow will abort if user clicks “No”, make sure you updated the text on the buttons, and texts are put on right button.</p>

<h2 id="6-Add-script-to-remove-backup-files"><a href="#6-Add-script-to-remove-backup-files" class="headerlink" title="6. Add script to remove backup files"></a>6. Add script to remove backup files</h2><p>Add another “Run Shell Script” aciton to execute another piece of ruby code.</p>

<figure class="highlight ruby"><figcaption><span>Remove backup files</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">if</span> ENV[<span class="string">'Transcode_Backup_Files'</span>]</div><div class="line">    ENV[<span class="string">'Transcode_Backup_Files'</span>].split(<span class="string">'|'</span>).each <span class="keyword">do</span> <span class="params">|file|</span></div><div class="line">        File.delete file</div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    ENV.delete <span class="string">'Transcode_Backup_Files'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div></pre></td></tr></table></figure>
<h2 id="7-Display-notification-to-tell-user-that-backup-files-has-been-deleted"><a href="#7-Display-notification-to-tell-user-that-backup-files-has-been-deleted" class="headerlink" title="7. Display notification to tell user that backup files has been deleted"></a>7. Display notification to tell user that backup files has been deleted</h2>
<p><strong>TIP:</strong> The transcode ruby script requires Ruby 1.9+, but Mac OS X default provides Ruby 1.8.3, which doesn’t support encoding. To interprets workflow embedded code with ruby 1.9+, please refers to <a href="/blog/2013/10/27/using-rvmed-ruby-in-mac-automator-workflow/">Using RVMed Ruby in Mac Automator Workflow</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/10/27/adjust-files-encoding-in-finder-context-menu-gb1312-to-utf-8-with-1-click/" data-id="ciqg4g842005r6nsi0cw2m88s" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/10/27/adjust-files-encoding-in-finder-context-menu-gb1312-to-utf-8-with-1-click/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gb2312/">GB2312</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gbk/">GBK</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/encoding/">encoding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lyrics/">lyrics</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/messy-code/">messy code</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/subtitle/">subtitle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/transcode/">transcode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/utf8/">utf8</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-using-rvmed-ruby-in-mac-automator-workflow" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/10/27/using-rvmed-ruby-in-mac-automator-workflow/" class="article-date">
  <time datetime="2013-10-27T00:00:00.000Z" itemprop="datePublished">2013-10-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/mac/">Mac</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/10/27/using-rvmed-ruby-in-mac-automator-workflow/">Using RVMed Ruby in Mac Automator Workflow</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>HINT</strong> This content is obsoleted on OSX 10.9 Mavericks</p>
<h2 id="Embed-Ruby-into-Automator-Workflow"><a href="#Embed-Ruby-into-Automator-Workflow" class="headerlink" title="Embed Ruby into Automator Workflow"></a>Embed Ruby into Automator Workflow</h2><p>Automator workflow has the ability to execute ruby code, but it is not that obvious if you doesn’t know it.</p>
<p>To embed ruby code into workflow, you need to create a “Run Shell Script” action first, then choose “/usr/bin/ruby” as the shell. Then the script in the text box will be parsed and executed as ruby code.</p>
<img src="/blog/2013/10/27/using-rvmed-ruby-in-mac-automator-workflow/ruby_in_automator.png" alt="Ruby In Automator" title="Ruby In Automator">
<p>So, from now on, you know how to embed ruby into automator workflow.</p>
<h2 id="Use-RVM-ruby-instead-of-System-Ruby"><a href="#Use-RVM-ruby-instead-of-System-Ruby" class="headerlink" title="Use RVM ruby instead of System Ruby"></a>Use RVM ruby instead of System Ruby</h2><p>By default, Automator will load system ruby at <code>/usr/bin/ruby</code>, which is ruby v1.8.7 without bundler support. For most ruby developers, they must have installed some kind of ruby version manager, such as <code>RVM</code> or <code>rbenv</code>. As to me, I uses <code>RVM</code>. So I wish I could use RVMed versions of Ruby rather than the system ruby, could be ruby 1.9.3 or even ruby 2.0 with bundler support.</p>
<p>To use the RVMed ruby, I tried several approaches by hacking different configurations or files. And at last, I made it doing this:</p>
<p>RVM provides a ruby executable file at <code>~/.rvm/bin/ruby</code>. On the other hand, <code>/usr/bin/ruby</code> is actually a symbol link that pointed to ‘/System/Library/Frameworks/Ruby.framework/Versions/Current/usr/bin/ruby’.</p>
<p>So what we need to do is to replace the the symbol link with a new one pointed to <code>~/.rvm/bin/ruby</code>.</p>
<figure class="highlight bash"><figcaption><span>Replace system ruby with RVMed ruby</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sudo mv /usr/bin/ruby /usr/bin/system_ruby</div><div class="line">sudo ln <span class="_">-s</span> /Users/timnew/.rvm/bin/ruby /usr/bin/ruby</div><div class="line"></div></pre></td></tr></table></figure>
<p>(You might need to replace the <code>/Users/timnew/.rvm/bin/ruby</code> with the path to your ruby executable file)</p>
<p>After doing this, done, you have the RVMed ruby in your Automator Workflow.</p>
<p>You can try to excute the following code in Workflow to verify it:</p>
<figure class="highlight ruby"><figcaption><span>Test Ruby Version</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">puts RUBY_VERSION</div></pre></td></tr></table></figure>
<p>If you do it correct, then you should see ‘1.9.3’ or any other version of ruby you have configured.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/10/27/using-rvmed-ruby-in-mac-automator-workflow/" data-id="ciqg4g83t005l6nsi01mu0dug" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/10/27/using-rvmed-ruby-in-mac-automator-workflow/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mac/">Mac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/osx/">OSX</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rvm/">RVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/automator/">automator</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/finder/">finder</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/service/">service</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-arduino-ide-1-5-3-is-too-buggy-to-use-and-work-arounds" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/10/27/arduino-ide-1-5-3-is-too-buggy-to-use-and-work-arounds/" class="article-date">
  <time datetime="2013-10-27T00:00:00.000Z" itemprop="datePublished">2013-10-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/arduino/">Arduino</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/10/27/arduino-ide-1-5-3-is-too-buggy-to-use-and-work-arounds/">Arduino IDE 1.5.3 is too buggy to use and work arounds</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The Arduino IDE 1.5.3 introduced some new features, such as support latest board Yun, or introduces new libraries and samples. But I found it is too buggy to use.</p>
<h2 id="1-Compile-code-against-Arduino-Nano-fails-due-to-parameter-mcu-passed-to-avrdude-is-missing"><a href="#1-Compile-code-against-Arduino-Nano-fails-due-to-parameter-mcu-passed-to-avrdude-is-missing" class="headerlink" title="1. Compile code against Arduino Nano fails due to parameter mcu passed to avrdude is missing."></a>1. Compile code against Arduino Nano fails due to parameter <code>mcu</code> passed to <code>avrdude</code> is missing.</h2><p><strong>Reason:</strong><br>The issue seems caused because the new IDE merged the menu items for Nano board. But for some reason, the configuration haven’t been updated accordingly.</p>
<p><strong>Workaround:</strong><br>Choose <code>Arduino Duemilanove and Diecimila</code> instead of <code>Arduino Nano</code>. Nano uses same chip as Duemilanove(ATmega328) and Diecimila(ATmega168), but uses a different PCB design. So the binary should be compatible.</p>
<h2 id="2-Compile-String-100-DEC-throws-ambiguous-matching-error"><a href="#2-Compile-String-100-DEC-throws-ambiguous-matching-error" class="headerlink" title="2. Compile String(100, DEC) throws ambiguous matching error"></a>2. Compile <code>String(100, DEC)</code> throws <code>ambiguous matching</code> error</h2><p><strong>Reason:</strong><br>The issue is caused because the API signature updated to <code>String(*, unsigned char)</code>, but constants are still declared as <code>int</code>.</p>
<p><strong>Workaround:</strong><br>Add force cast <code>DEC</code>, <code>HEX</code>, <code>BIN</code> to <code>byte</code> instead of <code>int</code>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/10/27/arduino-ide-1-5-3-is-too-buggy-to-use-and-work-arounds/" data-id="ciqg4g83o005a6nsi2tjf7q1u" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/10/27/arduino-ide-1-5-3-is-too-buggy-to-use-and-work-arounds/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ide/">IDE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/string/">String</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduino/">arduino</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/buggy/">buggy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/compile/">compile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/error/">error</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nano/">nano</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solution/">solution</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/workaround/">workaround</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-in-isenum-method-in-java" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/07/18/pitfall-in-isenum-method-in-java/" class="article-date">
  <time datetime="2013-07-18T00:00:00.000Z" itemprop="datePublished">2013-07-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/07/18/pitfall-in-isenum-method-in-java/">Pitfall in isEnum method in Java</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I found a very interesting phenomenon in Java type reflection when building an Android app.<br>I’m trying to build a common mechanism to serialize Enum into integer when writing it into database. To make it more flexible so I fetch the value type dynamically by using reflection. So I have the following code to check whether the value to be written is an enumeration:</p>
<figure class="highlight java"><figcaption><span>Code to check enumeration</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">CONVERTERS.add(<span class="keyword">new</span> ValueConverter() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(Object value)</span> </span>&#123;</div><div class="line">        Class type = value.getType();</div><div class="line">        <span class="keyword">return</span> type.isEnum(); <span class="comment">// Doesn't work</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">convert</span><span class="params">(Object value)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> String.valueOf(((Enum) value).ordinal());</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div></pre></td></tr></table></figure>
<p>I built the converters into a <code>responsibility chain</code>. The converter is applied only when <code>match</code> method returns true.</p>
<p>In the converter, I check the type with <code>isEnum</code> method. I expects the method yields true when the value is a enumeration. But later I found it doesn’t work as expected. And the behavior of this method is really confusing!</p>
<p>Here is how it works:</p>
<figure class="highlight java"><figcaption><span>How isEnum works</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ServiceStatus &#123;</div><div class="line">  NOT_COVERED,</div><div class="line">  PARTIAL,</div><div class="line">  FULL</div><div class="line">&#125;</div><div class="line"></div><div class="line">assertThat(ServiceStatus.class.isEnum()).isTrue();</div><div class="line">assertThat(ServiceStatus.FULL.class.isEnum()).isFalse();</div><div class="line">assertThat(ServiceStatus.FULL.getType().isEnum()).isFalse();</div><div class="line"></div></pre></td></tr></table></figure>
<p>Due to the implementation of Java Enumeration, the definition of enumeration value could be understood as the following code:</p>
<figure class="highlight java"><figcaption><span>Java Enumeration psudo-code</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ServiceStatus</span>$2 <span class="keyword">extends</span> <span class="title">ServiceStatus</span> </span>&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ServiceStatus FULL = <span class="keyword">new</span> ServiceStatus$<span class="number">2</span>();</div><div class="line"></div></pre></td></tr></table></figure>
<p>So the value <code>FULL</code> has a different type than <code>ServiceStatus</code> as I expected, the type of <code>FULL</code> is actually a subclass of <code>ServiceStatus</code>. And the enumeration value <code>FULL</code> is a singleton instance of the anonymous sub-class.</p>
<p>The the most unexpected behavior is that the <code>isEnum</code> method only returns true on Enumeration class itself, not its subclass!</p>
<p>To resolve this issue gracefully, I changed my implementation a little bit. Here is the updated implementation:</p>
<figure class="highlight java"><figcaption><span>Updated implementation</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">CONVERTERS.add(<span class="keyword">new</span> ValueConverter() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(Object value)</span> </span>&#123;</div><div class="line">        Class type = value.getType();</div><div class="line">        <span class="keyword">return</span> Enum.class.isAssignableFrom(type);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">convert</span><span class="params">(Object value)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> String.valueOf(((Enum) value).ordinal());</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div></pre></td></tr></table></figure>
<p>I uses <code>isAssignableFrom</code> to check whether value is the subclass of Enum or could be casted into Enum. I found this approach solved the issue gracefully.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/07/18/pitfall-in-isenum-method-in-java/" data-id="ciqg4g83q005g6nsicd7fp0hf" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/07/18/pitfall-in-isenum-method-in-java/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/enumeration/">enumeration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/isenum/">isEnum()</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/reflection/">reflection</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-sqlite-database-requires-special-table" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/06/21/android-sqlite-database-requires-special-table/" class="article-date">
  <time datetime="2013-06-21T00:00:00.000Z" itemprop="datePublished">2013-06-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/06/21/android-sqlite-database-requires-special-table/">Android SQLite database requires special table</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’m working on an Android application recently. During the development, our new app inherited a legacy SQLite database that created by a WinCE application.</p>
<p>Android announce that it supports the SQLite database, so we don’t worry about that too much. But when we try to open the legacy database with  <code>SQLiteDatabase.openDatabase</code>, it throws exception on our face!</p>
<p>After debugging, we found to open SQLite database with <code>SQLiteDatabase</code> class requires the database to have a special table called <code>android_metadata</code>, which contains the locale information. And <code>SQLiteDatabase</code> yields exception when the table cannot be found.</p>
<p>The table will be created automatically when <code>SQLiteDatabase</code> creates the database, but if the app need to open the database not created by android, some patch is needed.</p>
<p>Here is the script to patch the database:</p>
<figure class="highlight sql"><figcaption><span>Patch Database</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> android_metadata (locale <span class="built_in">TEXT</span>);</div><div class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> android_metadata <span class="keyword">VALUES</span>(<span class="string">'en-US'</span>);</div><div class="line"></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/06/21/android-sqlite-database-requires-special-table/" data-id="ciqg4g83l00526nsi7yot1a46" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/06/21/android-sqlite-database-requires-special-table/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-metadata/">android_metadata</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/crash/">crash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/exception/">exception</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlite/">sqlite</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/table/">table</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-script-to-manage-tw-t-e" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/06/20/script-to-manage-tw-t-e/" class="article-date">
  <time datetime="2013-06-20T00:00:00.000Z" itemprop="datePublished">2013-06-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/06/20/script-to-manage-tw-t-e/">Script to manage TW T&amp;E</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Have been on travel once again, and really found filling the ThoughtWorks T&amp;E expense form is really painful.</p>
<p>So I spent some time to refine the scripts that wrote last year when I was on Travel, which could be stimulate the pain when filing the form.</p>
<p>Post and managed as <a href="http://goo.gl/nG4Vm" target="_blank" rel="external">Gist</a></p>
<script src="//gist.github.com/5823705.js"></script>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/06/20/script-to-manage-tw-t-e/" data-id="ciqg4g83k004x6nsipi79qatw" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/06/20/script-to-manage-tw-t-e/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/expense/">expense</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/injection/">injection</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/time-sheet/">time sheet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/utility/">utility</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-node-over-express-autoload" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/27/node-over-express-autoload/" class="article-date">
  <time datetime="2013-04-27T00:00:00.000Z" itemprop="datePublished">2013-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/27/node-over-express-autoload/">Node over Express - Autoload</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>This is the 2nd post of the <a href="/blog/tags/#node over express-ref">Node over Express</a> series (the previous one is <a href="/blog/2013/04/25/node-over-express-configuration/">Configuration</a>). In this post, I’d like to discuss a famous pain point in Node.js.</p>
<h2 id="Pain-Point"><a href="#Pain-Point" class="headerlink" title="Pain Point"></a>Pain Point</h2><p>There is well known Lisp joke:</p>
<blockquote><p>A top hacker successfully stole the last 100 lines of a top secret program from the Pentagon. Because the program is written in Lisp, so the stolen code is just close brackets.</p>
</blockquote>
<p>It is a joke that there are too many brackets in Lisp. In Node.js there is a similar issue that there are too many <code>require</code>. Open any node.js file, usually one could find several lines of <code>require</code>.</p>
<p>Due to the node’s sandbox model, the developer has to require resources time and time again in every files. It is not so exciting to write or read lines of meaningless <code>require</code>. And the worst, it could be a nightmare once a developer wishes to replace some library with another.</p>
<h2 id="Rails-Approaches"><a href="#Rails-Approaches" class="headerlink" title="Rails Approaches"></a>Rails Approaches</h2><p>“Require hell” isn’t only for node.js, but also for Ruby apps. Rails has solved it gracefully, and the developer barely needs to require anything manually in Rails.</p>
<p>There are 2 kinds of dependencies in rails app, one is the external resource, another is the internal resource.</p>
<h3 id="External-Resources"><a href="#External-Resources" class="headerlink" title="External Resources"></a>External Resources</h3><p>External resources are classes encapsulated in ruby gems. In ruby application, developer describe the dependencies in <code>Gemfile</code>, and load them with <code>Bundler</code>. Some frameworks have already integrated with <code>Bundler</code>, such as Rails. When using them, developer doesn’t need to do anything manually, all the dependencies are required automatically. For others, use <code>bundle execute</code> to create the ruby runtime with all gems required.</p>
<h3 id="Internal-Resources"><a href="#Internal-Resources" class="headerlink" title="Internal Resources"></a>Internal Resources</h3><p>Internal Resources are the classes declared in the app, they could be models, the services or the controllers. Rails uses <code>Railtie</code> to require them automatically. The resource is loaded the first time it is used, the requiring process is “Lazy”. (In fact, this description isn’t that precise because Rails behaves differently in production environment. It loads all the classes during the launching for performance reason).</p>
<h2 id="Autoload-in-Node-js"><a href="#Autoload-in-Node-js" class="headerlink" title="Autoload in Node.js"></a>Autoload in Node.js</h2><p>Rails avoids the “require-hell” with two “autoload” mechanisms. Although there are still debates about whether autoload is good or not. But at least, autoload frees the developer from the dull dependency management and increases the productivity of developers. Developers love autoload in most cases.</p>
<p>So to avoid “require-hell” in Node.js, I prefers autoload mechanism. But because there are significant differences in type system between Node.js and Ruby, we cannot copy the mechanism from ruby to node as is. Therefore before diving into the solution, we need to understand the differences first.</p>
<h3 id="Node-js-Module-System"><a href="#Node-js-Module-System" class="headerlink" title="Node.js Module System"></a>Node.js Module System</h3><p>There are a number of similarities between Node.js and ruby; things in node.js usually have the equivalences in ruby. For example, <code>package</code> in node is similar to the <code>gem</code> in Ruby, <code>npm</code> equals to <code>Gem</code> and <code>Bundler</code>, <code>package.json</code> takes the responsibility of <code>Gemfile</code> and <code>Gemfile.lock</code>. The similarity enables porting autoload from ruby to node.</p>
<p>In some aspect, there are similarities between Node.js and Ruby, but there are also significant differences between them in some other aspects. One of the major differences is the type system and module sandbox in Node.js, which works in a quite different way to Ruby type system.</p>
<p>JavaScript isn’t a real OO language, so it doesn’t have real type system. All the types in JavaScript are actually functions, which are stored in local variables instead of in type system. Node.js loads files into different sandboxes, all the local variables are isolated between files to avoid “global leak”, a well-known deep-seated bad part of JavaScript. As a result, a Node.js developer needs to require used types again and again in every file.</p>
<p>In ruby, it is a lot better. With the help of the well designed type system, types are shared all over the runtime, a developer just needs to require the types not yet loaded.</p>
<p>So in node.js programs, there are many more <code>require</code> statements than in ruby. And due to the design of node.js and javascript, the issue is harder to be resolved.</p>
<h3 id="Global-Variable"><a href="#Global-Variable" class="headerlink" title="Global Variable"></a>Global Variable</h3><p>In the browser, the JavaScript runtime other than node, global variables are very common. Global variable could be abused easily, which brings global leak to bad written JavaScript programs, and drives thousands of developers up to the wall. The JavaScript developers are scared of global leak so much so that they designed such a strict isolation model in node.js. But to my understanding, the isolation avoided global leaks effectively. But at the same time, it brought tens of require statements to every files, which is also not acceptable.</p>
<p>In fact, with the help of JSLint, CoffeScript and some other tools, developers can avoid global leak easily. And global sharing isn’t the source of evil. If abuse is avoided, I believes a reasonable level of global sharing could be useful and helpful. Actually Node.js have built-in a global sharing mechanism.</p>
<p>To share values across file, a special variable <code>global</code> is needed, which could be accessed in every file, and the value of which is also shared across files.</p>
<p>Besides sharing value around, <code>global</code> has another important feature: node treats <code>global</code> as default context, whose child you can refer to without explicitly identifying. So <code>SomeType === global.SomeType</code>.</p>
<p>With the help of <code>global</code>, we find a way to share types across files naturally.</p>
<h3 id="JS-Property"><a href="#JS-Property" class="headerlink" title="JS Property"></a>JS Property</h3><p>Rails’ autoload mechanism loads the classes lazily. It only loads the class when it is used for first time. It is a neat feature, and Rails achieve it by tracking the exception of “Uninitialized Constant”. To implement similar feature in Node.js, tracking exception is hardly feasible, so I choose a different approach, I use Property.</p>
<p>Property (Attribute in Ruby) enables method (function) being invoked as the field of an object is accessed. Property is a common feature among OO languages, but is a “new” feature to JavaScript. Property is a feature declared in <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" target="_blank" rel="external">ECMAScript 5 standard</a>, which enables the developers to declare property on object by using the API <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="external">Object.defineProperty</a>. With the property, we’re able to hook the callback on the type variables, and require the types when the type is accessed. So the module won’t be required until it is used. On the other hand, node.js <code>require</code> function has built in the cache mechanism; it won’t load the file twice, instead it return the value from its cache.</p>
<p>With property, we make the autoload lazy!</p>
<h3 id="My-Implementation"><a href="#My-Implementation" class="headerlink" title="My Implementation"></a>My Implementation</h3><p>To make autoload work, we need to create a magic host object to hold the type variables. In my implementation, I call the magic object Autoloader<br>we need to require a bootstrap script when the app starts, which is used to describe which types and how they should be required.</p>
<figure class="highlight coffeescript"><figcaption><span>Bootstrap Script: initEnvironment.coffee</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">global</span>.createAutoLoader = <span class="built_in">require</span>(<span class="string">'./services/AutoLoader'</span>)</div><div class="line"><span class="built_in">global</span>.createPathHelper = <span class="built_in">require</span>(<span class="string">'./services/PathHelper'</span>)</div><div class="line"></div><div class="line"><span class="built_in">global</span>.rootPath = createPathHelper(__dirname, <span class="literal">true</span>)</div><div class="line"></div><div class="line"><span class="built_in">global</span>.Configuration = <span class="built_in">require</span>(rootPath.config(<span class="string">'configuration'</span>))</div><div class="line"></div><div class="line"><span class="built_in">global</span>.Services = createAutoLoader rootPath.services()</div><div class="line"><span class="built_in">global</span>.Routes = createAutoLoader rootPath.routes()</div><div class="line"><span class="built_in">global</span>.Records = createAutoLoader rootPath.records()</div><div class="line"><span class="built_in">global</span>.Models = createAutoLoader rootPath.models()</div><div class="line"></div><div class="line"><span class="built_in">global</span>.assets = &#123;&#125; <span class="comment"># initialize this context for connect-assets helpers</span></div></pre></td></tr></table></figure>
<p>The script sets-up the autoload hosts for all services, routes, records, models for my app. And we can reference the types as following:</p>
<figure class="highlight coffeescript"><figcaption><span>Sample Usage</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Records.User.findById uid, <span class="function"><span class="params">(err, user)</span> -&gt;</span></div><div class="line">  badge = <span class="keyword">new</span> Models.Badget(badgeInfo)</div><div class="line">  user.addBadge badge</div><div class="line">  user.save()</div></pre></td></tr></table></figure>
<p>In the <code>initEnvironment.coffee</code> script, there are 2 very important classes that are used:</p>
<ul>
<li>AutoLoader: The class that works as the type variable hosts. All the magic happens here.</li>
<li>PathHelper: The class used to handle the path combination issue.</li>
</ul>
<p>The detailed implementation is here:<br><figure class="highlight coffeescript"><figcaption><span>Autoload</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">_ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line">createPathHelper = <span class="built_in">require</span>(<span class="string">'./PathHelper'</span>)</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">createLoaderMethod</span> = <span class="params">(host, name, fullName)</span> -&gt;</div><div class="line">  host.__names.push name</div><div class="line">  Object.defineProperty host, name,</div><div class="line">                        get: <span class="function">-&gt;</span></div><div class="line">                          <span class="built_in">require</span>(fullName)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoLoader</span></span></div><div class="line">  constructor: <span class="function"><span class="params">(source)</span> -&gt;</span></div><div class="line">    @__names = []</div><div class="line">    <span class="keyword">for</span> name, fullName <span class="keyword">of</span> source</div><div class="line">      extName = path.extname fullName</div><div class="line">      createLoaderMethod(<span class="keyword">this</span>, name, fullName) <span class="keyword">if</span> <span class="built_in">require</span>.extensions[extName]? <span class="keyword">or</span> extName == <span class="string">''</span></div><div class="line"><span class="function"></span></div><div class="line"><span class="title">expandPath</span> = <span class="params">(rootPath)</span> -&gt;</div><div class="line">  createPathHelper(rootPath).toPathObject()</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">buildSource</span> = <span class="params">(items)</span> -&gt;</div><div class="line">  result = &#123;&#125;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> item <span class="keyword">in</span> items</div><div class="line">    extName = path.extname(item)</div><div class="line">    name = path.basename(item, extName)</div><div class="line">    result[name] = item</div><div class="line"></div><div class="line">  result</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">createAutoLoader</span> = <span class="params">(option)</span> -&gt;</div><div class="line">  pathObj = <span class="keyword">switch</span> <span class="keyword">typeof</span>(option)</div><div class="line">    <span class="keyword">when</span> <span class="string">'string'</span></div><div class="line">      expandPath(option)</div><div class="line">    <span class="keyword">when</span> <span class="string">'object'</span></div><div class="line">      <span class="keyword">if</span> option <span class="keyword">instanceof</span> Array</div><div class="line">        buildSource(option)</div><div class="line">      <span class="keyword">else</span></div><div class="line">        option</div><div class="line"></div><div class="line">  <span class="keyword">new</span> AutoLoader(pathObj)</div><div class="line"></div><div class="line">createAutoLoader.AutoLoader = AutoLoader</div><div class="line"></div><div class="line">exports = <span class="built_in">module</span>.exports = createAutoLoader</div></pre></td></tr></table></figure></p>
<figure class="highlight coffeescript"><figcaption><span>PathHelper</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">_ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">createPathHelper</span> = <span class="params">(rootPath, isConsolidated)</span> -&gt;</div><div class="line">  rootPath = path.normalize rootPath</div><div class="line"><span class="function">  <span class="title">result</span> = <span class="params">(args...)</span> -&gt;</span></div><div class="line">    <span class="keyword">return</span> rootPath <span class="keyword">if</span> args.length == <span class="number">0</span></div><div class="line">    parts = _.flatten [rootPath, args]</div><div class="line">    path.join.apply(<span class="keyword">this</span>, parts)</div><div class="line"></div><div class="line">  result.toPathObject = <span class="function">-&gt;</span></div><div class="line">    self = result()</div><div class="line">    files = fs.readdirSync(self)</div><div class="line">    pathObj = &#123;&#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files</div><div class="line">      fullName = path.join(self, file)</div><div class="line">      extName =  path.extname(file)</div><div class="line">      name = path.basename(file, extName)</div><div class="line">      pathObj[name] = fullName</div><div class="line"></div><div class="line">    pathObj</div><div class="line"></div><div class="line">  result.consolidate = <span class="function">-&gt;</span></div><div class="line">    pathObj = result.toPathObject()</div><div class="line"></div><div class="line">    <span class="keyword">for</span> name, fullName <span class="keyword">of</span> pathObj</div><div class="line">      stats = fs.statSync(fullName)</div><div class="line">      result[name] = createPathHelper(fullName) <span class="keyword">if</span> stats.isDirectory()</div><div class="line"></div><div class="line">    result</div><div class="line"></div><div class="line">  <span class="keyword">if</span> isConsolidated</div><div class="line">    result.consolidate()</div><div class="line">  <span class="keyword">else</span></div><div class="line">    result</div><div class="line"></div><div class="line">exports = <span class="built_in">module</span>.exports = createPathHelper</div></pre></td></tr></table></figure>
<p>The code above are part of the <a href="https://github.com/timnew/ExpressOverNode" target="_blank" rel="external">Express over Node</a>, to access the complete codebase, please check out the <a href="https://github.com/timnew/ExpressOverNode" target="_blank" rel="external">repo</a> on github.</p>
<hr>

<p>Besides of the content, I want to say thank you to my English teacher Marina Sarg, who helped me on this series of blog a lot. Without her, there won’t be this series of blogs. Marina, thank you very much.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/27/node-over-express-autoload/" data-id="ciqg4g83s005j6nsioj03f5i4" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/04/27/node-over-express-autoload/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/autoload/">autoload</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/express/">express</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-over-express/">node over express</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/blog/4/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/3/">3</a><a class="page-number" href="/blog/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/blog/6/">6</a><a class="page-number" href="/blog/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/blog/12/">12</a><a class="extend next" rel="next" href="/blog/6/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Recent Posts</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Tag Cloud</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Categories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>