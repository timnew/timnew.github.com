<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Category: Programming | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/categories/programming/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');

  ga('require', 'displayfeatures');

ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-collection-filtering-algorithm-with-bit-operation-part-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/" class="article-date">
  <time datetime="2016-04-23T09:46:30.000Z" itemprop="datePublished">2016-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/algorithm/">Algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Collection must be the most commonly used data model in programming. And there are a number of data structure that represents collection in memory, in which <code>Array</code> and <code>Liked List</code> must be the most well known ones.</p>
<p>When dealing with collection, <code>filtering</code> must be one of the most widely used operation being used. Such as find item(s) satisfies specific criteria from the collection. Although filtering is used a lot, but it isn’t actually a simple or easy operation to apply, especially dealing with tremendous data volume.</p>
<p>In fact, there are a number of derived topics about collection filtering, which is impossible to cover them all in the article. This article will focus on <code>bit operation</code>, probably a not widely known but really interesting topic to introduce.</p>
<h2 id="Problem-Find-the-missing-integer"><a href="#Problem-Find-the-missing-integer" class="headerlink" title="Problem: Find the missing integer"></a>Problem: Find the missing integer</h2><blockquote><p><strong>Problem</strong><br>Suppose there is a collection of integers <code>L</code>.<br>Name the collection that contains integers from 1 to <code>N</code> as <code>G</code><br>Then <code>L</code> contains all the elements of <code>G</code> except one number <code>x</code>.<br>Items in <code>L</code> are in random order.<br>Find <code>x</code>.</p>
</blockquote>
<p><strong>TIP: </strong> This problem be too easy to experienced developers and algorithm hackers. But it is a good opening words to the following 2 problems in this series. Also it reveals the core concept of some other advanced technologies, such as <code>CRC</code> or <code>bloom filter</code>.</p>
<p>When got this problem, the very intuitive(means do it manually by human being) idea is to compare the elements in <code>L</code> and <code>G</code>, find each element in <code>L</code> and remove it from <code>G</code>, then the only left item in <code>G</code> is <code>x</code>.</p>
<p>Here is the code:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer[] L</span></div><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer N</span></div><div class="line"><span class="comment"># <span class="doctag">@return</span> Integer x</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_missing_x</span><span class="params">(L, N)</span></span></div><div class="line">  G = [*(<span class="number">1</span>..N)] <span class="comment"># Create G with all integers from 1 to N</span></div><div class="line"></div><div class="line">  L.each &#123; <span class="params">|i|</span> G.delete(i) &#125; <span class="comment"># Traverse L, and remove each item in L from G</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> G.last <span class="comment"># Return the only rest item from G</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Well this is a work but brute algorithm, which is not efficient in both time and space:</p>
<ul>
<li>Instantiate <code>G</code> means it has space complexity <code>N</code></li>
<li>Find and remove <code>i</code> from <code>G</code> means it has time complexity at <code>O(N*Log(N))</code></li>
</ul>
<p>Yes, the algorithm can be optimized, with bit operation. In fact the problem can be resolved with time complexity <code>O(N)</code> and space complexity <code>O(1)</code>.</p>
<h2 id="Exclusive-Or-Operation"><a href="#Exclusive-Or-Operation" class="headerlink" title="Exclusive-Or Operation"></a><code>Exclusive-Or</code> Operation</h2><p><code>Exclusive-Or</code>(Or <code>XOR</code> for short, written as <code>^</code> in this article) is a basic bit operation, here is an Venn Diagram explains it:</p>
<img src="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/xor_venn.png" alt="XOR" title="XOR">
<p><code>XOR</code> is an important bit operation because it has following interesting features:</p>
<ol>
<li>A ^ B = B ^ A (aka <strong>Commutativity</strong>)</li>
<li>(A ^ B) ^ C = A ^ (B ^ C) (aka <strong>Associativity</strong>)</li>
<li>A ^ A = 0</li>
<li>A ^ 0 = A</li>
</ol>
<p>Commutativity and Associativity ensure that <code>XOR</code> can be used despite of order. The 3rd and 4th feature establishes a critical position for <code>XOR</code> in <code>cryptology</code> and <code>encoding</code>.</p>
<h2 id="Solution-with-XOR"><a href="#Solution-with-XOR" class="headerlink" title="Solution: with XOR"></a>Solution: with <code>XOR</code></h2><p>By making use of <code>XOR</code>, previous problem can ben resolved in a much more graceful way:</p>
<ul>
<li>Given <code>y</code> is the <code>xor</code> result of all items in <code>G</code></li>
<li>And <code>z</code> is the <code>xor</code> result of all items in <code>L</code></li>
<li>Then <code>x = y ^ z</code></li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer[] L</span></div><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer N</span></div><div class="line"><span class="comment"># <span class="doctag">@return</span> Integer x</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_missing_x</span><span class="params">(L, N)</span></span></div><div class="line">  x = <span class="number">0</span> <span class="comment"># Set x to 0, since A ^ 0 = A</span></div><div class="line"></div><div class="line">  (<span class="number">1</span>..N).each &#123; <span class="params">|i|</span> x ^= i &#125; <span class="comment"># Calculate the xor result for G</span></div><div class="line"></div><div class="line">  L.each &#123; <span class="params">|i|</span> x ^= i &#125; <span class="comment"># Keep xor all elements in L</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> x <span class="comment"># Return the only rest item from G</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Let’s prove it mathematically:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Given</span> x<span class="string">'= y ^ z</span></div><div class="line">Then  x' = (n1<span class="regexp"> ^</span> n2<span class="regexp"> ^</span> n3<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> x<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> nN)<span class="regexp"> ^</span> (n1<span class="regexp"> ^</span> n2<span class="regexp"> ^</span> n3<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> nN)</div><div class="line">Since<span class="regexp"> ^</span> obeys commutativity and associativity</div><div class="line">Then  = (n1<span class="regexp"> ^</span> n1)<span class="regexp"> ^</span> (n2<span class="regexp"> ^</span> n2)<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> (nN<span class="regexp"> ^</span> nN)<span class="regexp"> ^</span> x</div><div class="line">As n<span class="regexp"> ^</span> n = <span class="number">0</span> and n<span class="regexp"> ^</span> <span class="number">0</span> = n</div><div class="line">Then  x<span class="string">'= 0 ^ 0 ^ ... ^ 0 ^ x</span></div><div class="line">         = x</div></pre></td></tr></table></figure></p>
<p>Actually the code can be more concise by using <code>reduce</code>, with 2-lines of code</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer[] L</span></div><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer N</span></div><div class="line"><span class="comment"># <span class="doctag">@return</span> Integer x</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_missing_x</span><span class="params">(L, N)</span></span></div><div class="line">  x = (<span class="number">1</span>..N).reduce(&amp;<span class="symbol">:^</span>) <span class="comment"># Calculate the xor result for G</span></div><div class="line"></div><div class="line">  L.reduce(x, &amp;<span class="symbol">:^</span>) <span class="comment"># Keep xor all elements in L and return</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Or <code>C</code> version:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find_missing_x</span><span class="params">(<span class="keyword">long</span> N, <span class="keyword">long</span>* L)</span> </span>&#123;</div><div class="line">  <span class="keyword">long</span> x = N;</div><div class="line"></div><div class="line">  <span class="keyword">for</span>(<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; N - <span class="number">1</span>; i++) &#123; <span class="comment">// L has size of N-1</span></div><div class="line">    x ^= i ^ L[i];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> x;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Extending-problems"><a href="#Extending-problems" class="headerlink" title="Extending problems"></a>Extending problems</h2><p>So far the problem has been gracefully resolved. But it is yet the end, here is a couple of extending questions:</p>
<ol>
<li>If <code>G</code> is collection with random but unique numbers (Not continues integer from 1 to <code>N</code>). How to write the code?</li>
<li>Based on <code>1</code>, if there are 2 numbers are missing? How to find them both?</li>
<li>Based on <code>1</code>, but <code>L</code> contains the members from <code>G</code> except <code>x</code>for exactly 2 times. That means <code>L</code> might contain 0 or 1 <code>x</code>, but exactly 2 for any other members from <code>G</code>. How to find <code>x</code>?</li>
<li>Based on <code>1</code>, but <code>G</code> isn’t a collection of integer, but a collection of web urls. How to find the one missing url?</li>
<li>Based on <code>4</code>, <code>G</code> is a collection of url, <code>L</code> is subset of <code>G</code> (might contains fewer members other than exactly <code>N</code> - 1). How can we know a randomly picked member from <code>G</code> is absolutely not contained by <code>L</code>. Given the tolerance to mistake on saying a member from <code>G</code> is in <code>L</code> but it doesn’t.</li>
</ol>
<p>These problems will be explained in the following posts.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/" data-id="ciqg4g85m009h6nsiv11xnayj" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">Algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binary/">Binary</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bit-operation/">Bit Operation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bloom-filter/">Bloom Filter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/collection/">Collection</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/filtering/">Filtering</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/introduction/">Introduction</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logic/">Logic</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-clean-way-to-test-rejected-promise" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/" class="article-date">
  <time datetime="2015-08-14T08:08:53.000Z" itemprop="datePublished">2015-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>To test the the exception in a rejected promise could be a little bit painful.</p>
<p>And <a href="https://mochajs.org/" target="_blank" rel="external">Mocha</a> is Promise-friendly, which means it fails the test if exception is not caught.</p>
<p>So as a result, here is a simple code example to explain how it is being done:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">it <span class="string">'should throw session-expired exception'</span></div><div class="line">  <span class="keyword">new</span> Session().generateId().bindUserFromRedis()</div><div class="line">  .<span class="keyword">then</span> -&gt;</div><div class="line">    <span class="literal">null</span></div><div class="line">  .<span class="keyword">catch</span> (ex) -&gt;</div><div class="line">    ex</div><div class="line">  .<span class="keyword">then</span> (ex) -&gt;</div><div class="line">    expect(ex).to.be.<span class="keyword">instanceof</span>(ResponseError)</div><div class="line">              .<span class="keyword">and</span>.that.have.property(<span class="string">'errorName'</span>, <span class="string">'session-expired'</span>)</div></pre></td></tr></table></figure>
<hr>

<p><strong>Update:</strong> A Chai Plugin can mitigate the pain</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'should throw session-expired exception'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">return</span> expect(<span class="keyword">new</span> Session().generateId().bindUserFromRedis())</div><div class="line">           .to.evetually.rejected</div><div class="line">              .and.that.have.property(<span class="string">'errorName'</span>, <span class="string">'session-expired'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><strong>Update 2:</strong> With async, it can be converted into normal test<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'should throw session-expired exception'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">return</span> expect(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> <span class="keyword">new</span> Session().generateId().bindUserFromRedis())</div><div class="line">          .to.throw</div><div class="line">             .and.that.have.property(<span class="string">'errorName'</span>, <span class="string">'session-expired'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2015/08/14/a-clean-way-to-test-rejected-promise/" data-id="ciqg4g85p009p6nsi89fo4fzm" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2015/08/14/a-clean-way-to-test-rejected-promise/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mocha/">Mocha</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/promise/">Promise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test/">Test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-typical-eventbus-design-patterns" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/12/06/typical-eventbus-design-patterns/" class="article-date">
  <time datetime="2014-12-06T08:37:41.000Z" itemprop="datePublished">2014-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/design-patterns/">Design Patterns</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>EventBus</code> is an special <a href="`Pub &amp; Sub`">Publish &amp; Subscribe Pattern</a> implementation. <code>EventBus</code> enable message to be delivered between components without requiring the components to register itself to others.</p>
<p>Comparing <code>EventBus</code> to other <code>Pub &amp; Sub</code> implementations, <code>EventBus</code> is:</p>
<ol>
<li>Designed to replace the original event distribution system, which requires the components register itself to each other.</li>
<li>Not designed for general use, <code>EventBus</code> adds additional complexity and runtime overhead to the system. So it is not designed to replace normal method calls.</li>
<li>Not designed for inter-process communication as some other Pub&amp;Sub.</li>
</ol>
<h2 id="EventBus-saves-Android-developers’-life"><a href="#EventBus-saves-Android-developers’-life" class="headerlink" title="EventBus saves Android developers’ life"></a><code>EventBus</code> saves Android developers’ life</h2><p>When developing Android application, I strongly recommend developer to introduce an <code>EventBus</code> library. <a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">EventBus</a> from <code>GreenRobot</code>, <a href="http://square.github.io/otto/" target="_blank" rel="external">Otto</a> from <code>Squqre</code> are good solutions. Or even to choose the original <code>EventBus</code> in <a href="https://code.google.com/p/guava-libraries/" target="_blank" rel="external">Guava</a> library from Google.</p>
<p>With <code>EventBus</code>, components can communicate with each other without need to hold direct reference of each other. This is very important to avoid app crashes when calling a method on a detached or destroyed component. Usually this kind of issue isn’t that easy to handle due to Android’s over-complicated life cycle management. So even in the worst case that one component is sending message to another component which has been destroyed (which should unregister itself from EventBus on that time), it only triggered a <code>norecipient waring</code> instead of crashing the app.</p>
<p>Also with <code>EventBus</code> as intermedia, you can avoid to exposing objects to root activity or application just for registering callbacks on each other. Components are higher cohesion &amp; lower coupling.</p>
<p>As the result, <code>EventBus</code> saves tons of time to debugging crash, and make your code more readable, maintainble, extensible, and flexible.</p>
<h2 id="Abusing-EventBus-kills-your-app-easily"><a href="#Abusing-EventBus-kills-your-app-easily" class="headerlink" title="Abusing EventBus kills your app easily"></a>Abusing <code>EventBus</code> kills your app easily</h2><p>“<code>EventBus</code> is awesome! It is so convenient, so let’s replace everything with event”… This kind of saying is commonly heard from the developers who just realized the benefits from <code>EventBus</code>. Since <code>EventBus</code> is too convenient to use, they tends to replace everything with EventBus.</p>
<p>But we mentioned in the introduction of <code>EventBus</code> that <code>EventBus</code> is design to replace traditional event system in Java, and is not designed for general use. Abusing makes your code hard to understand, hard to debug. Long event chain is a common reason that cause of unexpected behavior.</p>
<h2 id="Broadcast-Event-Command-and-Request"><a href="#Broadcast-Event-Command-and-Request" class="headerlink" title="Broadcast Event, Command and Request"></a>Broadcast Event, Command and Request</h2><p><code>EventBus</code> is powerful, but can be easily abused. To make a better use of EventBus, I learn a number of EventBus usages, and evaluated the scenario, and summarized out 3 typeical EventBus usage patterns: <strong>Broadcast Event</strong>, <strong>Command</strong> and <strong>Request</strong>.</p>
<h3 id="Broadcast-Event"><a href="#Broadcast-Event" class="headerlink" title="Broadcast Event"></a>Broadcast Event</h3><p><code>Broadcast Event</code> is a special kind of event that used by a specific component to broadcast its status updated to other components.</p>
<h4 id="Declaration"><a href="#Declaration" class="headerlink" title="Declaration"></a>Declaration</h4><p><code>Broadcast Event</code> should be used when several components cares about the specific component’s status update. So usually <code>Broadcast Event</code> should have more than one recipients or, at least, potential recipients.</p>
<p><code>Broadcast Event</code> should be an immutable data object, so:</p>
<ol>
<li>It is immutable, so once it is created, its status should not changed, which guarantees the equality between recipients.</li>
<li>It is data object, so it should not has methods that might change other classes status.</li>
<li>It might have methods that helps its consumer to consume the data it contains.</li>
<li>It should be declared as a nested static class of publisher.</li>
</ol>
<p><strong>NOTICE</strong><br>If you thought a Event is “Broadcast Event”, but later you found it has only one recipient, then you might need to consider refact it into a <code>Command</code> or a <code>Request</code>.</p>
<h3 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h3><p><code>Command</code> is a special kind of event that has the ability to update specific object or specific type of objects. In most cases, <code>Command</code> should have only one recipient. In some special cases, it might has a group of recipients with exactly same type.</p>
<p>Precisely, the latter case is a variant of <code>Command</code> pattern, <code>Batch Command</code>, which works as same as <code>Command</code> but have multiple recipients so it can update multiple instances in a batch.</p>
<p><code>Command</code> should be a immutable object that able to update specific object, so:</p>
<ol>
<li>It should have 1 <code>execute</code> method with 1 parameter, which represents the target that the command updates.</li>
<li>When invoking execute method shouldn’t change its own status, so it does exactly same thing when applying it to multiple targets.</li>
<li>It behavior should be stable across time, so its behavior won’t change when it is apply asynchronously.</li>
<li>The object that <code>execute</code> method accepts is not necessarily to be the recipient. It could be the object that recipient holds or it has access to.</li>
<li>It should be declared as nested static class of the recipient.</li>
<li>If recipient accepts multiple events, these events are recommended to derived from the same base class. So The recipient could subscribe to the base class, rather than every command.</li>
</ol>
<p><strong>NOTICE</strong><br><code>Command</code> can be seen as recipient’s special method that can be invoked without known recipient instance. So its behavior should fully contained in the class. The subscribing method on recipient should contain one line of code to invoke <code>execute</code> method on command.</p>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p><code>Request</code> is a special kind of event that has the ability to accept data from another object. If the request has multiple recipients, to avoid ambiguous behavior, there should be only one of <code>Request</code>‘s respond the request.</p>
<p>But there is one exception, that is for the request collects data from multiple objects, multiple objects might respond to the request. This special kind of <code>Request</code> is called <code>Collector</code>.</p>
<p><code>Request</code> should be a object that accept data from recipient, so:</p>
<ol>
<li>It should have <code>respond</code> method with 1 parameter, which represents the data the request asks for.</li>
<li>Request should contains enough information for the recipients to determine whether to respond the request.</li>
<li>The recipients should check request’s status to determine whether it should respond request.</li>
<li>The request can update the publisher directly in the <code>respond</code> method</li>
<li>It should be declared as nested class of publisher. If possible, also declare it as static, which will be helpful to simplify the tests.</li>
<li>Request might has methods to help recipient to determine whether to respond the request.</li>
</ol>
<p><strong>NOTICE</strong><br><code>Request</code> can be seen as a special method that publisher exposes to a specific recipient, so the specific recipient can invoke the method to provide data. For <code>Request</code>, you might need to aware that that sometimes request might not found proper recipient to respond. If the responder is not guaranteed to exist, then the publish to watch out no-recipent warning from EventBus.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/12/06/typical-eventbus-design-patterns/" data-id="ciqg4g85q009s6nsi0zyjmxn7" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/12/06/typical-eventbus-design-patterns/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/command/">Command</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/design-pattern/">Design Pattern</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">Event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eventbus/">EventBus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/guava/">Guava</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/otto/">Otto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/request/">Request</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/" class="article-date">
  <time datetime="2014-11-09T05:44:29.000Z" itemprop="datePublished">2014-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Part 1: What it is for and how to used it</a></li>
</ul>
<hr>
<p>In android, view hierarchy usually are created via <code>layout</code> xml file. In the file, to instantiate a <code>TextView</code> we write:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span> /&gt;</div></pre></td></tr></table></figure>
<p>Usually, we need to specify the visual of the <code>TextView</code>, so we keep adding attributes to the <code>TextView</code> element:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/category_indicator_background"</span></div><div class="line">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:maxLines</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:textSize</span>=<span class="string">"12sp"</span> /&gt;</div></pre></td></tr></table></figure>
<p>Usually to fully customize visual representation of a view needs a lot of attributes and resources. Such as in this example. we added <code>background</code>, <code>gravity</code>, <code>maxLines</code>, <code>padding</code> and <code>textSize</code>, which is a lot of code.</p>
<p>And if we want to create another <code>TextView</code> with exactly same visual representation, we need to copy all the values again:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/category_indicator_background"</span></div><div class="line">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:maxLines</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:textSize</span>=<span class="string">"12sp"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 2"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/category_indicator_background"</span></div><div class="line">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:maxLines</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:textSize</span>=<span class="string">"12sp"</span> /&gt;</div></pre></td></tr></table></figure>
<p>Obviously, in this piece of code, there are a lot of duplications. We need to compare all the values to figure out the 2 <code>TextViews</code> have the same visual. If we want to change the style, we need to update 2 TextViews. And the last, if we want to create the 3rd <code>TextView</code> or even more ones, we need copy the code again and again, which makes the issue become more troublsome.</p>
<p>In a short word, the code has bad readability, bad maintainability, bad reusability. In the book <code>Refactor</code>, we know that code redundancy is bad smell. To mitigate the issue, we need to extract the shared code into another “unit”, and replace all the occurrences with the reference.</p>
<p>In Android layout xml, the extract “unit”, which represents the shared attributes, are called <code>Style</code>. After introduced <code>Style</code>, we have:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span></div><div class="line">    <span class="attr">style</span>=<span class="string">"@style/TextView.Customized"</span>/&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 2"</span></div><div class="line">    <span class="attr">style</span>=<span class="string">"@style/TextView.Customized"</span>/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"TextView.Customized"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:gravity"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:background"</span>&gt;</span>@drawable/category_indicator_background<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingLeft"</span>&gt;</span>22dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingRight"</span>&gt;</span>22dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingTop"</span>&gt;</span>12dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingBottom"</span>&gt;</span>12dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textAppearance"</span>&gt;</span>@style/CategoryIndicator.Text<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>12sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:maxLines"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Well, this is the basics about the <code>Style</code>: why we need it and how it is used.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/" data-id="ciqg4g85n009l6nsikjtbn0ai" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/style/">style</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/understanding/">understanding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/view/">view</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xml/">xml</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-perform-clicks-in-android-robolectric-unit-test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/" class="article-date">
  <time datetime="2014-10-27T08:17:13.000Z" itemprop="datePublished">2014-10-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/">Perform Clicks in Android Robolectric Unit Test</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Robolectric is an awesome library that makes UI unit test on Android a lot easier and faster. In UI test, one of the most basic thing is to simulate user interaction, such as clicking a button.</p>
<h2 id="Click-on-individual-View"><a href="#Click-on-individual-View" class="headerlink" title="Click on individual View"></a>Click on individual View</h2><p><code>Click</code> should be the most basic user interaction, besides invokeing the <code>View.performClick()</code> method, Robolectric provides a more smarter version <code>Robolectric.clickOn(View)</code>, which checks the view visibility and <code>enabled</code> status before actually “click” the view. If a view is either not visible or disabled, the click action will not be performed. This mechanism is useful to avoid some silly cases in automated tests.</p>
<h2 id="Long-Click-on-individual-View"><a href="#Long-Click-on-individual-View" class="headerlink" title="Long Click on individual View"></a>Long Click on individual View</h2><p><code>Long click</code> is a more advanced <code>click</code> action. To simulate a long click action, <code>View.performLongClick()</code> can be invoked. But since Robolectric doesn’t provide any long click helper, make sure you do it by yourself, including checking whether view is <code>long-clickable</code>, which usually will be set manually or more often, when <code>View.setOnLongClickListener</code> is invoked; view is visible and enabled as what <code>click</code> does. Although <code>Long click</code> is avaible to use, but from my experience, long click on a individual view is rarely used in real UI design, instead <code>long click</code> is usually performed on an item of list view or grid view. This is the trickest case that I’ll leave it to the last.</p>
<h2 id="Click-on-item-of-List-Grid"><a href="#Click-on-item-of-List-Grid" class="headerlink" title="Click on item of List/Grid"></a>Click on item of List/Grid</h2><p><code>Click</code> on List View or Grid View item. Well, idally, this shouldn’t be so much different than click on a indiviual view. But in Android implementation, item click is handled by the list view with a much more complicated API. To perform an <code>item click</code>, <code>boolean performItemClick(View v, int position, long id)</code> can be invoked. <code>performItemClick</code> requires 3 parameters, the first one is the view being clicked, the second one is the position of clicked view’s corresponding data item in adapter and the last is the if of clicked view’s corresponding data item. Complicated, isn’t it?</p>
<p>In Android implementation, item view displayed in ListView/GridView is actually provided by its adapter. Adapter works like a presenter in MVP pattern that creates/update item view based on the item data it holds. It also provides the id for the item. So to perform a item click, besides the ListView/GridView, you also need its adapter.</p>
<p>Following implementation explains how it works:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">    ListAdapter adapter = listView.getAdapter();</div><div class="line">    View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line">    listView.performItemClick(itemView, position, adapter.getItemId(position));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In the code, <code>AbsListView</code> is the base class of <code>ListView</code> and <code>GridView</code>. To click the item, you need</p>
<ol>
<li>Get the adapter of the <code>AbsListView</code></li>
<li>Create an <code>item view</code> for specific <code>position</code> with adapter</li>
<li>Calculate the <code>item id</code> of corresponding <code>position</code></li>
<li>Invoke <code>performItemClick</code> method with data we got before.</li>
</ol>
<p>In the implementation, for simplicity reason, we ignored some cases, such as convertView reusing. From my experience, in most cases, it won’t impact the functionality, so we don’t need to worry about it, unless you clearly know that matters, then you need to cover them in your tests.</p>
<h2 id="Long-click-and-item-of-List-Grid"><a href="#Long-click-and-item-of-List-Grid" class="headerlink" title="Long click and item of List/Grid"></a>Long click and item of List/Grid</h2><p>Well, this action is also not a commonly used. It is only used in limited cases, such as selecting multiple item or displaying context menu for specific item.<br>To perform a long click on the item is the most trickest case. In previous 3 cases, we either directly or indrectly depends on <code>View.perform***Click</code> method. But not sure why, android doesn’t provide similar public API method of <code>item long click</code>. By diving into Anrdoid source code, we can figure out that Item Long Click isn’t really handled by ListView itself, instead it is handled by a <code>Runnable</code> named <code>CheckForKeyLongPress</code>. To invoke method on this object isn’t that streight forward, and might involes unnecessary multithread issue.</p>
<p>I just want to click a item, why I have to deal with these unnecessary complicates? So I learnt from the <code>CheckForKeyLongPress</code> implementation, and implmented my own “API”:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">longClickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!listView.isLongClickable())</div><div class="line">        <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    OnItemLongClickListener listener = listView.getOnItemLongClickListener();</div><div class="line">    <span class="keyword">if</span> (listener == <span class="keyword">null</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    ListAdapter adapter = listView.getAdapter();</div><div class="line">    View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line"></div><div class="line">    listener.onItemLongClick(listView, itemView, position, adapter.getItemId(position));</div><div class="line">    listView.performHapticFeedback(LONG_PRESS);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>My main purpose of perform a click is to trigger the corresponding listener, so I tried to invoke the listener directly with some necessary pre-checks. This aporach will not triggers these UI effects, but I assume it can meet most test cases.</p>
<h2 id="APPENDIX-UIActions-helper-class"><a href="#APPENDIX-UIActions-helper-class" class="headerlink" title="APPENDIX UIActions helper class"></a>APPENDIX UIActions helper class</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.timnew.robolectric.utils;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.app.Fragment;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.AbsListView;</div><div class="line"><span class="keyword">import</span> android.widget.ListAdapter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.robolectric.Robolectric;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.view.HapticFeedbackConstants.LONG_PRESS;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.widget.AdapterView.OnItemLongClickListener;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UiActions</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(Activity activity, <span class="keyword">int</span> targetViewId)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(activity.findViewById(targetViewId));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(View parentView, <span class="keyword">int</span> targetViewId)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(parentView.findViewById(targetViewId));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(Fragment fragment, <span class="keyword">int</span> targetViewId)</span> </span>&#123;</div><div class="line">        <span class="comment">//noinspection ConstantConditions</span></div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(fragment.getView().findViewById(targetViewId));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">pressBackButton</span><span class="params">(Activity currentActivity)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (currentActivity.getFragmentManager().getBackStackEntryCount() &gt; <span class="number">0</span>)</div><div class="line">            currentActivity.getFragmentManager().popBackStackImmediate();</div><div class="line">        <span class="keyword">else</span></div><div class="line">            currentActivity.onBackPressed();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        ListAdapter adapter = listView.getAdapter();</div><div class="line">        View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line">        listView.performItemClick(itemView, position, adapter.getItemId(position));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">longClickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!listView.isLongClickable())</div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        OnItemLongClickListener listener = listView.getOnItemLongClickListener();</div><div class="line">        <span class="keyword">if</span> (listener == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        ListAdapter adapter = listView.getAdapter();</div><div class="line">        View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line"></div><div class="line">        listener.onItemLongClick(listView, itemView, position, adapter.getItemId(position));</div><div class="line">        listView.performHapticFeedback(LONG_PRESS);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/" data-id="ciqg4g85g00956nsiabtqave2" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/click/">click</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/item/">item</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/list-view/">list view</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/long-click/">long click</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/robolectric/">robolectric</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ui-action/">ui action</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unit-test/">unit test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2-modules-android-project-with-robolectric-gradle-android-studio" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/" class="article-date">
  <time datetime="2014-09-30T05:00:58.000Z" itemprop="datePublished">2014-09-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/">2 Modules Android project with Robolectric, Gradle, Android Studio</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Start a new Android project this week, so I started to setup the development environment. To be honest, it is not an easy experience to me.</p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>Here are the features I got now:</p>
<ul>
<li>Unit test with Robolectric. (Very fundamental requirement)</li>
<li>Unit tests are separated into an independent module. (Provide flexibility when project growing larger. And provide a more clear view of code organization)</li>
<li>Running unit tests recognized by Android Studio/IntelliJ unit test plugin and debug UTs in IDE. (This is very important when diagnose failure UT)</li>
<li>Running unit tests via CLI with <code>gradle wrapper</code>. (This is necessary requirement for CI servers)</li>
<li>Using resources in Robolectric test. (Avoid <code>Resource Not Found</code> exception in unit tests)</li>
<li>Test Android Annotation powered async implementation. (AA introduces new Async implementation, which is not supported by Robolectric by default)</li>
<li>AssertJ core support. (Fest has been deprecated since no one is maintain it now.)</li>
</ul>
<h2 id="Versions"><a href="#Versions" class="headerlink" title="Versions"></a>Versions</h2><p>The major difficulties that I met are version compatibility, I almost tried all available version combinations to make them all works. Here are the versions that I uses</p>
<ul>
<li>Gradle: 2.1</li>
<li>Groovy: 2.3.6</li>
<li>Ant: 1.9.3</li>
<li>JVM: 1.6.0_65 (Apple Inc. 20.65-b04-462)</li>
<li>OS: Mac OS X 10.9.5 x86_64</li>
<li>Android Studio: 0.8.11 (build AI-135.1446794)</li>
<li>IntelliJ: IDEA 14 CE EAP, build IC-138.2458.8</li>
<li>Android gradle plugin: com.android.tools.build:gradle:0.13.0</li>
<li>Android ADT gradle plugin: com.neenbedankt.gradle.plugins:android-apt:1.4+</li>
<li>Compile SDK version: 20</li>
<li>Build tool version: 20.0.0</li>
<li>Robolectric: 2.3</li>
</ul>
<h1 id="Known-Issues"><a href="#Known-Issues" class="headerlink" title="Known Issues"></a>Known Issues</h1><p>My current solution isn’t perfect. But for now, I haven’t working solution for them. Hope it could be fixed in the future</p>
<ul>
<li><code>AAR</code> is not supported in Unit Test. (A tricky issue, I’ll explain more in detail later)</li>
<li><a href="https://github.com/square/assertj-android" target="_blank" rel="external">AssertJ-Android</a> is not supported. (Cause by AAR support issue, alternative available.)</li>
</ul>
<h2 id="Project-Structure-and-configurations"><a href="#Project-Structure-and-configurations" class="headerlink" title="Project Structure and configurations"></a>Project Structure and configurations</h2><p>Here are the project structure:<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">RootProject</div><div class="line"><span class="string">|- settings.gradle</span></div><div class="line"><span class="string">|- build.gradle</span></div><div class="line"><span class="string">|- Launcher</span></div><div class="line">   \- builde.gradle</div><div class="line">\- UnitTest</div><div class="line">   <span class="string">|- build.gradle</span></div><div class="line">   \- UnitTest.iml</div></pre></td></tr></table></figure></p>
<p>Here are the contents</p>
<figure class="highlight gradle"><figcaption><span>\Settings.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">include</span> <span class="string">':Launcher'</span>, <span class="string">':UnitTest'</span></div></pre></td></tr></table></figure>
<figure class="highlight gradle"><figcaption><span>\build.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:0.13.0'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">allprojects</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenLocal()</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight gradle"><figcaption><span>\Launcher\build.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:0.13.0'</span></div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.4+'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">repositories</span> &#123;</div><div class="line">    mavenLocal()</div><div class="line">    mavenCentral()</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line">apply plugin: <span class="string">'android-apt'</span></div><div class="line"></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">20</span></div><div class="line">    buildToolsVersion <span class="string">'20.0.0'</span></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion <span class="number">9</span></div><div class="line">        targetSdkVersion <span class="number">19</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        debug &#123;</div><div class="line">            runProguard <span class="keyword">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.txt'</span></div><div class="line">        &#125;</div><div class="line">        release &#123;</div><div class="line">            runProguard <span class="keyword">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.txt'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">apt &#123;</div><div class="line">    arguments &#123;</div><div class="line">        androidManifestFile variant.processResources.manifestFile</div><div class="line">        resourcePackageName <span class="string">'me.timnew.game.launcher'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> AAVersion = <span class="string">'3.1'</span></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    apt <span class="string">"org.androidannotations:androidannotations:$AAVersion"</span>         <span class="comment">// Process AA annotations</span></div><div class="line">    <span class="comment">/*</span></div><div class="line">    * Android Studio will remove this line if you try to edit project configuration with GUI.</div><div class="line">    * It seems it is a bug of Android Studio since it does not understand DSL `apt`</div><div class="line">    */</div><div class="line">    <span class="keyword">compile</span> <span class="string">"org.androidannotations:androidannotations-api:$AAVersion"</span> <span class="comment">// AA Runtime API. Becareful</span></div><div class="line"></div><div class="line">    <span class="keyword">compile</span> <span class="string">'de.greenrobot:eventbus:2.2.1'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'org.easytesting:fest-reflect:1.4.1'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.google.guava:guava:18.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.koushikdutta.ion:ion:1.3.8'</span></div><div class="line"></div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>, <span class="string">'*.aar'</span>]) <span class="comment">// Well although I mentioned aar here, but it doesn't load correctly.</span></div><div class="line"></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:support-v4:20.0.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:support-annotations:20.0.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:20.0.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight gradle"><figcaption><span>\UnitTest\build.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:0.13.0'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply plugin: <span class="string">'java'</span></div><div class="line"></div><div class="line"><span class="keyword">repositories</span> &#123;</div><div class="line">    mavenLocal()</div><div class="line">    maven &#123; url <span class="string">"$System.env.ANDROID_HOME/extras/android/m2repository"</span> &#125; <span class="comment">// Fix 'com.android.support:*' package not found issue</span></div><div class="line">    mavenCentral()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">def</span> appModule = <span class="keyword">project</span>(<span class="string">':Launcher'</span>)</div><div class="line">    <span class="keyword">compile</span> appModule</div><div class="line"></div><div class="line">    testCompile appModule.android.applicationVariants.<span class="keyword">toList</span>().first().javaCompile.<span class="keyword">classpath</span>       <span class="comment">// Include classes from main project</span></div><div class="line">    testCompile appModule.android.applicationVariants.<span class="keyword">toList</span>().first().javaCompile.outputs.files</div><div class="line">    testCompile files(appModule.plugins.findPlugin(<span class="string">"com.android.application"</span>).getBootClasspath())</div><div class="line"></div><div class="line">    testCompile(<span class="string">'junit:junit:4.+'</span>) &#123;</div><div class="line">        <span class="keyword">exclude</span> module: <span class="string">'hamcrest-core'</span>                                                            <span class="comment">// Exclude problematic 'hamcrest'</span></div><div class="line">    &#125;</div><div class="line">    testCompile <span class="string">'org.robolectric:robolectric:2.3'</span></div><div class="line">    testCompile <span class="string">'org.mockito:mockito-core:1.9.5'</span></div><div class="line">    testCompile <span class="string">'org.assertj:assertj-core:1.6.1'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">tasks.withType(Test) &#123;</div><div class="line">    scanForTestClasses = <span class="keyword">false</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"**/*Should.class"</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"**/*Test.class"</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"**/*Tests.class"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Why-uses-java-plug-in-instead-of-android-unit-test-plug-ins"><a href="#Why-uses-java-plug-in-instead-of-android-unit-test-plug-ins" class="headerlink" title="Why uses java plug-in instead of android unit test plug-ins"></a>Why uses <code>java</code> plug-in instead of <code>android unit test</code> plug-ins</h2><p>Well, Gradle DSL provides a lot of flexibility to developer. But it also brought a lot complexity to IDE implementation. To figure out project configuration, IDE need to parse and understand the gradle scripts. Not only DSLs provided by gradle but all stuff come with plug-ins. From IDE, this is almost an impossible mission. So IDE need to figure out a way to simplify the process, such as support a subset of DSL.</p>
<p>For Android project, IntelliJ has difficulties to understand the all variations of <code>android unit test</code> plug-ins. So it is not easy to make unit test runnable from IDE. To solve the issue, you either try to teach IDE about the DSL by providing plug-in to IDE, or uses some languages that IDE understood.</p>
<p>I tried some plug-in available today, but none of them works for me. So I decide to use <code>java</code> DSL, which IntelliJ understood natively. As a trade off, since <code>java</code> gradle plugin doesn’t understand <code>Android Library</code>, so it cannot import <code>.aar</code> libries.</p>
<p>Besides I tried all <code>android unit test</code> gradle plugins, I found all of them depends on <code>android</code> gradle plugin. And <code>android</code> plugin depends on <code>AndroidManifest.xml</code> and some other stuff. It is wield to provide an manifest for your unit test.</p>
<p>So as the final solution, I uses <code>java</code> plug-in, avoid using <code>aar</code> in the test.</p>
<h2 id="Why-so-complicate"><a href="#Why-so-complicate" class="headerlink" title="Why so complicate"></a>Why so complicate</h2><p>Configurate an working Android project isn’t as easy as it sounds. Differ from iOS community, Google isn’t strong-minded as Apple. As a consequence that Android community is fragmented and lack of unified solution. There are tons of solutions available, but you might need to try them one by one to figure out which fits your requirement.</p>
<p>To make your tool chain, dependencies, IDE work together, compatibility is always your enemy. Even Google has to publish <a href="http://tools.android.com/tech-docs/new-build-system/version-compatibility" target="_blank" rel="external">Version Compatibility Table</a> to mitigate the pain.</p>
<p>What a mess!!!!!</p>
<h2 id="References-posts-plugins-or-template-projects"><a href="#References-posts-plugins-or-template-projects" class="headerlink" title="References posts, plugins or template projects"></a>References posts, plugins or template projects</h2><p>Here is a list of things that I tried but failed to fit my requirement. List here since it might be helpful to other people.</p>
<ul>
<li><a href="http://blog.blundell-apps.com/android-gradle-app-with-robolectric-junit-tests/" target="_blank" rel="external">Android Gradle App with Robolectric JUnit tests</a></li>
<li><a href="https://github.com/blundell/tests-app-robolectric-junit" target="_blank" rel="external">tests-app-robolectric-junit</a> template project</li>
<li><a href="https://github.com/robolectric/deckard-gradle" target="_blank" rel="external">deckard-gradle</a> template project</li>
<li><a href="https://github.com/JCAndKSolutions/android-unit-test" target="_blank" rel="external">android-unit-test</a> gradle plug in</li>
<li><a href="https://github.com/evant/android-studio-unit-test-plugin" target="_blank" rel="external">android-studio-unit-test-plugin</a> android studio/intellij plugin</li>
<li><a href="https://github.com/robolectric/robolectric-gradle-plugin" target="_blank" rel="external">robolectric-gradle-plugin</a></li>
<li><a href="https://github.com/novoda/robolectric-plugin" target="_blank" rel="external">robolectric-plugin</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/" data-id="ciqg4g85e008y6nsitwyyp3zz" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-studio/">Android Studio</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/boilerplate/">Boilerplate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gradle/">Gradle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/project/">Project</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/robolectric/">Robolectric</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/structure/">Structure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unit-test/">Unit Test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-trello-confetti-effect" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/09/24/trello-confetti-effect/" class="article-date">
  <time datetime="2014-09-24T05:13:33.000Z" itemprop="datePublished">2014-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/09/24/trello-confetti-effect/">Trello Confetti Effect</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://trello.com" target="_blank" rel="external">Trello</a> just created a <a href="https://trello.com/5m" target="_blank" rel="external">page</a> to celebrate their user number reaches 5 million. In their celebration page, they introduce an interesting effect, a number of blue squares rotating and falling from the sky.</p>
<p>By inspecting their source code, I extracted the effect implementation from the page.</p>
<iframe id="cp_embed_tlEBe" src="//codepen.io/timnew/embed/tlEBe?height=500&theme-id=7928&slug-hash=tlEBe&default-tab=result" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>
<p>As you can see, the effect is implemented with Canvas animation. Trello guys created a light weight particle system.</p>
<ul>
<li><code>ConfettiMachine</code> is the particle system controller, which takes the responsibility to create new particles and call <code>draw</code> method on them one by one.</li>
<li><code>Particle</code> is the representation of the blue square, it takes the rotation, fading out and rendering.</li>
</ul>
<p>The source code is extracted for study purpose, all code and credits belongs to Trello guys.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/09/24/trello-confetti-effect/" data-id="ciqg4g859008q6nsi91bfn3t8" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/09/24/trello-confetti-effect/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/animation/">animation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/confetti/">confetti</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/draw/">draw</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/effect/">effect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/particle/">particle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trello/">trello</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-otto-and-android-annotations-compatibility-issue-analysis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/" class="article-date">
  <time datetime="2014-09-14T08:14:22.000Z" itemprop="datePublished">2014-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/">Otto and Android Annotations Compatibility Issue Analysis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><a href="https://github.com/square/otto" target="_blank" rel="external">Otto</a> is a great Android event bus solution developed by <a href="http://square.github.io/" target="_blank" rel="external">SquareUp</a> guys. These guys extract the event bus related classes from <a href="https://code.google.com/p/guava-libraries/" target="_blank" rel="external">Google’s Guava</a>, and optimized it for Android. Event Bus is a great solution to keep your code away from messy anonymous or internal classes only used for event handling! And Otto’s simplicity and performance makes it used to be the most popular event bus solution in Android development.</p>
<p><a href="http://androidannotations.org/" target="_blank" rel="external">Android Annotations</a>, as known as <code>AA</code>, is another great library that makes Android developers’ lives a lot easier. Just annotating the code, AA helps developer handles the most boring or error-proning tasks for you, including binding widgets binding, asynchronous tasks, life time management, etc…</p>
<h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><p>Otto and AA are the libraries focusing on different aspects. Theoretically speaking, there shouldn’t be any compatibility issue between them. But the reality Otto event is never delivered to AA annotated classes. By inspecting the code with step by step debugging, I found the root cause of the issue is Otto failed to located <code>@Produce</code> and <code>@Subscribe</code> annotated methods in AA generated code.</p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>After a few study work, I finally understood what is the reason behind:</p>
<p>For performance consideration, Android Annotations actually does it work during the compilation time instead of Runtime. AA will derive the annotated classes, and generate some code according to the annotations applied. During the runtime, the classes got instantiated is actually the derived classes instead of the original one, although in the code is accessed via the original class as interface.</p>
<p>Here is a simple example:</p>
<p>I have the class <code>ServerListAdapter</code>, which is used to provide data for a grid view.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EBean</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerListAdapter</span> <span class="keyword">extends</span> <span class="title">AdvBaseAdapter</span>&lt;<span class="title">InetAddress</span>, <span class="title">ServerView</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RootContext</span></div><div class="line">    <span class="keyword">protected</span> Context context;</div><div class="line"></div><div class="line">    <span class="meta">@SystemService</span></div><div class="line">    <span class="keyword">protected</span> LayoutInflater inflater;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="keyword">protected</span> Bus bus;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerListAdapter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> ArrayList&lt;InetAddress&gt;());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@AfterInject</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterInject</span><span class="params">()</span> </span>&#123;</div><div class="line">        bus.register(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> ServerView <span class="title">createView</span><span class="params">(ViewGroup parent)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> ServerView_.build(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> ServerView <span class="title">updateView</span><span class="params">(ServerView itemView, InetAddress item)</span> </span>&#123;</div><div class="line">        itemView.update(item);</div><div class="line">        <span class="keyword">return</span> itemView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Subscribe</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fetchServerStatus</span><span class="params">(DiscoveryStatusEvent event)</span> </span>&#123;</div><div class="line">        setItems(event.addresses);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Subscribe</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServerStatusUpdated</span><span class="params">(DiscoveryStatusChangedEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.type) &#123;</div><div class="line">            <span class="keyword">case</span> SERVER_ONLINE:</div><div class="line">                getItems().add(event.address);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> SERVER_OFFLINE:</div><div class="line">                getItems().remove(event.address);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And this is the derived class generated by <code>AA</code> during the compiling-time:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerListAdapter_</span></span></div><div class="line">    <span class="keyword">extends</span> <span class="title">ServerListAdapter</span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context context_;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ServerListAdapter_</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        context_ = context;</div><div class="line">        init_();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ServerListAdapter_ <span class="title">getInstance_</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerListAdapter_(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init_</span><span class="params">()</span> </span>&#123;</div><div class="line">        inflater = ((LayoutInflater) context_.getSystemService(Context.LAYOUT_INFLATER_SERVICE));</div><div class="line">        context = context_;</div><div class="line">        bus = Bus_.getInstance_(context_);</div><div class="line">        afterInject();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rebind</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        context_ = context;</div><div class="line">        init_();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>And here is how it is consumed:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EFragment</span>(R.layout.fragment_server_list)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerListFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="keyword">protected</span> DiscoveryService discoveryService;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="keyword">protected</span> ServerListAdapter adapter;</div><div class="line"></div><div class="line">    <span class="meta">@ViewById</span>(R.id.server_list)</div><div class="line">    <span class="keyword">protected</span> GridView serverGridView;</div><div class="line"></div><div class="line">    <span class="meta">@AfterViews</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterViews</span><span class="params">()</span> </span>&#123;</div><div class="line">        serverGridView.setAdapter(adapter);</div><div class="line"></div><div class="line">        discoveryService.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDetach</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDetach();</div><div class="line">        discoveryService.stop();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>As you can see, in the <code>ServerListFragment</code>, the <code>ServerListAdapter</code> instance injected into <code>bean</code> is actually the instance of <code>ServerListAdapter_</code>. And due to polymorphic, the instance just behaves like a <code>ServerListAdapter</code> instance.</p>
<p>On the other hand, according to the description on <a href="http://square.github.io/otto/" target="_blank" rel="external">Otto’s Home Page</a>:</p>
<blockquote><p>In order to receive events, a class instance needs to register with the bus.<br>…<br>Registering will only find methods on the immediate class type. Unlike the Guava event bus, Otto will not traverse the class hierarchy and add methods from base classes or interfaces that are annotated. This is an explicit design decision to improve performance of the library as well as keep your code simple and unambiguous.</p>
<footer><strong>@Otto</strong><cite><a href="http://square.github.io/otto/" target="_blank" rel="external">Otto Homepage</a></cite></footer></blockquote>
<p>Otto only search annotations in direct class, which is <code>ServerListAdapter_</code> in instance, and there isn’t any annotation included. As a consequence, all the <code>@Subscribe</code> annotated methods are ignored by <code>com.squareup.otto.AnnotatedHandlerFinder</code>. So the posted events become <code>dead event</code> due to no subscriber found.</p>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><p>There is <a href="https://github.com/square/otto/issues/61" target="_blank" rel="external">rumor</a> that this issue will be fixed in <code>Otto 2.0</code>. But according to the <a href="https://github.com/square/otto/issues/61#issuecomment-44453104" target="_blank" rel="external">comment</a> from <a href="https://github.com/JakeWharton" target="_blank" rel="external">Jake Wharton</a>, Otto’s developer, <code>Otto 2.0</code> will take forever to release.</p>
<p>In fact <a href="https://github.com/square/otto/tree/2.0-wip" target="_blank" rel="external">Otto 2.0 Repo</a> has been not touched for 2 years already. Although we could check out the code and build Otto 2.0 by ourselves, but it takes efforts. Especially when some bug is found.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Luckily, although <code>Otto</code> turns into “maintenance mode”, the compatibility issue takes forever to resolve. I found a great Otto alternative, EventBus from GreenRobot. A boring name, but great library.</p>
<p>According to <code>EventBus</code>‘s document, it provides richer feature and better performance than <code>Otto</code>.<br>The most important <code>EventBus</code> is friendly to <code>AndroidAnnoations</code>. They two works well together.</p>
<h3 id="EventBus-and-Otto-Feature-Comparison"><a href="#EventBus-and-Otto-Feature-Comparison" class="headerlink" title="EventBus and Otto Feature Comparison"></a>EventBus and Otto Feature Comparison</h3><table>
<thead>
<tr>
<th></th>
<th>EventBus</th>
<th>Otto</th>
</tr>
</thead>
<tbody>
<tr>
<td>Declare event handling methods</td>
<td>Name conventions</td>
<td>Annotations</td>
</tr>
<tr>
<td>Event inheritance</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Subscriber inheritance</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Cache most recent events</td>
<td>Yes, sticky events</td>
<td>No</td>
</tr>
<tr>
<td>Event producers (e.g. for coding cached events)</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Event delivery in posting thread</td>
<td>Yes (Default)</td>
<td>Yes</td>
</tr>
<tr>
<td>Event delivery in main thread</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Event delivery in background thread</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Asynchronous event delivery</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
<h3 id="EventBus-and-Otto-Performance-Comparison"><a href="#EventBus-and-Otto-Performance-Comparison" class="headerlink" title="EventBus and Otto Performance Comparison"></a>EventBus and Otto Performance Comparison</h3><table>
<thead>
<tr>
<th></th>
<th>EventBus over Otto</th>
</tr>
</thead>
<tbody>
<tr>
<td>Posting 1000 events, Android 2.3 emulator</td>
<td>~70% faster</td>
</tr>
<tr>
<td>Posting 1000 events, S3 Android 4.0</td>
<td>~110% faster</td>
</tr>
<tr>
<td>Register 1000 subscribers, Android 2.3 emulator</td>
<td>~10% faster</td>
</tr>
<tr>
<td>Register 1000 subscribers, S3 Android 4.0</td>
<td>~70% faster</td>
</tr>
<tr>
<td>Register subscribers cold start, Android 2.3 emulator</td>
<td>~350% faster</td>
</tr>
<tr>
<td>Register subscribers cold start, S3 Android 4.0</td>
<td>About the same</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/" data-id="ciqg4g85b008t6nsin81uiucz" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-annotations/">android annotations</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event-bus/">event bus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google/">google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/greenbot/">greenbot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/guava/">guava</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/otto/">otto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming/">programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pub-sub/">pub & sub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/squareup/">squareUp</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-trick-to-use-coffeescript-in-hexo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/08/18/trick-to-use-coffeescript-in-hexo/" class="article-date">
  <time datetime="2014-08-18T10:19:44.000Z" itemprop="datePublished">2014-08-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/08/18/trick-to-use-coffeescript-in-hexo/">Trick to use CoffeeScript in Hexo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://hexo.io/" target="_blank" rel="external">Hexo</a> has a <code>scripts</code> folder, and the files under which are loaded by <code>Hexo</code> when start. I usually uses this folder as the development folder for my plug-in scripts. And extract them into independent package after polished it into package-ready quality.</p>
<p>Usually, the files under scripts should be <code>javascripts</code>. But as I’m a fan of <a href="http://coffeescript.org/" target="_blank" rel="external">Coffee Script</a>, so I wish to use <code>coffee-script</code> to write the plug-ins. For the formal package, I compile the <code>coffee scripts</code> into <code>javascripts</code> before release. But for development, I wish to use <code>coffee script</code> directly.</p>
<p>In <code>node.js</code>, it is possible to require <code>coffee-script</code> directly, if you registered the <code>coffee-script</code> runtime compiler:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">require</span>(<span class="string">'coffee-script/register'</span>);</div></pre></td></tr></table></figure>
<p>And as how node.js <code>require</code> function is implemented, you cannot register <code>coffee-script</code> runtime compiler in <code>.coffee</code> file. Or the compiler will complain:</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[error] <span class="symbol">HexoError:</span> Script load <span class="symbol">failed:</span> plugin.coffee</div><div class="line"><span class="symbol">SyntaxError:</span> Unexpected string</div><div class="line">  at Module._compile (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:439:25)</span></div><div class="line">  at Object.Module._extensions..js (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:474:10)</span></div><div class="line">  at Module.load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:356:32)</span></div><div class="line">  at Function.Module._load (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:312:12)</span></div><div class="line">  at Module.<span class="keyword">require</span> (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:364:17)</span></div><div class="line">  at <span class="keyword">require</span> (<span class="class"><span class="keyword">module</span>.<span class="title">js</span>:380:17)</span></div><div class="line">  at /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">node_modules</span>/<span class="title">hexo</span>/<span class="title">lib</span>/<span class="title">loaders</span>/<span class="title">scripts</span>.<span class="title">js</span>:17:11</span></div><div class="line">  at Array.forEach (native)</div><div class="line">  at /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">node_modules</span>/<span class="title">hexo</span>/<span class="title">lib</span>/<span class="title">loaders</span>/<span class="title">scripts</span>.<span class="title">js</span>:15:13</span></div><div class="line">  at /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">node_modules</span>/<span class="title">hexo</span>/<span class="title">lib</span>/<span class="title">util</span>/<span class="title">file2</span>.<span class="title">js</span>:339:7</span></div><div class="line">  at done (<span class="regexp">/usr/local</span><span class="regexp">/lib/node</span>_modules/hexo/node_modules/async/<span class="class"><span class="keyword">lib</span>/<span class="title">async</span>.<span class="title">js</span>:135:19)</span></div><div class="line">  at /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">node_modules</span>/<span class="title">hexo</span>/<span class="title">node_modules</span>/<span class="title">async</span>/<span class="title">lib</span>/<span class="title">async</span>.<span class="title">js</span>:32:16</span></div><div class="line">  at /usr/local/<span class="class"><span class="keyword">lib</span>/<span class="title">node_modules</span>/<span class="title">hexo</span>/<span class="title">lib</span>/<span class="title">util</span>/<span class="title">file2</span>.<span class="title">js</span>:335:11</span></div><div class="line">  at Object.oncomplete (evalmachine.&lt;anonymous&gt;:<span class="number">107</span>:<span class="number">15</span>)</div></pre></td></tr></table></figure>
<p>Theoretically, it is possible to put the <code>coffee-script</code> registration code in a <code>javascript</code> file and also put it under <code>/scripts</code> folder. SO <code>Hexo</code> will load it when start-up.</p>
<p>Well, this approach doesn’t really work. If you try it, it is very likely to get the exactly same error as before. The reason is related to <code>Hexo</code> implementation. <code>Hexo</code> uses <a href="https://github.com/hexojs/hexo/blob/master/lib/loaders/scripts.js" target="_blank" rel="external">Scripts Loader</a> to require files under <code>/scripts</code>. The loader doesn’t really provide an explicit way to specify which file is loaded before another. So the registration file is guaranteed to be loaded before any <code>.coffee</code>.</p>
<p>So far, it seems that there is no cure to this problem! But actually it does. There is undocumented feature will help to solve this issue.</p>
<p>Hexo uses [Script Loader] to load the scripts. In <a href="https://github.com/hexojs/hexo/blob/master/lib/loaders/scripts.js" target="_blank" rel="external">Scripts Loader</a> use <a href="https://github.com/hexojs/hexo/blob/master/lib/util/file2.js#L313" target="_blank" rel="external">hexo.util.file2</a> to populate the source files under <code>/scripts</code>. And <a href="https://github.com/hexojs/hexo/blob/master/lib/util/file2.js#L313" target="_blank" rel="external">hexo.util.file2</a> use <a href="http://nodejs.org/api/fs.html#fs_fs_readdir_path_callback" target="_blank" rel="external">fs.readdir</a> to actully populate the file system entries. For <a href="http://nodejs.org/api/fs.html#fs_fs_readdir_path_callback" target="_blank" rel="external">fs.readdir</a>, there is a undocumented feature, that the populated entries are actually sorted alphabetically, which means <code>a.js</code> is loaded before <code>b.coffee</code>.</p>
<p>With this feature, we can put our <code>coffee-script</code> registration in a file with lower alphabetic-order name. Personally, I’d like called <code>___register_coffeescript.js</code>, since <code>_</code> is smaller than any letter or number.</p>
<p>⚠️<strong>WARNING</strong>: <a href="http://nodejs.org/api/fs.html#fs_fs_readdir_path_callback" target="_blank" rel="external">fs.readdir</a> yielding sorted files is an undocumented behavior, which means it is not guaranteed either to work across platforms or not get changed in the future. So for, it works on Mac, and I expect it behaves similar on Linux. But not sure about Windows, since <code>fs</code> uses a different native binding on Windows.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/08/18/trick-to-use-coffeescript-in-hexo/" data-id="ciqg4g85000836nsi66813r60" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/08/18/trick-to-use-coffeescript-in-hexo/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coffee/">coffee</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hack/">hack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/plug-in/">plug-in</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/script/">script</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trick/">trick</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-favicon-is-not-as-simple-as-you-think" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/08/18/favicon-is-not-as-simple-as-you-think/" class="article-date">
  <time datetime="2014-08-17T16:04:36.000Z" itemprop="datePublished">2014-08-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/08/18/favicon-is-not-as-simple-as-you-think/">Favicon is not as simple as you think</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>Favicon</code> is the little icon that displayed on the title bar or tab bar when you browsing a web site. At very beginning, it is used to be the little icon displayed in favoriate bar when user add the website to favorites. Then later, it becomes the the standard way to specify custom icon for a website.</p>
<p>Most web site provides <code>favico</code>, developer add one line description in the <code>&lt;head&gt;</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">href</span>=<span class="string">"/favico.ico"</span> <span class="attr">type</span>=<span class="string">"image/x-icon"</span>&gt;</span></div></pre></td></tr></table></figure>
<p>This simple piece of code works, but there are a lot of issues with this declaration. Actually specify the <code>favico</code> isn’t as simple as you might expect!</p>
<p>For this piece of code, according to W3C document <a href="http://www.w3.org/2005/10/howto-favicon" target="_blank" rel="external">how to favicon</a>, there are 2 issues with it:</p>
<p>First, <code>shortcut</code> isn’t a standard value for <code>rel</code>, it is only for <code>IE</code>.</p>
<p>Second, <code>ico</code> format is a Microsoft oriented file type, not all platform likes it. Linux, Mac, iOS, Android, do not really appreciate this format.</p>
<p>Beides the 2 issues described above, the size of the <code>favicon</code> also matters.</p>
<p>Someone says it should be <code>16x16</code>. Yes, <code>16x16</code> icon is used in tab or tree view. Some other says it should be <code>32x32</code>. Well, this is also true. <code>32x32</code> icon is displayed in toolbar.</p>
<p><code>16x16</code> and <code>32x32</code> are the most used sizes for <code>favico</code>, but that’s not all. The reality is a lot complicated, I’ll explain this issue later. Let focus on this 2 size first.</p>
<p>To provide the image with 2 different sizes. For <code>ico</code> it is not an issue, since <code>ico</code> is a image container file format, which can encapsulate several images with different sizes and color in a single file. It is convenient for developer, but not for users. Because it means the users need to download a big file, most of the data in which is not used at all.</p>
<p>For the recommended <code>png</code>, it is no way to provide multiple images in a single file. So we have to provide 2 different separate files, and specify them with 2 different <code>&lt;link&gt;</code> tags with <code>sizes</code> attribute. This is a more efficient way, but unfortunately, you’re living in the world has something called <code>Internet Explorer</code>. The <code>favico</code> in <code>png</code> is not supported by IE until <code>IE 11</code>. What a hell!</p>
<p>Actually, there is a lot of issue with IE in this case. There is an <a href="https://mathiasbynens.be/notes/rel-shortcut-icon" target="_blank" rel="external">great article</a> by Mathias Bynen that discussed this issue in detail, which provides a lot of interesting information related to <code>favico</code>.</p>
<h3 id="Microsoft-Windows-8"><a href="#Microsoft-Windows-8" class="headerlink" title="Microsoft Windows 8"></a>Microsoft Windows 8</h3><p>Besides typical browser usage, <code>Favicon</code> is also used to create <code>Metro Tile</code> by <code>IE 10</code> and <code>IE 11</code> on Windows 8. It requires something quite different. Here is a MSDN document that described how to <a href="http://msdn.microsoft.com/en-us/library/ie/dn455106(v=vs.85).aspx" target="_blank" rel="external">create custom tiles for IE11 websites</a>. For these <code>tile icon</code>, Windows 8 also asks for a background color other than the icon itself.</p>
<h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><p>In the age of mobile internet, <code>favicon</code> is not just used by the desktop browser, but also mobile devices. On mobile devices, there are some more specific requirements.</p>
<p>On android, the screen size and resolution varies between devices. So the visual elements on Android are measured in <code>dp</code>. According to the screen resolution, there are different conversion ratios between <code>dp</code> and <code>px</code>. And to have pixel perfect image on Android, developer should provide several images for different <code>dp-px-ratios</code>.</p>
<p>Google have a well written document that described how to create icon for the web app that <a href="https://developer.chrome.com/multidevice/android/installtohomescreen" target="_blank" rel="external">added to homescreen</a>.</p>
<h3 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h3><p>For iOS, it is simliar to Android, but seems to be much more complicated. On iOS, it is also possible to create a shortcut for the web apps. Apple named such icon as <code>apple touch icon</code>, which is used by Safari and other browsers on iOS.</p>
<p>For the iOS devices, iPhone and iPad have different screen sizes, so they have different size requirements for <code>touch icon</code>.</p>
<p>Furthermore, there are device with <code>retina</code> display and with normal one. To have pixel perfect image on <code>retina display</code>, it requires the resolution of the image to be doubled.</p>
<p>And since iOS 7, iOS changed its UI style, the icon size used by iOS 7 is also slightly changed. So you should provide new icons for iOS 7 devices!</p>
<p>To make the icon fit iOS visual style best, Apple recommend web application to provide <code>precomposed icon</code>, which is a icon that added <code>rounded corner</code> and background by itself.</p>
<p>To have the pixel perfect icon on iOS, you might need to provide around 10 different images files as <code>apple touch icon</code>.</p>
<p>What a hell!!!! The <code>touch icon</code> on iOS is totally a mess!!!!</p>
<p>Here is a document from Apple that describes how <a href="https://developer.apple.com/library/ios/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html" target="_blank" rel="external">configure web application icon</a>.</p>
<h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><p>Besides all cases that describe above, <code>favicon</code> is also used in some special cases, such as <a href="https://developers.google.com/tv/web/docs/design_for_tv#favicons" target="_blank" rel="external">Google TV</a>, <a href="http://operacoast.com/developer#icon" target="_blank" rel="external">Opera Speed Dial</a>, Chrome Web App. They all requires different size of <code>favico</code>.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In a short description, <code>favico</code> isn’t as simple as it looks. And it actually used wrongly by most websites.<br>To provide proper <code>favico</code> for all platforms and devices is not a simple work to do.<br>Here is the <code>favico</code> declaration that used this blog:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"57x57"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-57x57.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"114x114"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-114x114.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"72x72"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-72x72.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"144x144"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-144x144.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"60x60"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-60x60.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"120x120"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-120x120.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"76x76"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-76x76.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon"</span> <span class="attr">sizes</span>=<span class="string">"152x152"</span> <span class="attr">href</span>=<span class="string">"/apple-touch-icon-152x152.png"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> <span class="attr">href</span>=<span class="string">"/favicon-196x196.png"</span> <span class="attr">sizes</span>=<span class="string">"196x196"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> <span class="attr">href</span>=<span class="string">"/favicon-160x160.png"</span> <span class="attr">sizes</span>=<span class="string">"160x160"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> <span class="attr">href</span>=<span class="string">"/favicon-96x96.png"</span> <span class="attr">sizes</span>=<span class="string">"96x96"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> <span class="attr">href</span>=<span class="string">"/favicon-16x16.png"</span> <span class="attr">sizes</span>=<span class="string">"16x16"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> <span class="attr">href</span>=<span class="string">"/favicon-32x32.png"</span> <span class="attr">sizes</span>=<span class="string">"32x32"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"msapplication-TileColor"</span> <span class="attr">content</span>=<span class="string">"#00a300"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"msapplication-TileImage"</span> <span class="attr">content</span>=<span class="string">"/mstile-144x144.png"</span>&gt;</span></div></pre></td></tr></table></figure>
<p>And these files are served on this blog as <code>favico</code>:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">favicon.ico</div><div class="line"></div><div class="line">favicon<span class="number">-16</span>x16.png</div><div class="line">favicon<span class="number">-32</span>x32.png</div><div class="line">favicon<span class="number">-96</span>x96.png</div><div class="line">favicon<span class="number">-160</span>x160.png</div><div class="line">favicon<span class="number">-196</span>x196.png</div><div class="line"></div><div class="line">apple-<span class="section">touch</span>-icon.png</div><div class="line">apple-<span class="section">touch</span>-icon-precomposed.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-57</span>x57.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-60</span>x60.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-72</span>x72.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-76</span>x76.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-114</span>x114.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-120</span>x120.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-144</span>x144.png</div><div class="line">apple-<span class="section">touch</span>-icon<span class="number">-152</span>x152.png</div><div class="line"></div><div class="line">browserconfig.xml</div><div class="line">mstile<span class="number">-70</span>x70.png</div><div class="line">mstile<span class="number">-144</span>x144.png</div><div class="line">mstile<span class="number">-150</span>x150.png</div><div class="line">mstile<span class="number">-310</span>x150.png</div><div class="line">mstile<span class="number">-310</span>x310.png</div></pre></td></tr></table></figure>
<p>As you can see, to prepare all these configurations and files is not an easy job to do. It really consumes you a lot effort.</p>
<p>Fortunately, we have the awesome <a href="http://realfavicongenerator.net/" target="_blank" rel="external">Real Favicon Generator</a> brought by <a href="https://github.com/phbernard/" target="_blank" rel="external">Philippe Bernard</a>, which will save your tons of time to have the proper fav icon configuration.</p>
<p><code>Real Favicon Generator</code> also comes with a <a href="http://realfavicongenerator.net/favicon_checker" target="_blank" rel="external">favicon checker</a>, which check the favorite configuration for your website, and generates  <a href="http://realfavicongenerator.net/favicon_checker?site=timnew.github.io" target="_blank" rel="external">beautiful report</a>.</p>
<p>At last the <a href="http://realfavicongenerator.net/faq" target="_blank" rel="external">FAQ</a> of the site also provides a good explanation of the issue described above in details. Hope it helps.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/08/18/favicon-is-not-as-simple-as-you-think/" data-id="ciqg4g85100866nsi0tve1xtm" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/08/18/favicon-is-not-as-simple-as-you-think/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deployment/">deployment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/design/">design</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/favicon/">favicon</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ios/">iOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/icon/">icon</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logo/">logo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tile/">tile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/website/">website</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/windows-8/">windows 8</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/categories/programming/blog/2/">2</a><a class="page-number" href="/categories/programming/blog/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/categories/programming/blog/8/">8</a><a class="extend next" rel="next" href="/categories/programming/blog/2/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Recent Posts</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Tag Cloud</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Categories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>