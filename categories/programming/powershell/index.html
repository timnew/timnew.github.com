<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Categorie: PowerShell | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/categories/programming/powershell/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');

  ga('require', 'displayfeatures');

ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Zoeken"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-powershell-script-to-serialize-and-deserialize-hash-object-to-and-from-ini-like-text" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/04/13/powershell-script-to-serialize-and-deserialize-hash-object-to-and-from-ini-like-text/" class="article-date">
  <time datetime="2012-04-13T00:00:00.000Z" itemprop="datePublished">2012-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/powershell/">PowerShell</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/04/13/powershell-script-to-serialize-and-deserialize-hash-object-to-and-from-ini-like-text/">Powershell script to serialize and deserialize hash-object to and from ini-like text</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Powershell and .net fx provides a dozen of approaches to manipulate hash-object. And it is really easy and convenient to initialize hash-object with values from environment variables, registry or cli arguments.<br>And Hash-Object can be accessed and built into hierarchy easily, so to use powershell hash-object as deploy configuration is really powerful and convenient.</p>
<p>But in our system, the application uses the ini-like key-value pair plain text as the initial configuration file. So our deploy script need the ability to serialize and deserialize hash-object to and from ini-like config.</p>
<p>So I composed this piece of script.</p>
<script src="//gist.github.com/2373809.js"></script>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/04/13/powershell-script-to-serialize-and-deserialize-hash-object-to-and-from-ini-like-text/" data-id="cineg3i74001jy7sixc8urlwx" class="article-share-link">Delen</a>
      
        <a href="http://timnew.me/blog/2012/04/13/powershell-script-to-serialize-and-deserialize-hash-object-to-and-from-ini-like-text/#disqus_thread" class="article-comment-link">Commentaren</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/configuration/">configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hash/">hash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ini/">ini</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/script/">script</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/serialization/">serialization</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-powershell-script-for-environment-provision-and-auto-deploy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/04/05/powershell-script-for-environment-provision-and-auto-deploy/" class="article-date">
  <time datetime="2012-04-05T00:00:00.000Z" itemprop="datePublished">2012-04-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/powershell/">PowerShell</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/04/05/powershell-script-for-environment-provision-and-auto-deploy/">Powershell Script for Environment Provision and Auto Deploy</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve been working on MetaPaas project for a while. And composing deploy script is one of the my major tasks.<br>Here are some script snippets I found or I compose, which could be very useful in my daily work.</p>
<h3 id="Download-File-from-Web"><a href="#Download-File-from-Web" class="headerlink" title="Download File from Web"></a>Download File from Web</h3><p>This piece of script is useful when the script need to download package from CI server or configuration from configuration server etc.<br>Especially when wget or curl available.</p>
<p><strong>NOTICE: </strong> This piece of script enable you to download the file from web in Powershell without any 3rd party dependences. But its performance is not as good as wget. Wget is still recommended if there are quite a lot of files to be downloaded.</p>
<p><a href="http://huddledmasses.org/wget-2-for-powershell/" target="_blank" rel="external">Original Source</a></p>
<figure class="highlight powershell"><figcaption><span>Get-WebFile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">## Get-WebFile (aka wget for PowerShell)</span></span><br><span class="line"><span class="comment">##############################################################################################################</span></span><br><span class="line"><span class="comment">## Downloads a file or page from the web</span></span><br><span class="line"><span class="comment">## History:</span></span><br><span class="line"><span class="comment">## v3.6 - Add -Passthru switch to output TEXT files</span></span><br><span class="line"><span class="comment">## v3.5 - Add -Quiet switch to turn off the progress reports ...</span></span><br><span class="line"><span class="comment">## v3.4 - Add progress report for files which don't report size</span></span><br><span class="line"><span class="comment">## v3.3 - Add progress report for files which report their size</span></span><br><span class="line"><span class="comment">## v3.2 - Use the pure Stream object because StreamWriter is based on TextWriter:</span></span><br><span class="line"><span class="comment">##        it was messing up binary files, and making mistakes with extended characters in text</span></span><br><span class="line"><span class="comment">## v3.1 - Unwrap the filename when it has quotes around it</span></span><br><span class="line"><span class="comment">## v3   - rewritten completely using HttpWebRequest + HttpWebResponse to figure out the file name, if possible</span></span><br><span class="line"><span class="comment">## v2   - adds a ton of parsing to make the output pretty</span></span><br><span class="line"><span class="comment">##        added measuring the scripts involved in the command, (uses Tokenizer)</span></span><br><span class="line"><span class="comment">##############################################################################################################</span></span><br><span class="line"><span class="keyword">function</span> Get-WebFile &#123;</span><br><span class="line">   <span class="keyword">param</span>(</span><br><span class="line">      <span class="variable">$url</span> = (<span class="built_in">Read-Host</span> <span class="string">"The URL to download"</span>),</span><br><span class="line">      <span class="variable">$fileName</span> = <span class="literal">$null</span>,</span><br><span class="line">      [switch]<span class="variable">$Passthru</span>,</span><br><span class="line">      [switch]<span class="variable">$quiet</span></span><br><span class="line">   )</span><br><span class="line"></span><br><span class="line">   <span class="variable">$req</span> = [System.Net.HttpWebRequest]::Create(<span class="variable">$url</span>);</span><br><span class="line">   <span class="variable">$res</span> = <span class="variable">$req</span>.GetResponse();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$fileName</span> -and !(<span class="built_in">Split-Path</span> <span class="variable">$fileName</span>)) &#123;</span><br><span class="line">      <span class="variable">$fileName</span> = <span class="built_in">Join-Path</span> (<span class="built_in">Get-Location</span> -PSProvider <span class="string">"FileSystem"</span>) <span class="variable">$fileName</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">elseif</span>((!<span class="variable">$Passthru</span> -and (<span class="variable">$fileName</span> <span class="nomarkup">-eq</span> <span class="literal">$null</span>)) -or ((<span class="variable">$fileName</span> <span class="nomarkup">-ne</span> <span class="literal">$null</span>) -and (<span class="built_in">Test-Path</span> -PathType <span class="string">"Container"</span> <span class="variable">$fileName</span>)))</span><br><span class="line">   &#123;</span><br><span class="line">      [string]<span class="variable">$fileName</span> = ([regex]<span class="string">'(?i)filename=(.*)$'</span>).Match(<span class="variable">$res</span>.Headers[<span class="string">"Content-Disposition"</span>] ).Groups[<span class="number">1</span>].Value</span><br><span class="line">      <span class="variable">$fileName</span> = <span class="variable">$fileName</span>.trim(<span class="string">"\/"</span><span class="string">"'"</span>)</span><br><span class="line">      <span class="keyword">if</span>(!<span class="variable">$fileName</span>) &#123;</span><br><span class="line">         <span class="variable">$fileName</span> = <span class="variable">$res</span>.ResponseUri.Segments[-<span class="number">1</span>]</span><br><span class="line">         <span class="variable">$fileName</span> = <span class="variable">$fileName</span>.trim(<span class="string">"\/"</span>)</span><br><span class="line">         <span class="keyword">if</span>(!<span class="variable">$fileName</span>) &#123;</span><br><span class="line">            <span class="variable">$fileName</span> = <span class="built_in">Read-Host</span> <span class="string">"Please provide a file name"</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="variable">$fileName</span> = <span class="variable">$fileName</span>.trim(<span class="string">"\/"</span>)</span><br><span class="line">         <span class="keyword">if</span>(!([IO.FileInfo]<span class="variable">$fileName</span>).Extension) &#123;</span><br><span class="line">            <span class="variable">$fileName</span> = <span class="variable">$fileName</span> + <span class="string">"."</span> + <span class="variable">$res</span>.ContentType.Split(<span class="string">";"</span>)[<span class="number">0</span>].Split(<span class="string">"/"</span>)[<span class="number">1</span>]</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable">$fileName</span> = <span class="built_in">Join-Path</span> (<span class="built_in">Get-Location</span> -PSProvider <span class="string">"FileSystem"</span>) <span class="variable">$fileName</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$Passthru</span>) &#123;</span><br><span class="line">      <span class="variable">$encoding</span> = [System.Text.Encoding]::GetEncoding(<span class="variable">$res</span>.CharacterSet )</span><br><span class="line">      [string]<span class="variable">$output</span> = <span class="string">""</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$res</span>.StatusCode <span class="nomarkup">-eq</span> <span class="number">200</span>) &#123;</span><br><span class="line">      [int]<span class="variable">$goal</span> = <span class="variable">$res</span>.ContentLength</span><br><span class="line">      <span class="variable">$reader</span> = <span class="variable">$res</span>.GetResponseStream()</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$fileName</span>) &#123;</span><br><span class="line">         <span class="variable">$writer</span> = <span class="built_in">new-object</span> System.IO.FileStream <span class="variable">$fileName</span>, <span class="string">"Create"</span></span><br><span class="line">      &#125;</span><br><span class="line">      [byte[]]<span class="variable">$buffer</span> = <span class="built_in">new-object</span> byte[] <span class="number">4096</span></span><br><span class="line">      [int]<span class="variable">$total</span> = [int]<span class="variable">$count</span> = <span class="number">0</span></span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">         <span class="variable">$count</span> = <span class="variable">$reader</span>.Read(<span class="variable">$buffer</span>, <span class="number">0</span>, <span class="variable">$buffer</span>.Length);</span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$fileName</span>) &#123;</span><br><span class="line">            <span class="variable">$writer</span>.Write(<span class="variable">$buffer</span>, <span class="number">0</span>, <span class="variable">$count</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(<span class="variable">$Passthru</span>)&#123;</span><br><span class="line">            <span class="variable">$output</span> += <span class="variable">$encoding</span>.GetString(<span class="variable">$buffer</span>,<span class="number">0</span>,<span class="variable">$count</span>)</span><br><span class="line">         &#125; <span class="keyword">elseif</span>(!<span class="variable">$quiet</span>) &#123;</span><br><span class="line">            <span class="variable">$total</span> += <span class="variable">$count</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$goal</span> <span class="nomarkup">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="built_in">Write-Progress</span> <span class="string">"Downloading <span class="variable">$url</span>"</span> <span class="string">"Saving <span class="variable">$total</span> of <span class="variable">$goal</span>"</span> -id <span class="number">0</span> -percentComplete ((<span class="variable">$total</span>/<span class="variable">$goal</span>)*<span class="number">100</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="built_in">Write-Progress</span> <span class="string">"Downloading <span class="variable">$url</span>"</span> <span class="string">"Saving <span class="variable">$total</span> bytes..."</span> -id <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125; <span class="keyword">while</span> (<span class="variable">$count</span> <span class="nomarkup">-gt</span> <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">      <span class="variable">$reader</span>.Close()</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$fileName</span>) &#123;</span><br><span class="line">         <span class="variable">$writer</span>.Flush()</span><br><span class="line">         <span class="variable">$writer</span>.Close()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$Passthru</span>)&#123;</span><br><span class="line">         <span class="variable">$output</span></span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="variable">$res</span>.Close();</span><br><span class="line">   <span class="keyword">if</span>(<span class="variable">$fileName</span>) &#123;</span><br><span class="line">      ls <span class="variable">$fileName</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Extract-File-with-Windows-Explorer"><a href="#Extract-File-with-Windows-Explorer" class="headerlink" title="Extract File with Windows Explorer"></a>Extract File with Windows Explorer</h3><p>This piece of code enable you to extract zip package without any 3rd party dependencies. It is useful environment provision script, which is usually executed on a Windows without anything being installed.</p>
<figure class="highlight powershell"><figcaption><span>Extract-Zip</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">Function</span> Extract-Zip ([string] <span class="variable">$zipPath</span>, [string]<span class="variable">$destination</span>) &#123;</span><br><span class="line">	<span class="variable">$progressbar</span> = <span class="number">4</span></span><br><span class="line">	<span class="variable">$shellApplication</span> = <span class="built_in">New-Object</span> -com shell.application</span><br><span class="line">	<span class="variable">$zipPackage</span> = <span class="variable">$shellApplication</span>.NameSpace(<span class="variable">$zipPath</span>)</span><br><span class="line">	<span class="variable">$destinationFolderName</span> = <span class="built_in">Join-Path</span> <span class="variable">$destination</span> <span class="string">"tiger"</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">Test-Path</span> <span class="variable">$destinationFolderName</span> ) &#123;</span><br><span class="line">		<span class="built_in">Remove-Item</span> <span class="variable">$destinationFolderName</span> -Recurse -Force</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">New-Item</span> <span class="variable">$destinationFolderName</span> -type directory</span><br><span class="line">	<span class="variable">$destinationFolder</span> = <span class="variable">$shellApplication</span>.NameSpace(<span class="variable">$destinationFolderName</span>)</span><br><span class="line">	<span class="variable">$destinationFolder</span>.CopyHere(<span class="variable">$zipPackage</span>.Items(), <span class="variable">$progressbar</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Interpolate-value-into-configuration"><a href="#Interpolate-value-into-configuration" class="headerlink" title="Interpolate value into configuration"></a>Interpolate value into configuration</h3><p>This piece of script enable you to replace the place-holders in configuration text with actual values.</p>
<figure class="highlight powershell"><figcaption><span>Apply-Config</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">Function</span> Apply-Config([hashtable]<span class="variable">$config</span>) &#123;</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$line</span> <span class="keyword">in</span> <span class="variable">$input</span>) &#123;</span><br><span class="line">		<span class="keyword">foreach</span>(<span class="variable">$key</span> <span class="keyword">in</span> <span class="variable">$config</span>.Keys) &#123;</span><br><span class="line">			<span class="variable">$line</span> = <span class="variable">$line</span> <span class="nomarkup">-replace</span> <span class="variable">$key</span>, <span class="variable">$config</span>[<span class="variable">$key</span>]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$line</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>This piece of script can be used in different scenarios:</p>
<h4 id="Prepare-Configuration"><a href="#Prepare-Configuration" class="headerlink" title="Prepare Configuration"></a>Prepare Configuration</h4><figure class="highlight powershell"><figcaption><span>Config</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$configuration</span> = @&#123;</span><br><span class="line">	<span class="string">"initialCatalog"</span> = <span class="string">"lion"</span></span><br><span class="line">	<span class="string">"logInitialCatalog"</span> = <span class="string">"lion_log"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"webServers"</span> = @(<span class="string">"192.168.122.46"</span>)</span><br><span class="line">	<span class="string">"dbServer"</span> = <span class="string">"192.168.122.65"</span></span><br><span class="line">	<span class="string">"SQLServerDataDir"</span> = <span class="string">"C:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA"</span></span><br><span class="line">	<span class="string">"SQLServerDataFileSize"</span> = <span class="string">"10MB"</span></span><br><span class="line">	<span class="string">"dataset"</span> = <span class="string">"prod"</span></span><br><span class="line"></span><br><span class="line">	<span class="string">"appPoolUser"</span> = <span class="string">"$(<span class="variable">$env:COMPUTERNAME</span>)\Lion"</span></span><br><span class="line">	<span class="string">"appPoolPassword"</span> = <span class="string">"1zhlmcl..oostp"</span></span><br><span class="line">	<span class="string">"createAppPoolUser"</span> = <span class="literal">$true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Apply-config-to-in-memory-configuration-template"><a href="#Apply-config-to-in-memory-configuration-template" class="headerlink" title="Apply config to in-memory configuration template"></a>Apply config to in-memory configuration template</h4><figure class="highlight powershell"><figcaption><span>Apply config to string in memory</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">$configurationText</span> = <span class="variable">$configurationTemplate</span> | Apply-Config(<span class="variable">$configuration</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Create-configuration-file-according-to-template"><a href="#Create-configuration-file-according-to-template" class="headerlink" title="Create configuration file according to template"></a>Create configuration file according to template</h4><figure class="highlight powershell"><figcaption><span>Apply config to file</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cat <span class="variable">$configurationTemplateFile</span> | Apply-Config(<span class="variable">$configuration</span>) &gt; <span class="variable">$configurationFile</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Download-and-apply-configuration-from-configuration-server"><a href="#Download-and-apply-configuration-from-configuration-server" class="headerlink" title="Download and apply configuration from configuration server"></a>Download and apply configuration from configuration server</h4><figure class="highlight powershell"><figcaption><span>Download and apply config</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Get-WebFile -url <span class="variable">$configTemplateUrl</span> -Passthru | Apply-Config(<span class="variable">$configuration</span>) &gt; <span class="variable">$configurationFile</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/04/05/powershell-script-for-environment-provision-and-auto-deploy/" data-id="cineg3i6s0016y7si7poo12y5" class="article-share-link">Delen</a>
      
        <a href="http://timnew.me/blog/2012/04/05/powershell-script-for-environment-provision-and-auto-deploy/#disqus_thread" class="article-comment-link">Commentaren</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/automation/">Automation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ci/">CI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/continues-delivery/">Continues Delivery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/continues-integration/">Continues Integration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deploy/">Deploy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deployment/">Deployment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">Powershell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/remote/">Remote</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/script/">Script</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Recente berichten</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Tag Cloud</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Categorieën</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archieven</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>