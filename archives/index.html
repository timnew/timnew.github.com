<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/archives/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');

  ga('require', 'displayfeatures');

ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-collection-filtering-algorithm-with-bit-operation-part-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/" class="article-date">
  <time datetime="2016-04-23T09:46:30.000Z" itemprop="datePublished">2016-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/algorithm/">Algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>Collection must be the most commonly used data model in programming. And there are a number of data structure that represents collection in memory, in which <code>Array</code> and <code>Liked List</code> must be the most well known ones.</p>
<p>When dealing with collection, <code>filtering</code> must be one of the most widely used operation being used. Such as find item(s) satisfies specific criteria from the collection. Although filtering is used a lot, but it isn’t actually a simple or easy operation to apply, especially dealing with tremendous data volume.</p>
<p>In fact, there are a number of derived topics about collection filtering, which is impossible to cover them all in the article. This article will focus on <code>bit operation</code>, probably a not widely known but really interesting topic to introduce.</p>
<h2 id="Problem-Find-the-missing-integer"><a href="#Problem-Find-the-missing-integer" class="headerlink" title="Problem: Find the missing integer"></a>Problem: Find the missing integer</h2><blockquote><p><strong>Problem</strong><br>Suppose there is a collection of integers <code>L</code>.<br>Name the collection that contains integers from 1 to <code>N</code> as <code>G</code><br>Then <code>L</code> contains all the elements of <code>G</code> except one number <code>x</code>.<br>Items in <code>L</code> are in random order.<br>Find <code>x</code>.</p>
</blockquote>
<p><strong>TIP: </strong> This problem be too easy to experienced developers and algorithm hackers. But it is a good opening words to the following 2 problems in this series. Also it reveals the core concept of some other advanced technologies, such as <code>CRC</code> or <code>bloom filter</code>.</p>
<p>When got this problem, the very intuitive(means do it manually by human being) idea is to compare the elements in <code>L</code> and <code>G</code>, find each element in <code>L</code> and remove it from <code>G</code>, then the only left item in <code>G</code> is <code>x</code>.</p>
<p>Here is the code:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer[] L</span></div><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer N</span></div><div class="line"><span class="comment"># <span class="doctag">@return</span> Integer x</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_missing_x</span><span class="params">(L, N)</span></span></div><div class="line">  G = [*(<span class="number">1</span>..N)] <span class="comment"># Create G with all integers from 1 to N</span></div><div class="line"></div><div class="line">  L.each &#123; <span class="params">|i|</span> G.delete(i) &#125; <span class="comment"># Traverse L, and remove each item in L from G</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> G.last <span class="comment"># Return the only rest item from G</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Well this is a work but brute algorithm, which is not efficient in both time and space:</p>
<ul>
<li>Instantiate <code>G</code> means it has space complexity <code>N</code></li>
<li>Find and remove <code>i</code> from <code>G</code> means it has time complexity at <code>O(N*Log(N))</code></li>
</ul>
<p>Yes, the algorithm can be optimized, with bit operation. In fact the problem can be resolved with time complexity <code>O(N)</code> and space complexity <code>O(1)</code>.</p>
<h2 id="Exclusive-Or-Operation"><a href="#Exclusive-Or-Operation" class="headerlink" title="Exclusive-Or Operation"></a><code>Exclusive-Or</code> Operation</h2><p><code>Exclusive-Or</code>(Or <code>XOR</code> for short, written as <code>^</code> in this article) is a basic bit operation, here is an Venn Diagram explains it:</p>
<img src="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/xor_venn.png" alt="XOR" title="XOR">
<p><code>XOR</code> is an important bit operation because it has following interesting features:</p>
<ol>
<li>A ^ B = B ^ A (aka <strong>Commutativity</strong>)</li>
<li>(A ^ B) ^ C = A ^ (B ^ C) (aka <strong>Associativity</strong>)</li>
<li>A ^ A = 0</li>
<li>A ^ 0 = A</li>
</ol>
<p>Commutativity and Associativity ensure that <code>XOR</code> can be used despite of order. The 3rd and 4th feature establishes a critical position for <code>XOR</code> in <code>cryptology</code> and <code>encoding</code>.</p>
<h2 id="Solution-with-XOR"><a href="#Solution-with-XOR" class="headerlink" title="Solution: with XOR"></a>Solution: with <code>XOR</code></h2><p>By making use of <code>XOR</code>, previous problem can ben resolved in a much more graceful way:</p>
<ul>
<li>Given <code>y</code> is the <code>xor</code> result of all items in <code>G</code></li>
<li>And <code>z</code> is the <code>xor</code> result of all items in <code>L</code></li>
<li>Then <code>x = y ^ z</code></li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer[] L</span></div><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer N</span></div><div class="line"><span class="comment"># <span class="doctag">@return</span> Integer x</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_missing_x</span><span class="params">(L, N)</span></span></div><div class="line">  x = <span class="number">0</span> <span class="comment"># Set x to 0, since A ^ 0 = A</span></div><div class="line"></div><div class="line">  (<span class="number">1</span>..N).each &#123; <span class="params">|i|</span> x ^= i &#125; <span class="comment"># Calculate the xor result for G</span></div><div class="line"></div><div class="line">  L.each &#123; <span class="params">|i|</span> x ^= i &#125; <span class="comment"># Keep xor all elements in L</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> x <span class="comment"># Return the only rest item from G</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Let’s prove it mathematically:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">Given</span> x<span class="string">'= y ^ z</span></div><div class="line">Then  x' = (n1<span class="regexp"> ^</span> n2<span class="regexp"> ^</span> n3<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> x<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> nN)<span class="regexp"> ^</span> (n1<span class="regexp"> ^</span> n2<span class="regexp"> ^</span> n3<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> nN)</div><div class="line">Since<span class="regexp"> ^</span> obeys commutativity and associativity</div><div class="line">Then  = (n1<span class="regexp"> ^</span> n1)<span class="regexp"> ^</span> (n2<span class="regexp"> ^</span> n2)<span class="regexp"> ^</span> ...<span class="regexp"> ^</span> (nN<span class="regexp"> ^</span> nN)<span class="regexp"> ^</span> x</div><div class="line">As n<span class="regexp"> ^</span> n = <span class="number">0</span> and n<span class="regexp"> ^</span> <span class="number">0</span> = n</div><div class="line">Then  x<span class="string">'= 0 ^ 0 ^ ... ^ 0 ^ x</span></div><div class="line">         = x</div></pre></td></tr></table></figure></p>
<p>Actually the code can be more concise by using <code>reduce</code>, with 2-lines of code</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer[] L</span></div><div class="line"><span class="comment"># <span class="doctag">@param</span> Integer N</span></div><div class="line"><span class="comment"># <span class="doctag">@return</span> Integer x</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_missing_x</span><span class="params">(L, N)</span></span></div><div class="line">  x = (<span class="number">1</span>..N).reduce(&amp;<span class="symbol">:^</span>) <span class="comment"># Calculate the xor result for G</span></div><div class="line"></div><div class="line">  L.reduce(x, &amp;<span class="symbol">:^</span>) <span class="comment"># Keep xor all elements in L and return</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>Or <code>C</code> version:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">find_missing_x</span><span class="params">(<span class="keyword">long</span> N, <span class="keyword">long</span>* L)</span> </span>&#123;</div><div class="line">  <span class="keyword">long</span> x = N;</div><div class="line"></div><div class="line">  <span class="keyword">for</span>(<span class="keyword">long</span> i = <span class="number">0</span>; i &lt; N - <span class="number">1</span>; i++) &#123; <span class="comment">// L has size of N-1</span></div><div class="line">    x ^= i ^ L[i];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> x;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Extending-problems"><a href="#Extending-problems" class="headerlink" title="Extending problems"></a>Extending problems</h2><p>So far the problem has been gracefully resolved. But it is yet the end, here is a couple of extending questions:</p>
<ol>
<li>If <code>G</code> is collection with random but unique numbers (Not continues integer from 1 to <code>N</code>). How to write the code?</li>
<li>Based on <code>1</code>, if there are 2 numbers are missing? How to find them both?</li>
<li>Based on <code>1</code>, but <code>L</code> contains the members from <code>G</code> except <code>x</code>for exactly 2 times. That means <code>L</code> might contain 0 or 1 <code>x</code>, but exactly 2 for any other members from <code>G</code>. How to find <code>x</code>?</li>
<li>Based on <code>1</code>, but <code>G</code> isn’t a collection of integer, but a collection of web urls. How to find the one missing url?</li>
<li>Based on <code>4</code>, <code>G</code> is a collection of url, <code>L</code> is subset of <code>G</code> (might contains fewer members other than exactly <code>N</code> - 1). How can we know a randomly picked member from <code>G</code> is absolutely not contained by <code>L</code>. Given the tolerance to mistake on saying a member from <code>G</code> is in <code>L</code> but it doesn’t.</li>
</ol>
<p>These problems will be explained in the following posts.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/" data-id="ciqg4g85m009h6nsiv11xnayj" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">Algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binary/">Binary</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bit-operation/">Bit Operation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bloom-filter/">Bloom Filter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/collection/">Collection</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/filtering/">Filtering</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/introduction/">Introduction</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/logic/">Logic</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-clean-way-to-test-rejected-promise" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/" class="article-date">
  <time datetime="2015-08-14T08:08:53.000Z" itemprop="datePublished">2015-08-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>To test the the exception in a rejected promise could be a little bit painful.</p>
<p>And <a href="https://mochajs.org/" target="_blank" rel="external">Mocha</a> is Promise-friendly, which means it fails the test if exception is not caught.</p>
<p>So as a result, here is a simple code example to explain how it is being done:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">it <span class="string">'should throw session-expired exception'</span></div><div class="line">  <span class="keyword">new</span> Session().generateId().bindUserFromRedis()</div><div class="line">  .<span class="keyword">then</span> -&gt;</div><div class="line">    <span class="literal">null</span></div><div class="line">  .<span class="keyword">catch</span> (ex) -&gt;</div><div class="line">    ex</div><div class="line">  .<span class="keyword">then</span> (ex) -&gt;</div><div class="line">    expect(ex).to.be.<span class="keyword">instanceof</span>(ResponseError)</div><div class="line">              .<span class="keyword">and</span>.that.have.property(<span class="string">'errorName'</span>, <span class="string">'session-expired'</span>)</div></pre></td></tr></table></figure>
<hr>

<p><strong>Update:</strong> A Chai Plugin can mitigate the pain</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'should throw session-expired exception'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">return</span> expect(<span class="keyword">new</span> Session().generateId().bindUserFromRedis())</div><div class="line">           .to.evetually.rejected</div><div class="line">              .and.that.have.property(<span class="string">'errorName'</span>, <span class="string">'session-expired'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p><strong>Update 2:</strong> With async, it can be converted into normal test<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">it(<span class="string">'should throw session-expired exception'</span>, () =&gt; &#123;</div><div class="line">  <span class="keyword">return</span> expect(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> <span class="keyword">new</span> Session().generateId().bindUserFromRedis())</div><div class="line">          .to.throw</div><div class="line">             .and.that.have.property(<span class="string">'errorName'</span>, <span class="string">'session-expired'</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2015/08/14/a-clean-way-to-test-rejected-promise/" data-id="ciqg4g85p009p6nsi89fo4fzm" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2015/08/14/a-clean-way-to-test-rejected-promise/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mocha/">Mocha</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/promise/">Promise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test/">Test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-typical-eventbus-design-patterns" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/12/06/typical-eventbus-design-patterns/" class="article-date">
  <time datetime="2014-12-06T08:37:41.000Z" itemprop="datePublished">2014-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/design-patterns/">Design Patterns</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>EventBus</code> is an special <a href="`Pub &amp; Sub`">Publish &amp; Subscribe Pattern</a> implementation. <code>EventBus</code> enable message to be delivered between components without requiring the components to register itself to others.</p>
<p>Comparing <code>EventBus</code> to other <code>Pub &amp; Sub</code> implementations, <code>EventBus</code> is:</p>
<ol>
<li>Designed to replace the original event distribution system, which requires the components register itself to each other.</li>
<li>Not designed for general use, <code>EventBus</code> adds additional complexity and runtime overhead to the system. So it is not designed to replace normal method calls.</li>
<li>Not designed for inter-process communication as some other Pub&amp;Sub.</li>
</ol>
<h2 id="EventBus-saves-Android-developers’-life"><a href="#EventBus-saves-Android-developers’-life" class="headerlink" title="EventBus saves Android developers’ life"></a><code>EventBus</code> saves Android developers’ life</h2><p>When developing Android application, I strongly recommend developer to introduce an <code>EventBus</code> library. <a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">EventBus</a> from <code>GreenRobot</code>, <a href="http://square.github.io/otto/" target="_blank" rel="external">Otto</a> from <code>Squqre</code> are good solutions. Or even to choose the original <code>EventBus</code> in <a href="https://code.google.com/p/guava-libraries/" target="_blank" rel="external">Guava</a> library from Google.</p>
<p>With <code>EventBus</code>, components can communicate with each other without need to hold direct reference of each other. This is very important to avoid app crashes when calling a method on a detached or destroyed component. Usually this kind of issue isn’t that easy to handle due to Android’s over-complicated life cycle management. So even in the worst case that one component is sending message to another component which has been destroyed (which should unregister itself from EventBus on that time), it only triggered a <code>norecipient waring</code> instead of crashing the app.</p>
<p>Also with <code>EventBus</code> as intermedia, you can avoid to exposing objects to root activity or application just for registering callbacks on each other. Components are higher cohesion &amp; lower coupling.</p>
<p>As the result, <code>EventBus</code> saves tons of time to debugging crash, and make your code more readable, maintainble, extensible, and flexible.</p>
<h2 id="Abusing-EventBus-kills-your-app-easily"><a href="#Abusing-EventBus-kills-your-app-easily" class="headerlink" title="Abusing EventBus kills your app easily"></a>Abusing <code>EventBus</code> kills your app easily</h2><p>“<code>EventBus</code> is awesome! It is so convenient, so let’s replace everything with event”… This kind of saying is commonly heard from the developers who just realized the benefits from <code>EventBus</code>. Since <code>EventBus</code> is too convenient to use, they tends to replace everything with EventBus.</p>
<p>But we mentioned in the introduction of <code>EventBus</code> that <code>EventBus</code> is design to replace traditional event system in Java, and is not designed for general use. Abusing makes your code hard to understand, hard to debug. Long event chain is a common reason that cause of unexpected behavior.</p>
<h2 id="Broadcast-Event-Command-and-Request"><a href="#Broadcast-Event-Command-and-Request" class="headerlink" title="Broadcast Event, Command and Request"></a>Broadcast Event, Command and Request</h2><p><code>EventBus</code> is powerful, but can be easily abused. To make a better use of EventBus, I learn a number of EventBus usages, and evaluated the scenario, and summarized out 3 typeical EventBus usage patterns: <strong>Broadcast Event</strong>, <strong>Command</strong> and <strong>Request</strong>.</p>
<h3 id="Broadcast-Event"><a href="#Broadcast-Event" class="headerlink" title="Broadcast Event"></a>Broadcast Event</h3><p><code>Broadcast Event</code> is a special kind of event that used by a specific component to broadcast its status updated to other components.</p>
<h4 id="Declaration"><a href="#Declaration" class="headerlink" title="Declaration"></a>Declaration</h4><p><code>Broadcast Event</code> should be used when several components cares about the specific component’s status update. So usually <code>Broadcast Event</code> should have more than one recipients or, at least, potential recipients.</p>
<p><code>Broadcast Event</code> should be an immutable data object, so:</p>
<ol>
<li>It is immutable, so once it is created, its status should not changed, which guarantees the equality between recipients.</li>
<li>It is data object, so it should not has methods that might change other classes status.</li>
<li>It might have methods that helps its consumer to consume the data it contains.</li>
<li>It should be declared as a nested static class of publisher.</li>
</ol>
<p><strong>NOTICE</strong><br>If you thought a Event is “Broadcast Event”, but later you found it has only one recipient, then you might need to consider refact it into a <code>Command</code> or a <code>Request</code>.</p>
<h3 id="Command"><a href="#Command" class="headerlink" title="Command"></a>Command</h3><p><code>Command</code> is a special kind of event that has the ability to update specific object or specific type of objects. In most cases, <code>Command</code> should have only one recipient. In some special cases, it might has a group of recipients with exactly same type.</p>
<p>Precisely, the latter case is a variant of <code>Command</code> pattern, <code>Batch Command</code>, which works as same as <code>Command</code> but have multiple recipients so it can update multiple instances in a batch.</p>
<p><code>Command</code> should be a immutable object that able to update specific object, so:</p>
<ol>
<li>It should have 1 <code>execute</code> method with 1 parameter, which represents the target that the command updates.</li>
<li>When invoking execute method shouldn’t change its own status, so it does exactly same thing when applying it to multiple targets.</li>
<li>It behavior should be stable across time, so its behavior won’t change when it is apply asynchronously.</li>
<li>The object that <code>execute</code> method accepts is not necessarily to be the recipient. It could be the object that recipient holds or it has access to.</li>
<li>It should be declared as nested static class of the recipient.</li>
<li>If recipient accepts multiple events, these events are recommended to derived from the same base class. So The recipient could subscribe to the base class, rather than every command.</li>
</ol>
<p><strong>NOTICE</strong><br><code>Command</code> can be seen as recipient’s special method that can be invoked without known recipient instance. So its behavior should fully contained in the class. The subscribing method on recipient should contain one line of code to invoke <code>execute</code> method on command.</p>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><p><code>Request</code> is a special kind of event that has the ability to accept data from another object. If the request has multiple recipients, to avoid ambiguous behavior, there should be only one of <code>Request</code>‘s respond the request.</p>
<p>But there is one exception, that is for the request collects data from multiple objects, multiple objects might respond to the request. This special kind of <code>Request</code> is called <code>Collector</code>.</p>
<p><code>Request</code> should be a object that accept data from recipient, so:</p>
<ol>
<li>It should have <code>respond</code> method with 1 parameter, which represents the data the request asks for.</li>
<li>Request should contains enough information for the recipients to determine whether to respond the request.</li>
<li>The recipients should check request’s status to determine whether it should respond request.</li>
<li>The request can update the publisher directly in the <code>respond</code> method</li>
<li>It should be declared as nested class of publisher. If possible, also declare it as static, which will be helpful to simplify the tests.</li>
<li>Request might has methods to help recipient to determine whether to respond the request.</li>
</ol>
<p><strong>NOTICE</strong><br><code>Request</code> can be seen as a special method that publisher exposes to a specific recipient, so the specific recipient can invoke the method to provide data. For <code>Request</code>, you might need to aware that that sometimes request might not found proper recipient to respond. If the responder is not guaranteed to exist, then the publish to watch out no-recipent warning from EventBus.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/12/06/typical-eventbus-design-patterns/" data-id="ciqg4g85q009s6nsi0zyjmxn7" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/12/06/typical-eventbus-design-patterns/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/command/">Command</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/design-pattern/">Design Pattern</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">Event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eventbus/">EventBus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/guava/">Guava</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/otto/">Otto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/request/">Request</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/" class="article-date">
  <time datetime="2014-11-09T05:44:29.000Z" itemprop="datePublished">2014-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Part 1: What it is for and how to used it</a></li>
</ul>
<hr>
<p>In android, view hierarchy usually are created via <code>layout</code> xml file. In the file, to instantiate a <code>TextView</code> we write:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span> /&gt;</div></pre></td></tr></table></figure>
<p>Usually, we need to specify the visual of the <code>TextView</code>, so we keep adding attributes to the <code>TextView</code> element:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/category_indicator_background"</span></div><div class="line">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:maxLines</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:textSize</span>=<span class="string">"12sp"</span> /&gt;</div></pre></td></tr></table></figure>
<p>Usually to fully customize visual representation of a view needs a lot of attributes and resources. Such as in this example. we added <code>background</code>, <code>gravity</code>, <code>maxLines</code>, <code>padding</code> and <code>textSize</code>, which is a lot of code.</p>
<p>And if we want to create another <code>TextView</code> with exactly same visual representation, we need to copy all the values again:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/category_indicator_background"</span></div><div class="line">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:maxLines</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:textSize</span>=<span class="string">"12sp"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 2"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/category_indicator_background"</span></div><div class="line">    <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">    <span class="attr">android:maxLines</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:paddingBottom</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:paddingLeft</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingRight</span>=<span class="string">"22dp"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"12dp"</span></div><div class="line">    <span class="attr">android:textSize</span>=<span class="string">"12sp"</span> /&gt;</div></pre></td></tr></table></figure>
<p>Obviously, in this piece of code, there are a lot of duplications. We need to compare all the values to figure out the 2 <code>TextViews</code> have the same visual. If we want to change the style, we need to update 2 TextViews. And the last, if we want to create the 3rd <code>TextView</code> or even more ones, we need copy the code again and again, which makes the issue become more troublsome.</p>
<p>In a short word, the code has bad readability, bad maintainability, bad reusability. In the book <code>Refactor</code>, we know that code redundancy is bad smell. To mitigate the issue, we need to extract the shared code into another “unit”, and replace all the occurrences with the reference.</p>
<p>In Android layout xml, the extract “unit”, which represents the shared attributes, are called <code>Style</code>. After introduced <code>Style</code>, we have:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 1"</span></div><div class="line">    <span class="attr">style</span>=<span class="string">"@style/TextView.Customized"</span>/&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"Sample 2"</span></div><div class="line">    <span class="attr">style</span>=<span class="string">"@style/TextView.Customized"</span>/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"TextView.Customized"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:gravity"</span>&gt;</span>center<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:background"</span>&gt;</span>@drawable/category_indicator_background<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingLeft"</span>&gt;</span>22dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingRight"</span>&gt;</span>22dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingTop"</span>&gt;</span>12dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:paddingBottom"</span>&gt;</span>12dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textAppearance"</span>&gt;</span>@style/CategoryIndicator.Text<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>12sp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:maxLines"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>Well, this is the basics about the <code>Style</code>: why we need it and how it is used.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/" data-id="ciqg4g85n009l6nsikjtbn0ai" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/style/">style</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/understanding/">understanding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/view/">view</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xml/">xml</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-walkthrough-untrusted-the-continuing-adventures-of-dr-eval" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/" class="article-date">
  <time datetime="2014-11-07T15:38:08.000Z" itemprop="datePublished">2014-11-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/game/">Game</a>►<a class="article-category-link" href="/categories/game/programming-game/">Programming Game</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #01A;"  >
      <a href="http://timnew.me/categories/game/">Game</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This post is Walkthrough to the game <a href="http://alexnisnevich.github.io/untrusted/" target="_blank" rel="external">Untrusted</a><br>The game introduction is available here: <a href="/blog/2014/11/05/awesome-geek-game-untrusted-the-continuing-adventures-of-dr-eval/">Awesome geek game Untrusted</a></p>
<h3 id="Level-1-cellBlockA"><a href="#Level-1-cellBlockA" class="headerlink" title="Level 1: cellBlockA"></a>Level 1: cellBlockA</h3><p>Well, you are trapped in a box. And you need to move yourself to the exit (blue squre).</p>
<ol>
<li>Before you can do anything, you need to pick the computer first, then you will be access to the source code interface.</li>
<li>Once you got the computer, you can figure out the code that generates the walls.</li>
<li>Remove the code that generate the wall! And press <code>Ctrl+5</code> to apply it.</li>
<li><script src="//gist.github.com/e2c2ea766f6163ccfcb6.js"></script>
</li>
</ol>
<h3 id="Level-2-theLongWayOut"><a href="#Level-2-theLongWayOut" class="headerlink" title="Level 2: theLongWayOut"></a>Level 2: theLongWayOut</h3><p>Well, you have learn the trick from Level 1, but it doesn’t work anylonger this time. You need to figure out a new apporach.</p>
<ol>
<li>Don’t try to find a path in the maze, there is no such solution.</li>
<li>You cannot change the maze created, but you can do something to it before it is deployed.</li>
<li>You have learn how to create it for specific size. Why not create another smaller one that doesn’t trouble you?!</li>
<li>A maze with size (0,0) is not possible, try a more realistic one, such as (3, 3) or (4, 4).</li>
<li>Exit is blocked completely. Do think about to break the wall, that is impossible.</li>
<li>Who said there can be only 1 exit per level?!</li>
<li>Create a new exit at a different location! You can learn the code form existing one.</li>
<li><script src="//gist.github.com/59ff5de31063dd27ce9d.js"></script>
</li>
</ol>
<h3 id="Level-3-validationEngaged"><a href="#Level-3-validationEngaged" class="headerlink" title="Level 3: validationEngaged"></a>Level 3: validationEngaged</h3><p>Well, again, <code>validateLevel</code> is introduced, which prevents you to replay the old tricks. So you cannot create or remove objects on the fly this time.</p>
<ol>
<li>Since you cannot create or remove objects this time, but you still can move objects.</li>
<li>Move one of the wall away to make a gap between the wall.</li>
<li><script src="//gist.github.com/a51ca90e78c392b453ae.js"></script>
</li>
</ol>
<h3 id="Level-4-multiplicity"><a href="#Level-4-multiplicity" class="headerlink" title="Level 4: multiplicity"></a>Level 4: multiplicity</h3><p>You cannot move wall this time, what will you do?</p>
<ol>
<li>Well, this is just a mindset trap. Forget about moving stuff aroud.</li>
<li>There is no <code>validateLevel</code> in this level.</li>
<li>What you did in level 2.</li>
<li>Just create a exit in the box.</li>
<li><script src="//gist.github.com/59c9d0f95aa2dabd303f.js"></script>
</li>
</ol>
<h3 id="Level-5-minesweeper"><a href="#Level-5-minesweeper" class="headerlink" title="Level 5: minesweeper"></a>Level 5: minesweeper</h3><p>Remember the favous game in Windows? Try it here.</p>
<ol>
<li>The issue here is that the mine cannot be distinguished.</li>
<li>Mark the mine with a color other than red.</li>
<li>You can change block block color by call <code>setSquareColor</code>.</li>
<li><script src="//gist.github.com/14cd0090ffe945cf7b54.js"></script>
</li>
</ol>
<h3 id="Level-6-drones101"><a href="#Level-6-drones101" class="headerlink" title="Level 6: drones101"></a>Level 6: drones101</h3><p>A killing drone? Keep away from it.</p>
<ol>
<li>Well, check <code>moveToward</code>, the logic is actually very dumb.</li>
<li>It always, move <code>up</code> and <code>down</code> if the x offset is larger than y offset.</li>
<li>It will not move, it the intented direction is blocked.</li>
<li><script src="//gist.github.com/d3c146559b8c3d7d0f41.js"></script></li>
<li>Move right first, then move down when you at the same col as the drone and block. Then move right, the drone will not follow you.</li>
</ol>
<h3 id="Level-7-colors"><a href="#Level-7-colors" class="headerlink" title="Level 7: colors"></a>Level 7: colors</h3><p>A phone to make call? Great idea!</p>
<ol>
<li>Pick up the phone, then press <code>q</code></li>
<li>The callback will be executed everytime you pressed <code>q</code></li>
<li>Rotate your color in the callback</li>
<li><script src="//gist.github.com/47bd1335906094d412aa.js"></script>
</li>
</ol>
<h3 id="Level-8-intoTheWoods"><a href="#Level-8-intoTheWoods" class="headerlink" title="Level 8: intoTheWoods"></a>Level 8: intoTheWoods</h3><p>Go across the forest from the left to the right!<br>In this level, there is very little code that you can change!</p>
<ol>
<li>Press <code>q</code></li>
<li>The only code you can change is the callback function name</li>
<li>All the functions that you can call are in the <code>functionList</code></li>
<li>Generate a new forest, when you press <code>q</code></li>
<li><script src="//gist.github.com/663f51f6cf02891a0b4a.js"></script></li>
<li>Move right as far as you can; Once you are blocked, press <code>q</code> to generate a new forest, the move.</li>
<li>Repeat move and generate forest untill you reach the exit.</li>
</ol>
<h3 id="Level-9-fordingTheRiver"><a href="#Level-9-fordingTheRiver" class="headerlink" title="Level 9: fordingTheRiver"></a>Level 9: fordingTheRiver</h3><p>Well, a self driven raft, the raft comes to pick you up.<br>BTW, I really love the BG music of this level.</p>
<ol>
<li>The raft direction is stored in variable <code>raftDirection</code>.</li>
<li>Change the <code>raftDirection</code> to <code>up</code>, will make the raft move up each turn.</li>
<li>Find a chance to override the value of <code>raftDirection</code>.</li>
<li>Write a function that registerd as phone call back with API <code>setPhoneCallback</code></li>
<li><script src="//gist.github.com/584529348a4010ef6512.js"></script></li>
<li>Go to the raft, after boarding the raft press <code>q</code> to execute callback, then move up.</li>
</ol>
<h3 id="Level-10-ambush"><a href="#Level-10-ambush" class="headerlink" title="Level 10: ambush"></a>Level 10: ambush</h3><p>Well, this time, there are a dozen of drones are on your way. You need to figure out a possible to get rid of them as fast as you can.</p>
<ol>
<li>Don’t try to run away as what you did in Level 6. It is a different scenario.</li>
<li>Try to change the drone behavior.</li>
<li>To apply the same logic to 3 kinds of drones might not be a good idea.</li>
<li>Move attak drones away from the row you’re in.</li>
<li>Move the Defence Drones away from the row you’re in.</li>
<li>Ask Reinforcement Drones to stay at the place.</li>
<li><script src="//gist.github.com/8f7358d7f81792eecb2d.js"></script>
</li>
</ol>
<h3 id="Level-11-robot"><a href="#Level-11-robot" class="headerlink" title="Level 11: robot"></a>Level 11: robot</h3><p>This time, there is very little thing about you. It is about the robot.</p>
<ol>
<li>“Hit and turn” should be smart enough for the puzzle.</li>
<li>Move forward, when hit something, turn 90 deg.</li>
<li>Use <code>me.canMove</code> to test the hit.</li>
<li>Since there just 2 states, a boolean should be enough to represent the state.</li>
<li><script src="//gist.github.com/4820d49d07688a4d5e08.js"></script>
</li>
</ol>
<h3 id="Level-12-robotNav"><a href="#Level-12-robotNav" class="headerlink" title="Level 12: robotNav"></a>Level 12: robotNav</h3><p>Well this time, it goes a little complicate.</p>
<ol>
<li>“Hit and turn” won’t work here.</li>
<li>Path seeking algorithm is way too complicate for this puzzle.</li>
<li>Robot should be able to be “programmed”.</li>
<li>An instruction system should be enough for the puzzle.</li>
<li>Preset the instruction to the robot, and ask robot to execute it step by step.</li>
<li><script src="//gist.github.com/ed9e09f7f630b745dc02.js"></script>
</li>
</ol>
<h3 id="Level-13-robotMaze"><a href="#Level-13-robotMaze" class="headerlink" title="Level 13: robotMaze"></a>Level 13: robotMaze</h3><p>Well, Well, Well, it upgraded again. More intelligence is needed.</p>
<ol>
<li>Maze is randomly generated, so fixed instruction sequence won’t work any longer.</li>
<li>Again, Path seeking algorithm is way too complicate for this puzzle.</li>
<li>Don’t waste your intelligence.</li>
<li>A lot of robot can be “controlled” remotely.</li>
<li>Try to teach the robot how to move by your character’s movement.</li>
<li><script src="//gist.github.com/76a8c8dd62310ccb1cd3.js"></script></li>
<li>The robot move down when you’re in last row; the robot move up when you’re in the last 3rd row; the robot try to move to your col when you’re in the last 2nd row.</li>
<li>Move into last 2nd row, and the move to most left. Move left and right to control robot move horizontally. Move to last 3rd row or last row when you need to tell robot move up and down.</li>
<li>Stay in last row and last 3rd row, and press ‘r’ will move robot up and down continuously.</li>
</ol>
<h3 id="Level-14-crispsContest"><a href="#Level-14-crispsContest" class="headerlink" title="Level 14: crispsContest"></a>Level 14: crispsContest</h3><p>Again another maze!</p>
<ol>
<li>The maze is unsolvable, don’t try to solve it.</li>
<li>Divide the maze into 5 regions, top left 2 rooms, top right 2 rooms, left 1 room, right 1 room, and bottom 2 rooms.</li>
<li>You can hold only one key for each color, or the key will be wasted</li>
<li>Because of restriction(hint.3), left and right regions are meaningless.</li>
<li>Region top left, top right, and bottom, enter and exists direction doesn’t matter.</li>
<li>Check carefully, a string in the code isn’t locked.</li>
<li>The item will be taken away is editable when you pass <code>greenLock</code>.</li>
<li>Computer and phone are important items for your further plan.</li>
<li><code>null</code> or undeclared value causes exception.</li>
<li>Exception will break the code execution, which blocks you from passing the door.</li>
<li>Try to find something exists, but you don’t have yet.</li>
<li><code>The Algorithm</code> ?</li>
<li><script src="//gist.github.com/0581159360391ecd6386.js"></script>
</li>
</ol>
<h3 id="Level-15-exceptionalCrossing"><a href="#Level-15-exceptionalCrossing" class="headerlink" title="Level 15: exceptionalCrossing"></a>Level 15: exceptionalCrossing</h3><p>Really a cruel design… Pick how to die? Tricky but interesting!</p>
<ol>
<li>The only thing you can change it the value passed to <code>player.killBy()</code>.</li>
<li>Try to remember what you encounter in last level.</li>
<li>Get some hint from the name of this level.</li>
<li>Exception breaks code execution.</li>
<li><code>null</code> is a valid value.</li>
<li>Undeclared value causes exception.</li>
<li><script src="//gist.github.com/274c06bf1ce471e98972.js"></script>
</li>
</ol>
<h3 id="Level-16-lasers"><a href="#Level-16-lasers" class="headerlink" title="Level 16: lasers"></a>Level 16: lasers</h3><p>Lazer kills different races.</p>
<p><strong>NOTICE</strong> You might got killed by lazer when you haven’t actually touched it. The reason is that the line isn’t 100% align with the coord is given. And I think it is a <strong>BUG</strong> than designed by purpose.</p>
<ol>
<li>Lazer representation and collision detection are separated.</li>
<li>Remove the drawing logic won’t solve the issue.</li>
<li>Lazer only kills the object with different color than itself.</li>
<li>Color the lines with the lazer color.</li>
<li>Use the phone to update your color.</li>
<li><script src="//gist.github.com/8742a1d05da744f52fa1.js"></script>
</li>
</ol>
<h3 id="Level-17-pointers"><a href="#Level-17-pointers" class="headerlink" title="Level 17: pointers"></a>Level 17: pointers</h3><p>This must be the most problematic level in the game!!!!<br>Since fortune is more important than wisdom in this level!<br>If you’re lucky enough, you might able to clear the level by entering a randomly picked portal.<br>Actually when I play this level for 1st time, I passed without dohing any code work.</p>
<ol>
<li>Well, you can do nothing to the layout, and teleporter links.</li>
<li>A path seeking algorithm won’t be helpful for this puzzle.</li>
<li>Not all the layout is solvable. That’s why you need some fortune!</li>
<li>You’ll be killed immediately if the teleporter is linked to a trap.</li>
<li>Try to figure out all the safe links, whose 2 end-points are teleporters.</li>
<li>Try to visualize the the safe links.</li>
<li>Check API document for new available APIs.</li>
<li>Use <code>map.getCanvasCoords</code> to figure out the plot coords for teleporters.</li>
<li>Draw lines between safe teleporters.</li>
<li>Line drawing code can be found in previous level.</li>
<li><script src="//gist.github.com/d5a34b58f979991195c0.js"></script></li>
<li>Restart the level, if the level is obviously not solvable.</li>
<li>The puzzle is unsolvable, if there is no link to the room where exit locates</li>
<li>The puzzle is unsolvable, if there is no link to the room player is placed.</li>
<li>Luck is the key!</li>
</ol>
<h3 id="Level-18-superDrEvalBros"><a href="#Level-18-superDrEvalBros" class="headerlink" title="Level 18: superDrEvalBros"></a>Level 18: superDrEvalBros</h3><p>Great honor to <code>Super Bro.Mario</code> 🏆</p>
<ol>
<li><code>Jump</code> is kind of misleading word.</li>
<li>“Bridge” should be a better solution.</li>
<li>To material builds the bridge is not necessarily to be “block”.</li>
<li>Create your material.</li>
<li><script src="//gist.github.com/510eb8288e8df8cd6d53.js"></script>
</li>
</ol>
<p><strong>HINT</strong> If you really like to jump:</p>
<ol>
<li><code>Jump</code> is possible, but not a really good solution, since it introduces <code>races</code> between 2 timers.</li>
<li><script src="//gist.github.com/c2eb267825c105774482.js"></script>
</li>
</ol>
<h3 id="Level-19-documentObjectMadness"><a href="#Level-19-documentObjectMadness" class="headerlink" title="Level 19: documentObjectMadness"></a>Level 19: documentObjectMadness</h3><p>jQuery!!!!</p>
<ol>
<li>Code isn’t editable at all in this level.</li>
<li>Use the <code>arrow keys</code> to navigate the green block.</li>
<li>You need to use green block to cover the red block.</li>
<li>If you familiar with <code>EverNote Web Clipper</code>, then it should be very easy for you.</li>
<li>Press <code>up</code> for 4 times, then <code>right</code> 2 times, and adjust your green block to cover <code>red</code></li>
</ol>
<h3 id="Level-20-bossFight"><a href="#Level-20-bossFight" class="headerlink" title="Level 20: bossFight"></a>Level 20: bossFight</h3><p>Finally, fight against the BOSS!</p>
<ol>
<li>To clear the level, you need to kill all the bosses to get the Algorithm first.</li>
<li>Timer is not available.</li>
<li>So before you can do anything, you need the phone to trigger something.</li>
<li>Only 1 block is available</li>
<li>You can place the only block in the middle of the gap to shelter the bullet for you. With its help, it isn’t that hard to get the phone without being shot.</li>
<li>Or You might create a new tile to shelter the bullets for you, the number of new material blocks are not limited.</li>
<li>To kill the <code>Boss</code>, you need create your own bullet!</li>
<li>If you create your own shelter material, you can make it <code>passable for</code> your bullet.</li>
<li>Who said the bullet must be shot from your position?</li>
<li>Who said the bullet must fly from bottom to top?</li>
<li>Who said you can only shot one bullet per key press?</li>
<li><script src="//gist.github.com/32f51daac7d17b9e233f.js"></script>
</li>
</ol>
<h3 id="Level-21-endOfTheLine"><a href="#Level-21-endOfTheLine" class="headerlink" title="Level 21: endOfTheLine"></a>Level 21: endOfTheLine</h3><p>It is <code>the End</code>?</p>
<ol>
<li>This isn’t really the last level!</li>
<li>The key is <code>map.finalLevel = true;</code>.</li>
<li>Press <code>Ctrl+0</code> to check what is inside.</li>
<li>What is in <code>scripts/</code> folder?</li>
<li>Why some blocks are purple, some others are black?</li>
<li>Check <code>objects.js</code>, find <code>exit</code> object definition.</li>
<li>Comment out <code>if (!game.map.finalLevel) {</code> and <code>}</code></li>
<li>Go to next level!</li>
</ol>
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script>
$(function(){var $root = $('.article-entry');
  $root.find('ol li').css('display', 'none');
  $root.find('ol').each(function(){var $ol = $(this);
    $('<li><a href="#">Hint me</a></li>').click(function(e){e.preventDefault();
      $ol.find('li:hidden:first').css('display', 'list-item')
      if($ol.find('li:hidden').length === 0) {$(this).remove();}
    }).appendTo($ol);
  });
});
</script>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/" data-id="ciqg4g85i00996nsit418kko3" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming-game/">Programming Game</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/untrusted/">Untrusted</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/walkthrough/">Walkthrough</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-awesome-geek-game-untrusted-the-continuing-adventures-of-dr-eval" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/11/05/awesome-geek-game-untrusted-the-continuing-adventures-of-dr-eval/" class="article-date">
  <time datetime="2014-11-05T14:21:40.000Z" itemprop="datePublished">2014-11-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/game/">Game</a>►<a class="article-category-link" href="/categories/game/programming-game/">Programming Game</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #01A;"  >
      <a href="http://timnew.me/categories/game/">Game</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/11/05/awesome-geek-game-untrusted-the-continuing-adventures-of-dr-eval/">Awesome geek game Untrusted - the Continuing Adventures of Dr. Eval</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://alexnisnevich.github.io/untrusted/" target="_blank" rel="external">Untrusted</a> is an awesome game brought to us by <a href="http://alex.nisnevich.com/portfolio/" target="_blank" rel="external">Alex Nisnevich</a> and <a href="http://github.everydayimshuflin.com/" target="_blank" rel="external">Greg Shuflin</a>. <code>Untrusted</code> is an unique puzzle game designed for geeks and developers. The reason I said it is designed for geeks and developer is because to solve the puzzles in the game, you need to know or even to write some <code>javascript</code>.</p>
<p>Here is how the creators describe their baby:</p>
<blockquote><p>Untrusted —or— the Continuing Adventures of Dr. Eval is an exciting Meta-Javascript Adventure Game wherein you guide the dashing, steadfast Dr. Eval through a mysterious MACHINE CONTINUUM, wherein, using only his trusty computer and the TURING-COMPLETE power of Javascript, he must literally ALTER HIS REALITY in order to find his freedom! You must literally edit and re-execute the very Javascript running the game in your browser to save Dr. Eval from this dark and confusing reality!</p>
<footer><strong>Untrusted Repo</strong><cite><a href="https://github.com/AlexNisnevich/untrusted" target="_blank" rel="external">github.com/AlexNisnevich/untrusted</a></cite></footer></blockquote>
<p>The description is a little bit hard to understand if you don’t touch the game. I’ll try to translate it a little bit:</p>
<p>In the game, to clear a level, you need to move your <code>avatar</code> to the exit. And just like other normal acarde game, you can control the your <code>avatar</code>, Dr. Eval using <code>arrow keys</code>. The intresting part of this game is that basically, you will always run into the a dead end if you just move Dr.Eval around without doing anything else. Luckily, you will be able to access the source code that creates the world and the rule in the world. To save yourself from the dead end, you need to change part the world/rule by hacking the source code.</p>
<p>The game isn’t that hard if you have some coding experience and is familiar with javascript concepts. And learn from the passed level is very important, since you might find either useful hints or even code to solve your current problem.</p>
<p><strong>NOTE</strong> Besides the puzzle and the code, the music of each level is also great! 8Bit music in different style! Really awesome!</p>
<p>Insterested? Here is the port lead to the game: <a href="http://alexnisnevich.github.io/untrusted/" target="_blank" rel="external">Untrusted</a></p>
<h2 id="Hints-and-Walkthrough"><a href="#Hints-and-Walkthrough" class="headerlink" title="Hints and Walkthrough"></a>Hints and Walkthrough</h2><p><del>I attached my hints and solutions below, is case if you run into trouble.</del></p>
<p>I have extract the walkthrough into another post.</p>
<p>Here is the link to the walkthrough: <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/11/05/awesome-geek-game-untrusted-the-continuing-adventures-of-dr-eval/" data-id="ciqg4g85f00916nsifv3k0356" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/11/05/awesome-geek-game-untrusted-the-continuing-adventures-of-dr-eval/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/introduction/">Introduction</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming-game/">Programming Game</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/untrusted/">Untrusted</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-perform-clicks-in-android-robolectric-unit-test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/" class="article-date">
  <time datetime="2014-10-27T08:17:13.000Z" itemprop="datePublished">2014-10-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/">Perform Clicks in Android Robolectric Unit Test</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Robolectric is an awesome library that makes UI unit test on Android a lot easier and faster. In UI test, one of the most basic thing is to simulate user interaction, such as clicking a button.</p>
<h2 id="Click-on-individual-View"><a href="#Click-on-individual-View" class="headerlink" title="Click on individual View"></a>Click on individual View</h2><p><code>Click</code> should be the most basic user interaction, besides invokeing the <code>View.performClick()</code> method, Robolectric provides a more smarter version <code>Robolectric.clickOn(View)</code>, which checks the view visibility and <code>enabled</code> status before actually “click” the view. If a view is either not visible or disabled, the click action will not be performed. This mechanism is useful to avoid some silly cases in automated tests.</p>
<h2 id="Long-Click-on-individual-View"><a href="#Long-Click-on-individual-View" class="headerlink" title="Long Click on individual View"></a>Long Click on individual View</h2><p><code>Long click</code> is a more advanced <code>click</code> action. To simulate a long click action, <code>View.performLongClick()</code> can be invoked. But since Robolectric doesn’t provide any long click helper, make sure you do it by yourself, including checking whether view is <code>long-clickable</code>, which usually will be set manually or more often, when <code>View.setOnLongClickListener</code> is invoked; view is visible and enabled as what <code>click</code> does. Although <code>Long click</code> is avaible to use, but from my experience, long click on a individual view is rarely used in real UI design, instead <code>long click</code> is usually performed on an item of list view or grid view. This is the trickest case that I’ll leave it to the last.</p>
<h2 id="Click-on-item-of-List-Grid"><a href="#Click-on-item-of-List-Grid" class="headerlink" title="Click on item of List/Grid"></a>Click on item of List/Grid</h2><p><code>Click</code> on List View or Grid View item. Well, idally, this shouldn’t be so much different than click on a indiviual view. But in Android implementation, item click is handled by the list view with a much more complicated API. To perform an <code>item click</code>, <code>boolean performItemClick(View v, int position, long id)</code> can be invoked. <code>performItemClick</code> requires 3 parameters, the first one is the view being clicked, the second one is the position of clicked view’s corresponding data item in adapter and the last is the if of clicked view’s corresponding data item. Complicated, isn’t it?</p>
<p>In Android implementation, item view displayed in ListView/GridView is actually provided by its adapter. Adapter works like a presenter in MVP pattern that creates/update item view based on the item data it holds. It also provides the id for the item. So to perform a item click, besides the ListView/GridView, you also need its adapter.</p>
<p>Following implementation explains how it works:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">    ListAdapter adapter = listView.getAdapter();</div><div class="line">    View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line">    listView.performItemClick(itemView, position, adapter.getItemId(position));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In the code, <code>AbsListView</code> is the base class of <code>ListView</code> and <code>GridView</code>. To click the item, you need</p>
<ol>
<li>Get the adapter of the <code>AbsListView</code></li>
<li>Create an <code>item view</code> for specific <code>position</code> with adapter</li>
<li>Calculate the <code>item id</code> of corresponding <code>position</code></li>
<li>Invoke <code>performItemClick</code> method with data we got before.</li>
</ol>
<p>In the implementation, for simplicity reason, we ignored some cases, such as convertView reusing. From my experience, in most cases, it won’t impact the functionality, so we don’t need to worry about it, unless you clearly know that matters, then you need to cover them in your tests.</p>
<h2 id="Long-click-and-item-of-List-Grid"><a href="#Long-click-and-item-of-List-Grid" class="headerlink" title="Long click and item of List/Grid"></a>Long click and item of List/Grid</h2><p>Well, this action is also not a commonly used. It is only used in limited cases, such as selecting multiple item or displaying context menu for specific item.<br>To perform a long click on the item is the most trickest case. In previous 3 cases, we either directly or indrectly depends on <code>View.perform***Click</code> method. But not sure why, android doesn’t provide similar public API method of <code>item long click</code>. By diving into Anrdoid source code, we can figure out that Item Long Click isn’t really handled by ListView itself, instead it is handled by a <code>Runnable</code> named <code>CheckForKeyLongPress</code>. To invoke method on this object isn’t that streight forward, and might involes unnecessary multithread issue.</p>
<p>I just want to click a item, why I have to deal with these unnecessary complicates? So I learnt from the <code>CheckForKeyLongPress</code> implementation, and implmented my own “API”:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">longClickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!listView.isLongClickable())</div><div class="line">        <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    OnItemLongClickListener listener = listView.getOnItemLongClickListener();</div><div class="line">    <span class="keyword">if</span> (listener == <span class="keyword">null</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line"></div><div class="line">    ListAdapter adapter = listView.getAdapter();</div><div class="line">    View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line"></div><div class="line">    listener.onItemLongClick(listView, itemView, position, adapter.getItemId(position));</div><div class="line">    listView.performHapticFeedback(LONG_PRESS);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>My main purpose of perform a click is to trigger the corresponding listener, so I tried to invoke the listener directly with some necessary pre-checks. This aporach will not triggers these UI effects, but I assume it can meet most test cases.</p>
<h2 id="APPENDIX-UIActions-helper-class"><a href="#APPENDIX-UIActions-helper-class" class="headerlink" title="APPENDIX UIActions helper class"></a>APPENDIX UIActions helper class</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> me.timnew.robolectric.utils;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.app.Fragment;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.AbsListView;</div><div class="line"><span class="keyword">import</span> android.widget.ListAdapter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.robolectric.Robolectric;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.view.HapticFeedbackConstants.LONG_PRESS;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> android.widget.AdapterView.OnItemLongClickListener;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UiActions</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(Activity activity, <span class="keyword">int</span> targetViewId)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(activity.findViewById(targetViewId));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(View parentView, <span class="keyword">int</span> targetViewId)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(parentView.findViewById(targetViewId));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">clickOn</span><span class="params">(Fragment fragment, <span class="keyword">int</span> targetViewId)</span> </span>&#123;</div><div class="line">        <span class="comment">//noinspection ConstantConditions</span></div><div class="line">        <span class="keyword">return</span> Robolectric.clickOn(fragment.getView().findViewById(targetViewId));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">pressBackButton</span><span class="params">(Activity currentActivity)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (currentActivity.getFragmentManager().getBackStackEntryCount() &gt; <span class="number">0</span>)</div><div class="line">            currentActivity.getFragmentManager().popBackStackImmediate();</div><div class="line">        <span class="keyword">else</span></div><div class="line">            currentActivity.onBackPressed();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        ListAdapter adapter = listView.getAdapter();</div><div class="line">        View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line">        listView.performItemClick(itemView, position, adapter.getItemId(position));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">longClickItem</span><span class="params">(AbsListView listView, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!listView.isLongClickable())</div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        OnItemLongClickListener listener = listView.getOnItemLongClickListener();</div><div class="line">        <span class="keyword">if</span> (listener == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        ListAdapter adapter = listView.getAdapter();</div><div class="line">        View itemView = adapter.getView(position, <span class="keyword">null</span>, listView);</div><div class="line"></div><div class="line">        listener.onItemLongClick(listView, itemView, position, adapter.getItemId(position));</div><div class="line">        listView.performHapticFeedback(LONG_PRESS);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/" data-id="ciqg4g85g00956nsiabtqave2" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/10/27/perform-clicks-in-android-robolectric-unit-test/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/click/">click</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/item/">item</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/list-view/">list view</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/long-click/">long click</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/robolectric/">robolectric</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ui-action/">ui action</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unit-test/">unit test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2-modules-android-project-with-robolectric-gradle-android-studio" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/" class="article-date">
  <time datetime="2014-09-30T05:00:58.000Z" itemprop="datePublished">2014-09-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/">2 Modules Android project with Robolectric, Gradle, Android Studio</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Start a new Android project this week, so I started to setup the development environment. To be honest, it is not an easy experience to me.</p>
<h2 id="Features"><a href="#Features" class="headerlink" title="Features"></a>Features</h2><p>Here are the features I got now:</p>
<ul>
<li>Unit test with Robolectric. (Very fundamental requirement)</li>
<li>Unit tests are separated into an independent module. (Provide flexibility when project growing larger. And provide a more clear view of code organization)</li>
<li>Running unit tests recognized by Android Studio/IntelliJ unit test plugin and debug UTs in IDE. (This is very important when diagnose failure UT)</li>
<li>Running unit tests via CLI with <code>gradle wrapper</code>. (This is necessary requirement for CI servers)</li>
<li>Using resources in Robolectric test. (Avoid <code>Resource Not Found</code> exception in unit tests)</li>
<li>Test Android Annotation powered async implementation. (AA introduces new Async implementation, which is not supported by Robolectric by default)</li>
<li>AssertJ core support. (Fest has been deprecated since no one is maintain it now.)</li>
</ul>
<h2 id="Versions"><a href="#Versions" class="headerlink" title="Versions"></a>Versions</h2><p>The major difficulties that I met are version compatibility, I almost tried all available version combinations to make them all works. Here are the versions that I uses</p>
<ul>
<li>Gradle: 2.1</li>
<li>Groovy: 2.3.6</li>
<li>Ant: 1.9.3</li>
<li>JVM: 1.6.0_65 (Apple Inc. 20.65-b04-462)</li>
<li>OS: Mac OS X 10.9.5 x86_64</li>
<li>Android Studio: 0.8.11 (build AI-135.1446794)</li>
<li>IntelliJ: IDEA 14 CE EAP, build IC-138.2458.8</li>
<li>Android gradle plugin: com.android.tools.build:gradle:0.13.0</li>
<li>Android ADT gradle plugin: com.neenbedankt.gradle.plugins:android-apt:1.4+</li>
<li>Compile SDK version: 20</li>
<li>Build tool version: 20.0.0</li>
<li>Robolectric: 2.3</li>
</ul>
<h1 id="Known-Issues"><a href="#Known-Issues" class="headerlink" title="Known Issues"></a>Known Issues</h1><p>My current solution isn’t perfect. But for now, I haven’t working solution for them. Hope it could be fixed in the future</p>
<ul>
<li><code>AAR</code> is not supported in Unit Test. (A tricky issue, I’ll explain more in detail later)</li>
<li><a href="https://github.com/square/assertj-android" target="_blank" rel="external">AssertJ-Android</a> is not supported. (Cause by AAR support issue, alternative available.)</li>
</ul>
<h2 id="Project-Structure-and-configurations"><a href="#Project-Structure-and-configurations" class="headerlink" title="Project Structure and configurations"></a>Project Structure and configurations</h2><p>Here are the project structure:<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">RootProject</div><div class="line"><span class="string">|- settings.gradle</span></div><div class="line"><span class="string">|- build.gradle</span></div><div class="line"><span class="string">|- Launcher</span></div><div class="line">   \- builde.gradle</div><div class="line">\- UnitTest</div><div class="line">   <span class="string">|- build.gradle</span></div><div class="line">   \- UnitTest.iml</div></pre></td></tr></table></figure></p>
<p>Here are the contents</p>
<figure class="highlight gradle"><figcaption><span>\Settings.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">include</span> <span class="string">':Launcher'</span>, <span class="string">':UnitTest'</span></div></pre></td></tr></table></figure>
<figure class="highlight gradle"><figcaption><span>\build.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:0.13.0'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">allprojects</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenLocal()</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight gradle"><figcaption><span>\Launcher\build.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:0.13.0'</span></div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.4+'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">repositories</span> &#123;</div><div class="line">    mavenLocal()</div><div class="line">    mavenCentral()</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line">apply plugin: <span class="string">'android-apt'</span></div><div class="line"></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">20</span></div><div class="line">    buildToolsVersion <span class="string">'20.0.0'</span></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion <span class="number">9</span></div><div class="line">        targetSdkVersion <span class="number">19</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        debug &#123;</div><div class="line">            runProguard <span class="keyword">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.txt'</span></div><div class="line">        &#125;</div><div class="line">        release &#123;</div><div class="line">            runProguard <span class="keyword">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.txt'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">apt &#123;</div><div class="line">    arguments &#123;</div><div class="line">        androidManifestFile variant.processResources.manifestFile</div><div class="line">        resourcePackageName <span class="string">'me.timnew.game.launcher'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> AAVersion = <span class="string">'3.1'</span></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    apt <span class="string">"org.androidannotations:androidannotations:$AAVersion"</span>         <span class="comment">// Process AA annotations</span></div><div class="line">    <span class="comment">/*</span></div><div class="line">    * Android Studio will remove this line if you try to edit project configuration with GUI.</div><div class="line">    * It seems it is a bug of Android Studio since it does not understand DSL `apt`</div><div class="line">    */</div><div class="line">    <span class="keyword">compile</span> <span class="string">"org.androidannotations:androidannotations-api:$AAVersion"</span> <span class="comment">// AA Runtime API. Becareful</span></div><div class="line"></div><div class="line">    <span class="keyword">compile</span> <span class="string">'de.greenrobot:eventbus:2.2.1'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'org.easytesting:fest-reflect:1.4.1'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.google.guava:guava:18.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.koushikdutta.ion:ion:1.3.8'</span></div><div class="line"></div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>, <span class="string">'*.aar'</span>]) <span class="comment">// Well although I mentioned aar here, but it doesn't load correctly.</span></div><div class="line"></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:support-v4:20.0.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:support-annotations:20.0.0'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:20.0.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight gradle"><figcaption><span>\UnitTest\build.gradle</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">buildscript</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">dependencies</span> &#123;</div><div class="line">        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:0.13.0'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">apply plugin: <span class="string">'java'</span></div><div class="line"></div><div class="line"><span class="keyword">repositories</span> &#123;</div><div class="line">    mavenLocal()</div><div class="line">    maven &#123; url <span class="string">"$System.env.ANDROID_HOME/extras/android/m2repository"</span> &#125; <span class="comment">// Fix 'com.android.support:*' package not found issue</span></div><div class="line">    mavenCentral()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">def</span> appModule = <span class="keyword">project</span>(<span class="string">':Launcher'</span>)</div><div class="line">    <span class="keyword">compile</span> appModule</div><div class="line"></div><div class="line">    testCompile appModule.android.applicationVariants.<span class="keyword">toList</span>().first().javaCompile.<span class="keyword">classpath</span>       <span class="comment">// Include classes from main project</span></div><div class="line">    testCompile appModule.android.applicationVariants.<span class="keyword">toList</span>().first().javaCompile.outputs.files</div><div class="line">    testCompile files(appModule.plugins.findPlugin(<span class="string">"com.android.application"</span>).getBootClasspath())</div><div class="line"></div><div class="line">    testCompile(<span class="string">'junit:junit:4.+'</span>) &#123;</div><div class="line">        <span class="keyword">exclude</span> module: <span class="string">'hamcrest-core'</span>                                                            <span class="comment">// Exclude problematic 'hamcrest'</span></div><div class="line">    &#125;</div><div class="line">    testCompile <span class="string">'org.robolectric:robolectric:2.3'</span></div><div class="line">    testCompile <span class="string">'org.mockito:mockito-core:1.9.5'</span></div><div class="line">    testCompile <span class="string">'org.assertj:assertj-core:1.6.1'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">tasks.withType(Test) &#123;</div><div class="line">    scanForTestClasses = <span class="keyword">false</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"**/*Should.class"</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"**/*Test.class"</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"**/*Tests.class"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Why-uses-java-plug-in-instead-of-android-unit-test-plug-ins"><a href="#Why-uses-java-plug-in-instead-of-android-unit-test-plug-ins" class="headerlink" title="Why uses java plug-in instead of android unit test plug-ins"></a>Why uses <code>java</code> plug-in instead of <code>android unit test</code> plug-ins</h2><p>Well, Gradle DSL provides a lot of flexibility to developer. But it also brought a lot complexity to IDE implementation. To figure out project configuration, IDE need to parse and understand the gradle scripts. Not only DSLs provided by gradle but all stuff come with plug-ins. From IDE, this is almost an impossible mission. So IDE need to figure out a way to simplify the process, such as support a subset of DSL.</p>
<p>For Android project, IntelliJ has difficulties to understand the all variations of <code>android unit test</code> plug-ins. So it is not easy to make unit test runnable from IDE. To solve the issue, you either try to teach IDE about the DSL by providing plug-in to IDE, or uses some languages that IDE understood.</p>
<p>I tried some plug-in available today, but none of them works for me. So I decide to use <code>java</code> DSL, which IntelliJ understood natively. As a trade off, since <code>java</code> gradle plugin doesn’t understand <code>Android Library</code>, so it cannot import <code>.aar</code> libries.</p>
<p>Besides I tried all <code>android unit test</code> gradle plugins, I found all of them depends on <code>android</code> gradle plugin. And <code>android</code> plugin depends on <code>AndroidManifest.xml</code> and some other stuff. It is wield to provide an manifest for your unit test.</p>
<p>So as the final solution, I uses <code>java</code> plug-in, avoid using <code>aar</code> in the test.</p>
<h2 id="Why-so-complicate"><a href="#Why-so-complicate" class="headerlink" title="Why so complicate"></a>Why so complicate</h2><p>Configurate an working Android project isn’t as easy as it sounds. Differ from iOS community, Google isn’t strong-minded as Apple. As a consequence that Android community is fragmented and lack of unified solution. There are tons of solutions available, but you might need to try them one by one to figure out which fits your requirement.</p>
<p>To make your tool chain, dependencies, IDE work together, compatibility is always your enemy. Even Google has to publish <a href="http://tools.android.com/tech-docs/new-build-system/version-compatibility" target="_blank" rel="external">Version Compatibility Table</a> to mitigate the pain.</p>
<p>What a mess!!!!!</p>
<h2 id="References-posts-plugins-or-template-projects"><a href="#References-posts-plugins-or-template-projects" class="headerlink" title="References posts, plugins or template projects"></a>References posts, plugins or template projects</h2><p>Here is a list of things that I tried but failed to fit my requirement. List here since it might be helpful to other people.</p>
<ul>
<li><a href="http://blog.blundell-apps.com/android-gradle-app-with-robolectric-junit-tests/" target="_blank" rel="external">Android Gradle App with Robolectric JUnit tests</a></li>
<li><a href="https://github.com/blundell/tests-app-robolectric-junit" target="_blank" rel="external">tests-app-robolectric-junit</a> template project</li>
<li><a href="https://github.com/robolectric/deckard-gradle" target="_blank" rel="external">deckard-gradle</a> template project</li>
<li><a href="https://github.com/JCAndKSolutions/android-unit-test" target="_blank" rel="external">android-unit-test</a> gradle plug in</li>
<li><a href="https://github.com/evant/android-studio-unit-test-plugin" target="_blank" rel="external">android-studio-unit-test-plugin</a> android studio/intellij plugin</li>
<li><a href="https://github.com/robolectric/robolectric-gradle-plugin" target="_blank" rel="external">robolectric-gradle-plugin</a></li>
<li><a href="https://github.com/novoda/robolectric-plugin" target="_blank" rel="external">robolectric-plugin</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/" data-id="ciqg4g85e008y6nsitwyyp3zz" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/09/30/2-modules-android-project-with-robolectric-gradle-android-studio/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-studio/">Android Studio</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/boilerplate/">Boilerplate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gradle/">Gradle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/project/">Project</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/robolectric/">Robolectric</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/structure/">Structure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unit-test/">Unit Test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-trello-confetti-effect" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/09/24/trello-confetti-effect/" class="article-date">
  <time datetime="2014-09-24T05:13:33.000Z" itemprop="datePublished">2014-09-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/09/24/trello-confetti-effect/">Trello Confetti Effect</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://trello.com" target="_blank" rel="external">Trello</a> just created a <a href="https://trello.com/5m" target="_blank" rel="external">page</a> to celebrate their user number reaches 5 million. In their celebration page, they introduce an interesting effect, a number of blue squares rotating and falling from the sky.</p>
<p>By inspecting their source code, I extracted the effect implementation from the page.</p>
<iframe id="cp_embed_tlEBe" src="//codepen.io/timnew/embed/tlEBe?height=500&theme-id=7928&slug-hash=tlEBe&default-tab=result" scrolling="no" frameborder="no" height="500" allowtransparency="true" allowfullscreen="true" class="cp_embed_iframe" style="width: 100%; overflow: hidden;"></iframe>
<p>As you can see, the effect is implemented with Canvas animation. Trello guys created a light weight particle system.</p>
<ul>
<li><code>ConfettiMachine</code> is the particle system controller, which takes the responsibility to create new particles and call <code>draw</code> method on them one by one.</li>
<li><code>Particle</code> is the representation of the blue square, it takes the rotation, fading out and rendering.</li>
</ul>
<p>The source code is extracted for study purpose, all code and credits belongs to Trello guys.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/09/24/trello-confetti-effect/" data-id="ciqg4g859008q6nsi91bfn3t8" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/09/24/trello-confetti-effect/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/animation/">animation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/confetti/">confetti</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/draw/">draw</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/effect/">effect</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/particle/">particle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trello/">trello</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-otto-and-android-annotations-compatibility-issue-analysis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/" class="article-date">
  <time datetime="2014-09-14T08:14:22.000Z" itemprop="datePublished">2014-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/">Otto and Android Annotations Compatibility Issue Analysis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p><a href="https://github.com/square/otto" target="_blank" rel="external">Otto</a> is a great Android event bus solution developed by <a href="http://square.github.io/" target="_blank" rel="external">SquareUp</a> guys. These guys extract the event bus related classes from <a href="https://code.google.com/p/guava-libraries/" target="_blank" rel="external">Google’s Guava</a>, and optimized it for Android. Event Bus is a great solution to keep your code away from messy anonymous or internal classes only used for event handling! And Otto’s simplicity and performance makes it used to be the most popular event bus solution in Android development.</p>
<p><a href="http://androidannotations.org/" target="_blank" rel="external">Android Annotations</a>, as known as <code>AA</code>, is another great library that makes Android developers’ lives a lot easier. Just annotating the code, AA helps developer handles the most boring or error-proning tasks for you, including binding widgets binding, asynchronous tasks, life time management, etc…</p>
<h2 id="Issue"><a href="#Issue" class="headerlink" title="Issue"></a>Issue</h2><p>Otto and AA are the libraries focusing on different aspects. Theoretically speaking, there shouldn’t be any compatibility issue between them. But the reality Otto event is never delivered to AA annotated classes. By inspecting the code with step by step debugging, I found the root cause of the issue is Otto failed to located <code>@Produce</code> and <code>@Subscribe</code> annotated methods in AA generated code.</p>
<h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>After a few study work, I finally understood what is the reason behind:</p>
<p>For performance consideration, Android Annotations actually does it work during the compilation time instead of Runtime. AA will derive the annotated classes, and generate some code according to the annotations applied. During the runtime, the classes got instantiated is actually the derived classes instead of the original one, although in the code is accessed via the original class as interface.</p>
<p>Here is a simple example:</p>
<p>I have the class <code>ServerListAdapter</code>, which is used to provide data for a grid view.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EBean</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerListAdapter</span> <span class="keyword">extends</span> <span class="title">AdvBaseAdapter</span>&lt;<span class="title">InetAddress</span>, <span class="title">ServerView</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RootContext</span></div><div class="line">    <span class="keyword">protected</span> Context context;</div><div class="line"></div><div class="line">    <span class="meta">@SystemService</span></div><div class="line">    <span class="keyword">protected</span> LayoutInflater inflater;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="keyword">protected</span> Bus bus;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerListAdapter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="keyword">new</span> ArrayList&lt;InetAddress&gt;());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@AfterInject</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterInject</span><span class="params">()</span> </span>&#123;</div><div class="line">        bus.register(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> ServerView <span class="title">createView</span><span class="params">(ViewGroup parent)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> ServerView_.build(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> ServerView <span class="title">updateView</span><span class="params">(ServerView itemView, InetAddress item)</span> </span>&#123;</div><div class="line">        itemView.update(item);</div><div class="line">        <span class="keyword">return</span> itemView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Subscribe</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fetchServerStatus</span><span class="params">(DiscoveryStatusEvent event)</span> </span>&#123;</div><div class="line">        setItems(event.addresses);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Subscribe</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServerStatusUpdated</span><span class="params">(DiscoveryStatusChangedEvent event)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (event.type) &#123;</div><div class="line">            <span class="keyword">case</span> SERVER_ONLINE:</div><div class="line">                getItems().add(event.address);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> SERVER_OFFLINE:</div><div class="line">                getItems().remove(event.address);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And this is the derived class generated by <code>AA</code> during the compiling-time:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerListAdapter_</span></span></div><div class="line">    <span class="keyword">extends</span> <span class="title">ServerListAdapter</span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Context context_;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ServerListAdapter_</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        context_ = context;</div><div class="line">        init_();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ServerListAdapter_ <span class="title">getInstance_</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerListAdapter_(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init_</span><span class="params">()</span> </span>&#123;</div><div class="line">        inflater = ((LayoutInflater) context_.getSystemService(Context.LAYOUT_INFLATER_SERVICE));</div><div class="line">        context = context_;</div><div class="line">        bus = Bus_.getInstance_(context_);</div><div class="line">        afterInject();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rebind</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        context_ = context;</div><div class="line">        init_();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>And here is how it is consumed:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EFragment</span>(R.layout.fragment_server_list)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerListFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span> </span>&#123;</div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="keyword">protected</span> DiscoveryService discoveryService;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="keyword">protected</span> ServerListAdapter adapter;</div><div class="line"></div><div class="line">    <span class="meta">@ViewById</span>(R.id.server_list)</div><div class="line">    <span class="keyword">protected</span> GridView serverGridView;</div><div class="line"></div><div class="line">    <span class="meta">@AfterViews</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">afterViews</span><span class="params">()</span> </span>&#123;</div><div class="line">        serverGridView.setAdapter(adapter);</div><div class="line"></div><div class="line">        discoveryService.start();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDetach</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDetach();</div><div class="line">        discoveryService.stop();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>As you can see, in the <code>ServerListFragment</code>, the <code>ServerListAdapter</code> instance injected into <code>bean</code> is actually the instance of <code>ServerListAdapter_</code>. And due to polymorphic, the instance just behaves like a <code>ServerListAdapter</code> instance.</p>
<p>On the other hand, according to the description on <a href="http://square.github.io/otto/" target="_blank" rel="external">Otto’s Home Page</a>:</p>
<blockquote><p>In order to receive events, a class instance needs to register with the bus.<br>…<br>Registering will only find methods on the immediate class type. Unlike the Guava event bus, Otto will not traverse the class hierarchy and add methods from base classes or interfaces that are annotated. This is an explicit design decision to improve performance of the library as well as keep your code simple and unambiguous.</p>
<footer><strong>@Otto</strong><cite><a href="http://square.github.io/otto/" target="_blank" rel="external">Otto Homepage</a></cite></footer></blockquote>
<p>Otto only search annotations in direct class, which is <code>ServerListAdapter_</code> in instance, and there isn’t any annotation included. As a consequence, all the <code>@Subscribe</code> annotated methods are ignored by <code>com.squareup.otto.AnnotatedHandlerFinder</code>. So the posted events become <code>dead event</code> due to no subscriber found.</p>
<h2 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h2><p>There is <a href="https://github.com/square/otto/issues/61" target="_blank" rel="external">rumor</a> that this issue will be fixed in <code>Otto 2.0</code>. But according to the <a href="https://github.com/square/otto/issues/61#issuecomment-44453104" target="_blank" rel="external">comment</a> from <a href="https://github.com/JakeWharton" target="_blank" rel="external">Jake Wharton</a>, Otto’s developer, <code>Otto 2.0</code> will take forever to release.</p>
<p>In fact <a href="https://github.com/square/otto/tree/2.0-wip" target="_blank" rel="external">Otto 2.0 Repo</a> has been not touched for 2 years already. Although we could check out the code and build Otto 2.0 by ourselves, but it takes efforts. Especially when some bug is found.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Luckily, although <code>Otto</code> turns into “maintenance mode”, the compatibility issue takes forever to resolve. I found a great Otto alternative, EventBus from GreenRobot. A boring name, but great library.</p>
<p>According to <code>EventBus</code>‘s document, it provides richer feature and better performance than <code>Otto</code>.<br>The most important <code>EventBus</code> is friendly to <code>AndroidAnnoations</code>. They two works well together.</p>
<h3 id="EventBus-and-Otto-Feature-Comparison"><a href="#EventBus-and-Otto-Feature-Comparison" class="headerlink" title="EventBus and Otto Feature Comparison"></a>EventBus and Otto Feature Comparison</h3><table>
<thead>
<tr>
<th></th>
<th>EventBus</th>
<th>Otto</th>
</tr>
</thead>
<tbody>
<tr>
<td>Declare event handling methods</td>
<td>Name conventions</td>
<td>Annotations</td>
</tr>
<tr>
<td>Event inheritance</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Subscriber inheritance</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Cache most recent events</td>
<td>Yes, sticky events</td>
<td>No</td>
</tr>
<tr>
<td>Event producers (e.g. for coding cached events)</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Event delivery in posting thread</td>
<td>Yes (Default)</td>
<td>Yes</td>
</tr>
<tr>
<td>Event delivery in main thread</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Event delivery in background thread</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td>Asynchronous event delivery</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
<h3 id="EventBus-and-Otto-Performance-Comparison"><a href="#EventBus-and-Otto-Performance-Comparison" class="headerlink" title="EventBus and Otto Performance Comparison"></a>EventBus and Otto Performance Comparison</h3><table>
<thead>
<tr>
<th></th>
<th>EventBus over Otto</th>
</tr>
</thead>
<tbody>
<tr>
<td>Posting 1000 events, Android 2.3 emulator</td>
<td>~70% faster</td>
</tr>
<tr>
<td>Posting 1000 events, S3 Android 4.0</td>
<td>~110% faster</td>
</tr>
<tr>
<td>Register 1000 subscribers, Android 2.3 emulator</td>
<td>~10% faster</td>
</tr>
<tr>
<td>Register 1000 subscribers, S3 Android 4.0</td>
<td>~70% faster</td>
</tr>
<tr>
<td>Register subscribers cold start, Android 2.3 emulator</td>
<td>~350% faster</td>
</tr>
<tr>
<td>Register subscribers cold start, S3 Android 4.0</td>
<td>About the same</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/" data-id="ciqg4g85b008t6nsin81uiucz" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/09/14/otto-and-android-annotations-compatibility-issue-analysis/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-annotations/">android annotations</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event/">event</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/event-bus/">event bus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google/">google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/greenbot/">greenbot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/guava/">guava</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/otto/">otto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/programming/">programming</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pub-sub/">pub & sub</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/squareup/">squareUp</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/archives/blog/2/">2</a><a class="page-number" href="/archives/blog/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/archives/blog/12/">12</a><a class="extend next" rel="next" href="/archives/blog/2/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Recent Posts</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Tag Cloud</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Categories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>