<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/archives/blog/6/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');

  ga('require', 'displayfeatures');

ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-node-over-express-configuration" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/25/node-over-express-configuration/" class="article-date">
  <time datetime="2013-04-25T00:00:00.000Z" itemprop="datePublished">2013-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/25/node-over-express-configuration/">Node over Express - Configuration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>I have been working on Node.js related projects for quite a while, and have built apps with node both for the clients or personal projects, such as <a href="https://live-hall.herokuapp.com" target="_blank" rel="external">LiveHall</a>, <a href="https://github.com/timnew/CiMonitor" target="_blank" rel="external">CiMonitor</a>, etc. I have promised some one to share my experience on node. Today I’ll begin to work on this. This will be the first blog of the series.</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>In this blog, I would like to talk about the configuration in node, which is common problem we need to solve in apps.</p>
<p>Problems related to configuration aren’t new, and there have been a dozens of mature solutions, but for Node.js apps, there is still something worth to be discussed.</p>
<p>Perhaps configuration could be treated as a kind of special data. Usually developers prefer to use data language to describe their configurations. Here are some examples:</p>
<ul>
<li>.net and Java developer usually uses Xml to describe their configuration</li>
<li>Ruby developer prefers Yaml as the configuration language</li>
<li>JavaScript developer tend to use Json</li>
</ul>
<p>Data languages are convenient, because developers can easily build DSL on it, then they describe the configuration with the DSL. But is the data language the best option available? Is it really suitable to be used in all scnearios?</p>
<p>Before we answer the questions, I would like to say something about the problem we’re facing. There is one common requirement to all kinds of configuration solutions, which is default values and overriding.</p>
<p>For example, as a Web app default, we use port 80; but in development environment, we prefer to use a port number over 1024, 3000 is a popular choice. That means we need to provide 80 as the default value of the port, but we wish to override the value with 3000 in the development environment.</p>
<p>For the languages I mentioned above, except for Yaml, Xml and Json, doesn’t provide native support of inheritance and overriding. It means we need to implement the mechanism by our own. Take Json as example, we might write the configuration in this way:</p>
<figure class="highlight json"><figcaption><span>Sample Json configuration</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"default"</span>: &#123;</span><br><span class="line">    <span class="attr">"port"</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="attr">"serveAssets"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"development"</span>: &#123;</span><br><span class="line">    <span class="attr">"port"</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"mongodb://localhost/development"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"test"</span>: &#123;</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"mongodb://localhost/test"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"production"</span>: &#123;</span><br><span class="line">    <span class="attr">"serveAssets"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"database"</span>: <span class="string">"mongodb://ds0123456.mongolab.com:43487/my_sample_app"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The previous Json snippet is a typical example of web app configuration; it has a default section to provide the default values for all environments. Three sections for specific environments. To apply it corecctly to our app, we need to load and parse the Json file to get all data first, then load the values of the default section, then override the value with the values from specific environment.  In addition, we might wish to have the validation that yields error when the provided environment doesn’t exist.</p>
<p>This solution looks simple and seems to work, but when you try to apply this approach to your app in real life, you need to watch out some pitfalls.</p>
<h2 id="Issue-1-Confidential-Values"><a href="#Issue-1-Confidential-Values" class="headerlink" title="Issue 1: Confidential Values"></a>Issue 1: Confidential Values</h2><p>In the real world, values in configuration sometimes could be sensitive and need to be kept confidential. It could contain the credential to access your database, Or it could contain the key to decrypt the cookies. It may also contain private certificate that identifies and authenticates the app to other services. In these scenarios, you need to protect your configuration in order to avoid big trouble!</p>
<p>To solve the issue, you might think about adding new feature that enable you to to encrypt confidential values or to load it from a different safe source.  To achieve it, you might need to add another layer of DSL which add more complexities to your app and make your code harder to debug or to maintain.</p>
<h2 id="Issue-2-Dynamic-Data"><a href="#Issue-2-Dynamic-Data" class="headerlink" title="Issue 2: Dynamic Data"></a>Issue 2: Dynamic Data</h2><p>A solution to first issue,  one could store the environment related but sensitive data in the environment variables. The solution is simple and works perfectly, so I highly recommend it. However, to do this means you need the capability to load the value not only from Json directly but also from the environment variables.</p>
<p>Sometimes, such as deploying your app to Heroku/Nojitsu, might give rise that make the case trickier. After deployed the app to Heroku/Nojitsu, the default values are provided in Json directly, and some of which need to be overrode with the values from environment variables or you need to do it vice versa. These tricky requirements might blow your mind and your code away easily. It causes complicated DSL design and hundreds lines of implementation, but just to load your configuration properly. Obviously it is not a good idea.</p>
<h2 id="Issue-3-Complicated-Inheritance-Relationship"><a href="#Issue-3-Complicated-Inheritance-Relationship" class="headerlink" title="Issue 3: Complicated Inheritance Relationship"></a>Issue 3: Complicated Inheritance Relationship</h2><p>Scared about above cases? No, then how about complicated inheritance relationship between environments?</p>
<p>In some big and complicated web apps, there might be more than 3 basic environments, such as:</p>
<ul>
<li>Development: for developers to develop the app locally</li>
<li>Test: for developers to run unit or function test locally, such as mocha tests</li>
<li>Regression: for developers or QAs to run regression tests, such as cucumber tests</li>
<li>Integration: for QAs or Ops to test the integration with other apps</li>
<li>Staging: for ops and QAs to test the app in production like environment before it really goes live</li>
<li>Production: the environment serves your real users</li>
<li>…</li>
</ul>
<p>When try to write configurations for these environments, one might find there are only a few differences between environments. To make life easier,  to avoid the redundancy, introducing the inheritance between configurations might be a good idea.</p>
<p>As the consequence, the whole configuration becomes environments with complex inheritance relationship. And to support this kind of configuration inheritance,  a more complex DSL and hundreds lines of codes are needed.</p>
<h2 id="Some-Comments"><a href="#Some-Comments" class="headerlink" title="Some Comments"></a>Some Comments</h2><p>My assumption above seems to be a little too complex.  From some people, it might be the “WORST CASE SCENERIO” and hard to come by. But according to my experience, it is very common when building real web app with node. So if to solve it isn’t too hard, it could be better to consider it seriously and solve it gracefully.</p>
<p>Ruby developer might think they’re lucky because Yaml supports inheritance natively. But confidential data and dynamic data still troubles.  </p>
<h2 id="My-Solution"><a href="#My-Solution" class="headerlink" title="My Solution"></a>My Solution</h2><p>After learnt a number of painful lessons, I figured out a simple but working solution: Configuration as Code - describe the configuration with the same language that the business logic is described!</p>
<p>Configuration as code isn’t a new concept, but it is extremely handy when you use it in node applications! Let me explain why and how it works:</p>
<p>To protect the confidential configuration values, one should store them with environment variables, which are only accessible in the specific server.<br>Then one can load these values from the environment variables as dynamically values.</p>
<p>To do it in a data language such as Xml, Json or Yaml could be hard, but it will become as easy as taking a candy from a baby if it is done in the programming language that application applied/used, such as ruby or javascript.</p>
<p>To the configuration inheritance, OO languages have already provided very handy inheritance mechanism. Why do we need to invent one? Why not just use it? To the value overriding, OO programming tells us that it is called polymorphism. The only difference here from the typical scenario is that we override the values instead of the behaviors. But it isn’t an issue, because the value could be the result of the behavior, right?</p>
<p>Now I assume that everyone got a pretty good idea of what I am saying. If that is the case, then the below code should be able to be understood quite clearly,  which is a standard Node.js file written in <code>coffee script</code>:</p>
<figure class="highlight coffeescript"><figcaption><span>Configuration as Code Example</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ? <span class="string">'development'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span></span><br><span class="line">  port: <span class="number">80</span></span><br><span class="line">  cookieSecret: <span class="string">'!J@IOH$!BFBEI#KLjfelajf792fjdksi23989HKHD&amp;&amp;#^@'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">development</span> <span class="keyword">extends</span> <span class="title">Config</span></span></span><br><span class="line">  port: <span class="number">3009</span></span><br><span class="line">  redis:</span><br><span class="line">    uri: <span class="string">'redis://localhost:6379'</span></span><br><span class="line">  mongo:</span><br><span class="line">    uri: <span class="string">'mongodb://localhost'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">test</span> <span class="keyword">extends</span> <span class="title">Config</span>.<span class="title">development</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">heroku</span> <span class="keyword">extends</span> <span class="title">Config</span></span></span><br><span class="line">  cookieSecret: process.env.COOKIE_SECRET</span><br><span class="line">  redis:</span><br><span class="line">    uri: process.env.REDISCLOUD_URL</span><br><span class="line">  mongo:</span><br><span class="line">    uri: process.env.MONGOLAB_URI</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> Config[process.env.NODE_ENV]()</span><br></pre></td></tr></table></figure>
<p>See, with the approach, one can describe the configuration easily and clearly in a few lines of code, but with built-in loading dynamical values capability and configuration inheritance and overriding capability.</p>
<p>In fact, with my suggestions, it might work better than expected! Here are the additional free benefits:</p>
<ol>
<li>Only one configuration is needed when  the app deployed to the cloud. Because all the host specific configurations are usually provided via the environment variables in Paas.</li>
<li>Have some simple and straightforward logic in the configuration, which could be very useful, especially if there is some naming convention in the configuration. But complicated or tricky logic should be strictly avoided, because it is hurts the readability and maintainability.</li>
<li>Easy to write tests for configurations, to ensure the values are properly set. It could be very handy when there are complicated inheritance relationships between configurations, or have some simple logic in your configuration.</li>
<li>Avoid to instantiate and execute the code that isn’t related to the current environment, which could be helpful to avoid overhead to instantiate unused expensive resources or to avoid errors caused because of incompatibility between environments.</li>
<li>Get runtime error when the configuration for the environment doesn’t exist.</li>
</ol>
<hr>

<p>Besides of the content, I want to say thank you to my English teacher Marina Sarg, who helped me on this series of blog a lot. Without her, there won’t be this series of blogs. Marina, thank you very much.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/25/node-over-express-configuration/" data-id="cinedk738005achsisiit4gn6" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/04/25/node-over-express-configuration/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/configuration/">configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/express/">express</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-over-express/">node over express</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mac-os-x-case-insensitive-file-system-pitfall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/" class="article-date">
  <time datetime="2013-04-18T00:00:00.000Z" itemprop="datePublished">2013-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/git/">git</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/">Mac OS X case-insensitive file system pitfall</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I was working on the YouTube video playback feature for <a href="http://live-hall.herokuapp.com" target="_blank" rel="external">LiveHall</a> last night, and have it works successfully on my local devbox, which is running Mac OS X. Then I deployed the code to Heroku, without any regression.</p>
<p>But today morning, when I have the demonstrate the new features, I met server error! It says 1 of the 4 javascripts are missing, so the Jade template failed to render.</p>
<p>This is a very wield issue, then I try the same data on my local dev box once again, and it works perfect! But it does yield error on the production!   Then I tried to use heroku toolbelt to run ls command on the production, and I found the there are 4 coffee scripts there.<br>Then I tried to enforce heroku to redeploy the app by using <code>git push --force</code>, but the issue remains!<br>Then I even tried to dive into the dependency pacakges <code>connect-assets</code> and <code>snockets</code>, but still found nothing useful.</p>
<p>Same code, same data, but different result! Very odd issue!</p>
<p>After half an hour fighting against the code, I suddenly noticed I the file name is <code>RevealJSPresenter.coffee</code>, whose “S” is capital S! And I reference the file with name <code>#= require ./presenter/RevealJsPresenter</code>, whose ‘s’ is a lowercase ‘s’!</p>
<p>And <code>snockets</code> depends on the OS feature to locate the file. On my local dev environment, I’m using Mac. Although OS X allow user to explicitly format the HFS+ into file name case sensitive mode, but it is case insensitive by default. So snockets can locate the file even the case is wrong.<br>But once I have deployed to heroku, which, I assume, runs Linux, whose file system is absolutely filename case sensitive. So the snockets won’t be able to locate the file due to the case issue.</p>
<p>To resolve the bug, I renamed my file in RubyMine, then try to commit in terminal.<br>But when I commit, I met another very interesting issue, that git says there is no file changed, so it refused to commit.<br>It is still the same issue, due to FS is case insensitive, git cannot detect the renaming.  </p>
<p>This problem is more common when coding on Windows, but CI or production runs on Linux. And the very common solution is to pull the code in case sensitive environment, then rename the file and commit it.</p>
<p>But I found another more easier way to do it:</p>
<p>Using <code>git mv</code> in terminal to rename the file, which will enforce git to track the file renaming action.</p>
<p>Or</p>
<p>Most of Git GUIs are able to track file name case changing, so you can try to commit the change with the tool, such as RubyMine or SourceTree.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/" data-id="cinedk7340053chsiefre54sj" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mac/">Mac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asset/">asset</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asset-pipeline/">asset pipeline</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/case-insensitive/">case insensitive</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/connect-assets/">connect-assets</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/file-name/">file name</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/file-system/">file system</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/snockets/">snockets</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-in-matching-line-head-and-line-end-in-regexp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/" class="article-date">
  <time datetime="2013-04-10T00:00:00.000Z" itemprop="datePublished">2013-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/regular-expression/">Regular Expression</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/">Pitfall in matching line head and line end in regexp</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I usually uses <code>\^\</code> and <code>\$\</code> to verify user input, e.g:<br>I uses following regexp to verify whether a user input is valid gmail email address:</p>
<figure class="highlight css"><figcaption><span>Matching Gmail</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^<span class="selector-attr">[a-zA-Z_\.]</span>+@<span class="keyword">gmail</span>.<span class="keyword">com</span>$</span><br></pre></td></tr></table></figure>
<p>But in fact it is potentially vulnerable!<br>According to the RegExp document, <code>^</code> and <code>$</code> is matching to <strong>line head</strong> and <strong>line end</strong>!<br>So I might rush into pitfall when user try to fool me with following input:<br><figure class="highlight perl"><figcaption><span>bad input</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"hacker@gmail.com\n&amp;lt;script&amp;gt;alert('bang!')&amp;lt;/script&amp;gt;"</span></span><br></pre></td></tr></table></figure></p>
<p>Since there is a <code>\n</code> in the string, so <code>$</code> won’t really match to the end of the string but actually matched to the <code>\n</code>, then the whole string become a valid input, but actually it isn’t!</p>
<p>To avoid such issue, we should stick to <code>\A</code> and <code>\z</code>, which is literally means the <strong>the beginning of the string</strong> and <strong>end of the string</strong>!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/" data-id="cinedk731004vchsiuzkcqeqa" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/line-end/">line end</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/line-head/">line head</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regex/">regex</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regexp/">regexp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regular-expression/">regular expression</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-multiple-project-summary-reporting-standard-cctray-xml-feed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/" class="article-date">
  <time datetime="2013-04-07T00:00:00.000Z" itemprop="datePublished">2013-04-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/continues-integration/">Continues Integration</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/">Multiple Project Summary Reporting Standard - cctray xml feed</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CCTray.xml is an RSS-like CI server build status xml feed, which is originally developed for CruiseControl.net.<br>ThoughtWorks declared it in a standard called “Multiple Project Summary Reporting Standard”, which now have become some kind of unofficial standard of CI server feed that is widely supported by all kind of popular CI servers.</p>
<p>You can find the feed as described below:</p>
<ul>
<li><a href="http://www.thoughtworks-studios.com/go-continuous-delivery" target="_blank" rel="external">GO</a>  - <a href="http://servername:8154/go/cctray.xml" target="_blank" rel="external">http://servername:8154/go/cctray.xml</a></li>
<li><a href="http://cruisecontrolrb.thoughtworks.com/" target="_blank" rel="external">CruiseControl.rb</a> - <a href="http://cc.rb.servername:3333/XmlStatusReport.aspx" target="_blank" rel="external">http://cc.rb.servername:3333/XmlStatusReport.aspx</a></li>
<li><a href="http://cruisecontrol.sourceforge.net/" target="_blank" rel="external">CruiseControl</a> - <a href="http://cc.java.servername:8080/cctray.xml" target="_blank" rel="external">http://cc.java.servername:8080/cctray.xml</a></li>
<li><a href="http://ccnet.thoughtworks.com/" target="_blank" rel="external">CruiseControl.NET</a> - <a href="http://cc.net.servername/XmlStatusReport.aspx" target="_blank" rel="external">http://cc.net.servername/XmlStatusReport.aspx</a></li>
<li><a href="http://jenkins-ci.org/" target="_blank" rel="external">Jenkins</a> - <a href="http://jenkins.servername:8080/cc.xml" target="_blank" rel="external">http://jenkins.servername:8080/cc.xml</a></li>
<li><a href="https://hudson.dev.java.net/" target="_blank" rel="external">Hudson</a> - <a href="http://hudson.servername:8080/cc.xml" target="_blank" rel="external">http://hudson.servername:8080/cc.xml</a></li>
<li><a href="http://travis-ci.org/" target="_blank" rel="external">Travis CI</a> - <a href="http://travis-ci.org/ownername/repositoryname/cc.xml" target="_blank" rel="external">http://travis-ci.org/ownername/repositoryname/cc.xml</a></li>
<li><a href="https://www.tddium.com/" target="_blank" rel="external">tddium</a> - - <a href="http://api.tddium.com/cc/long_uuid_string/cctray.xml" target="_blank" rel="external">http://api.tddium.com/cc/long_uuid_string/cctray.xml</a></li>
</ul>
<p>And according to <a href="https://github.com/robertmaldon/cc_dashboard" target="_blank" rel="external">cc_dashboard</a>, there are some exceptions that are not included in the document.</p>
<ul>
<li>An additional “Pending” activity</li>
<li>An additional “Unknown” status. I’ve seen Unknown reported by CruiseControl.rb when project builds are serialized (“Configuration.serialize_builds = true” set in .cruise/site_config.rb) and one build is waiting for another build to finish. I’ve seen Unknown reported by Hudson when a project is disabled.</li>
</ul>
<hr>

<p>The following is a patched version of <a href="http://confluence.public.thoughtworks.org/display/CI/Multiple+Project+Summary+Reporting+Standard" target="_blank" rel="external">Multiple Project Summary Reporting Standard</a>.</p>
<h2 id="Multiple-Project-Summary-Reporting-Standard"><a href="#Multiple-Project-Summary-Reporting-Standard" class="headerlink" title="Multiple Project Summary Reporting Standard"></a><a href="http://confluence.public.thoughtworks.org/display/CI/Multiple+Project+Summary+Reporting+Standard" target="_blank" rel="external">Multiple Project Summary Reporting Standard</a></h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Various Continuous Integration monitoring / reporting tools exist. Examples are:</p>
<ul>
<li><a href="http://confluence.public.thoughtworks.org/display/CCNET/CCTray" target="_blank" rel="external">CruiseControl.NET’s CCTray</a></li>
<li><a href="http://www.md.pp.ru/mozilla/cc/" target="_blank" rel="external">CruiseControl Firefox Plugin</a></li>
<li><a href="http://sourceforge.net/projects/ccmenu/" target="_blank" rel="external">CCMenu for Mac</a></li>
</ul>
<p>These tools work by polling Continuous Integration servers for summary information and presenting it appropriately to users.</p>
<p>If a Continuous Integration server can offer a standard summary format, and a reporting tool can consume the same, then we get interoperability between reporting tools and CI Servers.</p>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Summary information will be available as a plain XML string retrievable through an http GET request.</p>
<p>The format of the XML will be as follows:</p>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>A single <projects> node, the document root, which contains 0 or many <project> node.</project></projects></p>
<p>Each <project> may have the following attributes:</project></p>
<table><br><br>    <tbody><br><br>        <tr><br><br>            <th> name </th><br><br>            <th> description </th><br><br>            <th> type </th><br><br>            <th> required </th><br><br>        </tr><br><br>        <tr><br><br>            <td> name </td><br><br>            <td> The name of the project </td><br><br>            <td> string </td><br><br>            <td> yes </td><br><br>        </tr><br><br>        <tr><br><br>            <td> activity </td><br><br>            <td> The current state of the project </td><br><br>            <td> string enum : Sleeping, Building, CheckingModifications <br clear="all"> </td><br><br>            <td> yes </td><br>        </tr><br><br>        <tr><br><br>            <td> lastBuildStatus </td><br><br>            <td> A brief description of the last build </td><br><br>            <td> string enum : Pending, Success, Failure, Exception, Unknown </td><br><br>            <td> yes </td><br><br>        </tr><br><br>        <tr><br><br>            <td> lastBuildLabel </td><br><br>            <td> A referential name for the last build </td><br><br>            <td> string </td><br><br>            <td> no </td><br><br>        </tr><br><br>        <tr><br><br>            <td> lastBuildTime </td><br><br>            <td> When the last build occurred </td><br><br>            <td> DateTime </td><br><br>            <td> yes </td><br><br>        </tr><br><br>        <tr><br><br>            <td> nextBuildTime </td><br><br>            <td> When the next build is scheduled to occur (or when the next check to see whether a build should be performed is scheduled to occur) </td><br><br>            <td> DateTime </td><br><br>            <td> no </td><br><br>        </tr><br><br>        <tr><br><br>            <td> webUrl </td><br><br>            <td> A URL for where more detail can be found about this project </td><br><br>            <td> string (URL) </td><br><br>            <td> yes </td><br><br>        </tr><br><br>    </tbody><br><br></table>

<p>Clients that consume this XML should not rely on any optional attribute being present, and should degrade their functionality gracefully.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight xml"><figcaption><span>CCTray.xml Sample</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Projects</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Project</span></span><br><span class="line">        <span class="attr">name</span>=<span class="string">"SvnTest"</span></span><br><span class="line">        <span class="attr">activity</span>=<span class="string">"Sleeping"</span></span><br><span class="line">        <span class="attr">lastBuildStatus</span>=<span class="string">"Exception"</span></span><br><span class="line">        <span class="attr">lastBuildLabel</span>=<span class="string">"8"</span></span><br><span class="line">        <span class="attr">lastBuildTime</span>=<span class="string">"2005-09-28T10:30:34.6362160+01:00"</span></span><br><span class="line">        <span class="attr">nextBuildTime</span>=<span class="string">"2005-10-04T14:31:52.4509248+01:00"</span></span><br><span class="line">        <span class="attr">webUrl</span>=<span class="string">"http://mrtickle/ccnet/"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Project</span></span><br><span class="line">        <span class="attr">name</span>=<span class="string">"HelloWorld"</span></span><br><span class="line">        <span class="attr">activity</span>=<span class="string">"Sleeping"</span></span><br><span class="line">        <span class="attr">lastBuildStatus</span>=<span class="string">"Success"</span></span><br><span class="line">        <span class="attr">lastBuildLabel</span>=<span class="string">"13"</span></span><br><span class="line">        <span class="attr">lastBuildTime</span>=<span class="string">"2005-09-15T17:33:07.6447696+01:00"</span></span><br><span class="line">        <span class="attr">nextBuildTime</span>=<span class="string">"2005-10-04T14:31:51.7799600+01:00"</span></span><br><span class="line">        <span class="attr">webUrl</span>=<span class="string">"http://mrtickle/ccnet/"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Projects</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><figure class="highlight xml"><figcaption><span>cctray.xml Schema</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:schema</span> <span class="attr">elementFormDefault</span>=<span class="string">"qualified"</span> <span class="attr">xmlns:xs</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"Projects"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:complexType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:sequence</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"Project"</span> <span class="attr">maxOccurs</span>=<span class="string">"unbounded"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:complexType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"xs:NMTOKEN"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"activity"</span> <span class="attr">use</span>=<span class="string">"required"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:simpleType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:restriction</span> <span class="attr">base</span>=<span class="string">"xs:NMTOKEN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Sleeping"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Building"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"CheckingModifications"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:restriction</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:simpleType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"lastBuildStatus"</span> <span class="attr">use</span>=<span class="string">"required"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:simpleType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:restriction</span> <span class="attr">base</span>=<span class="string">"xs:NMTOKEN"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"pending"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Success"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Failure"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Unknown"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:restriction</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:simpleType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:attribute</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"lastBuildLabel"</span> <span class="attr">type</span>=<span class="string">"xs:NMTOKEN"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"lastBuildTime"</span> <span class="attr">type</span>=<span class="string">"xs:dateTime"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"nextBuildTime"</span> <span class="attr">type</span>=<span class="string">"xs:dateTime"</span> <span class="attr">use</span>=<span class="string">"optional"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"webUrl"</span> <span class="attr">type</span>=<span class="string">"xs:string"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:element</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:sequence</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:element</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">xs:schema</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/" data-id="cinedk72x004rchsinskkesqm" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ci/">CI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cctray/">cctray</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/continues-integration/">continues integration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cruise-control/">cruise control</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/feed/">feed</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jenkins/">jenkins</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/monitor/">monitor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/report/">report</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/standard/">standard</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tray/">tray</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xml/">xml</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-jsonview-chrome-extension-dark-theme" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/03/15/jsonview-chrome-extension-dark-theme/" class="article-date">
  <time datetime="2013-03-15T00:00:00.000Z" itemprop="datePublished">2013-03-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/package/">Package</a>►<a class="article-category-link" href="/categories/package/chrome-extension/">Chrome Extension</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #AA0;"  >
      <a href="http://timnew.me/categories/package/">Package</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/03/15/jsonview-chrome-extension-dark-theme/">JSONView Chrome Extension Dark Theme</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc" target="_blank" rel="external">JSONView</a> is a very popular JSON formatter for Chrome, which automatically prettifies the JSON content.</p>
<p>JSONView provide a very sweety feature that allow user to customize the css used to format the JSON. And I love dark theme and the Consolas font so much, so I customized my dark own dark theme for JSONView.</p>
<p>Here is my theme css, and you can copy it to your JSONView theme editor to apply.<br>Also you can find code on gist: <a href="https://gist.github.com/timnew/5167241" target="_blank" rel="external">https://gist.github.com/timnew/5167241</a></p>
<img src="/blog/2013/03/15/jsonview-chrome-extension-dark-theme/preview.png" alt="Theme Preview" title="Theme Preview">
<figure class="highlight css"><figcaption><span>Dark Theme for JSONView</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">white-space</span>: pre;</span><br><span class="line">  <span class="attribute">font-family</span>: consolas;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.property</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: orange;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.type-null</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.type-boolean</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: orangered;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.type-number</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.type-string</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: lightgreen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: dodgerBlue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.callback-function</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: gray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.collapser</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"-"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.collapsed</span> &gt; <span class="selector-class">.collapser</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"+"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.ellipsis</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"..."</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.collapsible</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">2em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hoverable</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">2px</span> <span class="number">1px</span> <span class="number">2px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hovered</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(255, 255, 255, .3);  </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.collapser</span> &#123;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">6px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/03/15/jsonview-chrome-extension-dark-theme/" data-id="cinedk72w004pchsiguevm189" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/03/15/jsonview-chrome-extension-dark-theme/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jsonview/">JSONView</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chrome/">chrome</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/consolas/">consolas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dark/">dark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/extension/">extension</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stylesheet/">stylesheet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/theme/">theme</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-google-glass-isn-t-really-an-enhanced-reality-device" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/" class="article-date">
  <time datetime="2013-02-26T00:00:00.000Z" itemprop="datePublished">2013-02-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/thinking/">Thinking</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #06A;"  >
      <a href="http://timnew.me/categories/thinking/">Thinking</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/">Google Glass isn&#39;t really an enhanced reality device</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Just watched <a href="http://youtu.be/V6Tsrg_EQMw" target="_blank" rel="external">a demo of Google Glass</a>, which provides a close view of the experience of using Google Glass in daily life.<br>Check out the video here:<br><a href="http://youtu.be/V6Tsrg_EQMw" target="_blank" rel="external">http://youtu.be/V6Tsrg_EQMw</a></p>
<p>After watching the video, I found glass behaves a little bit different to my previously understanding, it is could be a disadvantage of Google Glass, and will hurt the experience a lot!</p>
<p>Current design of the display on the Glass is to project the digital image on your right eye from a very close distance, which works like you have a transparent display near you right eye.<br>Since the display it so close to you eye, so the digital image will fall out of focus when you are looking around. When you really want to read something from the Glass, you need to ask your eye to focus on the image, on that time, the world around falls out of your focus!</p>
<p>According to the video, what Google is purchasing is a technology that can interact with user without any distraction, reads, bring the user out of the world. In this point of view, Google Glass is huge improvement comparing to classic digital devices, but is still not perfect!</p>
<p>From the distraction view, this little disadvantage isn’t really hurt the experience of Google Glass, if you feel happy that moving your eyeball on the top right of your view very often. But form enhanced reality point of view, it is a breaking blocker!</p>
<p>The most basic requirement of Enhanced Reality is to overlap the digital image contains descriptive information on the optical view of real world. But for Google Glass, it doesn’t provide a way for people to see the digital view and real world, but it is not simultaneously! Because you cannot see the digital view and surrounding world clearly simultaneously, then it is impossible for Google Glass to overlap the digital image over the optical image.</p>
<p>That’s what I means that <strong>Google Glass isn’t really an Enhanced Reality Device</strong> as a lot of people imagined and expected!</p>
<p>Here are 2 images that explain the idea:</p>
<p><strong> View when you look around </strong><br>The view around is clear, but the map is blur<br><img src="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/optical-view.jpg" alt="View when you look around" title="View when you look around"></p>
<p><strong> View when you read Glass </strong><br>The map become clear, but the view around is blur<br><img src="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/digital-view.jpg" alt="View when you read Glass" title="View when you read Glass"></p>
<p>To solve this problem, it requires device to detect the focus point of human eye, then adjust the image accordingly in real time. But still now, we don’t have mature technology that can detect the eye focus point and compact enough to built into a wearable device.</p>
<p>But any way, I still believe that Google Glass is an exciting milestone of purchasing real Enhanced Reality technology in human history! It must evolve and incubate a lot of future technologies!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/" data-id="cinedk72u004lchsi2koe8gbw" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/enhanced-reality/">enhanced reality</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/focus/">focus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/glass/">glass</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google/">google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/projection/">projection</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-some-tricky-ways-to-calculate-integer-in-javascript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/" class="article-date">
  <time datetime="2013-02-24T00:00:00.000Z" itemprop="datePublished">2013-02-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/">Some tricky ways to calculate integer in javascript</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Javascript is famous for its lack of preciseness, so it always surprises and make joke with the developers by breaking the common sense or instinct.</p>
<p>Javascript doesn’t provide <code>integer</code> type, but in daily life, <code>integer</code> sometimes is necessary, then how can we convert a trim a float number into integer in Javascript?<br>Some very common answers might be <code>Math.floor</code>, <code>Math.round</code> or even <code>parseInt</code>. But besides calling Math functions, is there any other answer?</p>
<p>The answer is bitwise operations. Amazing? Yes. Because bitwise operations are usually only applied to integers, so Javascript will try to convert the <code>number</code> into <code>&quot;integer&quot;</code> internally when a bitwise operation is applied, even it is still represented in type of <code>number</code></p>
<p>Suppose <code>value = 3.1415926</code>, and we want <code>integer</code> is the trimmed value of <code>value</code>, then we can have:</p>
<figure class="highlight js"><figcaption><span>Trim Float Number</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> value = <span class="number">3.1415926</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> integer = <span class="built_in">Math</span>.floor(value);</span><br><span class="line">integer = <span class="built_in">Math</span>.round(value);</span><br><span class="line">integer = <span class="built_in">parseInt</span>(value);</span><br><span class="line">integer = ~~value; <span class="comment">// Bitwise NOT</span></span><br><span class="line">integer = value | <span class="number">0</span>; <span class="comment">// Bitwise OR</span></span><br><span class="line">integer = value &lt;&lt; <span class="number">0</span>; <span class="comment">// Left Shift</span></span><br><span class="line">integer = value &gt;&gt; <span class="number">0</span>; <span class="comment">// Sign-propagating Right Shift</span></span><br><span class="line">integer = value &gt;&gt;&gt; <span class="number">0</span>; <span class="comment">// Zero-fill Right Shift</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>For more detail information about bitwise operation in javascript, please check out the <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Bitwise_Operators" target="_blank" rel="external">MDN document</a></p>
<p>All approaches listed before are working, but with different performance. And according to the result from <a href="http://jsperf.com/math-floor-vs-math-round-vs-parseint/42" target="_blank" rel="external">JsPerf</a>, I sort the algorithms by performance from good to bad:</p>
<ol>
<li><code>integer = ~~value;</code></li>
<li><code>integer = value &gt;&gt;&gt; 0;</code> and <code>integer = value &lt;&lt; 0;</code></li>
<li><code>integer = Math.floor(value);</code></li>
<li><code>integer = value &gt;&gt; 0;</code></li>
<li><code>integer = value | 0;</code></li>
<li><code>integer = Math.round(value);</code></li>
<li><code>integer = parseInt(value);</code></li>
</ol>
<p>NOTE: The test cases are running in Chrome 24.0.1312.57 on Mac OS X 10.8.2</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/" data-id="cinedk72s004jchsibflk3aam" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bitwise/">bitwise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/calculation/">calculation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/integer/">integer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trick/">trick</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-manage-configuration-in-rails-way-on-node-js-by-using-inheritance" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/" class="article-date">
  <time datetime="2013-02-22T00:00:00.000Z" itemprop="datePublished">2013-02-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/">Manage configuration in Rails way on node.js by using inheritance</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Application is usually required to run in different environments. To manage the differences between the environments, we usually introduce the concept of Environment Specific Configuration.<br>In Rails application, by default, Rails have provided 3 different environments, they are the well known, <code>development</code>, <code>test</code> and <code>production</code>.<br>And we can use the environment variable <code>RAILS_ENV</code> to tell Rails which environment to be loaded, if the <code>RAILS_ENV</code> is not provided, Rails will load the app in <code>development</code> env by default.</p>
<p>This approach is very convenient, so we want to apply it to anywhere. But in node.js, Express doesn’t provide any configuration management. So we need to built the feature by ourselves.</p>
<p>The environment management usually provide the following functionalities:</p>
<ul>
<li>Allow us to provide some configuration values as the default, which will be loaded in all environments, usually we call it <code>common</code>.</li>
<li>Specific configuration will be loaded according to the environment variable, and will override some values in the <code>common</code> if necessary.</li>
</ul>
<p>Rails uses <code>YAML</code> to hold these configurations, which is concise but powerful enough for this purpose. And YAML provided inheritance mechanism by default, so you can reduce the duplication by using inheritance.</p>
<figure class="highlight yaml"><figcaption><span>Inheritance in Rails YAML Configuration</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">development:</span> <span class="meta">&amp;defaults</span></span><br><span class="line"><span class="attr">  adapter:</span> mysql</span><br><span class="line"><span class="attr">  encoding:</span> utf8</span><br><span class="line"><span class="attr">  database:</span> sample_app_development</span><br><span class="line"><span class="attr">  username:</span> root</span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">  &lt;&lt;: <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">  database:</span> sample_app_test</span><br><span class="line"></span><br><span class="line"><span class="attr">cucumber:</span></span><br><span class="line">  &lt;&lt;: <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">  database:</span> sample_app_cucumber</span><br><span class="line"></span><br><span class="line"><span class="attr">production:</span></span><br><span class="line">  &lt;&lt;: <span class="meta">*defaults</span></span><br><span class="line"><span class="attr">  database:</span> sample_app_production</span><br><span class="line"><span class="attr">  username:</span> sample_app</span><br><span class="line"><span class="attr">  password:</span> secret_word</span><br><span class="line"><span class="attr">  host:</span> ec2<span class="bullet">-10</span><span class="bullet">-18</span><span class="bullet">-1</span><span class="bullet">-115.</span>us-west<span class="bullet">-2.</span>compute.amazonaws.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>In <code>express</code> and <code>node.js</code>, if we follow the same approach, comparing to <code>YAML</code>, we prefer <code>JSON</code>, which is supported natively by <code>Javascript</code>.<br>But to me, <code>JSON</code> isn’t the best option, there are some disadvantages of <code>JSON</code>:</p>
<ul>
<li>JSON Syntax is not concise enough</li>
<li>Matching the brackets and appending commas to the line end are distractions</li>
<li>Lack of flexility</li>
</ul>
<p>As an answer to these issues, I chose <code>coffee-script</code> instead of <code>JSON</code>.<br><code>Coffee</code> is concise. And similar to <code>YAML</code>, <code>coffee</code> uses indention to indicate the nested level. And <code>coffee</code> is executable, which provides a lot of flexibilities to the configuration. So we can implement a Domain Specific Language form</p>
<p>To do it, we need to solve 4 problems:</p>
<ol>
<li>Allow dev to declare default configuration.</li>
<li>Load specific configuration besides of default one.</li>
<li>Specific configuration can overrides the values in the default one.</li>
<li>Code is concise, clean and reading-friendly.</li>
</ol>
<p>Inspired by the YAML solution, I work out my first solution:</p>
<figure class="highlight coffeescript"><figcaption><span>Configuration in coffee script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">_ = <span class="built_in">require</span>(<span class="string">'underscore'</span>)</span><br><span class="line"></span><br><span class="line">config = &#123;&#125;</span><br><span class="line"></span><br><span class="line">config[<span class="string">'common'</span>] =</span><br><span class="line">  adapter: <span class="string">"mysql"</span></span><br><span class="line">  encoding: <span class="string">"utf8"</span></span><br><span class="line">  database: <span class="string">"sample_app_development"</span></span><br><span class="line">  username: <span class="string">"root"</span></span><br><span class="line"></span><br><span class="line">config[<span class="string">'development'</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">config[<span class="string">'test] =</span><br><span class="line">  database:"sample_app_test"</span><br><span class="line"></span><br><span class="line">config['</span>cucumber<span class="string">'] =</span><br><span class="line">  database:"sample_app_cucumber"</span><br><span class="line"></span><br><span class="line">config['</span>production<span class="string">'] =</span><br><span class="line">  database:"sample_app_production"</span><br><span class="line">  username:"sample_app"</span><br><span class="line">  password:"secret_word"</span><br><span class="line">  host:"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</span><br><span class="line"></span><br><span class="line">_.extend exports, config.common</span><br><span class="line"></span><br><span class="line">specificConfig = config[process.env.NODE_ENV ?'</span>development<span class="string">']</span><br><span class="line"></span><br><span class="line">if specificConfig?</span><br><span class="line">  _.extend exports, specificConfig</span><br><span class="line"></span></span><br></pre></td></tr></table></figure>
<p><code>YAML</code> is data centric language, so its inheritance is more like “mixin” another piece of data. So I uses <code>underscore</code> to help me to mixin the specific configuration over the default one, which overrides the overlapped values.</p>
<p>But if we jump out of the YAML’s box, let us think about the <code>Javascript</code> itself, Javascript is a prototype language, which means it had already provide an overriding mechanism natively. Each object inherits and overrides the value from its prototype.<br>So I worked out the 2nd solution:</p>
<figure class="highlight coffeescript"><figcaption><span>Prototype based Configuration</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">config = &#123;&#125;</span><br><span class="line"></span><br><span class="line">config[<span class="string">'common'</span>] =</span><br><span class="line">  adapter: <span class="string">"mysql"</span></span><br><span class="line">  encoding: <span class="string">"utf8"</span></span><br><span class="line">  database: <span class="string">"sample_app_development"</span></span><br><span class="line">  username: <span class="string">"root"</span></span><br><span class="line"></span><br><span class="line">config[<span class="string">'development'</span>] = &#123;&#125;</span><br><span class="line">config[<span class="string">'development'</span>].__proto__ = config[<span class="string">'common'</span>]</span><br><span class="line"></span><br><span class="line">config[<span class="string">'test] =</span><br><span class="line">  __proto__: config['</span>common<span class="string">']</span><br><span class="line">  database:"sample_app_test"</span><br><span class="line"></span><br><span class="line">config['</span>cucumber<span class="string">'] =</span><br><span class="line">  __proto__: config['</span>test<span class="string">']</span><br><span class="line">  database:"sample_app_cucumber"</span><br><span class="line"></span><br><span class="line">config['</span>production<span class="string">'] =</span><br><span class="line">  __proto__: config['</span>common<span class="string">']</span><br><span class="line">  database:"sample_app_production"</span><br><span class="line">  username:"sample_app"</span><br><span class="line">  password:"secret_word"</span><br><span class="line">  host:"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</span><br><span class="line"></span><br><span class="line">process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ?'</span>development<span class="string">'</span><br><span class="line"></span><br><span class="line">module.exports = config[process.env.NODE_ENV]</span><br><span class="line"></span></span><br></pre></td></tr></table></figure>
<p>This approach works, but looks kind of ugly. Since we’re using <code>coffee</code>, which provides the syntax sugar for class and class inheritance.<br>So we have the 3rd version:</p>
<figure class="highlight coffeescript"><figcaption><span>Class based configuration</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ? <span class="string">'development'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span></span><br><span class="line">  adapter: <span class="string">"mysql"</span></span><br><span class="line">  encoding: <span class="string">"utf8"</span></span><br><span class="line">  database: <span class="string">"sample_app_development"</span></span><br><span class="line">  username: <span class="string">"root"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">development</span> <span class="keyword">extends</span> <span class="title">Config</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">test</span> <span class="keyword">extends</span> <span class="title">Config</span></span></span><br><span class="line">  database: <span class="string">"sample_app_test"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">cucumber</span> <span class="keyword">extends</span> <span class="title">Config</span></span></span><br><span class="line">  database: <span class="string">"sample_app_cucumber"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">common</span> <span class="keyword">extends</span> <span class="title">Config</span></span></span><br><span class="line">  database: <span class="string">"sample_app_production"</span></span><br><span class="line">  username: <span class="string">"sample_app"</span></span><br><span class="line">  password: <span class="string">"secret_word"</span></span><br><span class="line">  host: <span class="string">"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> Config[process.env.NODE_ENV]()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now the code looks clean, and we can improve it a step further if necessary. We can try to separate the configurations into files, and required by the file name:</p>
<figure class="highlight coffeescript"><figcaption><span>Class based configuration</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># config/config.coffee</span></span><br><span class="line">configName = process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ? <span class="string">'development'</span></span><br><span class="line"></span><br><span class="line">SpecificConfig  = requrie(<span class="string">"./envs/<span class="subst">#&#123;configName&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> SpecificConfig()</span><br><span class="line"></span><br><span class="line"><span class="comment"># config/envs/commmon.coffee</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Common</span></span></span><br><span class="line">  adapter: <span class="string">"mysql"</span></span><br><span class="line">  encoding: <span class="string">"utf8"</span></span><br><span class="line">  database: <span class="string">"sample_app_development"</span></span><br><span class="line">  username: <span class="string">"root"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Common</span><br><span class="line"></span><br><span class="line"><span class="comment"># config/envs/development.coffee</span></span><br><span class="line">Common = <span class="built_in">require</span>(<span class="string">'./common'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Development</span> <span class="keyword">extends</span> <span class="title">Common</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Development</span><br><span class="line"></span><br><span class="line"><span class="comment"># config/envs/test.coffee</span></span><br><span class="line">Common = <span class="built_in">require</span>(<span class="string">'./common'</span>)  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">Common</span></span></span><br><span class="line">  database: <span class="string">"sample_app_test"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Test</span><br><span class="line"></span><br><span class="line"><span class="comment"># config/envs/cucumber.coffee</span></span><br><span class="line">Test = <span class="built_in">require</span>(<span class="string">'./common'</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cucumber</span> <span class="keyword">extends</span> <span class="title">Test</span></span></span><br><span class="line">  database: <span class="string">"sample_app_cucumber"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Cucumber</span><br><span class="line"></span><br><span class="line"><span class="comment"># config/envs/production.coffee</span></span><br><span class="line">Common = <span class="built_in">require</span>(<span class="string">'./common'</span>)  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Production</span> <span class="keyword">extends</span> <span class="title">Common</span></span></span><br><span class="line">  database: <span class="string">"sample_app_production"</span></span><br><span class="line">  username: <span class="string">"sample_app"</span></span><br><span class="line">  password: <span class="string">"secret_word"</span></span><br><span class="line">  host: <span class="string">"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Production</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/" data-id="cinedk72q004fchsiiwexxsih" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/configuration/">configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/environment/">environment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/express/">express</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/inheritance/">inheritance</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scheme/">scheme</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-implement-sqrt-with-basic-algebra-operators" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/01/30/implement-sqrt-with-basic-algebra-operators/" class="article-date">
  <time datetime="2013-01-30T00:00:00.000Z" itemprop="datePublished">2013-01-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/algorithm/">Algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/01/30/implement-sqrt-with-basic-algebra-operators/">Implement sqrt with basic algebra operators</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>It is a very basic question, but to solve it in a time limited environment, require solid knowledge about algorithm, and could use these knowledges flexibly.<br>I found the problem of myself is that I know it, but I cannot use it as flexible as my hand.</p>
<h3 id="The-problem-description"><a href="#The-problem-description" class="headerlink" title="The problem description:"></a>The problem description:</h3><blockquote>
<p>Calculate the square root of a given number N<br>The N could be a decimal, such as 6.25 or 0.01<br>The implementation only allow to use basic algebra operators like +, -, *, /, &lt;, &gt;, etc.<br>Advanced functions like Math.sqrt is not allowed</p>
</blockquote>
<p>As a TDDer, I’m used to write a simple test structure that is gonna used to express the test cases:</p>
<figure class="highlight rb"><figcaption><span>Code Skeleton</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> expected == actual</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>After this, we can begin to write our 1st test case, which is the simplest scenario that I can imagine:<br>We assume:</p>
<ol>
<li>n must be an integer</li>
<li>n must have a integer square root</li>
</ol>
<figure class="highlight rb"><figcaption><span>1st test case</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> expected == actual</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start from the easiest case, the integer square root.</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Run the code, if everything goes right, we will get a failed message as expected. Then we gonna introduce our first implementation to fix the failed test case:</p>
<p>With the 2 additional assumptions in 1st test case, we can easily figure out a simple solution: Simply linear search the integers between the root between 1 and n.</p>
<figure class="highlight rb"><figcaption><span>1st implementation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> expected == actual</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line">  (<span class="number">1</span>..n).each <span class="keyword">do</span> <span class="params">|x|</span></span><br><span class="line">    <span class="keyword">return</span> x <span class="keyword">if</span> x * x == n</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start from the easiest case, the integer square root.</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So far so good. But there are 2 magic integers that related to the sqrt, one is 1 and another is 0.<br>And it seems our function cannot handle all of them correctly, so I wanna improve my algorithm to enable it deals with special numbers: 0, 1.<br>So I added 2 test cases, and improved the implementation:</p>
<figure class="highlight rb"><figcaption><span>sqrt of 0 and 1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> expected == actual</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> n == <span class="number">0</span></span><br><span class="line">  (<span class="number">1</span>..n).each <span class="keyword">do</span> <span class="params">|x|</span></span><br><span class="line">    <span class="keyword">return</span> x <span class="keyword">if</span> x * x == n</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start from the easiest case, the integer square root.</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 corner cases</span></span><br><span class="line">assert <span class="number">1</span>, sqrt(<span class="number">1</span>)</span><br><span class="line">assert <span class="number">0</span>, sqrt(<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Now everything looks good, except the performance.<br>The time complexity of this algorithm is O(n), which is bad. I expected the algorithm complexity could close to O(1). At least it should be O(log n)</p>
<p>How could we improve the performance?<br>I had ever thought that it is safe to shrink the range to (1..2/n), but in fact it doesn’t really help to improve the performance of this algorithm, it is still O(n) after the update.<br>And it causes problems when dealing with the number 1, so I prefers to keep it as is.</p>
<p>So what we did in the sqrt function now it kind of a search, we search the number match the condition between 1 and n.<br>Obviously that 1..n is a ascending series, and mapping x -&gt; x*x has positive differential coefficient.<br>So it is possible for use to use variant binary search replace the linear search, which reduce the time complexity from O(n) to O(log n)</p>
<figure class="highlight rb"><figcaption><span>Binary Search</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> expected == actual</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(goal, start, stop)</span></span></span><br><span class="line">  mid = (stop - start) / <span class="number">2</span> + start</span><br><span class="line"></span><br><span class="line">  mid_square = mid * mid</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> mid_square == goal</span><br><span class="line">    <span class="keyword">return</span> mid</span><br><span class="line">  <span class="keyword">elsif</span> mid_square &gt; goal</span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, start, mid)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, mid, stop)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> n == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  binary_search(n, <span class="number">1</span>, n)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start from the easiest case, the integer square root.</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 corner cases</span></span><br><span class="line">assert <span class="number">1</span>, sqrt(<span class="number">1</span>)</span><br><span class="line">assert <span class="number">0</span>, sqrt(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 normal cases</span></span><br><span class="line">assert <span class="number">5</span>, sqrt(<span class="number">25</span>)</span><br><span class="line">assert <span class="number">9</span>, sqrt(<span class="number">81</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>After implemented the binary search algorithm, we found a very interesting phenomenon: We didn’t restrict n to integer, and it seems it get some capability to dealing with float number?!<br>So I tried to add 2 float number test cases:</p>
<figure class="highlight rb"><figcaption><span>Float number test cases</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> expected == actual</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(goal, start, stop)</span></span></span><br><span class="line">  mid = (stop - start) / <span class="number">2</span> + start</span><br><span class="line"></span><br><span class="line">  mid_square = mid * mid</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> mid_square == goal</span><br><span class="line">    <span class="keyword">return</span> mid</span><br><span class="line">  <span class="keyword">elsif</span> mid_square &gt; goal</span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, start, mid)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, mid, stop)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> n == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  binary_search(n, <span class="number">1</span>, n)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start from the easiest case, the integer square root.</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 corner cases</span></span><br><span class="line">assert <span class="number">1</span>, sqrt(<span class="number">1</span>)</span><br><span class="line">assert <span class="number">0</span>, sqrt(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 normal cases</span></span><br><span class="line">assert <span class="number">5</span>, sqrt(<span class="number">25</span>)</span><br><span class="line">assert <span class="number">9</span>, sqrt(<span class="number">81</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># float number</span></span><br><span class="line">assert <span class="number">2.5</span>, sqrt(<span class="number">6.25</span>)</span><br><span class="line">assert <span class="number">1.5</span>, sqrt(<span class="number">2.25</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Amazing, our code works fine!<br>But I believe it is tricky, since both 2.5 and 1.5 is the number stand on the right center between 2 near-by integers. And it fails dealing with generic float number.<br>The problem we met is call stack overflow. Binary search algorithm failed to hit the exactly accurate number that we expected.<br>To solve the problem, we can use a small enough range to replace the accurate equality comparison.<br>We introduce a const EPSILON to describe the accuracy of the calculation.</p>
<figure class="highlight rb"><figcaption><span>Adjust precision</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">EPSILON = <span class="number">100</span> * Float.const_get(<span class="symbol">:EPSILON</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> (expected - actual) &lt; EPSILON</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(goal, start, stop)</span></span></span><br><span class="line">  mid = (stop - start) / <span class="number">2</span> + start</span><br><span class="line"></span><br><span class="line">  mid_square = mid * mid</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mid_square - goal).abs &lt; EPSILON</span><br><span class="line">    <span class="keyword">return</span> mid</span><br><span class="line">  <span class="keyword">elsif</span> mid_square &gt; goal</span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, start, mid)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, mid, stop)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> n == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  binary_search(n, <span class="number">1</span>, n)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start from the easiest case, the integer square root.</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 corner cases</span></span><br><span class="line">assert <span class="number">1</span>, sqrt(<span class="number">1</span>)</span><br><span class="line">assert <span class="number">0</span>, sqrt(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 normal cases</span></span><br><span class="line">assert <span class="number">5</span>, sqrt(<span class="number">25</span>)</span><br><span class="line">assert <span class="number">9</span>, sqrt(<span class="number">81</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># float number</span></span><br><span class="line">assert <span class="number">2.5</span>, sqrt(<span class="number">6.25</span>)</span><br><span class="line">assert <span class="number">1.5</span>, sqrt(<span class="number">2.25</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># float numbers not at 2^n</span></span><br><span class="line">assert <span class="number">3.3</span>, sqrt(<span class="number">10.89</span>)</span><br><span class="line">assert <span class="number">7.7</span>, sqrt(<span class="number">59.29</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>  
<p>Now it looks our code can calculate the square root of most of the numbers that larger than 1. But it fails to calculate the square root of number less than 1.<br>The reason of the failure is because x <em> x &lt; x when x &lt; 1 but x </em> x &gt; 1 when x &gt; 1, which means we should search in different range for the numbers &gt; 1 and numbers &lt; 1.</p>
<figure class="highlight rb"><figcaption><span>float numbers <1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">EPSILON = <span class="number">100</span> * Float.const_get(<span class="symbol">:EPSILON</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> (expected - actual).abs &lt; (EPSILON * <span class="number">10</span>)</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(goal, start, stop)</span></span></span><br><span class="line">  mid = (stop - start) / <span class="number">2</span> + start</span><br><span class="line"></span><br><span class="line">  mid_square = mid * mid</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mid_square - goal).abs &lt; EPSILON</span><br><span class="line">    <span class="keyword">return</span> mid</span><br><span class="line">  <span class="keyword">elsif</span> mid_square &gt; goal</span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, start, mid)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(goal, mid, stop)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> n == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> n == <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">elsif</span> n &gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(n, <span class="number">1</span>, n)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(n, n, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">"Start from the easiest case, the integer square root."</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"2 corner cases"</span></span><br><span class="line">assert <span class="number">1</span>, sqrt(<span class="number">1</span>)</span><br><span class="line">assert <span class="number">0</span>, sqrt(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"2 normal cases"</span></span><br><span class="line">assert <span class="number">5</span>, sqrt(<span class="number">25</span>)</span><br><span class="line">assert <span class="number">9</span>, sqrt(<span class="number">81</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"float number"</span></span><br><span class="line">assert <span class="number">2.5</span>, sqrt(<span class="number">6.25</span>)</span><br><span class="line">assert <span class="number">1.5</span>, sqrt(<span class="number">2.25</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"float numbers not at 2^n"</span></span><br><span class="line">assert <span class="number">3.3</span>, sqrt(<span class="number">10.89</span>)</span><br><span class="line">assert <span class="number">7.7</span>, sqrt(<span class="number">59.29</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"float number &lt; 1"</span></span><br><span class="line">assert <span class="number">0</span>.<span class="number">1</span>, sqrt(<span class="number">0</span>.<span class="number">01</span>)</span><br><span class="line">assert <span class="number">0</span>.<span class="number">02</span>, sqrt(<span class="number">0</span>.<span class="number">0004</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So now the algorithm is pretty much as what we want, but we still found it raise call stack overflow exception sometimes. And it wastes too much iterations on unnecessary precision.<br>So I think maybe we can make the algorithm unlimitedly close to O(1) by sacrificing some precision of the result.<br>So we set up a limit for the maximum iterations that we can take during the calculation. When the limit is reached, we break out the iteration, and return a less accurate number.</p>
<p>It is really useful when calculating the irrational square root, which is has unlimited digits, and there is no accurate solution to it.</p>
<figure class="highlight rb"><figcaption><span>irrational square root</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">EPSILON = <span class="number">10</span> * Float.const_get(<span class="symbol">:EPSILON</span>)</span><br><span class="line"></span><br><span class="line">DEPTH_LIMIT = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assert</span><span class="params">(expected, actual)</span></span></span><br><span class="line">  <span class="keyword">if</span> (expected - actual).abs &lt; (EPSILON * <span class="number">10</span>)</span><br><span class="line">    puts <span class="string">"Passed"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">"Failed"</span></span><br><span class="line">    p expected</span><br><span class="line">    p actual</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">binary_search</span><span class="params">(goal, start, stop, depth)</span></span></span><br><span class="line">  mid = (stop - start) / <span class="number">2</span> + start</span><br><span class="line"></span><br><span class="line">  mid_square = mid * mid</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (mid_square - goal).abs &lt; EPSILON</span><br><span class="line">    <span class="keyword">return</span> mid</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> mid <span class="keyword">if</span> depth &gt;= DEPTH_LIMIT</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mid_square &gt; goal</span><br><span class="line">      <span class="keyword">return</span> binary_search(goal, start, mid, depth + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">return</span> binary_search(goal, mid, stop, depth + <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqrt</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> n == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  n = n.to_f</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> n == <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">elsif</span> n &gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(n, <span class="number">1</span>, n, <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> binary_search(n, n, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">"Start from the easiest case, the integer square root."</span></span><br><span class="line">assert <span class="number">3</span>, sqrt(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"2 corner cases"</span></span><br><span class="line">assert <span class="number">1</span>, sqrt(<span class="number">1</span>)</span><br><span class="line">assert <span class="number">0</span>, sqrt(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"2 normal cases"</span></span><br><span class="line">assert <span class="number">5</span>, sqrt(<span class="number">25</span>)</span><br><span class="line">assert <span class="number">9</span>, sqrt(<span class="number">81</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"float number"</span></span><br><span class="line">assert <span class="number">2.5</span>, sqrt(<span class="number">6.25</span>)</span><br><span class="line">assert <span class="number">1.5</span>, sqrt(<span class="number">2.25</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"float numbers not at 2^n"</span></span><br><span class="line">assert <span class="number">3.3</span>, sqrt(<span class="number">10.89</span>)</span><br><span class="line">assert <span class="number">7.7</span>, sqrt(<span class="number">59.29</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"float number &lt; 1"</span></span><br><span class="line">assert <span class="number">0</span>.<span class="number">1</span>, sqrt(<span class="number">0</span>.<span class="number">01</span>)</span><br><span class="line">assert <span class="number">0</span>.<span class="number">02</span>, sqrt(<span class="number">0</span>.<span class="number">0004</span>)</span><br><span class="line"></span><br><span class="line">puts <span class="string">"irrational root"</span></span><br><span class="line">assert <span class="number">1.414213562373095</span>, sqrt(<span class="number">2</span>)</span><br><span class="line">assert <span class="number">1.732050807568877</span>, sqrt(<span class="number">3</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So besides of the binary search approach,  we can calculate the square root with Newton’s method, which calculates the result with a iterative equation.<br>Newton’s method has the limitation in precision, but has a good performance. It is said that one of the ancestors of FPS game Quake uses it in the game engine to get a good performance with limited computing power.<br>Here is a <a href="http://www.school-for-champions.com/algebra/square_root_approx.htm" target="_blank" rel="external">easy-understood document</a> explain how it works.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/01/30/implement-sqrt-with-basic-algebra-operators/" data-id="cinedk72m004achsizip6e7do" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/01/30/implement-sqrt-with-basic-algebra-operators/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/binary-search/">binary search</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/facebook/">facebook</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqrt/">sqrt</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-in-node-crypto-and-base64-encoding" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/" class="article-date">
  <time datetime="2013-01-30T00:00:00.000Z" itemprop="datePublished">2013-01-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/">Pitfall in node crypto and base64 encoding</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today, we found there is a huge pitfall in node.js crypto module! Decipher has potential problem when processing Base64 encoding.</p>
<p>We’re building RESTful web service based on Node.js, which talks to some other services implemented with Ruby.</p>
<h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><p>In ruby, we use the default <code>Base64</code> class to handle Base64 encoding.</p>
<p><code>Base64#encode64</code> has a very interesting feature:<br>It add <code>line break (\n)</code> to output every 60 characters. This format make the output look pretty and be friendly for human reading:</p>
<figure class="highlight nginx"><figcaption><span>Ruby Base64 Block</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">MSwyLDMsNCw1LDYsNyw4LDksMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgs</span></span><br><span class="line">MTksMjAsMjEsMjIsMjMsMjQsMjUsMjYsMjcsMjgsMjksMzAsMzEsMzIsMzMs</span><br><span class="line">MzQsMzUsMzYsMzcsMzgsMzksNDAsNDEsNDIsNDMsNDQsNDUsNDYsNDcsNDgs</span><br><span class="line">NDksNTAsNTEsNTIsNTMsNTQsNTUsNTYsNTcsNTgsNTksNjAsNjEsNjIsNjMs</span><br><span class="line">NjQsNjUsNjYsNjcsNjgsNjksNzAsNzEsNzIsNzMsNzQsNzUsNzYsNzcsNzgs</span><br><span class="line">NzksODAsODEsODIsODMsODQsODUsODYsODcsODgsODksOTAsOTEsOTIsOTMs</span><br><span class="line">OTQsOTUsOTYsOTcsOTgsOTksMTAw</span><br></pre></td></tr></table></figure>
<p>The <code>Base64#decode64</code> class ignores the <code>line break (\n)</code> when parsing the base64 encoded data, so the <code>line break</code> won’t pollute the data.</p>
<h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><p>Node.js take <code>Base64</code> as one of the 5 standard encodings (<code>ascii</code>, <code>utf8</code>, <code>base64</code>, <code>binary</code>, <code>hex</code>). Ideally the data or string can be transcoded between these 4 encodings without data loss.</p>
<p>The <code>Buffer</code> class is the simplest way to transcode the data:</p>
<figure class="highlight coffeescript"><figcaption><span>Base64 Encoder in Node.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Base64 =</span><br><span class="line">  encode64: <span class="function"><span class="params">(text)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">new</span> Buffer(text, <span class="string">'utf8'</span>).toString(<span class="string">'base64'</span>)</span><br><span class="line"></span><br><span class="line">  decode64: <span class="function"><span class="params">(base64)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">new</span> Buffer(base64. <span class="string">'base64'</span>).toString(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Although <code>encode64</code> function in node.js won’t add <code>line break</code> to the output, but the <code>decode64</code> function does ignore the <code>line break</code> when parsing the data. It keeps the consistent behavior with ruby <code>Base64</code> class, so we can use this <code>decode64</code> function to decode the data from ruby.</p>
<p>Since <code>base64</code> is one of the standard encodings, and some of the node.js API does allow set encoding for input and output. So ideally, we can complete the base64 encoding and decoding during processing the data.<br>It seems Node.js is more convenient comparing to Ruby when dealing with <code>Base64</code>.</p>
<p>e.g. We can combine reading file and base64 encoding the content into one operation by setting the encoding to readFileSync API.</p>
<figure class="highlight coffeescript"><figcaption><span>Write and Read string as Base64</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fileName = <span class="string">'./binary.dat'</span> <span class="comment"># this file contains binary data</span></span><br><span class="line">base64 = fs.readFileSync(fileName, <span class="string">'base64'</span>) <span class="comment"># file content has been base64 encoded</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>It looks like we can always use this trick to avoid manually base64 encoding and decoding when the API has encoding parameter! But actually it is not true! There is a BIG pitfall here!</p>
<p>In our real case, we uses <code>crypto</code> module to decrypt the the JSON document that encrypted and base64 encoded by Ruby:</p>
<figure class="highlight coffeescript"><figcaption><span>Base64 Deocde and Decrypt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"><span class="function"></span><br><span class="line"><span class="title">parse</span> = <span class="params">(data, algorithm, key, iv)</span> -&gt;</span></span><br><span class="line">  decipher = crypto.createDecipheriv(algorithm, key, iv)</span><br><span class="line"></span><br><span class="line">  decrypted = decipher.update(data, <span class="string">'base64'</span>, <span class="string">'utf8'</span>) <span class="comment"># Set input encoding to 'base64' to ask API to base64 decode the input before decryption</span></span><br><span class="line">  decrypted += dechiper.final(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line">  JSON.parse(decrypted)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><figcaption><span>Manually Base64 Decoding</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"><span class="function"></span><br><span class="line"><span class="title">parse</span> = <span class="params">(data, algorithm, key, iv)</span> -&gt;</span></span><br><span class="line">  decipher = crypto.createDecipheriv(algorithm, key, iv)</span><br><span class="line"></span><br><span class="line">  binary = <span class="keyword">new</span> Buffer(data,<span class="string">'base64'</span>) <span class="comment"># Manually Base64 Decode</span></span><br><span class="line"></span><br><span class="line">  decrypted = decipher.update(binary, <span class="string">'binary'</span>, <span class="string">'utf8'</span>) <span class="comment"># Set input encoding to 'binary'</span></span><br><span class="line">  decrypted += dechiper.final(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line">  JSON.parse(decrypted)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The previous 2 implementations are very similar except the second one base64 decoded the data manually by using <code>Buffer</code>. Ideally they should be equivalent in behavior. But in fact, they are <strong>NOT</strong> equivalent!</p>
<p>The previous implementation throws “TypeError: DecipherFinal fail”.<br>And the reason is that the shortcut way doesn’t ignore the <code>line break</code>, but <code>Buffer</code> does!!! So in the previous implementation, the data is polluted by the <code>line break</code>!</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>Be careful, when you try to ask the API to base64 decode the data by setting the encoding argument to ‘base64’. It has inconsistent behavior comparing to <code>Buffer</code> class.</p>
<p>I’m not sure whether it is a node.js bug, or it is as is by design. But it is indeed a pitfall that hides so deep. And usually is extremely hard to figure out. Since encrypted binary is hard to human to read, and debugging between 2 languages are also kind of hard!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/" data-id="cinedk72o004dchsitfbp6fek" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/base64/">base64</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/buffer/">buffer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/crypto/">crypto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/decipher/">decipher</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/encoding/">encoding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/archives/blog/5/">&laquo; __('prev')</a><a class="page-number" href="/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/blog/4/">4</a><a class="page-number" href="/archives/blog/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/archives/blog/7/">7</a><a class="page-number" href="/archives/blog/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/archives/blog/12/">12</a><a class="extend next" rel="next" href="/archives/blog/7/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Articles récents</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Nuage de mot-clés</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Catégories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>