<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2014 | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/archives/2014/blog/3/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '[object Object]', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-migrate-blog-to-hexo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/08/12/migrate-blog-to-hexo/" class="article-date">
  <time datetime="2014-08-12T14:59:14.000Z" itemprop="datePublished">2014-08-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/hexo/">Hexo</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/08/12/migrate-blog-to-hexo/">Migrate Blog to Hexo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This post is a celebration for the migration from <a href="http://octopress.org/" target="_blank" rel="external">Octopress</a> to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a></p>
<p><code>Octopress</code> has done an excellent job on filling the gap between <code>jekyll</code> and full function repo based blog engine. But because of the tech stack it is based on. It isn’t really a awesome framework to use.</p>
<p>The first time I got pissed off by <code>Octopress</code> was by the end of 2012. Then I come up the idea to rewrite it in <code>Node.js</code>. But I wasn’t able to make it happen, because I was held by the new project assignment, and didn’t have too many spare time on the blog engine.</p>
<p>To save effort, I began to customize <code>Octopress</code> by rewriting some code in <code>Octopress</code> and <code>Jekyll</code>, which started the long march of <code>Octopress</code> customization.</p>
<p>I did a number of customization on <code>Octopress</code>, from erb template to Jekyll generators, from <code>Rake</code> script to TextMate bundles.</p>
<p>Before I switch to Sublime, I uses TextMate for quite long time. So I customized the <code>Rake</code> script and TextMate bundle, which enables me to invoke almost every rake command in TextMate with hotkey. I can even rename the blog post file name according to the title in front-matter without leaving TextMate. Besides the functionality, I also customized the templates and the widgets a lot to get better visual effects and reading experience.</p>
<p>I’ve benefited from these customization a lot. On the other hand, these deep customization blocks me from migrating to <code>Hexo</code>, a better alternative. Even I have found <code>Hexo</code> in the early 2013, and believe it is a better blog platform. But it is really costy for me to migrate the blogs away from the Octopress.</p>
<p>Luckily, after years development, a bunch of tools and libraries came up, which has minimized the gap between <code>Octopress</code> and <code>Hexo</code>.<br>After several days effort, finally retired the <code>Octoress</code> engine, and completed the journey of moving from <code>Octopress</code> to <code>Hexo</code>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/08/12/migrate-blog-to-hexo/" data-id="cimz4udto007fnwsi84700j64" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/08/12/migrate-blog-to-hexo/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/migration/">migration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/octopress/">octopress</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-page-renders-improperly-in-ie-before-developer-tool-has-opened" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/" class="article-date">
  <time datetime="2014-08-01T00:00:00.000Z" itemprop="datePublished">2014-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/">Page renders improperly in IE before developer tool has opened</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today I found a super annoying issue about IE. Our website works perfectly in any browser except IE. The page isn’t rendered properly in IE 9. Well, this is common, this is the nature of IE. The mysterious issue I found is that once you opened or ever opened the developer tool, open the page or refresh the page, the problem is gone magically!!!!</p>
<p>As a conclusion, opening the developer tool changes the browser behavior!!!!! What a hell! So you know there is something wrong, but once you try to figure out the error message, you have to open developer tool. Once you open the developer tool, the bug is gone! <strong>DEAD END!!!</strong></p>
<p>Because I cannot open developer tool, so I have to debug with <code>alert</code>. It is really a horrible experience to me, and feels like inspecting nuclear reaction with a plain optical magnifier or fixing a high-tech spacecraft with stones and clubs.</p>
<p>Since it is client-rich page, a lot of javascript is introduced. So I cannot go through the scripts line by line, instead I have to make an assumption to explain the phenomena spotted, then validate it with experiments, finally correct or extend the assumption according the validation result.</p>
<p>During the process I invalidated a couple of assumptions, some of them are seems very close to the “right answer”, such as “some script is loaded and executed before its dependencies, and developer tool load all the scripts first because it displays all the scripts”.</p>
<p>After spending a couple of hours on it, I put on eye on a line of code that is really out of my expectation: <code>console.warn</code>.</p>
<figure class="highlight javascript"><figcaption><span>Code breaks the page rendering</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">console</span>.warn(<span class="string">'__proto__ is not supported by current browser, fallback to hard-copy approach'</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>I displays a warning message to console when a workaround is applied. But a tricky fact about IE 9 is that <code>console</code> isn’t available until developer tool is opened (<a href="http://msdn.microsoft.com/library/ie/bg182326(v=vs.85" target="_blank" rel="external">MSDN reference here</a>))!!!</p>
<p>The fact that console is not available until developer tools is opened really blows my mind away! (Maybe it is because I have little experience work with IE). As a chrome user, I take console as the universal log system for javascript. But in IE, according to the <a href="http://msdn.microsoft.com/library/ie/bg182326(v=vs.85" target="_blank" rel="external">document</a>), the code should check the existence of console every time print a log.</p>
<p>There is another pitfall here, and I saw someone really post it as answer on <a href="http://stackoverflow.com/questions/2656730/internet-explorer-console" target="_blank" rel="external">StackOverflow</a>:</p>
<figure class="highlight javascript"><figcaption><span>Bad polyfill implemntation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">console</span> == <span class="string">"undefined"</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.console = &#123; log: <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123; alert(msg); &#125; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>We usually access <code>console</code> as <code>console.log</code>, feels like <code>console</code> is a global instance to access. But actually console is an member of <code>window</code>, its full name should be <code>window.console</code>. When <code>console</code> exists, we can definitely reference to it via <code>console</code>. But if it doesn’t exist, the statement <code>console</code> cause script error! So the following code doesn’t work:</p>
<figure class="highlight javascript"><figcaption><span>Pitfalls in console existence check</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span>(<span class="built_in">console</span>) === <span class="string">'undefined'</span>)&#123; <span class="comment">// Break the script execution</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Never got executed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">console</span> != <span class="literal">null</span>) &#123; <span class="comment">// Break the script execution</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Never got executed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">console</span>) &#123; <span class="comment">// Break the script execution</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Never got executed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.console) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this works!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>To avoid <code>console</code> issue, a ployfill could be very useful. Here is a great implementation available as <code>bower</code> package: <a href="https://github.com/paulmillr/console-polyfill" target="_blank" rel="external">console-polyfill</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/" data-id="cimz4udtx007vnwsiu4gp8xs3" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ie/">IE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/console/">console</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/developer-tool/">developer tool</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/polyfill/">polyfill</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/undefined/">undefined</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-javascript-prototype-chain-mutator" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/07/30/javascript-prototype-chain-mutator/" class="article-date">
  <time datetime="2014-07-30T00:00:00.000Z" itemprop="datePublished">2014-07-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/07/30/javascript-prototype-chain-mutator/">JavaScript Prototype Chain Mutator</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In JavaScript world, JSON serialization is widely used. When fetching data from server via Ajax, the data is usually represented in JSON; or loading configuration/data from file in Node.js application, the configuration/data is usually in JSON format.</p>
<p>JSON serialization is powerful and convenient, but there is limitation. For security and other reason, behavior and type information are forbidden in JSON. Functions members are removed when stringify a JavaScript object, also functions are not allowed in JSON.</p>
<p>Comparing Yaml to Ruby, this limitation isn’t that convenient when writing JavaScript application. For example, to consume the JSON data fetched via ajax from server, I really wish I can invoke some method on the deserialized model.</p>
<p>Here is simple example:</p>
<figure class="highlight coffeescript"><figcaption><span>Ideal World</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rect</span></span></span><br><span class="line">  constructor: <span class="function"><span class="params">(width, height)</span> -&gt;</span></span><br><span class="line">    @width = width <span class="keyword">if</span> width?</span><br><span class="line">    @height = height <span class="keyword">if</span> height?</span><br><span class="line"></span><br><span class="line">  area: <span class="function">-&gt;</span></span><br><span class="line">    @width * @height</span><br><span class="line"></span><br><span class="line">$.get <span class="string">'/rect/latest'</span>, <span class="function"><span class="params">(rectJSON)</span> -&gt;</span>  </span><br><span class="line">  rect = JSON.parse(rectJSON)</span><br><span class="line">  <span class="built_in">console</span>.log rect.area() <span class="comment"># This code doesn't work because there is rect is a plain object</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The code doesn’t work, because <code>rect</code> in a plain object, which doesn’t contains any behavior. Someone called the rect <code>DTO</code>, Data Transfer Object, or POJO, Plain Old Java Object, a concept borrowed from Java world. Here we call it <code>DTO</code>.</p>
<p>To add behaviors to <code>DTO</code>, there are variant approaches. Such as create a behavior wrapper around the <code>DTO</code>, or create a new model with behavior and copy all the data from <code>DTO</code> to model. These practices are borrowed from Java world, or traditional Object Oriented world.</p>
<p>In fact, in JavaScript, there could be a better and smarter way to achieve that: <code>Object Mutation</code>, altering object prototype chain on the fly to convert a object into the instance of a specific type. The process is really similar to biologic genetic mutation, converting a species into another by altering the gene, so I borrow the term <code>mutation</code>.</p>
<p>With the idea, we can achieve this:</p>
<figure class="highlight coffeescript"><figcaption><span>Mutate rect with Mutator</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rect</span></span></span><br><span class="line">  constructor: <span class="function"><span class="params">(width, height)</span> -&gt;</span></span><br><span class="line">    @width = width <span class="keyword">if</span> width?</span><br><span class="line">    @height = height <span class="keyword">if</span> height?</span><br><span class="line"></span><br><span class="line">  area: <span class="function">-&gt;</span></span><br><span class="line">    @width * @height</span><br><span class="line"></span><br><span class="line">$.get <span class="string">'/rect/latest'</span>, <span class="function"><span class="params">(rectJSON)</span> -&gt;</span>  </span><br><span class="line">  rect = JSON.parse(rectJSON)</span><br><span class="line"></span><br><span class="line">  mutate(rect, Rect)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log rect.area()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The key to implement <code>mutate</code> function is to simulate <code>new</code> operator behavior, alerting <code>object.__proto__</code> and apply <code>constructor</code> to the instance! For more detail, check out the library <a href="https://github.com/timnew/mutator" target="_blank" rel="external">mutator</a> <a href="https://github.com/timnew/mutator" target="_blank" rel="external"><img src="https://badge.fury.io/bo/widget.coffee.svg" alt="Bower version"></a> <a href="https://www.npmjs.org/package/mutator" target="_blank" rel="external"><img src="http://img.shields.io/npm/v/mutator.svg" alt="NPM version"></a>, which is available as both <code>NPM</code> package and <code>bower</code> package.</p>
<p>When implementing the <code>mutator</code>, in IE, again, in the evil IE, the idea doesn’t work. Before IE 11, JavaScript prototype chain for instance is not accessible. There is nothing equivalent to <code>object.__proto__</code> in IE 10 and prior. The most similar workaround is doing a hard-copy of all the members, but it still fails in type check and some dynamical usage.</p>
<p><strong>Background</strong></p>
<blockquote>
<p><code>object.__proto__</code> is a Mozilla “private” implementation until EcmaScript 6.<br>It is interesting that most JavaScript support it except IE.<br>Luckily, IE 11 introduced some features in EcmaScript 6, <code>object.__proto__</code> is one of them.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/07/30/javascript-prototype-chain-mutator/" data-id="cimz4udtu007qnwsigc3chbx4" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/07/30/javascript-prototype-chain-mutator/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ajax/">ajax</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bower/">bower</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/browser/">browser</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/class/">class</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/inheritance/">inheritance</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json/">json</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mutation/">mutation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mutator/">mutator</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/npm/">npm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/prototype/">prototype</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-converting-between-html-5-data-attribute-style-hyphen-name-and-javascript-camcel-case-name" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/07/29/converting-between-html-5-data-attribute-style-hyphen-name-and-javascript-camcel-case-name/" class="article-date">
  <time datetime="2014-07-29T00:00:00.000Z" itemprop="datePublished">2014-07-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/07/29/converting-between-html-5-data-attribute-style-hyphen-name-and-javascript-camcel-case-name/">converting between HTML 5 data-attribute style hyphen name and javascript camcel-case name</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I found a bug in <a href="http://bower.io/search/?q=widget.coffee" target="_blank" rel="external">widget.coffee</a> today. To fix the issue, I need the conversion between HTML 5 <code>data-attribute</code> name and javascript function name, e.g. conversion between <code>data-action-handler</code> and <code>actionHandler</code>.</p>
<p>By taking jQuery implementation as reference, I come up 2 utility functions for the conversion:</p>
<figure class="highlight coffeescript"><figcaption><span>NameConversion</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Utils =</span><br><span class="line">  hyphenToCamelCase: <span class="function"><span class="params">(hyphen)</span> -&gt;</span> <span class="comment"># Convert 'action-handler' to 'actionHandler'</span></span><br><span class="line">    hyphen.replace <span class="regexp">/-([a-z])/g</span>, <span class="function"><span class="params">(match)</span> -&gt;</span></span><br><span class="line">      match[<span class="number">1</span>].toUppercase()</span><br><span class="line"></span><br><span class="line">  camelCaseToHyphen: <span class="function"><span class="params">(camelCase)</span> -&gt;</span> <span class="comment"># Convert 'actionHandler' to 'action-handler'</span></span><br><span class="line">    camelCase.replace(<span class="regexp">/[A-Z]/g</span>, <span class="string">'-$1'</span>).toLowerCase()</span><br><span class="line"></span><br><span class="line">  attributeToCamelCase: <span class="function"><span class="params">(attribute)</span> -&gt;</span> <span class="comment"># Convert 'data-action-handler' or 'action-handler' to 'actionHandler'</span></span><br><span class="line">    Utils.hyphenToCamelCase dataAttribute.replace(<span class="regexp">/^(data-)?(.*)/</span>, <span class="string">'$2'</span>)</span><br><span class="line"></span><br><span class="line">  camelCaseToAttribute: <span class="function"><span class="params">(camelCase)</span> -&gt;</span> <span class="comment"># Convert 'actionHanlder' to 'data-action-handler'</span></span><br><span class="line">    <span class="string">'data-'</span> + Utils.camelCaseToHyphen(camelCase)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Here is a more solid implementation based on previous one.</p>
<figure class="highlight javascript"><figcaption><span>a sloid javascript version</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> Utils = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">hyphenToCamelCase</span>(<span class="params">hyphen</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hyphen.replace(<span class="regexp">/-([a-z])/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> match[<span class="number">1</span>].toUppercase();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">camelCaseToHyphen</span>(<span class="params">camelCase</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> camelCase.replace(<span class="regexp">/[A-Z]/g</span>, <span class="string">'-$1'</span>).toLowerCase();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">attributeToCamelCase</span>(<span class="params">attribute</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hyphenToCamelCase(dataAttribute.replace(<span class="regexp">/^(data-)?(.*)/</span>, <span class="string">'$2'</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">camelCaseToAttribute</span>(<span class="params">camelCase</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'data-'</span> + camelCaseToHyphen(camelCase);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    hyphenToCamelCase: hyphenToCamelCase,</span><br><span class="line">    camelCaseToHyphen: camelCaseToHyphen,</span><br><span class="line">    attributeToCamelCase: attributeToCamelCase,</span><br><span class="line">    camelCaseToAttribute: camelCaseToAttribute</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/07/29/converting-between-html-5-data-attribute-style-hyphen-name-and-javascript-camcel-case-name/" data-id="cimz4udtq007jnwsi7ifrc3i3" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/07/29/converting-between-html-5-data-attribute-style-hyphen-name-and-javascript-camcel-case-name/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/camel-case/">camel-case</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/conversion/">conversion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/data-attribute/">data attribute</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hyphen/">hyphen</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/name/">name</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-remove-bower-from-your-build-script" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/07/10/remove-bower-from-your-build-script/" class="article-date">
  <time datetime="2014-07-10T00:00:00.000Z" itemprop="datePublished">2014-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/07/10/remove-bower-from-your-build-script/">Remove Bower from your build script</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="The-mysterious-broken-build"><a href="#The-mysterious-broken-build" class="headerlink" title="The mysterious broken build"></a>The mysterious broken build</h3><p>This morning, our QA told us that <code>knockout</code>, a javascript library that we used in our web app is missing on staging environment. Then we checked the package she got from CI server, and the javascript library was indeed not included. But when we tried to generate the package on our local dev box, we found that <code>knockout</code> is included.</p>
<p>It is a big surprise to us, because we share the exact same build scripts and environment between dev-boxes and CI agents and because we manage the front-end dependencies with <code>bower</code>. In our <code>gulp</code> script, we ask <code>bower</code> to install the dependencies every time to make sure they are up to date.</p>
<h3 id="The-root-cause-of-the-broken-build"><a href="#The-root-cause-of-the-broken-build" class="headerlink" title="The root cause of the broken build"></a>The root cause of the broken build</h3><p>After spending hours on diagnosing the CI agents, we finally figure out the reason, a tricky story:</p>
<p>When the Knockout maintainer released the v3.1 bower package, they made a mistake in <code>bower.json</code> config file, which packaged the <code>spec</code> folder instead of the <code>dist</code> folder. So this package is actually broken, because the main javascript file <code>dist/knockout.js</code> , described in <code>bower.json</code> doesn’t exist.</p>
<p>Later, the engineers realized they made a mistake, and they fixed the issue by releasing a new package. Maybe they think they haven’t changed any script logic, so <strong>they release the new package under the same version number</strong>, which is the criminal who broke our builds.</p>
<p>We’re so unlucky that the broken package is downloaded on our CI server when our build script was executed there for the first time. And the broken package is stored in <code>bower</code> cache at that time.</p>
<p>Because of Bower’s cache mechanism, the broken package is used unless the version is bumped or cache is expired. This is the reason why our build is broken on the CI server.</p>
<p>But on our dev box, for some reason, we had run <code>bower cache clean</code>, which invalidated the cache. So we have a good build on our local dev box. This is the reason why we can generate good package on our dev box.</p>
<p>It is a very tricky issue when using bower to manage dependencies. Although it is not completely our fault, but it is kind of the worst case then we can face. The build broke silently, there were no error logs or messages that helped to figure out the reason. (Well, we haven’t got a chance to setup the smoke test for our app yet, so it could be kind of our fault.)</p>
<p>We thought we had been careful enough to clean the <code>bower_components</code> folder every time, but that prevented us from figuring out the real cause.</p>
<p>After fixing this issue, discussed with my pair Rafa and we came up some practices that could be helpful to avoid this kind of issue:</p>
<h3 id="Best-practices"><a href="#Best-practices" class="headerlink" title="Best practices"></a>Best practices</h3><ul>
<li>Avoid <code>bower install</code> or any equivalent step (such as <code>gulp-bower</code>, <code>grunt-bower</code>, etc.) in the build script</li>
<li>Check <code>bower_components</code> into the code repository or download the dependencies from our self managed repository for large projects.</li>
<li>When dependencies are changed, manually install them and make sure they’re good.</li>
</ul>
<p>After doing this, our build script runs even faster, because we don’t need to check all dependencies are up-to-date every time. This is a bonus from removing <code>bower install</code> from our build script.</p>
<h3 id="Some-thoughts-on-the-package-system"><a href="#Some-thoughts-on-the-package-system" class="headerlink" title="Some thoughts on the package system"></a>Some thoughts on the package system</h3><p>Bower components are maintained by the community, and there is no strict quality control to ensure the package is bug-free or being released in an appropriate way. So it could be safer if we can check them manually, and lock them down across environments.</p>
<p>This could be common issue for all kind of community managed package system. Not just Bower, it could be Maven, Ruby Gem, Node.js package, Python pip package, nuget package or even Docker containers!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/07/10/remove-bower-from-your-build-script/" data-id="cimz4udtn007bnwsi0x1sy2dr" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/07/10/remove-bower-from-your-build-script/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/automation/">automation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bower/">bower</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/continues-integration/">continues integration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/deployment/">deployment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/environment/">environment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pipeline/">pipeline</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-the-battle-between-game-developers-and-game-hackers-part-1-how-hiddenint-works" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/06/24/the-battle-between-game-developers-and-game-hackers-part-1-how-hiddenint-works/" class="article-date">
  <time datetime="2014-06-24T00:00:00.000Z" itemprop="datePublished">2014-06-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cracking/">Cracking</a>►<a class="article-category-link" href="/categories/cracking/game/">Game</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #A00;"  >
      <a href="http://timnew.me/categories/cracking/">Cracking</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/06/24/the-battle-between-game-developers-and-game-hackers-part-1-how-hiddenint-works/">The battle between Game developers and Game Hackers - Part.1 How HiddenInt works</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>Harvest: Massive Encounter</code> is a very unique strategic tower defense game published by <a href="http://www.oxeyegames.com/harvest-massive-encounter/" target="_blank" rel="external">Oxeye Game Studio</a>. The game is amazing, but I won’t focus on that. I will discuss something interesting I discovered when hacking the game.</p>
<p>By hacking the game, I want to lock down the the number of Mineral that I have in the game. Mineral is the only key resource in the game, which is used to build or upgrade structures. Theoretically locking down a value is easy. Scan the memory for specific number for a few times to filter out the list of potential memory addresses. Then try them one by one. And finally figure out the proper address, then locked it down with the game hacking tool. Very standard approach, and supported by most of the game hacking tool.</p>
<p>But in Harvest, the story is quite different. By searching the mineral value, we can locate a specific address. But we can easily find that the value is only used for display instead of real game state data. In fact, Harvest uses a quite unique approach to protect its game status data! Oxeye guys call it the <code>Hidden Int</code>.</p>
<p>Here is the psudo-code explains how the it works:</p>
<figure class="highlight csharp"><figcaption><span>HiddenInt Psudo implementation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">HiddenInt</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> mask;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> hashedValue;</span><br><span class="line">  <span class="keyword">private</span> Random maskGenerator;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">HiddenInt</span>(<span class="params"><span class="keyword">int</span> initialValue</span>) </span>&#123;</span><br><span class="line">    maskGenerator = <span class="keyword">new</span> Random();</span><br><span class="line">    setValue(initialValue);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span>(<span class="params"><span class="keyword">int</span> <span class="keyword">value</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mask = maskGenerator.next();</span><br><span class="line">    <span class="keyword">this</span>.hashedValue = <span class="keyword">value</span> ^ <span class="keyword">this</span>.mask; <span class="comment">// ^ is xor operator.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">value</span> = <span class="keyword">this</span>.hashedValue ^ <span class="keyword">this</span>.mask;</span><br><span class="line">    setValue(<span class="keyword">value</span>); <span class="comment">// Generate a new mask and hashed value every time when the value is read.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">modifyValue</span>(<span class="params"><span class="keyword">int</span> difference</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">value</span> = getValue();</span><br><span class="line">    <span class="keyword">value</span> += difference;</span><br><span class="line">    setValue(<span class="keyword">value</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> ~HiddenInt() &#123; <span class="comment">// Destructor</span></span><br><span class="line">    delete maskGenerator;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>So from the code, you can see, the plain value is never got stored in memory. Instead, it stored a “hashed” value, which is the plain value xor a random generated mask. And every time, when either the value being read or written, the mask changes. This kills the almost all kind of memory scanning features in all kind of game hacking tool! You cannot find the plain value in the memory, so you have to use “fuzzy scan”, which detects the values changes instead of scanning specific value. Again, the data in memory keeps changing even when the value doesn’t (I’ll explain why it happens later), so “fuzzy scan” doesn’t work either here!! That’s a master kill!</p>
<p>Besides of keeping mask changing, it also keeps reading the value out and writing it back, which kills most game editing tool “value frozen” feature! Unless you can ensure you freeze the <code>mask</code> and <code>hashed value</code> at the same time, or it breaks the value! Since the reading and writing happen in a very high frequency (Again I’ll explain why it happens later), so you have to lock down the value at a specific point, or the locked value will be overwritten immediately.</p>
<p>Furthermore, since this value is the key game value, which is displayed on Game UI all the time, the <code>getValue()</code> is called every time when game UI renders! And usually game UI renders in at least 60fps. So the value is read 60 times per second, and the mask changes 60 times per second! (This is why the value keep changing in a high frequency!)</p>
<p>So this is the almost invincible way to keep key game state data safe from common game hacking tools!</p>
<p>In the next post, I’ll explain how to find out a bypass to this security mechanism!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/06/24/the-battle-between-game-developers-and-game-hackers-part-1-how-hiddenint-works/" data-id="cimz4udtj0073nwsinzyxoxzu" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/06/24/the-battle-between-game-developers-and-game-hackers-part-1-how-hiddenint-works/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bit-slicer/">Bit Slicer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cheat/">Cheat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cheat-engine/">Cheat Engine</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/crack/">Crack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/debugger/">Debugger</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/game/">Game</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/harvest/">Harvest</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hiddenint/">HiddenInt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/massive-encounter/">Massive Encounter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/memory-editing/">Memory Editing</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oxeye/">Oxeye</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-process-nexttick-implementation-in-browser" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/06/23/process-nexttick-implementation-in-browser/" class="article-date">
  <time datetime="2014-06-23T00:00:00.000Z" itemprop="datePublished">2014-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/06/23/process-nexttick-implementation-in-browser/">Process.nextTick Implementation in Browser</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Recursion is a common trick that is often used in JavaScript programming. So infinite recursion will cause stack overflow errors.<br>Some languages resolves this issue by introduce automatically tail call optimization, but in JavaScript we need to take care it on our own.</p>
<p>To solve the issue, <code>Node.js</code> has the utility functions <code>nextTick</code> to ensure specific code is invoked after the current function returned.<br>In Browser there is no standard approach to solve this issue, so workarounds are needed.</p>
<p>Thanks to <a href="https://github.com/defunctzombie" target="_blank" rel="external">Roman Shtylman(@defunctzombie)</a>, who created the <code>node-process</code> for <code>Browserify</code>, which simulate the <code>Node.js</code> API in browser environment.<br>Here is his implementation:</p>
<p><a href="https://github.com/defunctzombie/node-process/blob/master/browser.js" target="_blank" rel="external">node-process</a><br><figure class="highlight js"><figcaption><span>Infinite Recursion</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">process.nextTick = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> canSetImmediate = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span></span><br><span class="line">    &amp;&amp; <span class="built_in">window</span>.setImmediate;</span><br><span class="line">    <span class="keyword">var</span> canPost = <span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span></span><br><span class="line">    &amp;&amp; <span class="built_in">window</span>.postMessage &amp;&amp; <span class="built_in">window</span>.addEventListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (canSetImmediate) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">f</span>) </span>&#123; <span class="keyword">return</span> <span class="built_in">window</span>.setImmediate(f) &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (canPost) &#123;</span><br><span class="line">        <span class="keyword">var</span> queue = [];</span><br><span class="line">        <span class="built_in">window</span>.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ev</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> source = ev.source;</span><br><span class="line">            <span class="keyword">if</span> ((source === <span class="built_in">window</span> || source === <span class="literal">null</span>) &amp;&amp; ev.data === <span class="string">'process-tick'</span>) &#123;</span><br><span class="line">                ev.stopPropagation();</span><br><span class="line">                <span class="keyword">if</span> (queue.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> fn = queue.shift();</span><br><span class="line">                    fn();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">            queue.push(fn);</span><br><span class="line">            <span class="built_in">window</span>.postMessage(<span class="string">'process-tick'</span>, <span class="string">'*'</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">nextTick</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">        setTimeout(fn, <span class="number">0</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>Here is some comments on the implementation.</p>
<h3 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout"></a>setTimeout</h3><p>To simulate the nextTick behavior, <code>setTimeout(fn, 0)</code> is a well-known and easy to adopt approach. The issue of this method is that <code>setTimeout</code> function does heavy operations, call it in loop causes significant performance issue. So we should try to use cheaper approach when possible.</p>
<h3 id="setImmidate"><a href="#setImmidate" class="headerlink" title="setImmidate"></a>setImmidate</h3><p>There is a function called <code>setImmediate</code>, which behaves quite similar to <code>nextTick</code> but with a few differences when dealing with IO stuff. But in browser environment, there is no IO issue, so we can definitely replace the <code>nextTick</code> with it.</p>
<blockquote><p>Immediates are queued in the order created, and are popped off the queue once per loop iteration. This is different from process.nextTick which will execute process.maxTickDepth queued callbacks per iteration. setImmediate will yield to the event loop after firing a queued callback to make sure I/O is not being starved. While order is preserved for execution, other I/O events may fire between any two scheduled immediate callbacks.</p>
<footer><strong>setImmediate(callback, [arg], [...])</strong><cite><a href="http://nodejs.org/api/timers.html#timers_setimmediate_callback_arg" target="_blank" rel="external">Node.js</a></cite></footer></blockquote>
<p>The <code>setImmediate</code> function is perfect replacement for <code>nextTick</code>, but it is not supported by all the browsers. Only <code>IE 10</code> and <code>Node.js 0.10.+</code> supports it. Chrome, Firefox, Opera and all mobile browsers don’t.</p>
<blockquote><p>Note: This method is not expected to become standard, and is only implemented by recent builds of Internet Explorer and Node.js 0.10+. It meets resistance both from Gecko (Firefox) and Webkit (Google/Apple).</p>
<footer><strong>window.setImmediate</strong><cite><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.setImmediate" target="_blank" rel="external">MDN</a></cite></footer></blockquote>
<h3 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage"></a>window.postMessage</h3><p><code>window.postMessage</code> enable developer to access message queue in the browser. By adding some additional code, we can simulate nextTick behavior based on message queue. It works in most modern browser, except <code>IE 8</code>. In <code>IE 8</code>, the API is implemented in a  synchronous way, which introduce an extra level of stack-push, so it cannot be used to simulate <code>nextTick</code>.</p>
<p>Overall, there is no perfect workaround to the <code>nextTick</code> issue for now. All the solutions have different limitations, we can only hope that this issue can be resolved in the future ECMAScript standard.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/06/23/process-nexttick-implementation-in-browser/" data-id="cimz4udtl0077nwsitm7r85qx" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/06/23/process-nexttick-implementation-in-browser/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/browser/">browser</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/infinite-recursion/">infinite recursion</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nexttick/">nextTick</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/" class="article-date">
  <time datetime="2014-06-20T00:00:00.000Z" itemprop="datePublished">2014-06-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/">Android Studio 0.6.1 SDK recognition issue when using Android SDK 19 and Gradle</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A few days ago I upgraded my Android Studio to version 0.6.1. And migrated my android project build system from Maven to Gradle. Then nightmare happened!</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/android_studio_version.png" alt="Android Studio Version" title="Android Studio Version">
<p>It looks there are some issue with Android Studio version 0.6.1, which cannot recognize the jar files in Android SDK 19 (4.4 Kit Kat). As a consequence that all the Android fundemantal classes are not recognized properly, which makes IDEA almost impossible to be used.</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/classes_not_recognized.png" alt="Classes Not Recognized" title="Classes Not Recognized">
<p>After spending days on googling and trying, I realize the issue is caused that Android Studio doesn’t recognize the sdk 19 content properly.</p>
<p>Here is the content of Android SDK 19 that Android Studio 0.6.1 identified:</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/sdk_in_android_studio.png" alt="SDK in Android Studio" title="SDK in Android Studio">
<p>As comparison, here is a list of proper content of Andrdoid SDK 19 with Google API:</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/sdk_in_idea.png" alt="SDK in IDEA" title="SDK in IDEA">
<p>Here is a list of proper content of Andrdoid SDK 19 retrived from Maven Repository:</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/maven_sdk_in_idea.png" alt="Maven SDK" title="Maven SDK">
<p>In the list, you can easily figure out that the <code>android.jar</code> file is missing! It is the reason why the classes are not properly recognized! Even more if you compare the list against the JDK 1.6, you will find that most of the content are the same.</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/jdk.png" alt="JDK" title="JDK">
<p>Ideally, to fix this issue should be quite easy. Android Studio provides a <code>Project Settings</code> dialog allow developer to adjust the SDK configurations.</p>
<p>Project Settings Dialog:</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/project_settings.png" alt="Project Settings" title="Project Settings">
<p>But for Gradle projects, Android Studio displays a greately simplified project settings dialog instead of the original one, which doesn’t allow developer to config the SDK in dialog any longer.</p>
<p>Gradle Project Settings Dialog:</p>
<img src="/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/gradle_project_settings.png" alt="Project Settings" title="Project Settings">
<p>Still now, I figured out several potentisal workarounds to this issue, hope these helps:</p>
<ol>
<li>Downgrade the SDK version from 19 to 18 fixes the issue.<br>If you not really needs SDK 19 features, try to downgrade the SDK version to 18 to fix the issue.</li>
<li>Use IntelliJ instead of Android Studio<br>I encounters a different issue when using IDEA, it fails to sync the Gradle file.</li>
<li>Use Maven or ANT instead of Gradle<br>Gradle is powerful, but there are too many environment issues when using with IDEs… Maven is relatively more stable.</li>
</ol>
<p>I haven’t figure out a perfect solution to this issue, just hope the Google can fix the issue as soon as possible.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/" data-id="cimz4udth0070nwsiwmutrzsy" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/06/20/android-studio-0-6-1-sdk-recognition-issue-when-using-android-sdk-19-and-gradle/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-studio/">android studio</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android-jar/">android.jar</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gradle/">gradle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jar/">jar</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sdk/">sdk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-is-android-api-document-on-consumerirmanager-lying" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/" class="article-date">
  <time datetime="2014-05-28T00:00:00.000Z" itemprop="datePublished">2014-05-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/">Is Android API document on ConsumerIrManager lying?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Just found a shocking fact that Android API document on <code>ConsumerIrManger.transmit</code> method is wrong!</p>
<p>KitKat has realised its own Infrared blaster API, which is incompatible with legacy Samsung private API. So I was working on <a href="https://github.com/timnew/AndroidInfrared" target="_blank" rel="external">Android Infrared Library</a> to make it adapted automatically on both Samsung private API and <code>Kit Kat</code>official API.</p>
<p>After I finished the coding according the document, I found the app broke on my Galaxy Note 3 with <code>Kit Kat</code>. It works perfect when running on <code>Jelly Bean</code>.</p>
<p>And I figured out an issue that it takes longer time to transmit the same seqeunce when I upgraded API. (When IR blaster is working, the LED indicator on the phone turns blue. And I found the time of indicator turning blue is significant longer than before.) And my <a href="https://github.com/timnew/IRRecorder" target="_blank" rel="external">IRRecorder</a> cannot recognize the sequence sent by my phone any longer.</p>
<p>After spent several hours, I figured out the reason. The pattern was encoded in a wrong way. But I’m pretty sure that I strictly followed the API document.</p>
<p>So I get a conculusion that <strong>the <code>ConsumerIrManager</code> implementation on Samsung Note 3 is different to what described in Android API document.</strong> However I’m not sure the reason is that the Android document is lying or Samsung implemented the driver in a wrong way.</p>
<p>Here is the technical details of the issue and its solution:</p>
<p>IR Command is trasmitted by turnning the IR blaster LED on and off for a certain period of time. So each IR command can be represented by a series of time periods, which indicates how long the led is on or off. The difference between Samsung API and Kit Kat APi is that how the time is mesured.</p>
<blockquote><p><strong>carrierFrequency</strong> The IR carrier frequency in Hertz.<br><strong>pattern</strong> The alternating on/off pattern in microseconds to transmit.</p>
<footer><strong>ConsumerIrManager.transmit(int carrierFrequency, int[] pattern)</strong><cite><a href="https://developer.android.com/reference/android/hardware/ConsumerIrManager.html#transmit(int,%20int[])" target="_blank" rel="external">Android Developer Reference</a></cite></footer></blockquote>
<p>According to the <a href="https://developer.android.com/reference/android/hardware/ConsumerIrManager.html#transmit(int,%20int[]" target="_blank" rel="external">Android Developer Refernece</a>), the time in KitKat is measured in the unit of microseconds.</p>
<p>But for Samsung, the time is mesured by the number of cycles. Take NEC encoding as example, the frequency is 38kHz. So the cycle time <code>T ~= 26us</code>. BIT_MARK is <code>21 cycles</code>, the period of time is around <code>26us x 21 ~= 546us</code>.</p>
<p>So ideally, regardless of lead-in and lead-out sequence, to send the code <code>0xA</code> in NEC encoding, Samsung API needs <code>21 60 21 21 21 60 21 21</code>; and Kit Kat API needs <code>560 1600 560 560 560 1600 560 560</code>.</p>
<p>But accroding to my experience, the Android Developer Reference is wrong. <strong>Even in KitKat, the time sequence is also measure by number of cycles instead of the number of microseconds!</strong></p>
<p>So to fix the issue, you need some mathmatical work. Here is the conversion formula:</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n = t / T = t * f / <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">n: <span class="keyword">the</span> <span class="built_in">number</span> <span class="keyword">of</span> cycles</span><br><span class="line">t: <span class="keyword">the</span> <span class="built_in">time</span> <span class="keyword">in</span> microseconds</span><br><span class="line">T: <span class="keyword">the</span> cycle <span class="built_in">time</span> <span class="keyword">in</span> microseconds</span><br><span class="line">f: <span class="keyword">the</span> transmitting frequency <span class="keyword">in</span> Hertz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/" data-id="cimz4udt8006ynwsie9c3lzer" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/05/28/is-android-api-document-on-consumerirmanager-lying/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/samsung/">Samsung</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/api/">api</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/document/">document</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/error/">error</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/infrared/">infrared</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kit-kat/">kit kat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/lying/">lying</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-use-jade-as-client-side-template-engine" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/05/26/use-jade-as-client-side-template-engine/" class="article-date">
  <time datetime="2014-05-26T00:00:00.000Z" itemprop="datePublished">2014-05-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/05/26/use-jade-as-client-side-template-engine/">Use Jade as client-side template engine</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://jade-lang.com/" target="_blank" rel="external">Jade</a> is a powerful JavaScript HTML template engine, which is concise and powerful. Due to its awesome syntax and powerful features, it almost become the default template engine for node.js web servers.</p>
<p>Jade is well known as a server-side HTML template, but actually it can also be used as a client-side template engine, which is barely known by people! To have a better understanding of this issue, firstly we should how Jade engine works.</p>
<p>When we’re translating a jade file into HTML, Jade engine actually does 2 separate tasks: <strong>Compiling</strong> and <strong>Rendering</strong>.</p>
<h3 id="Compiling"><a href="#Compiling" class="headerlink" title="Compiling"></a>Compiling</h3><p>Compiling is almost a transparent process when rendering jade files directly into HTML, including, rendering a jade file with <code>jade</code> cli tool. But it is actually the most important step while translating the jade template to HTML.<br>Compiling will be translate the jade file into a JavaScript function. During the process, all the static content has been translated.</p>
<p>Here is simple example:</p>
<figure class="highlight plain"><figcaption><span>Jade template</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html(lang=&quot;en&quot;)</span><br><span class="line">  head</span><br><span class="line">    title Title  </span><br><span class="line">  body</span><br><span class="line">    h1 Jade - node template engine</span><br><span class="line">    #container.col</span><br><span class="line">      p You are amazing</span><br><span class="line">      p.</span><br><span class="line">        Jade is a terse and simple</span><br><span class="line">        templating language with a</span><br><span class="line">        strong focus on performance</span><br><span class="line">        and powerful features.</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>Compiled template</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">template</span>(<span class="params">locals</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buf = [];</span><br><span class="line">    <span class="keyword">var</span> jade_mixins = &#123;&#125;;</span><br><span class="line">    buf.push(<span class="string">'&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;Title  &lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Jade - node template engine&lt;/h1&gt;&lt;div id="container"class="col"&gt;     &lt;p&gt;You are amazing&lt;/p&gt;&lt;p&gt;Jade is a terse and simple\ntemplating language with a\nstrong focus on performance\nand powerful features.&lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;'</span>);</span><br><span class="line">    <span class="keyword">return</span> buf.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As you can see, the template is translated into a JavaScript function, which contains all the HTML data. In this case, since we didn’t introduce any interpolation, so the HTML content has been fully generated.</p>
<p>The case will become more complicated when interpolation, <code>each</code>, <code>if</code> statement is introduced.</p>
<figure class="highlight plain"><figcaption><span>Jade template with interpolation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">doctype html</span><br><span class="line">html(lang=&quot;en&quot;)</span><br><span class="line">  head</span><br><span class="line">    title =title  </span><br><span class="line">  body</span><br><span class="line">    h1 Jade - node template engine</span><br><span class="line">    #container.col</span><br><span class="line">    ul</span><br><span class="line">      each item in items</span><br><span class="line">        li= item</span><br><span class="line"></span><br><span class="line">    if usingJade</span><br><span class="line">      p You are amazing</span><br><span class="line">    else</span><br><span class="line">      p Get it!</span><br><span class="line"></span><br><span class="line">    p.</span><br><span class="line">      Jade is a terse and simple</span><br><span class="line">      templating language with a</span><br><span class="line">      strong focus on performance</span><br><span class="line">      and powerful features.</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>Compiled template with interpolation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">template</span>(<span class="params">locals</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buf = [];</span><br><span class="line">    <span class="keyword">var</span> jade_mixins = &#123;&#125;;</span><br><span class="line">    <span class="keyword">var</span> locals_ = locals || &#123;&#125;, items = locals_.items, usingJade = locals_.usingJade;</span><br><span class="line">    buf.push(<span class="string">'&lt;!DOCTYPE html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;=title  &lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Jade - node template engine&lt;/h1&gt;&lt;div id="container"class="col"&gt;&lt;/div&gt;&lt;ul&gt;'</span>);</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $$obj = items;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"number"</span> == <span class="keyword">typeof</span> $$obj.length) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> $index = <span class="number">0</span>, $$l = $$obj.length; $index &lt; $$l; $index++) &#123;</span><br><span class="line">                <span class="keyword">var</span> item = $$obj[$index];</span><br><span class="line">                buf.push(<span class="string">"&lt;li&gt;"</span> + jade.escape(<span class="literal">null</span> == (jade.interp = item) ? <span class="string">""</span> : jade.interp) + <span class="string">"&lt;/li&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> $$l = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> $index <span class="keyword">in</span> $$obj) &#123;</span><br><span class="line">                $$l++;</span><br><span class="line">                <span class="keyword">var</span> item = $$obj[$index];</span><br><span class="line">                buf.push(<span class="string">"&lt;li&gt;"</span> + jade.escape(<span class="literal">null</span> == (jade.interp = item) ? <span class="string">""</span> : jade.interp) + <span class="string">"&lt;/li&gt;"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).call(<span class="keyword">this</span>);</span><br><span class="line">    buf.push(<span class="string">"&lt;/ul&gt;"</span>);</span><br><span class="line">    <span class="keyword">if</span> (usingJade) &#123;</span><br><span class="line">        buf.push(<span class="string">"&lt;p&gt;You are amazing&lt;/p&gt;"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        buf.push(<span class="string">"&lt;p&gt;Get it!&lt;/p&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    buf.push(<span class="string">"&lt;p&gt;Jade is a terse and simple\ntemplating language with a\nstrong focus on performance\nand powerful features.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</span><br><span class="line">    <span class="keyword">return</span> buf.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><figcaption><span>Data for interpolation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"title"</span>: <span class="string">"Jade Demo"</span>,</span><br><span class="line">  <span class="attr">"usingJade"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"items"</span>:[</span><br><span class="line">    <span class="string">"item1"</span>,</span><br><span class="line">    <span class="string">"item2"</span>,</span><br><span class="line">    <span class="string">"item3"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><figcaption><span>Output Html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>=title  <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Jade - node template engine<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"container"</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>item1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>item2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span>&gt;</span>item3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>You are amazing<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      Jade is a terse and simple</span><br><span class="line">      templating language with a</span><br><span class="line">      strong focus on performance</span><br><span class="line">      and powerful features.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Well, as you can see, the function has become quite complicated than before. It could become more complicated when <code>extend</code>, <code>include</code> or <code>mixin</code> introduced, you can trial it on your own.</p>
<h3 id="Rendering"><a href="#Rendering" class="headerlink" title="Rendering"></a>Rendering</h3><p>After the compiling, the rendering process is quite simple. Just invoking the compiled function, the return string is rendered html. The only thing need to mentioned here is the interpolation data should be passed to the template function as <code>locals</code>.</p>
<h3 id="Using-Jade-as-front-end-template-engine"><a href="#Using-Jade-as-front-end-template-engine" class="headerlink" title="Using Jade as front-end template engine"></a>Using Jade as front-end template engine</h3><p>Still now, you probably have got my idea. To use jade a front-end template, we can compose the template in jade. Later compile it into JavaScript file. And then we can invoke the JavaScript function in front-end to achieve dynamic client-side rendering!</p>
<p>Since Jade template has been precompiled at server side, so there is very little runtime effort when rendering the template at client-side. So it is a cheaper solution when you have lots of templates.</p>
<p>To compile the jade files into JavaScript instead of HTML, you need to pass <code>-c</code> or <code>--client</code> option to <code>jade</code> cli tool. Or calling <code>jade.compile</code> instead of <code>jade.render</code> while using JavaScript API.</p>
<h3 id="Configure-Grunt"><a href="#Configure-Grunt" class="headerlink" title="Configure Grunt"></a>Configure Grunt</h3><p>Well, since <a href="http://gruntjs.com/" target="_blank" rel="external">Grunt</a> is popular in node.js world. So we can also use Grunt to do the stuff for us.<br>Basically, use grunt for jade is straightforward. But it is a little bit tricky when you want to compile the back-end template into HTML as well as to compile the front-end template into JavaScripts.</p>
<p>I used a little trick to solve the issue. I follow the convention in Rails, that prefix the front-end template files with underscore.<br>So</p>
<figure class="highlight mizar"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/layouts/default.jade       -&gt; Layout file, extended <span class="keyword">by</span> back-<span class="keyword">end</span>/front-<span class="keyword">end</span> templates, should <span class="keyword">not</span> <span class="keyword">be</span> compiled.</span><br><span class="line">/views/settings/index.jade  -&gt; Back-<span class="keyword">end</span> template, should <span class="keyword">be</span> compiled into HTML</span><br><span class="line">/views/settings/_item.jade  -&gt; Front-<span class="keyword">end</span> template, should <span class="keyword">be</span> compiled into JavaScript</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><figcaption><span>Gruntfile.coffee</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">(grunt)</span> -&gt;</span></span><br><span class="line">  grunt.initConfig</span><br><span class="line">    pkg: grunt.file.readJSON(<span class="string">'package.json'</span>)</span><br><span class="line"></span><br><span class="line">    jade:</span><br><span class="line">      options:</span><br><span class="line">        pretty: <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      compile:</span><br><span class="line">        expand: <span class="literal">true</span></span><br><span class="line">        cwd: <span class="string">'views'</span></span><br><span class="line">        src: [<span class="string">'**/*.jade'</span>, <span class="string">'!**/_*.jade'</span>]</span><br><span class="line">        dest: <span class="string">'build/'</span></span><br><span class="line">        ext: <span class="string">'.html'</span></span><br><span class="line"></span><br><span class="line">      template:</span><br><span class="line">        options:</span><br><span class="line">          client: <span class="literal">true</span></span><br><span class="line">          namespace: <span class="string">'Templates'</span></span><br><span class="line"></span><br><span class="line">        expand: <span class="literal">true</span></span><br><span class="line">        cwd: <span class="string">'views'</span></span><br><span class="line">        src: [<span class="string">'**/_*.jade'</span>]</span><br><span class="line">        dest: <span class="string">'build/'</span></span><br><span class="line">        ext: <span class="string">'.js'</span></span><br><span class="line"></span><br><span class="line">  grunt.loadNpmTasks(<span class="string">'grunt-contrib-jade'</span>)  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>I distinguish the layouts and templates by file path. And distinguish the front-end/back-end templates by prefix. The filter <code>!**/_*.jade</code> excludes the front-end templates when compiling the back-end templates.</p>
<p>This approach should work fine in most cases, but if you are facing more complicated situation, and can’t be handled with this trick, try defining your own convention, and recognizing it with custom filter function to categorize them.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/05/26/use-jade-as-client-side-template-engine/" data-id="cimz4udt4006snwsianmg7zux" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2014/05/26/use-jade-as-client-side-template-engine/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/client-side/">client side</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/front-end/">front-end</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/grunt/">grunt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jade/">jade</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pre-compile/">pre-compile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/template-engine/">template engine</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/archives/2014/blog/2/">&laquo; __('prev')</a><a class="page-number" href="/archives/2014/">1</a><a class="page-number" href="/archives/2014/blog/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/archives/2014/blog/4/">4</a><a class="extend next" rel="next" href="/archives/2014/blog/4/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Recent Posts</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/05/awesome-geek-game-untrusted-the-continuing-adventures-of-dr-eval/">Awesome geek game Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Tag Cloud</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a> <a href="/tags/eventbus/" style="font-size: 10px;">EventBus</a> <a href="/tags/fp/" style="font-size: 10px;">FP</a> <a href="/tags/fswatcher/" style="font-size: 10px;">FSWatcher</a> <a href="/tags/gb2312/" style="font-size: 10px;">GB2312</a> <a href="/tags/gbk/" style="font-size: 10px;">GBK</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Categories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">72</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>