<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2013 | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/archives/2013/blog/2/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');

  ga('require', 'displayfeatures');

ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-script-to-manage-tw-t-e" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/06/20/script-to-manage-tw-t-e/" class="article-date">
  <time datetime="2013-06-20T00:00:00.000Z" itemprop="datePublished">2013-06-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/06/20/script-to-manage-tw-t-e/">Script to manage TW T&amp;E</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Have been on travel once again, and really found filling the ThoughtWorks T&amp;E expense form is really painful.</p>
<p>So I spent some time to refine the scripts that wrote last year when I was on Travel, which could be stimulate the pain when filing the form.</p>
<p>Post and managed as <a href="http://goo.gl/nG4Vm" target="_blank" rel="external">Gist</a></p>
<script src="//gist.github.com/5823705.js"></script>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/06/20/script-to-manage-tw-t-e/" data-id="ciqg4g83k004x6nsipi79qatw" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/06/20/script-to-manage-tw-t-e/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/expense/">expense</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/injection/">injection</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/time-sheet/">time sheet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/utility/">utility</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-node-over-express-autoload" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/27/node-over-express-autoload/" class="article-date">
  <time datetime="2013-04-27T00:00:00.000Z" itemprop="datePublished">2013-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/27/node-over-express-autoload/">Node over Express - Autoload</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>This is the 2nd post of the <a href="/blog/tags/#node over express-ref">Node over Express</a> series (the previous one is <a href="/blog/2013/04/25/node-over-express-configuration/">Configuration</a>). In this post, I’d like to discuss a famous pain point in Node.js.</p>
<h2 id="Pain-Point"><a href="#Pain-Point" class="headerlink" title="Pain Point"></a>Pain Point</h2><p>There is well known Lisp joke:</p>
<blockquote><p>A top hacker successfully stole the last 100 lines of a top secret program from the Pentagon. Because the program is written in Lisp, so the stolen code is just close brackets.</p>
</blockquote>
<p>It is a joke that there are too many brackets in Lisp. In Node.js there is a similar issue that there are too many <code>require</code>. Open any node.js file, usually one could find several lines of <code>require</code>.</p>
<p>Due to the node’s sandbox model, the developer has to require resources time and time again in every files. It is not so exciting to write or read lines of meaningless <code>require</code>. And the worst, it could be a nightmare once a developer wishes to replace some library with another.</p>
<h2 id="Rails-Approaches"><a href="#Rails-Approaches" class="headerlink" title="Rails Approaches"></a>Rails Approaches</h2><p>“Require hell” isn’t only for node.js, but also for Ruby apps. Rails has solved it gracefully, and the developer barely needs to require anything manually in Rails.</p>
<p>There are 2 kinds of dependencies in rails app, one is the external resource, another is the internal resource.</p>
<h3 id="External-Resources"><a href="#External-Resources" class="headerlink" title="External Resources"></a>External Resources</h3><p>External resources are classes encapsulated in ruby gems. In ruby application, developer describe the dependencies in <code>Gemfile</code>, and load them with <code>Bundler</code>. Some frameworks have already integrated with <code>Bundler</code>, such as Rails. When using them, developer doesn’t need to do anything manually, all the dependencies are required automatically. For others, use <code>bundle execute</code> to create the ruby runtime with all gems required.</p>
<h3 id="Internal-Resources"><a href="#Internal-Resources" class="headerlink" title="Internal Resources"></a>Internal Resources</h3><p>Internal Resources are the classes declared in the app, they could be models, the services or the controllers. Rails uses <code>Railtie</code> to require them automatically. The resource is loaded the first time it is used, the requiring process is “Lazy”. (In fact, this description isn’t that precise because Rails behaves differently in production environment. It loads all the classes during the launching for performance reason).</p>
<h2 id="Autoload-in-Node-js"><a href="#Autoload-in-Node-js" class="headerlink" title="Autoload in Node.js"></a>Autoload in Node.js</h2><p>Rails avoids the “require-hell” with two “autoload” mechanisms. Although there are still debates about whether autoload is good or not. But at least, autoload frees the developer from the dull dependency management and increases the productivity of developers. Developers love autoload in most cases.</p>
<p>So to avoid “require-hell” in Node.js, I prefers autoload mechanism. But because there are significant differences in type system between Node.js and Ruby, we cannot copy the mechanism from ruby to node as is. Therefore before diving into the solution, we need to understand the differences first.</p>
<h3 id="Node-js-Module-System"><a href="#Node-js-Module-System" class="headerlink" title="Node.js Module System"></a>Node.js Module System</h3><p>There are a number of similarities between Node.js and ruby; things in node.js usually have the equivalences in ruby. For example, <code>package</code> in node is similar to the <code>gem</code> in Ruby, <code>npm</code> equals to <code>Gem</code> and <code>Bundler</code>, <code>package.json</code> takes the responsibility of <code>Gemfile</code> and <code>Gemfile.lock</code>. The similarity enables porting autoload from ruby to node.</p>
<p>In some aspect, there are similarities between Node.js and Ruby, but there are also significant differences between them in some other aspects. One of the major differences is the type system and module sandbox in Node.js, which works in a quite different way to Ruby type system.</p>
<p>JavaScript isn’t a real OO language, so it doesn’t have real type system. All the types in JavaScript are actually functions, which are stored in local variables instead of in type system. Node.js loads files into different sandboxes, all the local variables are isolated between files to avoid “global leak”, a well-known deep-seated bad part of JavaScript. As a result, a Node.js developer needs to require used types again and again in every file.</p>
<p>In ruby, it is a lot better. With the help of the well designed type system, types are shared all over the runtime, a developer just needs to require the types not yet loaded.</p>
<p>So in node.js programs, there are many more <code>require</code> statements than in ruby. And due to the design of node.js and javascript, the issue is harder to be resolved.</p>
<h3 id="Global-Variable"><a href="#Global-Variable" class="headerlink" title="Global Variable"></a>Global Variable</h3><p>In the browser, the JavaScript runtime other than node, global variables are very common. Global variable could be abused easily, which brings global leak to bad written JavaScript programs, and drives thousands of developers up to the wall. The JavaScript developers are scared of global leak so much so that they designed such a strict isolation model in node.js. But to my understanding, the isolation avoided global leaks effectively. But at the same time, it brought tens of require statements to every files, which is also not acceptable.</p>
<p>In fact, with the help of JSLint, CoffeScript and some other tools, developers can avoid global leak easily. And global sharing isn’t the source of evil. If abuse is avoided, I believes a reasonable level of global sharing could be useful and helpful. Actually Node.js have built-in a global sharing mechanism.</p>
<p>To share values across file, a special variable <code>global</code> is needed, which could be accessed in every file, and the value of which is also shared across files.</p>
<p>Besides sharing value around, <code>global</code> has another important feature: node treats <code>global</code> as default context, whose child you can refer to without explicitly identifying. So <code>SomeType === global.SomeType</code>.</p>
<p>With the help of <code>global</code>, we find a way to share types across files naturally.</p>
<h3 id="JS-Property"><a href="#JS-Property" class="headerlink" title="JS Property"></a>JS Property</h3><p>Rails’ autoload mechanism loads the classes lazily. It only loads the class when it is used for first time. It is a neat feature, and Rails achieve it by tracking the exception of “Uninitialized Constant”. To implement similar feature in Node.js, tracking exception is hardly feasible, so I choose a different approach, I use Property.</p>
<p>Property (Attribute in Ruby) enables method (function) being invoked as the field of an object is accessed. Property is a common feature among OO languages, but is a “new” feature to JavaScript. Property is a feature declared in <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" target="_blank" rel="external">ECMAScript 5 standard</a>, which enables the developers to declare property on object by using the API <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="external">Object.defineProperty</a>. With the property, we’re able to hook the callback on the type variables, and require the types when the type is accessed. So the module won’t be required until it is used. On the other hand, node.js <code>require</code> function has built in the cache mechanism; it won’t load the file twice, instead it return the value from its cache.</p>
<p>With property, we make the autoload lazy!</p>
<h3 id="My-Implementation"><a href="#My-Implementation" class="headerlink" title="My Implementation"></a>My Implementation</h3><p>To make autoload work, we need to create a magic host object to hold the type variables. In my implementation, I call the magic object Autoloader<br>we need to require a bootstrap script when the app starts, which is used to describe which types and how they should be required.</p>
<figure class="highlight coffeescript"><figcaption><span>Bootstrap Script: initEnvironment.coffee</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">global</span>.createAutoLoader = <span class="built_in">require</span>(<span class="string">'./services/AutoLoader'</span>)</div><div class="line"><span class="built_in">global</span>.createPathHelper = <span class="built_in">require</span>(<span class="string">'./services/PathHelper'</span>)</div><div class="line"></div><div class="line"><span class="built_in">global</span>.rootPath = createPathHelper(__dirname, <span class="literal">true</span>)</div><div class="line"></div><div class="line"><span class="built_in">global</span>.Configuration = <span class="built_in">require</span>(rootPath.config(<span class="string">'configuration'</span>))</div><div class="line"></div><div class="line"><span class="built_in">global</span>.Services = createAutoLoader rootPath.services()</div><div class="line"><span class="built_in">global</span>.Routes = createAutoLoader rootPath.routes()</div><div class="line"><span class="built_in">global</span>.Records = createAutoLoader rootPath.records()</div><div class="line"><span class="built_in">global</span>.Models = createAutoLoader rootPath.models()</div><div class="line"></div><div class="line"><span class="built_in">global</span>.assets = &#123;&#125; <span class="comment"># initialize this context for connect-assets helpers</span></div></pre></td></tr></table></figure>
<p>The script sets-up the autoload hosts for all services, routes, records, models for my app. And we can reference the types as following:</p>
<figure class="highlight coffeescript"><figcaption><span>Sample Usage</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Records.User.findById uid, <span class="function"><span class="params">(err, user)</span> -&gt;</span></div><div class="line">  badge = <span class="keyword">new</span> Models.Badget(badgeInfo)</div><div class="line">  user.addBadge badge</div><div class="line">  user.save()</div></pre></td></tr></table></figure>
<p>In the <code>initEnvironment.coffee</code> script, there are 2 very important classes that are used:</p>
<ul>
<li>AutoLoader: The class that works as the type variable hosts. All the magic happens here.</li>
<li>PathHelper: The class used to handle the path combination issue.</li>
</ul>
<p>The detailed implementation is here:<br><figure class="highlight coffeescript"><figcaption><span>Autoload</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">_ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line">createPathHelper = <span class="built_in">require</span>(<span class="string">'./PathHelper'</span>)</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">createLoaderMethod</span> = <span class="params">(host, name, fullName)</span> -&gt;</div><div class="line">  host.__names.push name</div><div class="line">  Object.defineProperty host, name,</div><div class="line">                        get: <span class="function">-&gt;</span></div><div class="line">                          <span class="built_in">require</span>(fullName)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoLoader</span></span></div><div class="line">  constructor: <span class="function"><span class="params">(source)</span> -&gt;</span></div><div class="line">    @__names = []</div><div class="line">    <span class="keyword">for</span> name, fullName <span class="keyword">of</span> source</div><div class="line">      extName = path.extname fullName</div><div class="line">      createLoaderMethod(<span class="keyword">this</span>, name, fullName) <span class="keyword">if</span> <span class="built_in">require</span>.extensions[extName]? <span class="keyword">or</span> extName == <span class="string">''</span></div><div class="line"><span class="function"></span></div><div class="line"><span class="title">expandPath</span> = <span class="params">(rootPath)</span> -&gt;</div><div class="line">  createPathHelper(rootPath).toPathObject()</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">buildSource</span> = <span class="params">(items)</span> -&gt;</div><div class="line">  result = &#123;&#125;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> item <span class="keyword">in</span> items</div><div class="line">    extName = path.extname(item)</div><div class="line">    name = path.basename(item, extName)</div><div class="line">    result[name] = item</div><div class="line"></div><div class="line">  result</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">createAutoLoader</span> = <span class="params">(option)</span> -&gt;</div><div class="line">  pathObj = <span class="keyword">switch</span> <span class="keyword">typeof</span>(option)</div><div class="line">    <span class="keyword">when</span> <span class="string">'string'</span></div><div class="line">      expandPath(option)</div><div class="line">    <span class="keyword">when</span> <span class="string">'object'</span></div><div class="line">      <span class="keyword">if</span> option <span class="keyword">instanceof</span> Array</div><div class="line">        buildSource(option)</div><div class="line">      <span class="keyword">else</span></div><div class="line">        option</div><div class="line"></div><div class="line">  <span class="keyword">new</span> AutoLoader(pathObj)</div><div class="line"></div><div class="line">createAutoLoader.AutoLoader = AutoLoader</div><div class="line"></div><div class="line">exports = <span class="built_in">module</span>.exports = createAutoLoader</div></pre></td></tr></table></figure></p>
<figure class="highlight coffeescript"><figcaption><span>PathHelper</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">_ = <span class="built_in">require</span>(<span class="string">'lodash'</span>)</div><div class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line">path = <span class="built_in">require</span>(<span class="string">'path'</span>)</div><div class="line"><span class="function"></span></div><div class="line"><span class="title">createPathHelper</span> = <span class="params">(rootPath, isConsolidated)</span> -&gt;</div><div class="line">  rootPath = path.normalize rootPath</div><div class="line"><span class="function">  <span class="title">result</span> = <span class="params">(args...)</span> -&gt;</span></div><div class="line">    <span class="keyword">return</span> rootPath <span class="keyword">if</span> args.length == <span class="number">0</span></div><div class="line">    parts = _.flatten [rootPath, args]</div><div class="line">    path.join.apply(<span class="keyword">this</span>, parts)</div><div class="line"></div><div class="line">  result.toPathObject = <span class="function">-&gt;</span></div><div class="line">    self = result()</div><div class="line">    files = fs.readdirSync(self)</div><div class="line">    pathObj = &#123;&#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> files</div><div class="line">      fullName = path.join(self, file)</div><div class="line">      extName =  path.extname(file)</div><div class="line">      name = path.basename(file, extName)</div><div class="line">      pathObj[name] = fullName</div><div class="line"></div><div class="line">    pathObj</div><div class="line"></div><div class="line">  result.consolidate = <span class="function">-&gt;</span></div><div class="line">    pathObj = result.toPathObject()</div><div class="line"></div><div class="line">    <span class="keyword">for</span> name, fullName <span class="keyword">of</span> pathObj</div><div class="line">      stats = fs.statSync(fullName)</div><div class="line">      result[name] = createPathHelper(fullName) <span class="keyword">if</span> stats.isDirectory()</div><div class="line"></div><div class="line">    result</div><div class="line"></div><div class="line">  <span class="keyword">if</span> isConsolidated</div><div class="line">    result.consolidate()</div><div class="line">  <span class="keyword">else</span></div><div class="line">    result</div><div class="line"></div><div class="line">exports = <span class="built_in">module</span>.exports = createPathHelper</div></pre></td></tr></table></figure>
<p>The code above are part of the <a href="https://github.com/timnew/ExpressOverNode" target="_blank" rel="external">Express over Node</a>, to access the complete codebase, please check out the <a href="https://github.com/timnew/ExpressOverNode" target="_blank" rel="external">repo</a> on github.</p>
<hr>

<p>Besides of the content, I want to say thank you to my English teacher Marina Sarg, who helped me on this series of blog a lot. Without her, there won’t be this series of blogs. Marina, thank you very much.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/27/node-over-express-autoload/" data-id="ciqg4g83s005j6nsioj03f5i4" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/04/27/node-over-express-autoload/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/autoload/">autoload</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/express/">express</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-over-express/">node over express</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-node-over-express-configuration" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/25/node-over-express-configuration/" class="article-date">
  <time datetime="2013-04-25T00:00:00.000Z" itemprop="datePublished">2013-04-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/25/node-over-express-configuration/">Node over Express - Configuration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>I have been working on Node.js related projects for quite a while, and have built apps with node both for the clients or personal projects, such as <a href="https://live-hall.herokuapp.com" target="_blank" rel="external">LiveHall</a>, <a href="https://github.com/timnew/CiMonitor" target="_blank" rel="external">CiMonitor</a>, etc. I have promised some one to share my experience on node. Today I’ll begin to work on this. This will be the first blog of the series.</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>In this blog, I would like to talk about the configuration in node, which is common problem we need to solve in apps.</p>
<p>Problems related to configuration aren’t new, and there have been a dozens of mature solutions, but for Node.js apps, there is still something worth to be discussed.</p>
<p>Perhaps configuration could be treated as a kind of special data. Usually developers prefer to use data language to describe their configurations. Here are some examples:</p>
<ul>
<li>.net and Java developer usually uses Xml to describe their configuration</li>
<li>Ruby developer prefers Yaml as the configuration language</li>
<li>JavaScript developer tend to use Json</li>
</ul>
<p>Data languages are convenient, because developers can easily build DSL on it, then they describe the configuration with the DSL. But is the data language the best option available? Is it really suitable to be used in all scnearios?</p>
<p>Before we answer the questions, I would like to say something about the problem we’re facing. There is one common requirement to all kinds of configuration solutions, which is default values and overriding.</p>
<p>For example, as a Web app default, we use port 80; but in development environment, we prefer to use a port number over 1024, 3000 is a popular choice. That means we need to provide 80 as the default value of the port, but we wish to override the value with 3000 in the development environment.</p>
<p>For the languages I mentioned above, except for Yaml, Xml and Json, doesn’t provide native support of inheritance and overriding. It means we need to implement the mechanism by our own. Take Json as example, we might write the configuration in this way:</p>
<figure class="highlight json"><figcaption><span>Sample Json configuration</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"default"</span>: &#123;</div><div class="line">    <span class="attr">"port"</span>: <span class="number">80</span>,</div><div class="line">    <span class="attr">"serveAssets"</span>: <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"development"</span>: &#123;</div><div class="line">    <span class="attr">"port"</span>: <span class="number">3000</span>,</div><div class="line">    <span class="attr">"database"</span>: <span class="string">"mongodb://localhost/development"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"test"</span>: &#123;</div><div class="line">    <span class="attr">"database"</span>: <span class="string">"mongodb://localhost/test"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"production"</span>: &#123;</div><div class="line">    <span class="attr">"serveAssets"</span>: <span class="literal">false</span>,</div><div class="line">    <span class="attr">"database"</span>: <span class="string">"mongodb://ds0123456.mongolab.com:43487/my_sample_app"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The previous Json snippet is a typical example of web app configuration; it has a default section to provide the default values for all environments. Three sections for specific environments. To apply it corecctly to our app, we need to load and parse the Json file to get all data first, then load the values of the default section, then override the value with the values from specific environment.  In addition, we might wish to have the validation that yields error when the provided environment doesn’t exist.</p>
<p>This solution looks simple and seems to work, but when you try to apply this approach to your app in real life, you need to watch out some pitfalls.</p>
<h2 id="Issue-1-Confidential-Values"><a href="#Issue-1-Confidential-Values" class="headerlink" title="Issue 1: Confidential Values"></a>Issue 1: Confidential Values</h2><p>In the real world, values in configuration sometimes could be sensitive and need to be kept confidential. It could contain the credential to access your database, Or it could contain the key to decrypt the cookies. It may also contain private certificate that identifies and authenticates the app to other services. In these scenarios, you need to protect your configuration in order to avoid big trouble!</p>
<p>To solve the issue, you might think about adding new feature that enable you to to encrypt confidential values or to load it from a different safe source.  To achieve it, you might need to add another layer of DSL which add more complexities to your app and make your code harder to debug or to maintain.</p>
<h2 id="Issue-2-Dynamic-Data"><a href="#Issue-2-Dynamic-Data" class="headerlink" title="Issue 2: Dynamic Data"></a>Issue 2: Dynamic Data</h2><p>A solution to first issue,  one could store the environment related but sensitive data in the environment variables. The solution is simple and works perfectly, so I highly recommend it. However, to do this means you need the capability to load the value not only from Json directly but also from the environment variables.</p>
<p>Sometimes, such as deploying your app to Heroku/Nojitsu, might give rise that make the case trickier. After deployed the app to Heroku/Nojitsu, the default values are provided in Json directly, and some of which need to be overrode with the values from environment variables or you need to do it vice versa. These tricky requirements might blow your mind and your code away easily. It causes complicated DSL design and hundreds lines of implementation, but just to load your configuration properly. Obviously it is not a good idea.</p>
<h2 id="Issue-3-Complicated-Inheritance-Relationship"><a href="#Issue-3-Complicated-Inheritance-Relationship" class="headerlink" title="Issue 3: Complicated Inheritance Relationship"></a>Issue 3: Complicated Inheritance Relationship</h2><p>Scared about above cases? No, then how about complicated inheritance relationship between environments?</p>
<p>In some big and complicated web apps, there might be more than 3 basic environments, such as:</p>
<ul>
<li>Development: for developers to develop the app locally</li>
<li>Test: for developers to run unit or function test locally, such as mocha tests</li>
<li>Regression: for developers or QAs to run regression tests, such as cucumber tests</li>
<li>Integration: for QAs or Ops to test the integration with other apps</li>
<li>Staging: for ops and QAs to test the app in production like environment before it really goes live</li>
<li>Production: the environment serves your real users</li>
<li>…</li>
</ul>
<p>When try to write configurations for these environments, one might find there are only a few differences between environments. To make life easier,  to avoid the redundancy, introducing the inheritance between configurations might be a good idea.</p>
<p>As the consequence, the whole configuration becomes environments with complex inheritance relationship. And to support this kind of configuration inheritance,  a more complex DSL and hundreds lines of codes are needed.</p>
<h2 id="Some-Comments"><a href="#Some-Comments" class="headerlink" title="Some Comments"></a>Some Comments</h2><p>My assumption above seems to be a little too complex.  From some people, it might be the “WORST CASE SCENERIO” and hard to come by. But according to my experience, it is very common when building real web app with node. So if to solve it isn’t too hard, it could be better to consider it seriously and solve it gracefully.</p>
<p>Ruby developer might think they’re lucky because Yaml supports inheritance natively. But confidential data and dynamic data still troubles.  </p>
<h2 id="My-Solution"><a href="#My-Solution" class="headerlink" title="My Solution"></a>My Solution</h2><p>After learnt a number of painful lessons, I figured out a simple but working solution: Configuration as Code - describe the configuration with the same language that the business logic is described!</p>
<p>Configuration as code isn’t a new concept, but it is extremely handy when you use it in node applications! Let me explain why and how it works:</p>
<p>To protect the confidential configuration values, one should store them with environment variables, which are only accessible in the specific server.<br>Then one can load these values from the environment variables as dynamically values.</p>
<p>To do it in a data language such as Xml, Json or Yaml could be hard, but it will become as easy as taking a candy from a baby if it is done in the programming language that application applied/used, such as ruby or javascript.</p>
<p>To the configuration inheritance, OO languages have already provided very handy inheritance mechanism. Why do we need to invent one? Why not just use it? To the value overriding, OO programming tells us that it is called polymorphism. The only difference here from the typical scenario is that we override the values instead of the behaviors. But it isn’t an issue, because the value could be the result of the behavior, right?</p>
<p>Now I assume that everyone got a pretty good idea of what I am saying. If that is the case, then the below code should be able to be understood quite clearly,  which is a standard Node.js file written in <code>coffee script</code>:</p>
<figure class="highlight coffeescript"><figcaption><span>Configuration as Code Example</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ? <span class="string">'development'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span></div><div class="line">  port: <span class="number">80</span></div><div class="line">  cookieSecret: <span class="string">'!J@IOH$!BFBEI#KLjfelajf792fjdksi23989HKHD&amp;&amp;#^@'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">development</span> <span class="keyword">extends</span> <span class="title">Config</span></span></div><div class="line">  port: <span class="number">3009</span></div><div class="line">  redis:</div><div class="line">    uri: <span class="string">'redis://localhost:6379'</span></div><div class="line">  mongo:</div><div class="line">    uri: <span class="string">'mongodb://localhost'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">test</span> <span class="keyword">extends</span> <span class="title">Config</span>.<span class="title">development</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">heroku</span> <span class="keyword">extends</span> <span class="title">Config</span></span></div><div class="line">  cookieSecret: process.env.COOKIE_SECRET</div><div class="line">  redis:</div><div class="line">    uri: process.env.REDISCLOUD_URL</div><div class="line">  mongo:</div><div class="line">    uri: process.env.MONGOLAB_URI</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> Config[process.env.NODE_ENV]()</div></pre></td></tr></table></figure>
<p>See, with the approach, one can describe the configuration easily and clearly in a few lines of code, but with built-in loading dynamical values capability and configuration inheritance and overriding capability.</p>
<p>In fact, with my suggestions, it might work better than expected! Here are the additional free benefits:</p>
<ol>
<li>Only one configuration is needed when  the app deployed to the cloud. Because all the host specific configurations are usually provided via the environment variables in Paas.</li>
<li>Have some simple and straightforward logic in the configuration, which could be very useful, especially if there is some naming convention in the configuration. But complicated or tricky logic should be strictly avoided, because it is hurts the readability and maintainability.</li>
<li>Easy to write tests for configurations, to ensure the values are properly set. It could be very handy when there are complicated inheritance relationships between configurations, or have some simple logic in your configuration.</li>
<li>Avoid to instantiate and execute the code that isn’t related to the current environment, which could be helpful to avoid overhead to instantiate unused expensive resources or to avoid errors caused because of incompatibility between environments.</li>
<li>Get runtime error when the configuration for the environment doesn’t exist.</li>
</ol>
<hr>

<p>Besides of the content, I want to say thank you to my English teacher Marina Sarg, who helped me on this series of blog a lot. Without her, there won’t be this series of blogs. Marina, thank you very much.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/25/node-over-express-configuration/" data-id="ciqg4g83m00556nsieui8fr5d" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/04/25/node-over-express-configuration/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/configuration/">configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/express/">express</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-over-express/">node over express</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mac-os-x-case-insensitive-file-system-pitfall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/" class="article-date">
  <time datetime="2013-04-18T00:00:00.000Z" itemprop="datePublished">2013-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/git/">git</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/">Mac OS X case-insensitive file system pitfall</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I was working on the YouTube video playback feature for <a href="http://live-hall.herokuapp.com" target="_blank" rel="external">LiveHall</a> last night, and have it works successfully on my local devbox, which is running Mac OS X. Then I deployed the code to Heroku, without any regression.</p>
<p>But today morning, when I have the demonstrate the new features, I met server error! It says 1 of the 4 javascripts are missing, so the Jade template failed to render.</p>
<p>This is a very wield issue, then I try the same data on my local dev box once again, and it works perfect! But it does yield error on the production!   Then I tried to use heroku toolbelt to run ls command on the production, and I found the there are 4 coffee scripts there.<br>Then I tried to enforce heroku to redeploy the app by using <code>git push --force</code>, but the issue remains!<br>Then I even tried to dive into the dependency pacakges <code>connect-assets</code> and <code>snockets</code>, but still found nothing useful.</p>
<p>Same code, same data, but different result! Very odd issue!</p>
<p>After half an hour fighting against the code, I suddenly noticed I the file name is <code>RevealJSPresenter.coffee</code>, whose “S” is capital S! And I reference the file with name <code>#= require ./presenter/RevealJsPresenter</code>, whose ‘s’ is a lowercase ‘s’!</p>
<p>And <code>snockets</code> depends on the OS feature to locate the file. On my local dev environment, I’m using Mac. Although OS X allow user to explicitly format the HFS+ into file name case sensitive mode, but it is case insensitive by default. So snockets can locate the file even the case is wrong.<br>But once I have deployed to heroku, which, I assume, runs Linux, whose file system is absolutely filename case sensitive. So the snockets won’t be able to locate the file due to the case issue.</p>
<p>To resolve the bug, I renamed my file in RubyMine, then try to commit in terminal.<br>But when I commit, I met another very interesting issue, that git says there is no file changed, so it refused to commit.<br>It is still the same issue, due to FS is case insensitive, git cannot detect the renaming.  </p>
<p>This problem is more common when coding on Windows, but CI or production runs on Linux. And the very common solution is to pull the code in case sensitive environment, then rename the file and commit it.</p>
<p>But I found another more easier way to do it:</p>
<p>Using <code>git mv</code> in terminal to rename the file, which will enforce git to track the file renaming action.</p>
<p>Or</p>
<p>Most of Git GUIs are able to track file name case changing, so you can try to commit the change with the tool, such as RubyMine or SourceTree.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/" data-id="ciqg4g83i004p6nsip5kok8in" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mac/">Mac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asset/">asset</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asset-pipeline/">asset pipeline</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/case-insensitive/">case insensitive</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/connect-assets/">connect-assets</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/file-name/">file name</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/file-system/">file system</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/snockets/">snockets</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-in-matching-line-head-and-line-end-in-regexp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/" class="article-date">
  <time datetime="2013-04-10T00:00:00.000Z" itemprop="datePublished">2013-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/regular-expression/">Regular Expression</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/">Pitfall in matching line head and line end in regexp</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I usually uses <code>\^\</code> and <code>\$\</code> to verify user input, e.g:<br>I uses following regexp to verify whether a user input is valid gmail email address:</p>
<figure class="highlight css"><figcaption><span>Matching Gmail</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">^<span class="selector-attr">[a-zA-Z_\.]</span>+@<span class="keyword">gmail</span>.<span class="keyword">com</span>$</div></pre></td></tr></table></figure>
<p>But in fact it is potentially vulnerable!<br>According to the RegExp document, <code>^</code> and <code>$</code> is matching to <strong>line head</strong> and <strong>line end</strong>!<br>So I might rush into pitfall when user try to fool me with following input:<br><figure class="highlight lsl"><figcaption><span>bad input</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="string">"hacker@gmail.com<span class="subst">\n</span>&amp;lt;script&amp;gt;alert('bang!')&amp;lt;/script&amp;gt;"</span></div></pre></td></tr></table></figure></p>
<p>Since there is a <code>\n</code> in the string, so <code>$</code> won’t really match to the end of the string but actually matched to the <code>\n</code>, then the whole string become a valid input, but actually it isn’t!</p>
<p>To avoid such issue, we should stick to <code>\A</code> and <code>\z</code>, which is literally means the <strong>the beginning of the string</strong> and <strong>end of the string</strong>!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/" data-id="ciqg4g83h004n6nsitih60nrv" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/line-end/">line end</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/line-head/">line head</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regex/">regex</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regexp/">regexp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regular-expression/">regular expression</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-multiple-project-summary-reporting-standard-cctray-xml-feed" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/" class="article-date">
  <time datetime="2013-04-07T00:00:00.000Z" itemprop="datePublished">2013-04-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/continues-integration/">Continues Integration</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/">Multiple Project Summary Reporting Standard - cctray xml feed</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>CCTray.xml is an RSS-like CI server build status xml feed, which is originally developed for CruiseControl.net.<br>ThoughtWorks declared it in a standard called “Multiple Project Summary Reporting Standard”, which now have become some kind of unofficial standard of CI server feed that is widely supported by all kind of popular CI servers.</p>
<p>You can find the feed as described below:</p>
<ul>
<li><a href="http://www.thoughtworks-studios.com/go-continuous-delivery" target="_blank" rel="external">GO</a>  - <a href="http://servername:8154/go/cctray.xml" target="_blank" rel="external">http://servername:8154/go/cctray.xml</a></li>
<li><a href="http://cruisecontrolrb.thoughtworks.com/" target="_blank" rel="external">CruiseControl.rb</a> - <a href="http://cc.rb.servername:3333/XmlStatusReport.aspx" target="_blank" rel="external">http://cc.rb.servername:3333/XmlStatusReport.aspx</a></li>
<li><a href="http://cruisecontrol.sourceforge.net/" target="_blank" rel="external">CruiseControl</a> - <a href="http://cc.java.servername:8080/cctray.xml" target="_blank" rel="external">http://cc.java.servername:8080/cctray.xml</a></li>
<li><a href="http://ccnet.thoughtworks.com/" target="_blank" rel="external">CruiseControl.NET</a> - <a href="http://cc.net.servername/XmlStatusReport.aspx" target="_blank" rel="external">http://cc.net.servername/XmlStatusReport.aspx</a></li>
<li><a href="http://jenkins-ci.org/" target="_blank" rel="external">Jenkins</a> - <a href="http://jenkins.servername:8080/cc.xml" target="_blank" rel="external">http://jenkins.servername:8080/cc.xml</a></li>
<li><a href="https://hudson.dev.java.net/" target="_blank" rel="external">Hudson</a> - <a href="http://hudson.servername:8080/cc.xml" target="_blank" rel="external">http://hudson.servername:8080/cc.xml</a></li>
<li><a href="http://travis-ci.org/" target="_blank" rel="external">Travis CI</a> - <a href="http://travis-ci.org/ownername/repositoryname/cc.xml" target="_blank" rel="external">http://travis-ci.org/ownername/repositoryname/cc.xml</a></li>
<li><a href="https://www.tddium.com/" target="_blank" rel="external">tddium</a> - - <a href="http://api.tddium.com/cc/long_uuid_string/cctray.xml" target="_blank" rel="external">http://api.tddium.com/cc/long_uuid_string/cctray.xml</a></li>
</ul>
<p>And according to <a href="https://github.com/robertmaldon/cc_dashboard" target="_blank" rel="external">cc_dashboard</a>, there are some exceptions that are not included in the document.</p>
<ul>
<li>An additional “Pending” activity</li>
<li>An additional “Unknown” status. I’ve seen Unknown reported by CruiseControl.rb when project builds are serialized (“Configuration.serialize_builds = true” set in .cruise/site_config.rb) and one build is waiting for another build to finish. I’ve seen Unknown reported by Hudson when a project is disabled.</li>
</ul>
<hr>

<p>The following is a patched version of <a href="http://confluence.public.thoughtworks.org/display/CI/Multiple+Project+Summary+Reporting+Standard" target="_blank" rel="external">Multiple Project Summary Reporting Standard</a>.</p>
<h2 id="Multiple-Project-Summary-Reporting-Standard"><a href="#Multiple-Project-Summary-Reporting-Standard" class="headerlink" title="Multiple Project Summary Reporting Standard"></a><a href="http://confluence.public.thoughtworks.org/display/CI/Multiple+Project+Summary+Reporting+Standard" target="_blank" rel="external">Multiple Project Summary Reporting Standard</a></h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>Various Continuous Integration monitoring / reporting tools exist. Examples are:</p>
<ul>
<li><a href="http://confluence.public.thoughtworks.org/display/CCNET/CCTray" target="_blank" rel="external">CruiseControl.NET’s CCTray</a></li>
<li><a href="http://www.md.pp.ru/mozilla/cc/" target="_blank" rel="external">CruiseControl Firefox Plugin</a></li>
<li><a href="http://sourceforge.net/projects/ccmenu/" target="_blank" rel="external">CCMenu for Mac</a></li>
</ul>
<p>These tools work by polling Continuous Integration servers for summary information and presenting it appropriately to users.</p>
<p>If a Continuous Integration server can offer a standard summary format, and a reporting tool can consume the same, then we get interoperability between reporting tools and CI Servers.</p>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Summary information will be available as a plain XML string retrievable through an http GET request.</p>
<p>The format of the XML will be as follows:</p>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>A single <projects> node, the document root, which contains 0 or many <project> node.</project></projects></p>
<p>Each <project> may have the following attributes:</project></p>
<table><br><br>    <tbody><br><br>        <tr><br><br>            <th> name </th><br><br>            <th> description </th><br><br>            <th> type </th><br><br>            <th> required </th><br><br>        </tr><br><br>        <tr><br><br>            <td> name </td><br><br>            <td> The name of the project </td><br><br>            <td> string </td><br><br>            <td> yes </td><br><br>        </tr><br><br>        <tr><br><br>            <td> activity </td><br><br>            <td> The current state of the project </td><br><br>            <td> string enum : Sleeping, Building, CheckingModifications <br clear="all"> </td><br><br>            <td> yes </td><br>        </tr><br><br>        <tr><br><br>            <td> lastBuildStatus </td><br><br>            <td> A brief description of the last build </td><br><br>            <td> string enum : Pending, Success, Failure, Exception, Unknown </td><br><br>            <td> yes </td><br><br>        </tr><br><br>        <tr><br><br>            <td> lastBuildLabel </td><br><br>            <td> A referential name for the last build </td><br><br>            <td> string </td><br><br>            <td> no </td><br><br>        </tr><br><br>        <tr><br><br>            <td> lastBuildTime </td><br><br>            <td> When the last build occurred </td><br><br>            <td> DateTime </td><br><br>            <td> yes </td><br><br>        </tr><br><br>        <tr><br><br>            <td> nextBuildTime </td><br><br>            <td> When the next build is scheduled to occur (or when the next check to see whether a build should be performed is scheduled to occur) </td><br><br>            <td> DateTime </td><br><br>            <td> no </td><br><br>        </tr><br><br>        <tr><br><br>            <td> webUrl </td><br><br>            <td> A URL for where more detail can be found about this project </td><br><br>            <td> string (URL) </td><br><br>            <td> yes </td><br><br>        </tr><br><br>    </tbody><br><br></table>

<p>Clients that consume this XML should not rely on any optional attribute being present, and should degrade their functionality gracefully.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight xml"><figcaption><span>CCTray.xml Sample</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Projects</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Project</span></span></div><div class="line">        <span class="attr">name</span>=<span class="string">"SvnTest"</span></div><div class="line">        <span class="attr">activity</span>=<span class="string">"Sleeping"</span></div><div class="line">        <span class="attr">lastBuildStatus</span>=<span class="string">"Exception"</span></div><div class="line">        <span class="attr">lastBuildLabel</span>=<span class="string">"8"</span></div><div class="line">        <span class="attr">lastBuildTime</span>=<span class="string">"2005-09-28T10:30:34.6362160+01:00"</span></div><div class="line">        <span class="attr">nextBuildTime</span>=<span class="string">"2005-10-04T14:31:52.4509248+01:00"</span></div><div class="line">        <span class="attr">webUrl</span>=<span class="string">"http://mrtickle/ccnet/"</span>/&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">Project</span></span></div><div class="line">        <span class="attr">name</span>=<span class="string">"HelloWorld"</span></div><div class="line">        <span class="attr">activity</span>=<span class="string">"Sleeping"</span></div><div class="line">        <span class="attr">lastBuildStatus</span>=<span class="string">"Success"</span></div><div class="line">        <span class="attr">lastBuildLabel</span>=<span class="string">"13"</span></div><div class="line">        <span class="attr">lastBuildTime</span>=<span class="string">"2005-09-15T17:33:07.6447696+01:00"</span></div><div class="line">        <span class="attr">nextBuildTime</span>=<span class="string">"2005-10-04T14:31:51.7799600+01:00"</span></div><div class="line">        <span class="attr">webUrl</span>=<span class="string">"http://mrtickle/ccnet/"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">Projects</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h3><figure class="highlight xml"><figcaption><span>cctray.xml Schema</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> <span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">xs:schema</span> <span class="attr">elementFormDefault</span>=<span class="string">"qualified"</span> <span class="attr">xmlns:xs</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"Projects"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:complexType</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:sequence</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:element</span> <span class="attr">name</span>=<span class="string">"Project"</span> <span class="attr">maxOccurs</span>=<span class="string">"unbounded"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:complexType</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"xs:NMTOKEN"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"activity"</span> <span class="attr">use</span>=<span class="string">"required"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:simpleType</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:restriction</span> <span class="attr">base</span>=<span class="string">"xs:NMTOKEN"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Sleeping"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Building"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"CheckingModifications"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:restriction</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:simpleType</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:attribute</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"lastBuildStatus"</span> <span class="attr">use</span>=<span class="string">"required"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:simpleType</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:restriction</span> <span class="attr">base</span>=<span class="string">"xs:NMTOKEN"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"pending"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Exception"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Success"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Failure"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:enumeration</span> <span class="attr">value</span>=<span class="string">"Unknown"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:restriction</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:simpleType</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:attribute</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"lastBuildLabel"</span> <span class="attr">type</span>=<span class="string">"xs:NMTOKEN"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"lastBuildTime"</span> <span class="attr">type</span>=<span class="string">"xs:dateTime"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"nextBuildTime"</span> <span class="attr">type</span>=<span class="string">"xs:dateTime"</span> <span class="attr">use</span>=<span class="string">"optional"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">xs:attribute</span> <span class="attr">name</span>=<span class="string">"webUrl"</span> <span class="attr">type</span>=<span class="string">"xs:string"</span> <span class="attr">use</span>=<span class="string">"required"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:element</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:sequence</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:complexType</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:element</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xs:schema</span>&gt;</span></div><div class="line"></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/" data-id="ciqg4g83j004u6nsihr7zaysn" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/04/07/multiple-project-summary-reporting-standard-cctray-xml-feed/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ci/">CI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cctray/">cctray</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/continues-integration/">continues integration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cruise-control/">cruise control</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/feed/">feed</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/go/">go</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jenkins/">jenkins</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/monitor/">monitor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/report/">report</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/standard/">standard</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tray/">tray</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xml/">xml</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-jsonview-chrome-extension-dark-theme" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/03/15/jsonview-chrome-extension-dark-theme/" class="article-date">
  <time datetime="2013-03-15T00:00:00.000Z" itemprop="datePublished">2013-03-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/package/">Package</a>►<a class="article-category-link" href="/categories/package/chrome-extension/">Chrome Extension</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #AA0;"  >
      <a href="http://timnew.me/categories/package/">Package</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/03/15/jsonview-chrome-extension-dark-theme/">JSONView Chrome Extension Dark Theme</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://chrome.google.com/webstore/detail/jsonview/chklaanhfefbnpoihckbnefhakgolnmc" target="_blank" rel="external">JSONView</a> is a very popular JSON formatter for Chrome, which automatically prettifies the JSON content.</p>
<p>JSONView provide a very sweety feature that allow user to customize the css used to format the JSON. And I love dark theme and the Consolas font so much, so I customized my dark own dark theme for JSONView.</p>
<p>Here is my theme css, and you can copy it to your JSONView theme editor to apply.<br>Also you can find code on gist: <a href="https://gist.github.com/timnew/5167241" target="_blank" rel="external">https://gist.github.com/timnew/5167241</a></p>
<img src="/blog/2013/03/15/jsonview-chrome-extension-dark-theme/preview.png" alt="Theme Preview" title="Theme Preview">
<figure class="highlight css"><figcaption><span>Dark Theme for JSONView</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">body</span> &#123;</div><div class="line">  <span class="attribute">white-space</span>: pre;</div><div class="line">  <span class="attribute">font-family</span>: consolas;</div><div class="line">  <span class="attribute">color</span>: white;</div><div class="line">  <span class="attribute">background</span>: black;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.property</span> &#123;</div><div class="line">  <span class="attribute">color</span>: orange;</div><div class="line">  <span class="attribute">font-weight</span>: bold;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.type-null</span> &#123;</div><div class="line">  <span class="attribute">color</span>: gray;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.type-boolean</span> &#123;</div><div class="line">  <span class="attribute">color</span>: orangered;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.type-number</span> &#123;</div><div class="line">  <span class="attribute">color</span>: lightblue;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.type-string</span> &#123;</div><div class="line">  <span class="attribute">color</span>: lightgreen;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">a</span> &#123;</div><div class="line">  <span class="attribute">color</span>: dodgerBlue;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.callback-function</span> &#123;</div><div class="line">  <span class="attribute">color</span>: gray;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.collapser</span><span class="selector-pseudo">:after</span> &#123;</div><div class="line">  <span class="attribute">content</span>: <span class="string">"-"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.collapsed</span> &gt; <span class="selector-class">.collapser</span><span class="selector-pseudo">:after</span> &#123;</div><div class="line">  <span class="attribute">content</span>: <span class="string">"+"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.ellipsis</span><span class="selector-pseudo">:after</span> &#123;</div><div class="line">  <span class="attribute">content</span>: <span class="string">"..."</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.collapsible</span> &#123;</div><div class="line">  <span class="attribute">margin-left</span>: <span class="number">2em</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.hoverable</span> &#123;</div><div class="line">  <span class="attribute">padding</span>: <span class="number">1px</span> <span class="number">2px</span> <span class="number">1px</span> <span class="number">2px</span>;</div><div class="line">  <span class="attribute">border-radius</span>: <span class="number">3px</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.hovered</span> &#123;</div><div class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(255, 255, 255, .3);  </div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.collapser</span> &#123;</div><div class="line">  <span class="attribute">padding-right</span>: <span class="number">6px</span>;</div><div class="line">  <span class="attribute">padding-left</span>: <span class="number">6px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/03/15/jsonview-chrome-extension-dark-theme/" data-id="ciqg4g83f004k6nsihjegcijf" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/03/15/jsonview-chrome-extension-dark-theme/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jsonview/">JSONView</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chrome/">chrome</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/consolas/">consolas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dark/">dark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/extension/">extension</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stylesheet/">stylesheet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/theme/">theme</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-google-glass-isn-t-really-an-enhanced-reality-device" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/" class="article-date">
  <time datetime="2013-02-26T00:00:00.000Z" itemprop="datePublished">2013-02-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/thinking/">Thinking</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #06A;"  >
      <a href="http://timnew.me/categories/thinking/">Thinking</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/">Google Glass isn&#39;t really an enhanced reality device</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Just watched <a href="http://youtu.be/V6Tsrg_EQMw" target="_blank" rel="external">a demo of Google Glass</a>, which provides a close view of the experience of using Google Glass in daily life.<br>Check out the video here:<br><a href="http://youtu.be/V6Tsrg_EQMw" target="_blank" rel="external">http://youtu.be/V6Tsrg_EQMw</a></p>
<p>After watching the video, I found glass behaves a little bit different to my previously understanding, it is could be a disadvantage of Google Glass, and will hurt the experience a lot!</p>
<p>Current design of the display on the Glass is to project the digital image on your right eye from a very close distance, which works like you have a transparent display near you right eye.<br>Since the display it so close to you eye, so the digital image will fall out of focus when you are looking around. When you really want to read something from the Glass, you need to ask your eye to focus on the image, on that time, the world around falls out of your focus!</p>
<p>According to the video, what Google is purchasing is a technology that can interact with user without any distraction, reads, bring the user out of the world. In this point of view, Google Glass is huge improvement comparing to classic digital devices, but is still not perfect!</p>
<p>From the distraction view, this little disadvantage isn’t really hurt the experience of Google Glass, if you feel happy that moving your eyeball on the top right of your view very often. But form enhanced reality point of view, it is a breaking blocker!</p>
<p>The most basic requirement of Enhanced Reality is to overlap the digital image contains descriptive information on the optical view of real world. But for Google Glass, it doesn’t provide a way for people to see the digital view and real world, but it is not simultaneously! Because you cannot see the digital view and surrounding world clearly simultaneously, then it is impossible for Google Glass to overlap the digital image over the optical image.</p>
<p>That’s what I means that <strong>Google Glass isn’t really an Enhanced Reality Device</strong> as a lot of people imagined and expected!</p>
<p>Here are 2 images that explain the idea:</p>
<p><strong> View when you look around </strong><br>The view around is clear, but the map is blur<br><img src="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/optical-view.jpg" alt="View when you look around" title="View when you look around"></p>
<p><strong> View when you read Glass </strong><br>The map become clear, but the view around is blur<br><img src="/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/digital-view.jpg" alt="View when you read Glass" title="View when you read Glass"></p>
<p>To solve this problem, it requires device to detect the focus point of human eye, then adjust the image accordingly in real time. But still now, we don’t have mature technology that can detect the eye focus point and compact enough to built into a wearable device.</p>
<p>But any way, I still believe that Google Glass is an exciting milestone of purchasing real Enhanced Reality technology in human history! It must evolve and incubate a lot of future technologies!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/" data-id="ciqg4g83e004h6nsixcco6mjd" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/02/26/google-glass-isn-t-really-an-enhanced-reality-device/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/enhanced-reality/">enhanced reality</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/focus/">focus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/glass/">glass</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google/">google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/projection/">projection</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-some-tricky-ways-to-calculate-integer-in-javascript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/" class="article-date">
  <time datetime="2013-02-24T00:00:00.000Z" itemprop="datePublished">2013-02-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/">Some tricky ways to calculate integer in javascript</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Javascript is famous for its lack of preciseness, so it always surprises and make joke with the developers by breaking the common sense or instinct.</p>
<p>Javascript doesn’t provide <code>integer</code> type, but in daily life, <code>integer</code> sometimes is necessary, then how can we convert a trim a float number into integer in Javascript?<br>Some very common answers might be <code>Math.floor</code>, <code>Math.round</code> or even <code>parseInt</code>. But besides calling Math functions, is there any other answer?</p>
<p>The answer is bitwise operations. Amazing? Yes. Because bitwise operations are usually only applied to integers, so Javascript will try to convert the <code>number</code> into <code>&quot;integer&quot;</code> internally when a bitwise operation is applied, even it is still represented in type of <code>number</code></p>
<p>Suppose <code>value = 3.1415926</code>, and we want <code>integer</code> is the trimmed value of <code>value</code>, then we can have:</p>
<figure class="highlight js"><figcaption><span>Trim Float Number</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> value = <span class="number">3.1415926</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> integer = <span class="built_in">Math</span>.floor(value);</div><div class="line">integer = <span class="built_in">Math</span>.round(value);</div><div class="line">integer = <span class="built_in">parseInt</span>(value);</div><div class="line">integer = ~~value; <span class="comment">// Bitwise NOT</span></div><div class="line">integer = value | <span class="number">0</span>; <span class="comment">// Bitwise OR</span></div><div class="line">integer = value &lt;&lt; <span class="number">0</span>; <span class="comment">// Left Shift</span></div><div class="line">integer = value &gt;&gt; <span class="number">0</span>; <span class="comment">// Sign-propagating Right Shift</span></div><div class="line">integer = value &gt;&gt;&gt; <span class="number">0</span>; <span class="comment">// Zero-fill Right Shift</span></div><div class="line"></div></pre></td></tr></table></figure>
<p>For more detail information about bitwise operation in javascript, please check out the <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Operators/Bitwise_Operators" target="_blank" rel="external">MDN document</a></p>
<p>All approaches listed before are working, but with different performance. And according to the result from <a href="http://jsperf.com/math-floor-vs-math-round-vs-parseint/42" target="_blank" rel="external">JsPerf</a>, I sort the algorithms by performance from good to bad:</p>
<ol>
<li><code>integer = ~~value;</code></li>
<li><code>integer = value &gt;&gt;&gt; 0;</code> and <code>integer = value &lt;&lt; 0;</code></li>
<li><code>integer = Math.floor(value);</code></li>
<li><code>integer = value &gt;&gt; 0;</code></li>
<li><code>integer = value | 0;</code></li>
<li><code>integer = Math.round(value);</code></li>
<li><code>integer = parseInt(value);</code></li>
</ol>
<p>NOTE: The test cases are running in Chrome 24.0.1312.57 on Mac OS X 10.8.2</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/" data-id="ciqg4g83c004b6nsitt2gpkt4" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/02/24/some-tricky-ways-to-calculate-integer-in-javascript/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bitwise/">bitwise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/calculation/">calculation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/integer/">integer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trick/">trick</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-manage-configuration-in-rails-way-on-node-js-by-using-inheritance" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/" class="article-date">
  <time datetime="2013-02-22T00:00:00.000Z" itemprop="datePublished">2013-02-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/">Manage configuration in Rails way on node.js by using inheritance</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Application is usually required to run in different environments. To manage the differences between the environments, we usually introduce the concept of Environment Specific Configuration.<br>In Rails application, by default, Rails have provided 3 different environments, they are the well known, <code>development</code>, <code>test</code> and <code>production</code>.<br>And we can use the environment variable <code>RAILS_ENV</code> to tell Rails which environment to be loaded, if the <code>RAILS_ENV</code> is not provided, Rails will load the app in <code>development</code> env by default.</p>
<p>This approach is very convenient, so we want to apply it to anywhere. But in node.js, Express doesn’t provide any configuration management. So we need to built the feature by ourselves.</p>
<p>The environment management usually provide the following functionalities:</p>
<ul>
<li>Allow us to provide some configuration values as the default, which will be loaded in all environments, usually we call it <code>common</code>.</li>
<li>Specific configuration will be loaded according to the environment variable, and will override some values in the <code>common</code> if necessary.</li>
</ul>
<p>Rails uses <code>YAML</code> to hold these configurations, which is concise but powerful enough for this purpose. And YAML provided inheritance mechanism by default, so you can reduce the duplication by using inheritance.</p>
<figure class="highlight yaml"><figcaption><span>Inheritance in Rails YAML Configuration</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="attr">development:</span> <span class="meta">&amp;defaults</span></div><div class="line"><span class="attr">  adapter:</span> mysql</div><div class="line"><span class="attr">  encoding:</span> utf8</div><div class="line"><span class="attr">  database:</span> sample_app_development</div><div class="line"><span class="attr">  username:</span> root</div><div class="line"></div><div class="line"><span class="attr">test:</span></div><div class="line">  &lt;&lt;: <span class="meta">*defaults</span></div><div class="line"><span class="attr">  database:</span> sample_app_test</div><div class="line"></div><div class="line"><span class="attr">cucumber:</span></div><div class="line">  &lt;&lt;: <span class="meta">*defaults</span></div><div class="line"><span class="attr">  database:</span> sample_app_cucumber</div><div class="line"></div><div class="line"><span class="attr">production:</span></div><div class="line">  &lt;&lt;: <span class="meta">*defaults</span></div><div class="line"><span class="attr">  database:</span> sample_app_production</div><div class="line"><span class="attr">  username:</span> sample_app</div><div class="line"><span class="attr">  password:</span> secret_word</div><div class="line"><span class="attr">  host:</span> ec2<span class="bullet">-10</span><span class="bullet">-18</span><span class="bullet">-1</span><span class="bullet">-115.</span>us-west<span class="bullet">-2.</span>compute.amazonaws.com</div><div class="line"></div></pre></td></tr></table></figure>
<p>In <code>express</code> and <code>node.js</code>, if we follow the same approach, comparing to <code>YAML</code>, we prefer <code>JSON</code>, which is supported natively by <code>Javascript</code>.<br>But to me, <code>JSON</code> isn’t the best option, there are some disadvantages of <code>JSON</code>:</p>
<ul>
<li>JSON Syntax is not concise enough</li>
<li>Matching the brackets and appending commas to the line end are distractions</li>
<li>Lack of flexility</li>
</ul>
<p>As an answer to these issues, I chose <code>coffee-script</code> instead of <code>JSON</code>.<br><code>Coffee</code> is concise. And similar to <code>YAML</code>, <code>coffee</code> uses indention to indicate the nested level. And <code>coffee</code> is executable, which provides a lot of flexibilities to the configuration. So we can implement a Domain Specific Language form</p>
<p>To do it, we need to solve 4 problems:</p>
<ol>
<li>Allow dev to declare default configuration.</li>
<li>Load specific configuration besides of default one.</li>
<li>Specific configuration can overrides the values in the default one.</li>
<li>Code is concise, clean and reading-friendly.</li>
</ol>
<p>Inspired by the YAML solution, I work out my first solution:</p>
<figure class="highlight coffeescript"><figcaption><span>Configuration in coffee script</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">_ = <span class="built_in">require</span>(<span class="string">'underscore'</span>)</div><div class="line"></div><div class="line">config = &#123;&#125;</div><div class="line"></div><div class="line">config[<span class="string">'common'</span>] =</div><div class="line">  adapter: <span class="string">"mysql"</span></div><div class="line">  encoding: <span class="string">"utf8"</span></div><div class="line">  database: <span class="string">"sample_app_development"</span></div><div class="line">  username: <span class="string">"root"</span></div><div class="line"></div><div class="line">config[<span class="string">'development'</span>] = &#123;&#125;</div><div class="line"></div><div class="line">config[<span class="string">'test] =</span></div><div class="line">  database:"sample_app_test"</div><div class="line"></div><div class="line">config['cucumber<span class="string">'] =</span></div><div class="line">  database:"sample_app_cucumber"</div><div class="line"></div><div class="line">config['production<span class="string">'] =</span></div><div class="line">  database:"sample_app_production"</div><div class="line">  username:"sample_app"</div><div class="line">  password:"secret_word"</div><div class="line">  host:"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</div><div class="line"></div><div class="line">_.extend exports, config.common</div><div class="line"></div><div class="line">specificConfig = config[process.env.NODE_ENV ?'development<span class="string">']</span></div><div class="line"></div><div class="line">if specificConfig?</div><div class="line">  _.extend exports, specificConfig</div><div class="line"></div></pre></td></tr></table></figure>
<p><code>YAML</code> is data centric language, so its inheritance is more like “mixin” another piece of data. So I uses <code>underscore</code> to help me to mixin the specific configuration over the default one, which overrides the overlapped values.</p>
<p>But if we jump out of the YAML’s box, let us think about the <code>Javascript</code> itself, Javascript is a prototype language, which means it had already provide an overriding mechanism natively. Each object inherits and overrides the value from its prototype.<br>So I worked out the 2nd solution:</p>
<figure class="highlight coffeescript"><figcaption><span>Prototype based Configuration</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">config = &#123;&#125;</div><div class="line"></div><div class="line">config[<span class="string">'common'</span>] =</div><div class="line">  adapter: <span class="string">"mysql"</span></div><div class="line">  encoding: <span class="string">"utf8"</span></div><div class="line">  database: <span class="string">"sample_app_development"</span></div><div class="line">  username: <span class="string">"root"</span></div><div class="line"></div><div class="line">config[<span class="string">'development'</span>] = &#123;&#125;</div><div class="line">config[<span class="string">'development'</span>].__proto__ = config[<span class="string">'common'</span>]</div><div class="line"></div><div class="line">config[<span class="string">'test] =</span></div><div class="line">  __proto__: config['common<span class="string">']</span></div><div class="line">  database:"sample_app_test"</div><div class="line"></div><div class="line">config['cucumber<span class="string">'] =</span></div><div class="line">  __proto__: config['test<span class="string">']</span></div><div class="line">  database:"sample_app_cucumber"</div><div class="line"></div><div class="line">config['production<span class="string">'] =</span></div><div class="line">  __proto__: config['common<span class="string">']</span></div><div class="line">  database:"sample_app_production"</div><div class="line">  username:"sample_app"</div><div class="line">  password:"secret_word"</div><div class="line">  host:"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</div><div class="line"></div><div class="line">process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ?'development<span class="string">'</span></div><div class="line"></div><div class="line">module.exports = config[process.env.NODE_ENV]</div><div class="line"></div></pre></td></tr></table></figure>
<p>This approach works, but looks kind of ugly. Since we’re using <code>coffee</code>, which provides the syntax sugar for class and class inheritance.<br>So we have the 3rd version:</p>
<figure class="highlight coffeescript"><figcaption><span>Class based configuration</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ? <span class="string">'development'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span></span></div><div class="line">  adapter: <span class="string">"mysql"</span></div><div class="line">  encoding: <span class="string">"utf8"</span></div><div class="line">  database: <span class="string">"sample_app_development"</span></div><div class="line">  username: <span class="string">"root"</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">development</span> <span class="keyword">extends</span> <span class="title">Config</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">test</span> <span class="keyword">extends</span> <span class="title">Config</span></span></div><div class="line">  database: <span class="string">"sample_app_test"</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">cucumber</span> <span class="keyword">extends</span> <span class="title">Config</span></span></div><div class="line">  database: <span class="string">"sample_app_cucumber"</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>.<span class="title">common</span> <span class="keyword">extends</span> <span class="title">Config</span></span></div><div class="line">  database: <span class="string">"sample_app_production"</span></div><div class="line">  username: <span class="string">"sample_app"</span></div><div class="line">  password: <span class="string">"secret_word"</span></div><div class="line">  host: <span class="string">"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> Config[process.env.NODE_ENV]()</div><div class="line"></div></pre></td></tr></table></figure>
<p>Now the code looks clean, and we can improve it a step further if necessary. We can try to separate the configurations into files, and required by the file name:</p>
<figure class="highlight coffeescript"><figcaption><span>Class based configuration</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># config/config.coffee</span></div><div class="line">configName = process.env.NODE_ENV = process.env.NODE_ENV?.toLowerCase() ? <span class="string">'development'</span></div><div class="line"></div><div class="line">SpecificConfig  = requrie(<span class="string">"./envs/<span class="subst">#&#123;configName&#125;</span>"</span>)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> SpecificConfig()</div><div class="line"></div><div class="line"><span class="comment"># config/envs/commmon.coffee</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Common</span></span></div><div class="line">  adapter: <span class="string">"mysql"</span></div><div class="line">  encoding: <span class="string">"utf8"</span></div><div class="line">  database: <span class="string">"sample_app_development"</span></div><div class="line">  username: <span class="string">"root"</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = Common</div><div class="line"></div><div class="line"><span class="comment"># config/envs/development.coffee</span></div><div class="line">Common = <span class="built_in">require</span>(<span class="string">'./common'</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Development</span> <span class="keyword">extends</span> <span class="title">Common</span></span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = Development</div><div class="line"></div><div class="line"><span class="comment"># config/envs/test.coffee</span></div><div class="line">Common = <span class="built_in">require</span>(<span class="string">'./common'</span>)  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">Common</span></span></div><div class="line">  database: <span class="string">"sample_app_test"</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = Test</div><div class="line"></div><div class="line"><span class="comment"># config/envs/cucumber.coffee</span></div><div class="line">Test = <span class="built_in">require</span>(<span class="string">'./common'</span>)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cucumber</span> <span class="keyword">extends</span> <span class="title">Test</span></span></div><div class="line">  database: <span class="string">"sample_app_cucumber"</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = Cucumber</div><div class="line"></div><div class="line"><span class="comment"># config/envs/production.coffee</span></div><div class="line">Common = <span class="built_in">require</span>(<span class="string">'./common'</span>)  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Production</span> <span class="keyword">extends</span> <span class="title">Common</span></span></div><div class="line">  database: <span class="string">"sample_app_production"</span></div><div class="line">  username: <span class="string">"sample_app"</span></div><div class="line">  password: <span class="string">"secret_word"</span></div><div class="line">  host: <span class="string">"ec2-10-18-1-115.us-west-2.compute.amazonaws.com"</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = Production</div><div class="line"></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/" data-id="ciqg4g83d004e6nsij0bvucv0" class="article-share-link">Share</a>
      
        <a href="http://timnew.me/blog/2013/02/22/manage-configuration-in-rails-way-on-node-js-by-using-inheritance/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/configuration/">configuration</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/environment/">environment</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/express/">express</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/inheritance/">inheritance</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scheme/">scheme</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/archives/2013/">&laquo; __('prev')</a><a class="page-number" href="/archives/2013/">1</a><span class="page-number current">2</span><a class="page-number" href="/archives/2013/blog/3/">3</a><a class="extend next" rel="next" href="/archives/2013/blog/3/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Recent Posts</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Tag Cloud</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Categories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>