<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Mot-clé: pitfall | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/tags/pitfall/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-complex-value-array-in-stylus" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/08/16/complex-value-array-in-stylus/" class="article-date">
  <time datetime="2014-08-16T15:32:38.000Z" itemprop="datePublished">2014-08-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/08/16/complex-value-array-in-stylus/">Complex Value Array in Stylus</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://learnboost.github.io/stylus/" target="_blank" rel="external">Stylus</a> is an awesome CSS pre-processor, which provides much more concise syntax and more powerful feature than its competitors, such as <a href="http://lesscss.org/" target="_blank" rel="external">LESS</a> or <a href="http://sass-lang.com/" target="_blank" rel="external">SCSS</a>.</p>
<p>But now, with more and more features added into <code>Stylus</code>, it seems its syntax become over-weighted. Pitfall come up.</p>
<p>I wish to declare an array of values for <code>box-shadow</code> property. And I can reference them with index:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop-shadows = [</span><br><span class="line">  <span class="number">0</span> <span class="number">2px</span> <span class="number">10px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.16</span>),</span><br><span class="line">  <span class="number">0</span> <span class="number">6px</span> <span class="number">20px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.19</span>),</span><br><span class="line">  <span class="number">0</span> <span class="number">17px</span> <span class="number">50px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.19</span>),</span><br><span class="line">  <span class="number">0</span> <span class="number">25px</span> <span class="number">55px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.21</span>),</span><br><span class="line">  <span class="number">0</span> <span class="number">40px</span> <span class="number">77px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.22</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">drop-shadow</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="attribute">box-shadow</span> shadows[n]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">5</span>)  </span><br><span class="line">  .drop-shadow-&#123;i&#125;</span><br><span class="line">    drop-shadow(i)</span><br></pre></td></tr></table></figure>
<p>And expect it generates</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.drop-shadow-1</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">10px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.16);</span><br><span class="line">&#125;  </span><br><span class="line"><span class="selector-class">.drop-shadow-2</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">6px</span> <span class="number">20px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.19);</span><br><span class="line">&#125;  </span><br><span class="line"><span class="selector-class">.drop-shadow-3</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">17px</span> <span class="number">50px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.19);</span><br><span class="line">&#125;  </span><br><span class="line"><span class="selector-class">.drop-shadow-4</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">25px</span> <span class="number">55px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.21);</span><br><span class="line">&#125;  </span><br><span class="line"><span class="selector-class">.drop-shadow-5</span> &#123;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">40px</span> <span class="number">77px</span> <span class="number">0</span> <span class="built_in">rgba</span>(0, 0, 0, 0.22;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><del>But I found there is not such thing called <code>Array</code> in <code>Stylus</code>!!!!<del><br>There is only <code>Hash</code>, and Hash doesn’t accept number as key!<br>So finally, I come up something like this:</del></del></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">drop-shadows = &#123;</span><br><span class="line">  <span class="string">'1'</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">10px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.16</span>),</span><br><span class="line">  <span class="string">'2'</span>: <span class="number">0</span> <span class="number">6px</span> <span class="number">20px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.19</span>),</span><br><span class="line">  <span class="string">'3'</span>: <span class="number">0</span> <span class="number">17px</span> <span class="number">50px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.19</span>),</span><br><span class="line">  <span class="string">'4'</span>: <span class="number">0</span> <span class="number">25px</span> <span class="number">55px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.21</span>),</span><br><span class="line">  <span class="string">'5'</span>: <span class="number">0</span> <span class="number">40px</span> <span class="number">77px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.22</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">drop-shadow</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="attribute">box-shadow</span> shadows[n+<span class="string">''</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">5</span>)  </span><br><span class="line">  .drop-shadow-&#123;i&#125;</span><br><span class="line">    drop-shadow(i)</span><br></pre></td></tr></table></figure>
<p>In this piece of code, there are a bunch of pitfalls:</p>
<ol>
<li>Hash doesn’t accept number as key. So <code>1: 0 2px 10px 0 rgba(0, 0, 0, 0.16)</code> cause compile error.</li>
<li><code>&#39;1&#39; != 1</code>, so <code>drop-shadows[1]</code> returns <code>null</code></li>
<li>There is no type conversion function in <code>Stylus</code>, use the same trick as <code>JavaScript</code>. <code>&#39;&#39;+n</code> convert <code>n</code> into <code>string</code>.</li>
</ol>
<hr>
<p>Just found <code>Stylus</code> provides something called <code>List</code>, which is pretty much similar to what array in other languages, except the syntax.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drop-shadows = <span class="number">0</span> <span class="number">2px</span> <span class="number">10px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.16</span>),</span><br><span class="line">               <span class="number">0</span> <span class="number">6px</span> <span class="number">20px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.19</span>),</span><br><span class="line">               <span class="number">0</span> <span class="number">17px</span> <span class="number">50px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.19</span>),</span><br><span class="line">               <span class="number">0</span> <span class="number">25px</span> <span class="number">55px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.21</span>),</span><br><span class="line">               <span class="number">0</span> <span class="number">40px</span> <span class="number">77px</span> <span class="number">0</span> rgba(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.22</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">drop-shadow</span><span class="params">(n)</span></span></span><br><span class="line">  <span class="attribute">box-shadow</span> shadows[n]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">5</span>)  </span><br><span class="line">  .drop-shadow-&#123;i&#125;</span><br><span class="line">    drop-shadow(i)</span><br></pre></td></tr></table></figure>
<p>So no brackets or parentesis needed.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/08/16/complex-value-array-in-stylus/" data-id="cinedk74y007zchsig6gk1kpi" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/08/16/complex-value-array-in-stylus/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/array/">array</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/box-shadow/">box-shadow</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/css/">css</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hash/">hash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stylus/">stylus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/workaround/">workaround</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-page-renders-improperly-in-ie-before-developer-tool-has-opened" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/" class="article-date">
  <time datetime="2014-08-01T00:00:00.000Z" itemprop="datePublished">2014-08-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/">Page renders improperly in IE before developer tool has opened</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today I found a super annoying issue about IE. Our website works perfectly in any browser except IE. The page isn’t rendered properly in IE 9. Well, this is common, this is the nature of IE. The mysterious issue I found is that once you opened or ever opened the developer tool, open the page or refresh the page, the problem is gone magically!!!!</p>
<p>As a conclusion, opening the developer tool changes the browser behavior!!!!! What a hell! So you know there is something wrong, but once you try to figure out the error message, you have to open developer tool. Once you open the developer tool, the bug is gone! <strong>DEAD END!!!</strong></p>
<p>Because I cannot open developer tool, so I have to debug with <code>alert</code>. It is really a horrible experience to me, and feels like inspecting nuclear reaction with a plain optical magnifier or fixing a high-tech spacecraft with stones and clubs.</p>
<p>Since it is client-rich page, a lot of javascript is introduced. So I cannot go through the scripts line by line, instead I have to make an assumption to explain the phenomena spotted, then validate it with experiments, finally correct or extend the assumption according the validation result.</p>
<p>During the process I invalidated a couple of assumptions, some of them are seems very close to the “right answer”, such as “some script is loaded and executed before its dependencies, and developer tool load all the scripts first because it displays all the scripts”.</p>
<p>After spending a couple of hours on it, I put on eye on a line of code that is really out of my expectation: <code>console.warn</code>.</p>
<figure class="highlight javascript"><figcaption><span>Code breaks the page rendering</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">console</span>.warn(<span class="string">'__proto__ is not supported by current browser, fallback to hard-copy approach'</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>I displays a warning message to console when a workaround is applied. But a tricky fact about IE 9 is that <code>console</code> isn’t available until developer tool is opened (<a href="http://msdn.microsoft.com/library/ie/bg182326(v=vs.85" target="_blank" rel="external">MSDN reference here</a>))!!!</p>
<p>The fact that console is not available until developer tools is opened really blows my mind away! (Maybe it is because I have little experience work with IE). As a chrome user, I take console as the universal log system for javascript. But in IE, according to the <a href="http://msdn.microsoft.com/library/ie/bg182326(v=vs.85" target="_blank" rel="external">document</a>), the code should check the existence of console every time print a log.</p>
<p>There is another pitfall here, and I saw someone really post it as answer on <a href="http://stackoverflow.com/questions/2656730/internet-explorer-console" target="_blank" rel="external">StackOverflow</a>:</p>
<figure class="highlight javascript"><figcaption><span>Bad polyfill implemntation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">console</span> == <span class="string">"undefined"</span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.console = &#123; log: <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123; alert(msg); &#125; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>We usually access <code>console</code> as <code>console.log</code>, feels like <code>console</code> is a global instance to access. But actually console is an member of <code>window</code>, its full name should be <code>window.console</code>. When <code>console</code> exists, we can definitely reference to it via <code>console</code>. But if it doesn’t exist, the statement <code>console</code> cause script error! So the following code doesn’t work:</p>
<figure class="highlight javascript"><figcaption><span>Pitfalls in console existence check</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span>(<span class="built_in">console</span>) === <span class="string">'undefined'</span>)&#123; <span class="comment">// Break the script execution</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Never got executed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">console</span> != <span class="literal">null</span>) &#123; <span class="comment">// Break the script execution</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Never got executed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">console</span>) &#123; <span class="comment">// Break the script execution</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Never got executed'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.console) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'this works!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>To avoid <code>console</code> issue, a ployfill could be very useful. Here is a great implementation available as <code>bower</code> package: <a href="https://github.com/paulmillr/console-polyfill" target="_blank" rel="external">console-polyfill</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/" data-id="cinedk74j007lchsi4v3zx199" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2014/08/01/page-renders-improperly-in-ie-before-developer-tool-has-opened/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ie/">IE</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/console/">console</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/developer-tool/">developer tool</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/polyfill/">polyfill</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/undefined/">undefined</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mac-os-x-case-insensitive-file-system-pitfall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/" class="article-date">
  <time datetime="2013-04-18T00:00:00.000Z" itemprop="datePublished">2013-04-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/git/">git</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/">Mac OS X case-insensitive file system pitfall</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I was working on the YouTube video playback feature for <a href="http://live-hall.herokuapp.com" target="_blank" rel="external">LiveHall</a> last night, and have it works successfully on my local devbox, which is running Mac OS X. Then I deployed the code to Heroku, without any regression.</p>
<p>But today morning, when I have the demonstrate the new features, I met server error! It says 1 of the 4 javascripts are missing, so the Jade template failed to render.</p>
<p>This is a very wield issue, then I try the same data on my local dev box once again, and it works perfect! But it does yield error on the production!   Then I tried to use heroku toolbelt to run ls command on the production, and I found the there are 4 coffee scripts there.<br>Then I tried to enforce heroku to redeploy the app by using <code>git push --force</code>, but the issue remains!<br>Then I even tried to dive into the dependency pacakges <code>connect-assets</code> and <code>snockets</code>, but still found nothing useful.</p>
<p>Same code, same data, but different result! Very odd issue!</p>
<p>After half an hour fighting against the code, I suddenly noticed I the file name is <code>RevealJSPresenter.coffee</code>, whose “S” is capital S! And I reference the file with name <code>#= require ./presenter/RevealJsPresenter</code>, whose ‘s’ is a lowercase ‘s’!</p>
<p>And <code>snockets</code> depends on the OS feature to locate the file. On my local dev environment, I’m using Mac. Although OS X allow user to explicitly format the HFS+ into file name case sensitive mode, but it is case insensitive by default. So snockets can locate the file even the case is wrong.<br>But once I have deployed to heroku, which, I assume, runs Linux, whose file system is absolutely filename case sensitive. So the snockets won’t be able to locate the file due to the case issue.</p>
<p>To resolve the bug, I renamed my file in RubyMine, then try to commit in terminal.<br>But when I commit, I met another very interesting issue, that git says there is no file changed, so it refused to commit.<br>It is still the same issue, due to FS is case insensitive, git cannot detect the renaming.  </p>
<p>This problem is more common when coding on Windows, but CI or production runs on Linux. And the very common solution is to pull the code in case sensitive environment, then rename the file and commit it.</p>
<p>But I found another more easier way to do it:</p>
<p>Using <code>git mv</code> in terminal to rename the file, which will enforce git to track the file renaming action.</p>
<p>Or</p>
<p>Most of Git GUIs are able to track file name case changing, so you can try to commit the change with the tool, such as RubyMine or SourceTree.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/" data-id="cinedk7340053chsiefre54sj" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/04/18/mac-os-x-case-insensitive-file-system-pitfall/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mac/">Mac</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asset/">asset</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/asset-pipeline/">asset pipeline</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/case-insensitive/">case insensitive</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/connect-assets/">connect-assets</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/file-name/">file name</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/file-system/">file system</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/snockets/">snockets</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-in-matching-line-head-and-line-end-in-regexp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/" class="article-date">
  <time datetime="2013-04-10T00:00:00.000Z" itemprop="datePublished">2013-04-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/regular-expression/">Regular Expression</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/">Pitfall in matching line head and line end in regexp</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I usually uses <code>\^\</code> and <code>\$\</code> to verify user input, e.g:<br>I uses following regexp to verify whether a user input is valid gmail email address:</p>
<figure class="highlight css"><figcaption><span>Matching Gmail</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^<span class="selector-attr">[a-zA-Z_\.]</span>+@<span class="keyword">gmail</span>.<span class="keyword">com</span>$</span><br></pre></td></tr></table></figure>
<p>But in fact it is potentially vulnerable!<br>According to the RegExp document, <code>^</code> and <code>$</code> is matching to <strong>line head</strong> and <strong>line end</strong>!<br>So I might rush into pitfall when user try to fool me with following input:<br><figure class="highlight perl"><figcaption><span>bad input</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"hacker@gmail.com\n&amp;lt;script&amp;gt;alert('bang!')&amp;lt;/script&amp;gt;"</span></span><br></pre></td></tr></table></figure></p>
<p>Since there is a <code>\n</code> in the string, so <code>$</code> won’t really match to the end of the string but actually matched to the <code>\n</code>, then the whole string become a valid input, but actually it isn’t!</p>
<p>To avoid such issue, we should stick to <code>\A</code> and <code>\z</code>, which is literally means the <strong>the beginning of the string</strong> and <strong>end of the string</strong>!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/" data-id="cinedk731004vchsiuzkcqeqa" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/04/10/pitfall-in-matching-line-head-and-line-end-in-regexp/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/line-end/">line end</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/line-head/">line head</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regex/">regex</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regexp/">regexp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/regular-expression/">regular expression</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-in-node-crypto-and-base64-encoding" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/" class="article-date">
  <time datetime="2013-01-30T00:00:00.000Z" itemprop="datePublished">2013-01-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/">Pitfall in node crypto and base64 encoding</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today, we found there is a huge pitfall in node.js crypto module! Decipher has potential problem when processing Base64 encoding.</p>
<p>We’re building RESTful web service based on Node.js, which talks to some other services implemented with Ruby.</p>
<h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><p>In ruby, we use the default <code>Base64</code> class to handle Base64 encoding.</p>
<p><code>Base64#encode64</code> has a very interesting feature:<br>It add <code>line break (\n)</code> to output every 60 characters. This format make the output look pretty and be friendly for human reading:</p>
<figure class="highlight nginx"><figcaption><span>Ruby Base64 Block</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">MSwyLDMsNCw1LDYsNyw4LDksMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgs</span></span><br><span class="line">MTksMjAsMjEsMjIsMjMsMjQsMjUsMjYsMjcsMjgsMjksMzAsMzEsMzIsMzMs</span><br><span class="line">MzQsMzUsMzYsMzcsMzgsMzksNDAsNDEsNDIsNDMsNDQsNDUsNDYsNDcsNDgs</span><br><span class="line">NDksNTAsNTEsNTIsNTMsNTQsNTUsNTYsNTcsNTgsNTksNjAsNjEsNjIsNjMs</span><br><span class="line">NjQsNjUsNjYsNjcsNjgsNjksNzAsNzEsNzIsNzMsNzQsNzUsNzYsNzcsNzgs</span><br><span class="line">NzksODAsODEsODIsODMsODQsODUsODYsODcsODgsODksOTAsOTEsOTIsOTMs</span><br><span class="line">OTQsOTUsOTYsOTcsOTgsOTksMTAw</span><br></pre></td></tr></table></figure>
<p>The <code>Base64#decode64</code> class ignores the <code>line break (\n)</code> when parsing the base64 encoded data, so the <code>line break</code> won’t pollute the data.</p>
<h3 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h3><p>Node.js take <code>Base64</code> as one of the 5 standard encodings (<code>ascii</code>, <code>utf8</code>, <code>base64</code>, <code>binary</code>, <code>hex</code>). Ideally the data or string can be transcoded between these 4 encodings without data loss.</p>
<p>The <code>Buffer</code> class is the simplest way to transcode the data:</p>
<figure class="highlight coffeescript"><figcaption><span>Base64 Encoder in Node.js</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Base64 =</span><br><span class="line">  encode64: <span class="function"><span class="params">(text)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">new</span> Buffer(text, <span class="string">'utf8'</span>).toString(<span class="string">'base64'</span>)</span><br><span class="line"></span><br><span class="line">  decode64: <span class="function"><span class="params">(base64)</span> -&gt;</span></span><br><span class="line">    <span class="keyword">new</span> Buffer(base64. <span class="string">'base64'</span>).toString(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Although <code>encode64</code> function in node.js won’t add <code>line break</code> to the output, but the <code>decode64</code> function does ignore the <code>line break</code> when parsing the data. It keeps the consistent behavior with ruby <code>Base64</code> class, so we can use this <code>decode64</code> function to decode the data from ruby.</p>
<p>Since <code>base64</code> is one of the standard encodings, and some of the node.js API does allow set encoding for input and output. So ideally, we can complete the base64 encoding and decoding during processing the data.<br>It seems Node.js is more convenient comparing to Ruby when dealing with <code>Base64</code>.</p>
<p>e.g. We can combine reading file and base64 encoding the content into one operation by setting the encoding to readFileSync API.</p>
<figure class="highlight coffeescript"><figcaption><span>Write and Read string as Base64</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"></span><br><span class="line">fileName = <span class="string">'./binary.dat'</span> <span class="comment"># this file contains binary data</span></span><br><span class="line">base64 = fs.readFileSync(fileName, <span class="string">'base64'</span>) <span class="comment"># file content has been base64 encoded</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>It looks like we can always use this trick to avoid manually base64 encoding and decoding when the API has encoding parameter! But actually it is not true! There is a BIG pitfall here!</p>
<p>In our real case, we uses <code>crypto</code> module to decrypt the the JSON document that encrypted and base64 encoded by Ruby:</p>
<figure class="highlight coffeescript"><figcaption><span>Base64 Deocde and Decrypt</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"><span class="function"></span><br><span class="line"><span class="title">parse</span> = <span class="params">(data, algorithm, key, iv)</span> -&gt;</span></span><br><span class="line">  decipher = crypto.createDecipheriv(algorithm, key, iv)</span><br><span class="line"></span><br><span class="line">  decrypted = decipher.update(data, <span class="string">'base64'</span>, <span class="string">'utf8'</span>) <span class="comment"># Set input encoding to 'base64' to ask API to base64 decode the input before decryption</span></span><br><span class="line">  decrypted += dechiper.final(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line">  JSON.parse(decrypted)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight coffeescript"><figcaption><span>Manually Base64 Decoding</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>)</span><br><span class="line"><span class="function"></span><br><span class="line"><span class="title">parse</span> = <span class="params">(data, algorithm, key, iv)</span> -&gt;</span></span><br><span class="line">  decipher = crypto.createDecipheriv(algorithm, key, iv)</span><br><span class="line"></span><br><span class="line">  binary = <span class="keyword">new</span> Buffer(data,<span class="string">'base64'</span>) <span class="comment"># Manually Base64 Decode</span></span><br><span class="line"></span><br><span class="line">  decrypted = decipher.update(binary, <span class="string">'binary'</span>, <span class="string">'utf8'</span>) <span class="comment"># Set input encoding to 'binary'</span></span><br><span class="line">  decrypted += dechiper.final(<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line">  JSON.parse(decrypted)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>The previous 2 implementations are very similar except the second one base64 decoded the data manually by using <code>Buffer</code>. Ideally they should be equivalent in behavior. But in fact, they are <strong>NOT</strong> equivalent!</p>
<p>The previous implementation throws “TypeError: DecipherFinal fail”.<br>And the reason is that the shortcut way doesn’t ignore the <code>line break</code>, but <code>Buffer</code> does!!! So in the previous implementation, the data is polluted by the <code>line break</code>!</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>Be careful, when you try to ask the API to base64 decode the data by setting the encoding argument to ‘base64’. It has inconsistent behavior comparing to <code>Buffer</code> class.</p>
<p>I’m not sure whether it is a node.js bug, or it is as is by design. But it is indeed a pitfall that hides so deep. And usually is extremely hard to figure out. Since encrypted binary is hard to human to read, and debugging between 2 languages are also kind of hard!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/" data-id="cinedk72o004dchsitfbp6fek" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2013/01/30/pitfall-in-node-crypto-and-base64-encoding/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/base64/">base64</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/buffer/">buffer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/crypto/">crypto</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/decipher/">decipher</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/encoding/">encoding</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-in-nokogiri-xpath-and-namespace" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/10/25/pitfall-in-nokogiri-xpath-and-namespace/" class="article-date">
  <time datetime="2012-10-25T00:00:00.000Z" itemprop="datePublished">2012-10-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/ruby/">Ruby</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/10/25/pitfall-in-nokogiri-xpath-and-namespace/">Pitfall in Nokogiri XPath and Namespace</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><code>Nokogiri</code> is a really popular Xml and Html library for Ruby. People loves <code>Nokogiri</code> is not just because it is powerful and fast, the most important is its flexible and convenient.<br><code>Nokogiri</code> works perfect in most aspects, but there is a big pitfall when handling the xml namespace!</p>
<p>I met a super weird issue when processing xml returned by Google Data API, and the API returns the following xml document:<br><figure class="highlight xml"><figcaption><span>API response</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></span><br><span class="line"><span class="tag">&lt;<span class="name">feed</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2005/Atom"</span> <span class="attr">xmlns:media</span>=<span class="string">"http://search.yahoo.com/mrss/"</span> <span class="attr">xmlns:yt</span>=<span class="string">"http://gdata.youtube.com/schemas/2007"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">media:group</span>&gt;</span>(...)<span class="tag">&lt;/<span class="name">media:group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">yt:position</span>&gt;</span>1<span class="tag">&lt;/<span class="name">yt:position</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">media:group</span>&gt;</span>(...)<span class="tag">&lt;/<span class="name">media:group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">yt:position</span>&gt;</span>2<span class="tag">&lt;/<span class="name">yt:position</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">media:group</span>&gt;</span>(...)<span class="tag">&lt;/<span class="name">media:group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">yt:position</span>&gt;</span>3<span class="tag">&lt;/<span class="name">yt:position</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">entry</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">media:group</span>&gt;</span>(...)<span class="tag">&lt;/<span class="name">media:group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">yt:position</span>&gt;</span>4<span class="tag">&lt;/<span class="name">yt:position</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">feed</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>I instantiated a <code>Nokogiri::XML</code> DOM with the xml document, and then I try to query the DOM with XPath: <code>xml_dom.xpath &#39;//entry&#39;</code>:</p>
<figure class="highlight ruby"><figcaption><span>Query DOM</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xml_dom = Nokogiri::XML Faraday.get api_url</span><br><span class="line">entries = xml_dom.xpath <span class="string">'//entry'</span></span><br></pre></td></tr></table></figure>
<p>I’m expecting <code>entries</code> is an array with 4 elements, but actually it is empty array. After a few tries, I found the query yields empty array when I introduce the element name in the query.</p>
<figure class="highlight ruby"><figcaption><span>Try Xpath Queries</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xml_dom.xpath <span class="string">'.'</span> <span class="comment"># returns document</span></span><br><span class="line">xml_dom.xapth <span class="string">'//.'</span> <span class="comment"># returns all element nodes</span></span><br><span class="line">xml_dom.xpath <span class="string">'/feed'</span> <span class="comment"># returns empty array</span></span><br><span class="line">xml_dom.xpath <span class="string">'//entry'</span> <span class="comment"># returns empty array</span></span><br><span class="line">xml_dom.xpath <span class="string">'//media:group'</span>, <span class="string">'media'</span> =&gt; <span class="string">'http://search.yahoo.com/mrss/'</span> <span class="comment"># returns 4 the media:group nodes</span></span><br></pre></td></tr></table></figure>
<p>It is super weird.</p>
<p>After half an hour fighting against the Nokogiri, I begin to realize that it must be related to the namespace.<br>And I found that there is an attribute applied to the root element of the document: <code>xmlns=&quot;http://www.w3.org/2005/Atom&quot;</code>, which means all the elements without explicit namespace declaration in the xml dom are under the namespace <code>http://www.w3.org/2005/Atom</code> by default.</p>
<p>And for some reason, the XPath query is namespace sensitive! It requires the <strong>full name</strong> rather than the <strong>local name</strong>, which means we should query the DOM with the code: <code>xml_dom.xpath &#39;//atom:entry&#39;, &#39;atom&#39; =&gt; &#39;http://www.w3.org/2005/Atom&#39;</code>.</p>
<figure class="highlight ruby"><figcaption><span>Fixed XPath Queries</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xml_dom.xpath <span class="string">'.'</span> <span class="comment"># returns document</span></span><br><span class="line">xml_dom.xapth <span class="string">'//.'</span> <span class="comment"># returns all element nodes</span></span><br><span class="line">xml_dom.xpath <span class="string">'/atom:feed'</span>, <span class="string">'atom'</span> =&gt; <span class="string">'http://www.w3.org/2005/Atom'</span> <span class="comment"># returns root node</span></span><br><span class="line">xml_dom.xpath <span class="string">'//atom:entry'</span>, <span class="string">'atom'</span> =&gt; <span class="string">'http://www.w3.org/2005/Atom'</span> <span class="comment"># returns 4 entry nodes</span></span><br><span class="line">xml_dom.xpath <span class="string">'//media:group'</span>, <span class="string">'media'</span> =&gt; <span class="string">'http://search.yahoo.com/mrss/'</span> <span class="comment"># returns 4 the media:group nodes</span></span><br></pre></td></tr></table></figure>
<p>So in a sentence: XPath in <code>Nokogiri</code> doesn’t inherit the default namespace, so when query the DOM with default namespace, we need to explicitly specify the namespace in XPath query. It is really a hidden requirement and is very likely to be ignored by the developers!</p>
<p>So if there is no naming collision issue, it is recommeded to avoid this kind of “silly” issues by removing the namespaces in the DOM. <code>Nokogiri::XML::Document</code> class provides <code>Nokogiri::XML::Document#remove_namespaces!</code> method to achieve this goal.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/10/25/pitfall-in-nokogiri-xpath-and-namespace/" data-id="cinedk72b003schsix9usufe0" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/10/25/pitfall-in-nokogiri-xpath-and-namespace/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/namespace/">namespace</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nokogiri/">nokogiri</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xpath/">xpath</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pitfall-when-return-string-in-via-json-in-rails" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/08/15/pitfall-when-return-string-in-via-json-in-rails/" class="article-date">
  <time datetime="2012-08-15T00:00:00.000Z" itemprop="datePublished">2012-08-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/ruby/">Ruby</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/08/15/pitfall-when-return-string-in-via-json-in-rails/">pitfall when return string in via json in rails</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today we met a weird problem when return a string via json.</p>
<p>Here is the coffee script code:</p>
<figure class="highlight coffeescript"><figcaption><span>Front End</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$.post serverUrl, data, <span class="function"><span class="params">(status)</span> -&gt;</span></span><br><span class="line">	<span class="built_in">console</span>.log status</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>And here is our controller:</p>
<figure class="highlight ruby"><figcaption><span>Backend Action</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action</span></span></span><br><span class="line">	<span class="comment"># do some complex logic</span></span><br><span class="line"></span><br><span class="line">	render <span class="symbol">json:</span> <span class="string">"success"</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Code looks perfect, but we found that the callback is never called! When we check the network traffic, you will found that server does send its response “success”, but the callback is not called!</p>
<p>After spending half an hour to struggle against the jQuery, we finally find the problem!</p>
<p>The reason is that <code>success</code> is not a valid json data! A valid json string should be quoted with “”, or JSON parser will treat it as token, like true or false or nil.</p>
<p>So to fix the problem, we need to change our action code:</p>
<figure class="highlight ruby"><figcaption><span>Fixed Backend Action</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">action</span></span></span><br><span class="line">	<span class="comment"># do some complex logic</span></span><br><span class="line"></span><br><span class="line">	render <span class="symbol">json:</span> <span class="string">'"success"'</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>This is really a pitfall, since the wrong code looks so nature!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/08/15/pitfall-when-return-string-in-via-json-in-rails/" data-id="cinedk722003fchsi8psde448" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/08/15/pitfall-when-return-string-in-via-json-in-rails/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/json/">json</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-pitfall-in-jquery-form-serialization" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/" class="article-date">
  <time datetime="2012-06-21T00:00:00.000Z" itemprop="datePublished">2012-06-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/">A pitfall in jQuery form serialization</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today, I was so surprised that I got an empty string when I call the serialize method on a jQuery wrapped form.<br>The html is written in Haml:</p>
<figure class="highlight haml"><figcaption><span>Html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">form</span><span class="selector-id">#graph-option</span><span class="selector-class">.horizontal-form</span></span></span><br><span class="line"><span class="tag">	%<span class="selector-tag">fieldset</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'start-date'</span>&#125;</span> Start Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#start-date</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'end-date'</span>&#125;</span> End Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#end-date</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">button</span><span class="selector-id">#submit-option</span><span class="selector-class">.btn</span><span class="selector-class">.large-btn</span></span></span><br></pre></td></tr></table></figure>
<p>And the script is written in coffee-script:</p>
<figure class="highlight coffeescript"><figcaption><span>Script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ -&gt;</span><br><span class="line">	$(<span class="string">'#submit-option'</span>).click -&gt;</span><br><span class="line">		option = $(<span class="string">'#graph-option'</span>).serialize()</span><br><span class="line">		$.post <span class="string">'/dashboard/graph'</span>, option, <span class="function"><span class="params">(data)</span> -&gt;</span></span><br><span class="line">			renderCharts data</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>When I execute the script, I got 500 error. And the reason is that the option is empty.<br>I believe this must be caused by a super silly mistake, so I try to call serialize methods on Twitter Bootstrap website, and I still got empty string!!!!</p>
<p>After half an hour debugging, I just realize that I forgot to assign the name to all the input elements. And according to html specification, the browser uses the name of the elements to identify whom the value belongs to.<br>So when the name is omitted, the serailizeArray method in jQuery returns an empty array, as a result, the serialize method returns empty string.</p>
<p>According to my experience, it is easy to identify this problem, if the html is in html-like format, such as erb. But it is really hard to identify this issue if the page is written in haml, because in haml, id is used much more often.<br>To fix this problem, we need to specify the name explicitly for each form element.</p>
<p>Here is the fixed haml code:</p>
<figure class="highlight haml"><figcaption><span>Html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">form</span><span class="selector-id">#graph-option</span><span class="selector-class">.horizontal-form</span></span></span><br><span class="line"><span class="tag">	%<span class="selector-tag">fieldset</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'start-date'</span>&#125;</span> Start Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#start-date</span>&#123; <span class="attr">:name</span>=&gt;<span class="string">'start-date'</span> &#125;</span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'end-date'</span>&#125;</span> End Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#end-date</span>&#123; <span class="attr">:name</span>=&gt;<span class="string">'end-date'</span> &#125;</span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">button</span><span class="selector-id">#submit-option</span><span class="selector-class">.btn</span><span class="selector-class">.large-btn</span></span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/" data-id="cinedk71o002schsia83oa5p0" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/form/">form</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/id/">id</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/name/">name</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/serialization/">serialization</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-name-trap-in-rails" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/06/02/name-trap-in-rails/" class="article-date">
  <time datetime="2012-06-02T00:00:00.000Z" itemprop="datePublished">2012-06-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/ruby/">Ruby</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/06/02/name-trap-in-rails/">Name trap in Rails</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’m a newbie to Rails, and my past few projects are all rails based, including MetaPaas, Recruiting On Rails and current SFP.<br>I was amazed by the convenience of Rails, and also hurt by its “smartness”.<br>The power of Rails was described in quite a lot of posts, so I wanna to share some failure experiences.<br>Actually I have felt into quite a number of pitfalls in Rails, and here is one of the most painful ones.</p>
<p>To explain the problem easier, I just simplify the scenario:<br>I have a model called “Candidate”, which holds a “Status” to store the status of the candidate, so I have the code like this:</p>
<figure class="highlight ruby"><figcaption><span>Candidate and Status</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Candidate</span> &lt; ActiveRecord::Base</span></span><br><span class="line">	has_one status</span><br><span class="line"></span><br><span class="line">	<span class="comment"># other definition</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Status</span> &lt; ActiveRecord::Base</span></span><br><span class="line">	belongs_to candidate</span><br><span class="line"></span><br><span class="line">	<span class="comment"># other definition</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>For some reason, I change the relationship between Candidate and Status. It is changed from one-to-one to one-to-many.<br>So I changed the <code>has_one</code> to <code>has_many</code>:</p>
<figure class="highlight ruby"><figcaption><span>Candidate and Status</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Candidate</span> &lt; ActiveRecord::Base</span></span><br><span class="line">	has_many status</span><br><span class="line"></span><br><span class="line">	<span class="comment"># other definition</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Status</span> &lt; ActiveRecord::Base</span></span><br><span class="line">	belongs_to candidate</span><br><span class="line"></span><br><span class="line">	<span class="comment"># other definition</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>I thought it is an easy modification, but the app fails to run, even I have done the database migration.<br>It said rails cannot find a constant named “Statu”!</p>
<p>After my first sight on this error message, I believed it is caused by a typo, I must mistyped “Status” as “Statu”.<br>So I full-text search the whole project for “Statu”, but I cannot find any.</p>
<p>This error message is quite weird to me, since I have no idea about where the word “Statu” come from!<br>After spent half an hour on pointless trying, I suddenly noticed that the word “status” is end with “s”, and according to Rails’ convention, rails must think “status” is the plural form of “statu”. So according to the convention again, it try to find a class named “Statu”.<br>And we should use the plural form noun as name for one-to-many field, since that holds an array rather than a single object.</p>
<p>So after changing <code>status</code> to <code>statuses</code>, the problem solved.</p>
<p>Convention based system is powerful, a lot magic just happened there. But also the magic things are hard to debug when some special case breaks the convention presumption.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/06/02/name-trap-in-rails/" data-id="cinedk71m002ochsifh28wzh1" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/06/02/name-trap-in-rails/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/active-model/">active model</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/convention/">convention</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/error/">error</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/name/">name</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/rails/">rails</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ruby/">ruby</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trap/">trap</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-space-pitfall-in-coffee-script" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/05/14/space-pitfall-in-coffee-script/" class="article-date">
  <time datetime="2012-05-14T00:00:00.000Z" itemprop="datePublished">2012-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>►<a class="article-category-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/05/14/space-pitfall-in-coffee-script/">Space Pitfall in coffee-script</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Coffee Script had fixed quite a lot of pitfalls in Javascript. But on another hand it also introduced some other pitfalls, the most common one is the space.</p>
<h3 id="Space-in-function-declaration"><a href="#Space-in-function-declaration" class="headerlink" title="Space in function declaration"></a>Space in function declaration</h3><p>Read the following code:</p>
<figure class="highlight coffeescript"><figcaption><span>Show Message:Coffee</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show = message -&gt;</span><br><span class="line">	<span class="built_in">console</span>.log message</span><br><span class="line"></span><br><span class="line">show <span class="string">"space pitfall"</span></span><br></pre></td></tr></table></figure>
<p>This is a quite simple script, but it failed to run. And if you might also feel confused about the error message: “message is not defined”</p>
<p>What happened to the code? We indeed had declared the message as argument of function show. To reveal the answer, we should analyze the compiled javascript.<br>Here is the compiled code:</p>
<figure class="highlight js"><figcaption><span>Show Message:JS</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated by CoffeeScript 1.3.1</span></span><br><span class="line"><span class="keyword">var</span> show;</span><br><span class="line"></span><br><span class="line">show = message(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">console</span>.log(message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">showe(<span class="string">"space pitfall"</span>);</span><br></pre></td></tr></table></figure>
<p>Look the fun declaration, you will see it is not a function declaration as we want but a function call.<br>The reason is that we omitted the parentheses around the argument and we add a new space between <code>message</code> and <code>-&gt;</code>. So the coffee-script compiler interpret message as a function call with a function as parameter.</p>
<p><strong>Soltuion</strong><br>To fix this problem, we can remove the space between <code>message</code> and <code>-&gt;</code> to enforce coffee-script compiler interpret them as a whole.</p>
<figure class="highlight coffeescript"><figcaption><span>Show Message:Fix</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show = message-&gt;</span><br><span class="line">	<span class="built_in">console</span>.log message</span><br><span class="line"></span><br><span class="line">show <span class="string">"space pitfall"</span></span><br></pre></td></tr></table></figure>
<p><strong>Best Practise</strong><br>To avoid this pitfall, my suggestion is never omit the parentheses around the arguments, even there is only one argument.<br>And also including the function call, even coffee-script allow to omit the parentheses. Since you won’t able to chain the method call if you omit the parentheses.<br>So never omit parentheses, unless you are very certain that there is no any ambiguity and you won’t use method chain.</p>
<h3 id="The-space-in-array-index"><a href="#The-space-in-array-index" class="headerlink" title="The space in array index"></a>The space in array index</h3><p>Since coffee script doesn’t support the <a href="#">negative index</a>. So we should use following code as negative index:</p>
<figure class="highlight coffeescript"><figcaption><span>Last Hero:Coffee</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">heros = [<span class="string">"Egeal Eye"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>]</span><br><span class="line">lastHero = heros[heros <span class="number">-1</span>]</span><br><span class="line"><span class="built_in">console</span>.log lastHero</span><br></pre></td></tr></table></figure>
<p>This piece of code is also failed to run, and the error message is “property of object is not a function”.<br>Quite wield right?<br>Let’s see what is behind the scene, here is the compiled code:</p>
<figure class="highlight js"><figcaption><span>Last Hero:JS</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated by CoffeeScript 1.3.1</span></span><br><span class="line"><span class="keyword">var</span> heros, lastHero;</span><br><span class="line"></span><br><span class="line">heros = [<span class="string">"Egeal Eyr"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>];</span><br><span class="line"></span><br><span class="line">lastHero = heros[heros.length(<span class="number">-1</span>)];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(lastHero);</span><br></pre></td></tr></table></figure>
<p>Same problem, <code>heros.length -1</code> is interpreted as <code>heros.length(-1)</code> instead of <code>heros.length -1</code>.<br>To fix this problem, we should write the code in following way:</p>
<figure class="highlight coffeescript"><figcaption><span>Last Hero:Fix1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">heros = [<span class="string">"Egeal Eye"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>]</span><br><span class="line">lastHero = heros[heros - <span class="number">1</span>]</span><br><span class="line"><span class="built_in">console</span>.log lastHero</span><br></pre></td></tr></table></figure>
<p>Or</p>
<figure class="highlight coffeescript"><figcaption><span>Last Hero:Fix2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">heros = [<span class="string">"Egeal Eye"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>]</span><br><span class="line">lastHero = heros[heros<span class="number">-1</span>]</span><br><span class="line"><span class="built_in">console</span>.log lastHero</span><br></pre></td></tr></table></figure>
<p>Both solution is try to enforce the compiler divid the component in correct way.</p>
<p>And unfortunately, there is no way to avoid this problem, the only thing you can do is always be aware the spaces in expression.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/05/14/space-pitfall-in-coffee-script/" data-id="cinedk71c002achsih4gycs1q" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/05/14/space-pitfall-in-coffee-script/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/best-practice/">best-practice</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coffee-script/">coffee-script</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/compile/">compile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/space/">space</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/tags/pitfall/blog/2/">2</a><a class="extend next" rel="next" href="/tags/pitfall/blog/2/">__('next') &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Articles récents</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Nuage de mot-clés</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Catégories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>