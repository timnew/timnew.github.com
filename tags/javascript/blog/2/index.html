<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Mot-clé: javascript | ThoughtWorkshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="timnew programming code software">
<meta property="og:type" content="website">
<meta property="og:title" content="ThoughtWorkshop">
<meta property="og:url" content="http://timnew.me/tags/javascript/blog/2/index.html">
<meta property="og:site_name" content="ThoughtWorkshop">
<meta property="og:description" content="timnew programming code software">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThoughtWorkshop">
<meta name="twitter:description" content="timnew programming code software">
<meta name="twitter:creator" content="@timnew">
<link rel="publisher" href="108780866821209050000">
  
    <link rel="alternate" href="/atom.xml" title="ThoughtWorkshop" type="application/atom+xml">
  
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
<link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196">
<link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<meta name="msapplication-TileColor" content="#00a300">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">

  <!-- <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"> -->
  <link rel="stylesheet" href="/css/style.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-30567867-1', 'auto');

  ga('require', 'displayfeatures');

ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ThoughtWorkshop</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Digital Bigs in my thought</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/#main">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/photos/500px.html">Photos</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://timnew.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-inject-jquery-to-current-page" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/07/19/inject-jquery-to-current-page/" class="article-date">
  <time datetime="2012-07-19T00:00:00.000Z" itemprop="datePublished">2012-07-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/07/19/inject-jquery-to-current-page/">Inject jQuery to current page</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Now I’m hacking some web sites to try to grab the interesting informations from the page. But for some reason, all the sites I’m working on now, doesn’t included jQuery, they uses YUI or extJS, which makes me feel super inconvenient when trying hacking the page pattern.</p>
<p>Do I need to find a way to inject jQuery into the current page that I’m browsing.<br>Thanks to the browser address bar which allow us to execute javascript directly on current session. And also thanks to bookmark, which allow us to persists the script into bookmark, and invoke it with only one mouse click.</p>
<p>So I wrote this:</p>
<script src="//gist.github.com/3137257.js"></script>
<p>With this, we can quickly inject jQuery into current session in no time.</p>
<p>You can drag the following link to your browser favorites bar to:<br><a href="javascript:var%20b=document.body;if(b){void(z=document.createElement('script'));void(z.type='text/javascript');void(z.src='http://code.jquery.com/jquery-1.7.2.min.js');void(b.appendChild(z));}else{}" target="_blank" rel="external">Inject jQuery</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/07/19/inject-jquery-to-current-page/" data-id="cinedk71u0034chsiguuuqdll" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/07/19/inject-jquery-to-current-page/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bookmark/">bookmark</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/browser/">browser</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/execution/">execution</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/inject/">inject</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/">jQuery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/script/">script</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/trick/">trick</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-pitfall-in-jquery-form-serialization" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/" class="article-date">
  <time datetime="2012-06-21T00:00:00.000Z" itemprop="datePublished">2012-06-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/">A pitfall in jQuery form serialization</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today, I was so surprised that I got an empty string when I call the serialize method on a jQuery wrapped form.<br>The html is written in Haml:</p>
<figure class="highlight haml"><figcaption><span>Html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">form</span><span class="selector-id">#graph-option</span><span class="selector-class">.horizontal-form</span></span></span><br><span class="line"><span class="tag">	%<span class="selector-tag">fieldset</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'start-date'</span>&#125;</span> Start Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#start-date</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'end-date'</span>&#125;</span> End Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#end-date</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">button</span><span class="selector-id">#submit-option</span><span class="selector-class">.btn</span><span class="selector-class">.large-btn</span></span></span><br></pre></td></tr></table></figure>
<p>And the script is written in coffee-script:</p>
<figure class="highlight coffeescript"><figcaption><span>Script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ -&gt;</span><br><span class="line">	$(<span class="string">'#submit-option'</span>).click -&gt;</span><br><span class="line">		option = $(<span class="string">'#graph-option'</span>).serialize()</span><br><span class="line">		$.post <span class="string">'/dashboard/graph'</span>, option, <span class="function"><span class="params">(data)</span> -&gt;</span></span><br><span class="line">			renderCharts data</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>When I execute the script, I got 500 error. And the reason is that the option is empty.<br>I believe this must be caused by a super silly mistake, so I try to call serialize methods on Twitter Bootstrap website, and I still got empty string!!!!</p>
<p>After half an hour debugging, I just realize that I forgot to assign the name to all the input elements. And according to html specification, the browser uses the name of the elements to identify whom the value belongs to.<br>So when the name is omitted, the serailizeArray method in jQuery returns an empty array, as a result, the serialize method returns empty string.</p>
<p>According to my experience, it is easy to identify this problem, if the html is in html-like format, such as erb. But it is really hard to identify this issue if the page is written in haml, because in haml, id is used much more often.<br>To fix this problem, we need to specify the name explicitly for each form element.</p>
<p>Here is the fixed haml code:</p>
<figure class="highlight haml"><figcaption><span>Html</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">%<span class="selector-tag">form</span><span class="selector-id">#graph-option</span><span class="selector-class">.horizontal-form</span></span></span><br><span class="line"><span class="tag">	%<span class="selector-tag">fieldset</span></span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'start-date'</span>&#125;</span> Start Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#start-date</span>&#123; <span class="attr">:name</span>=&gt;<span class="string">'start-date'</span> &#125;</span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">label</span>&#123; <span class="attr">:for</span>=&gt;<span class="string">'end-date'</span>&#125;</span> End Date</span><br><span class="line"><span class="tag">		%<span class="selector-tag">select</span><span class="selector-id">#end-date</span>&#123; <span class="attr">:name</span>=&gt;<span class="string">'end-date'</span> &#125;</span></span><br><span class="line"><span class="tag">		%<span class="selector-tag">button</span><span class="selector-id">#submit-option</span><span class="selector-class">.btn</span><span class="selector-class">.large-btn</span></span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/" data-id="cinedk71o002schsia83oa5p0" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/06/21/a-pitfall-in-jquery-form-serialization/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/form/">form</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/id/">id</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jquery/">jquery</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/name/">name</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/serialization/">serialization</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-space-pitfall-in-coffee-script" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/05/14/space-pitfall-in-coffee-script/" class="article-date">
  <time datetime="2012-05-14T00:00:00.000Z" itemprop="datePublished">2012-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>►<a class="article-category-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/05/14/space-pitfall-in-coffee-script/">Space Pitfall in coffee-script</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Coffee Script had fixed quite a lot of pitfalls in Javascript. But on another hand it also introduced some other pitfalls, the most common one is the space.</p>
<h3 id="Space-in-function-declaration"><a href="#Space-in-function-declaration" class="headerlink" title="Space in function declaration"></a>Space in function declaration</h3><p>Read the following code:</p>
<figure class="highlight coffeescript"><figcaption><span>Show Message:Coffee</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show = message -&gt;</span><br><span class="line">	<span class="built_in">console</span>.log message</span><br><span class="line"></span><br><span class="line">show <span class="string">"space pitfall"</span></span><br></pre></td></tr></table></figure>
<p>This is a quite simple script, but it failed to run. And if you might also feel confused about the error message: “message is not defined”</p>
<p>What happened to the code? We indeed had declared the message as argument of function show. To reveal the answer, we should analyze the compiled javascript.<br>Here is the compiled code:</p>
<figure class="highlight js"><figcaption><span>Show Message:JS</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated by CoffeeScript 1.3.1</span></span><br><span class="line"><span class="keyword">var</span> show;</span><br><span class="line"></span><br><span class="line">show = message(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">console</span>.log(message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">showe(<span class="string">"space pitfall"</span>);</span><br></pre></td></tr></table></figure>
<p>Look the fun declaration, you will see it is not a function declaration as we want but a function call.<br>The reason is that we omitted the parentheses around the argument and we add a new space between <code>message</code> and <code>-&gt;</code>. So the coffee-script compiler interpret message as a function call with a function as parameter.</p>
<p><strong>Soltuion</strong><br>To fix this problem, we can remove the space between <code>message</code> and <code>-&gt;</code> to enforce coffee-script compiler interpret them as a whole.</p>
<figure class="highlight coffeescript"><figcaption><span>Show Message:Fix</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show = message-&gt;</span><br><span class="line">	<span class="built_in">console</span>.log message</span><br><span class="line"></span><br><span class="line">show <span class="string">"space pitfall"</span></span><br></pre></td></tr></table></figure>
<p><strong>Best Practise</strong><br>To avoid this pitfall, my suggestion is never omit the parentheses around the arguments, even there is only one argument.<br>And also including the function call, even coffee-script allow to omit the parentheses. Since you won’t able to chain the method call if you omit the parentheses.<br>So never omit parentheses, unless you are very certain that there is no any ambiguity and you won’t use method chain.</p>
<h3 id="The-space-in-array-index"><a href="#The-space-in-array-index" class="headerlink" title="The space in array index"></a>The space in array index</h3><p>Since coffee script doesn’t support the <a href="#">negative index</a>. So we should use following code as negative index:</p>
<figure class="highlight coffeescript"><figcaption><span>Last Hero:Coffee</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">heros = [<span class="string">"Egeal Eye"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>]</span><br><span class="line">lastHero = heros[heros <span class="number">-1</span>]</span><br><span class="line"><span class="built_in">console</span>.log lastHero</span><br></pre></td></tr></table></figure>
<p>This piece of code is also failed to run, and the error message is “property of object is not a function”.<br>Quite wield right?<br>Let’s see what is behind the scene, here is the compiled code:</p>
<figure class="highlight js"><figcaption><span>Last Hero:JS</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Generated by CoffeeScript 1.3.1</span></span><br><span class="line"><span class="keyword">var</span> heros, lastHero;</span><br><span class="line"></span><br><span class="line">heros = [<span class="string">"Egeal Eyr"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>];</span><br><span class="line"></span><br><span class="line">lastHero = heros[heros.length(<span class="number">-1</span>)];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(lastHero);</span><br></pre></td></tr></table></figure>
<p>Same problem, <code>heros.length -1</code> is interpreted as <code>heros.length(-1)</code> instead of <code>heros.length -1</code>.<br>To fix this problem, we should write the code in following way:</p>
<figure class="highlight coffeescript"><figcaption><span>Last Hero:Fix1</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">heros = [<span class="string">"Egeal Eye"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>]</span><br><span class="line">lastHero = heros[heros - <span class="number">1</span>]</span><br><span class="line"><span class="built_in">console</span>.log lastHero</span><br></pre></td></tr></table></figure>
<p>Or</p>
<figure class="highlight coffeescript"><figcaption><span>Last Hero:Fix2</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">heros = [<span class="string">"Egeal Eye"</span>, <span class="string">"XMen"</span>, <span class="string">"American Captain"</span>, <span class="string">"IronMan"</span>]</span><br><span class="line">lastHero = heros[heros<span class="number">-1</span>]</span><br><span class="line"><span class="built_in">console</span>.log lastHero</span><br></pre></td></tr></table></figure>
<p>Both solution is try to enforce the compiler divid the component in correct way.</p>
<p>And unfortunately, there is no way to avoid this problem, the only thing you can do is always be aware the spaces in expression.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/05/14/space-pitfall-in-coffee-script/" data-id="cinedk71c002achsih4gycs1q" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/05/14/space-pitfall-in-coffee-script/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/best-practice/">best-practice</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coffee-script/">coffee-script</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/compile/">compile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/space/">space</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-exports-vs-module-exports-in-node-js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/04/20/exports-vs-module-exports-in-node-js/" class="article-date">
  <time datetime="2012-04-20T00:00:00.000Z" itemprop="datePublished">2012-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/04/20/exports-vs-module-exports-in-node-js/">exports vs module.exports in node.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I was confused about how require function works in node.js for a long time. I found when I require a module, sometimes I can get the object I want, but sometimes, I don’t I just got an empty object, which give an <a href="/blog/2012/03/21/a-way-to-expose-singleton-object-and-its-constructor-in-nodejs">imagination</a> that we cannot export the object by assigning it to exports, but it seems somehow we can export a function by assignment.</p>
<p>Today, I re-read the <a href="http://docs.nodejs.org/api/modules.html#modules_the_module_object" target="_blank" rel="external">document</a> again, and I finally make clear that I misunderstood the “require” mechanism and how I did that.</p>
<p>I clearly remember this sentence in the <a href="http://docs.nodejs.org/api/modules.html#modules_the_module_object" target="_blank" rel="external">doc</a></p>
<blockquote>
<p> In particular <strong>module.exports</strong> is the <strong>same</strong> as the <strong>exports</strong> object.</p>
</blockquote>
<p>So I believed that the exports is just a shortcut alias to module.exports, we can use one instead of another without worrying about the differences between them two.<br>But this understanding is proved to be wrong. exports and module.exports are different.</p>
<p>Today I found this in the <a href="http://docs.nodejs.org/api/modules.html#modules_module_exports" target="_blank" rel="external">doc</a>:</p>
<blockquote>
<p>The <strong>exports</strong> object is <strong>created by</strong> the <strong>Module system</strong>. Sometimes this is <strong>not acceptable</strong>, many want their module to be an instance of some class. <strong>To do this assign the desired export object to module.exports.</strong></p>
</blockquote>
<p>So it says that module.exports is different from exports. And it you exports something by assignment, you need to assign it to module.exports.</p>
<p>Let’s try to understand these sentences deeper by code examples.</p>
<p>In the saying</p>
<blockquote>
<p>The <strong>exports</strong> object is <strong>created by</strong> the <strong>Module system</strong>.</p>
</blockquote>
<p>The word “created by” actually means when node.js try to load a javascript file, before executing any line of code in your file, the module system executes the following code first for you:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> exports = <span class="built_in">module</span>.exports</span><br></pre></td></tr></table></figure>
<p>So the actual interface in node.js’s module system is module object. the actual exported object is <code>module.exports</code> not <code>exports</code>.<br>And the <code>exports</code> is just a normal variable, and there is not “magic” in it. So if you assign something to it, it is replaced absolutely.</p>
<p>That’s why I failed to get the exported object I want when I assign the it to exports variable.</p>
<p>So to export some variable as a whole, we should always assign it to <code>module.exports</code>.<br>And at same time, if there is no good excuse, we’d better to keep the convention that <code>exports</code> is the shortcut alias to <code>module.exports</code>. So we should also assign the module.exports to exports.</p>
<p>As a conclusion, to export something in node.js by assignment, we should always follow the following pattern:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports = <span class="built_in">module</span>.exports = &#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/04/20/exports-vs-module-exports-in-node-js/" data-id="cinedk70q001ochsigwqsu0h4" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/04/20/exports-vs-module-exports-in-node-js/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/exports/">exports</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/module/">module</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-a-way-to-expose-singleton-object-and-its-constructor-in-node-js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/03/21/a-way-to-expose-singleton-object-and-its-constructor-in-node-js/" class="article-date">
  <time datetime="2012-03-21T00:00:00.000Z" itemprop="datePublished">2012-03-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/node-js/">node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/03/21/a-way-to-expose-singleton-object-and-its-constructor-in-node-js/">A way to expose singleton object and its constructor in node.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In <a href="nodejs.org">Node.js</a> world, we usually encapsulate a service into a module, which means the module need to export the façade of the service. In most case the service could be a singleton, all apps use the same service.</p>
<p>But in some rare cases, people might would like to create several instances of the service ,which means the module also need to also export the service constructor.</p>
<p>A very natural idea is to export the default service, and expose the constructor as a method of the default instance. So we could consume the service in this way:</p>
<figure class="highlight js"><figcaption><span>Ideal Usage</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultService = <span class="built_in">require</span>(<span class="string">'service'</span>);</span><br><span class="line"><span class="keyword">var</span> anotherService = service.newService();</span><br></pre></td></tr></table></figure>
<p>So we need to write the module in this way:</p>
<figure class="highlight js"><figcaption><span>Ideal Export</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Service</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> Service();</span><br><span class="line">moudle.exports.newService = Service;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><del>But for some reason, node.js doesn’t allow module to expose object by assigning the a object to module.exports.<br>To export a whole object, it is required to copy all the members of the object to <code>moudle.exports</code>, which drives out all kinds of tricky code.</del><br><ins>I misunderstood how node.js require works, and <a href="/blog/2012/04/20/exports_vs_module_exports_in_node_js">HERE</a> is the right understanding. Even I misunderstood the mechanism, but the conclusion of this post is still correct. To export function is still a more convenient way to export both default instance and the constructor.</ins></p>
<p>And things can become much worse when there are backward reference from the object property to itself.<br>So to solve this problem gracefully, we need to change our mind.<br>Since it is proved that it is tricky to export a object, can we try to expose the constructor instead?</p>
<p>Then answer is yes. And Node.js does allow we to assign a function to the module.exports to exports the function.<br>So we got this code.</p>
<figure class="highlight js"><figcaption><span>Export Constructor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Service</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"><span class="built_in">module</span>.exports = Service;</span><br></pre></td></tr></table></figure>
<p>So we can use create service instance in this way:</p>
<figure class="highlight js"><figcaption><span>Create Service</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Service = <span class="built_in">require</span>(<span class="string">'service'</span>);</span><br><span class="line"><span class="keyword">var</span> aService = <span class="keyword">new</span> Service();</span><br></pre></td></tr></table></figure>
<p>As you see, since the one we exported is constructor so we need to create a instance manually before we can use it. Another problem is that we lost the shared instance between module users, and it is a common requirement to share the same service instance between users.</p>
<p>How to solve this problem? Since as we know, function is also kind of object in javascript, so we can kind of add a member to the constructor called default, which holds the shared instance of the service.</p>
<p>This solution works but not in a graceful way! A crazy but fancy idea is that can we transform the constructor itself into kind of singleton instance??!! Which means you can do this:</p>
<figure class="highlight js"><figcaption><span>Export Singleton</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> defaultService = <span class="built_in">require</span>(<span class="string">'service'</span>);</span><br><span class="line">defaultService.foo();</span><br><span class="line"><span class="keyword">var</span> anotherService = service();</span><br><span class="line">anotherService.foo();</span><br></pre></td></tr></table></figure>
<p>The code style looks familiar? Yes, jQuery, and many other well-designed js libraries are designed to work in this way.<br>So our idea is kind of feasible but how?</p>
<p>Great thank to Javascript’s prototype system (or maybe SELF’s prototype system is more accurate.), we can simply make a service instance to be the constructor’s prototype.</p>
<figure class="highlight js"><figcaption><span>Actual Export</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Service</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"><span class="built_in">module</span>.exports = Service;</span><br><span class="line">Service.__proto__ = <span class="keyword">new</span> Serivce;</span><br></pre></td></tr></table></figure>
<p>Sounds crazy, but works, and gracefully! That’s the beauty of Javascript.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/03/21/a-way-to-expose-singleton-object-and-its-constructor-in-node-js/" data-id="cinedk7080012chsiqbn2l0oq" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/03/21/a-way-to-expose-singleton-object-and-its-constructor-in-node-js/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/exports/">exports</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js-hack/">js hack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/module/">module</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pattern/">pattern</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/singleton/">singleton</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-enhanced-typeof-operator-in-javascript" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/03/18/enhanced-typeof-operator-in-javascript/" class="article-date">
  <time datetime="2012-03-18T00:00:00.000Z" itemprop="datePublished">2012-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">Programming</a>►<a class="article-category-link" href="/categories/programming/javascript/">JavaScript</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #40A;"  >
      <a href="http://timnew.me/categories/programming/">Programming</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/03/18/enhanced-typeof-operator-in-javascript/">Enhanced typeof() operator in JavaScript</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Javascript is weakly typed, and its type system always behaves different than your expectation.<br>Javascript provide typeof operator to test the type of a variable. it works fine generally. e.g.</p>
<figure class="highlight javascript"><figcaption><span>typeof default behaviors</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typeof</span>(<span class="number">1</span>) === <span class="string">'number'</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="string">'hello'</span>) === <span class="string">'string'</span></span><br><span class="line"><span class="keyword">typeof</span>(&#123;&#125;) === <span class="string">'object'</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;) === <span class="string">'function'</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>But it is not enough, it behaves stupid when you dealing with objects created by constructors. e.g.<br>if you expected<br><figure class="highlight javascript"><figcaption><span>Expected typeof behavior against object</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span>(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2012-12-12'</span>)) === <span class="string">'date'</span> <span class="comment">// Returns false</span></span><br></pre></td></tr></table></figure><br>Then you must be disappointed, since actually<br><figure class="highlight javascript"><figcaption><span>Actual typeof behavior against object</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typeof</span>(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2012-12-12'</span>)) === <span class="string">'object'</span> <span class="comment">// Returns true</span></span><br></pre></td></tr></table></figure><br>Yes, when you apply <code>typeof()</code> operator on any objects, it just yield the general type “object” rather than the more meaningful type “date”.</p>
<p>How can we make the <code>typeof()</code> operator works in the way as we expected?<br>As we know when we create a object, the special property of the object constructor will be set to the function that create the object. which means:</p>
<figure class="highlight javascript"><figcaption><span>Get constructor property of object</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2012-1-1'</span>)).constructor <span class="comment">// Returns [Function Date]</span></span><br></pre></td></tr></table></figure>
<p>So ideally we can retrieve the name of the function as the type of the variable. And to be compatible with javascript’s native operator, we need to convert the name to lower case. So we got this expression:</p>
<figure class="highlight javascript"><figcaption><span>Simulate typeof operator behavior with constructor property</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">typeOf</span>(<span class="params">obj</span>) </span>&#123; <span class="comment">// Use capital O to differentiate this function from typeof operator</span></span><br><span class="line">	<span class="keyword">return</span> obj ? obj.constructor.name.toLowerCase() : <span class="keyword">typeof</span>(obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">typeOf(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2012-1-1'</span>)) === <span class="string">'date'</span> <span class="comment">// Returns true</span></span><br></pre></td></tr></table></figure>
<p>And luckily, we can also apply this to other primitive types, e.g:</p>
<figure class="highlight javascript"><figcaption><span>Apply typeOf to primitive types</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typeOf(<span class="number">123</span>) === <span class="string">'number'</span>; <span class="comment">// Returns true</span></span><br><span class="line">typeOf(<span class="string">'hello'</span>) === <span class="string">'string'</span>; <span class="comment">// Returns true</span></span><br><span class="line">typeOf(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;) === <span class="string">'function'</span>;  <span class="comment">// Returns true</span></span><br></pre></td></tr></table></figure>
<p>or even</p>
<figure class="highlight javascript"><figcaption><span>Apply typeOf to anonymous object</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeOf(&#123;&#125;) === <span class="string">'object'</span>; <span class="comment">// Returns true</span></span><br></pre></td></tr></table></figure>
<p>So in general, we use this expression as new implementation of the <code>typeof()</code> operator! <strong>EXCEPT One case</strong>!</p>
<p>If someone declare the object constructor in this way, our new <code>typeof()</code> implementation will work improperly!</p>
<figure class="highlight javascript"><figcaption><span>Closure encapsulated anonymous constructor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SomeClass = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.someProperty=<span class="string">'some value'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>or even define the constructor like this</p>
<figure class="highlight javascript"><figcaption><span>Anonymous Closure</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SomeClass = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.someProperty = <span class="string">'some value'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And we will find that</p>
<figure class="highlight javascript"><figcaption><span>Apply typeOf to object instantiated by anonymous constructor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typeOf(<span class="keyword">new</span> SomeClass) === <span class="string">''</span>; <span class="comment">// Returns true</span></span><br></pre></td></tr></table></figure>
<p>the reason behind this is because the real constructor of the SomeClass is actually an anonymous function, whose name is not set.</p>
<p>To solve this problem, we need to declare the name of the constructor:</p>
<figure class="highlight javascript"><figcaption><span>Closure encapsulated named constructor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SomeClass = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">SomeClass</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.someProperty=<span class="string">'some value'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>or even define the constructor like this</p>
<figure class="highlight javascript"><figcaption><span>Named constructor</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> SomeClass = <span class="function"><span class="keyword">function</span> <span class="title">SomeClass</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.someProperty = <span class="string">'some value'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/03/18/enhanced-typeof-operator-in-javascript/" data-id="cinedk6zw0010chsirj0a326c" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/03/18/enhanced-typeof-operator-in-javascript/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fix/">fix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js/">js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/js-hack/">js hack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pitfall/">pitfall</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/type/">type</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typeof/">typeof</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-make-javascript-node-tmbundle-works-with-textmate-under-node-js-0-6-5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/03/12/make-javascript-node-tmbundle-works-with-textmate-under-node-js-0-6-5/" class="article-date">
  <time datetime="2012-03-12T00:00:00.000Z" itemprop="datePublished">2012-03-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/practice/">Practice</a>►<a class="article-category-link" href="/categories/practice/textmate/">TextMate</a>
  </div>

  </div>
  <div class="article-inner">
    
  
  <div class="ribbon-wrapper relative right">
    <div class="ribbon "  style="background-color: #0A3;"  >
      <a href="http://timnew.me/categories/practice/">Practice</a>
    </div>
  </div>


    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/03/12/make-javascript-node-tmbundle-works-with-textmate-under-node-js-0-6-5/">Make javascript node.tmbundle works with TextMate under node.js 0.6.5</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I downloaded the <a href="https://github.com/drnic/javascript-node.tmbundle" target="_blank" rel="external">TextMate bundle for node.js</a>.<br>But this bundle doesn’t work properly.<br>When i clicked cmd+R to run javascript, it reports that it cannot get variable “TM_FILE” from undefined.<br>And the console output contains a warning that module “sys” is renamed as “util”.</p>
<p>To fix this two issues:<br>Some fix these 2 issues, some modification to command script is needed:  </p>
<ol>
<li>Open Command Editor in TextMate, and edit the command script of “Run File or Spec” under “JavaScript Node” category:</li>
<li>Change <code>var sys = require(&quot;sys&quot;);</code> to <code>var sys = require(&quot;util&quot;);</code> to fix the warning.</li>
<li>Replace all instances of <code>process.ENV.</code> with <code>process.env</code>.</li>
</ol>
<p>After modification, close the Bundle Editor. Then ask TextMate to reload all the bundles.<br>Then the command will work perfectly now.</p>
<hr>
<p>There is another Trick, since there had been a bundle called javascript in TextMate. So this node js bundle doesn’t activated when you editing .js file.<br>You need to press ctrl + alt + n to activate the bundle manually.</p>
<p>This problem can be fixed by changing scope selector of all the snippets and commands. You can change it from “source.js.node” to “source.js”</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://timnew.me/blog/2012/03/12/make-javascript-node-tmbundle-works-with-textmate-under-node-js-0-6-5/" data-id="cinedk6zu000wchsizz23z2zz" class="article-share-link">Partager</a>
      
        <a href="http://timnew.me/blog/2012/03/12/make-javascript-node-tmbundle-works-with-textmate-under-node-js-0-6-5/#disqus_thread" class="article-comment-link">Commentaires</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bundle/">bundle</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node-js/">node.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/textmate/">textmate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tmbundle/">tmbundle</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/tags/javascript/">&laquo; __('prev')</a><a class="page-number" href="/tags/javascript/">1</a><span class="page-number current">2</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    <div class="widget-wrap"><h3 class="widget-title">About Me</h3><div class="widget self-intro"><img src="/images/avatar.png"/><p>Tim is</p><ul class="description"><li>a<span>geek</span></li><li>an spare-time<span>web developer</span></li><li>a part-time<span>mobile developer</span></li><li>a night-time<span>photographer</span></li><li>an early-time<span>pcb solderer</span></li></ul><ul class="social-links"><li><a href="https://linkedin.com/in/timwen" target="_blank" class="linked-in"></a></li><li><a href="https://twitter.com/timnew" target="_blank" class="twitter"></a></li><li><a href="https://github.com/timnew" target="_blank" class="github"></a></li></ul></div></div>
  
    
  <div class="widget-wrap">
    <a href="/posts">
      <h3 class="widget-title">Articles récents</h3>
    </a>
    <div class="widget recent-posts">
      <ul>
        
          <li>
            <a href="/blog/2016/04/23/collection-filtering-algorithm-with-bit-operation-part-1/">Collection Filtering Algorithm with Bit Operation - Part.1</a>
          </li>
        
          <li>
            <a href="/blog/2015/08/14/a-clean-way-to-test-rejected-promise/">A clean way to test rejected promise</a>
          </li>
        
          <li>
            <a href="/blog/2014/12/06/typical-eventbus-design-patterns/">Typical EventBus Design Patterns</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/09/understand-styles-in-android-part-1-what-it-is-for-and-how-to-used-it/">Understand Styles in Android - Part 1. What it is for and how to used it</a>
          </li>
        
          <li>
            <a href="/blog/2014/11/07/walkthrough-untrusted-the-continuing-adventures-of-dr-eval/">Walkthrough: Untrusted - the Continuing Adventures of Dr. Eval</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/tags">
      <h3 class="widget-title">Nuage de mot-clés</h3>
    </a>
    <div class="widget tagcloud">
      <a href="/tags/net/" style="font-size: 10px;">.net</a> <a href="/tags/alfred/" style="font-size: 10px;">Alfred</a> <a href="/tags/algorithm/" style="font-size: 10px;">Algorithm</a> <a href="/tags/android/" style="font-size: 20px;">Android</a> <a href="/tags/android-studio/" style="font-size: 10px;">Android Studio</a> <a href="/tags/automation/" style="font-size: 10px;">Automation</a> <a href="/tags/binary/" style="font-size: 10px;">Binary</a> <a href="/tags/bit-operation/" style="font-size: 10px;">Bit Operation</a> <a href="/tags/bit-slicer/" style="font-size: 10px;">Bit Slicer</a> <a href="/tags/bloom-filter/" style="font-size: 10px;">Bloom Filter</a> <a href="/tags/boilerplate/" style="font-size: 10px;">Boilerplate</a> <a href="/tags/c/" style="font-size: 20px;">C#</a> <a href="/tags/ci/" style="font-size: 15px;">CI</a> <a href="/tags/css/" style="font-size: 10px;">CSS</a> <a href="/tags/cheat/" style="font-size: 10px;">Cheat</a> <a href="/tags/cheat-engine/" style="font-size: 10px;">Cheat Engine</a> <a href="/tags/class/" style="font-size: 10px;">Class</a> <a href="/tags/cocoa/" style="font-size: 10px;">Cocoa</a> <a href="/tags/collection/" style="font-size: 10px;">Collection</a> <a href="/tags/command/" style="font-size: 10px;">Command</a> <a href="/tags/continues-delivery/" style="font-size: 10px;">Continues Delivery</a> <a href="/tags/continues-integration/" style="font-size: 10px;">Continues Integration</a> <a href="/tags/crack/" style="font-size: 10px;">Crack</a> <a href="/tags/d/" style="font-size: 10px;">D</a> <a href="/tags/debugger/" style="font-size: 10px;">Debugger</a> <a href="/tags/deploy/" style="font-size: 10px;">Deploy</a> <a href="/tags/deployment/" style="font-size: 10px;">Deployment</a> <a href="/tags/design/" style="font-size: 10px;">Design</a> <a href="/tags/design-pattern/" style="font-size: 10px;">Design Pattern</a> <a href="/tags/event/" style="font-size: 10px;">Event</a>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/categories">
      <h3 class="widget-title">Catégories</h3>
    </a>
    <div class="widget category-list">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/">Cracking</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cracking/game/">Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">Design</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/visual/">Visual</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/web/">Web</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/game/">Game</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/game/programming-game/">Programming Game</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/geek-toy/">Geek Toy</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/">Package</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/package/chrome-extension/">Chrome Extension</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/package/hexo/">Hexo</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/">Practice</a><span class="category-list-count">22</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/practice/atom/">Atom</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/continues-integration/">Continues Integration</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/devops/">DevOps</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/hexo/">Hexo</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/mac/">Mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/shell/">Shell</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/textmate/">TextMate</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/windows/">Windows</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/practice/git/">git</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">Programming</a><span class="category-list-count">73</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/algorithm/">Algorithm</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/arduino/">Arduino</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/c/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/chrome/">Chrome</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/design-patterns/">Design Patterns</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/">JavaScript</a><span class="category-list-count">8</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/programming/javascript/coffeescript/">CoffeeScript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/postgressql/">PostgresSql</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/powershell/">PowerShell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/regular-expression/">Regular Expression</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/ruby/">Ruby</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/wpf/">WPF</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/web/">Web</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/node-js/">node.js</a><span class="category-list-count">10</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/thinking/">Thinking</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <a href="/archives">
      <h3 class="widget-title">Archives</h3>
    </a>
    <div class="widget archive-list">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10/">October 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08/">August 2012</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/04/">April 2012</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 TimNew<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/#main" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/photos/500px.html" class="mobile-nav-link">Photos</a>
  
</nav>
    
<script>
  var disqus_shortname = 'timnew-github';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>